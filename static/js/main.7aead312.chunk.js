(this["webpackJsonpclient-2"]=this["webpackJsonpclient-2"]||[]).push([[0],{161:function(e,t,n){e.exports=n.p+"static/media/person.c998eae2.svg"},22:function(e,t,n){"use strict";var r=n(6),i=n(7),a=n(9),o=function(){function e(){Object(r.a)(this,e),this.skylinkEventManager=a.b,this.evts={candidate:[a.c.CANDIDATE_PROCESSING_STATE,a.c.CANDIDATE_GENERATION_STATE,a.c.CANDIDATES_GATHERED,a.c.ICE_CONNECTION_STATE,a.c.DATA_STREAM_STATE,a.c.DATA_STREAM_STATE,a.c.DATA_TRANSFER_STATE],dataTransfer:[a.c.CANDIDATE_GENERATION_STATE,a.c.CANDIDATES_GATHERED,a.c.ICE_CONNECTION_STATE,a.c.DATA_STREAM_STATE,a.c.DATA_TRANSFER_STATE],dataChannel:[a.c.ON_INCOMING_DATA,a.c.ON_INCOMING_DATA_REQUEST,a.c.ON_INCOMING_DATA_STREAM,a.c.ON_INCOMING_DATA_STREAM_STARTED,a.c.ON_INCOMING_DATA_STREAM_STOPPED,a.c.DATA_CHANNEL_STATE,a.c.ON_INCOMING_MESSAGE],media:[a.c.MEDIA_ACCESS_FALLBACK,a.c.MEDIA_ACCESS_REQUIRED,a.c.MEDIA_ACCESS_STOPPED,a.c.MEDIA_ACCESS_SUCCESS,a.c.RECORDING_STATE,a.c.RTMP_STATE,a.c.LOCAL_MEDIA_MUTED,a.c.MEDIA_ACCESS_ERROR],peer:[a.c.PEER_UPDATED,a.c.PEER_JOINED,a.c.PEER_LEFT,a.c.PEER_RESTART,a.c.SERVER_PEER_JOINED,a.c.SERVER_PEER_LEFT,a.c.SERVER_PEER_RESTART,a.c.GET_PEERS_STATE_CHANGE,a.c.PEER_CONNECTION_STATE,a.c.SESSION_DISCONNECT,a.c.GET_CONNECTION_STATUS_STATE_CHANGE],peerHandshake:[a.c.HANDSHAKE_PROGRESS,a.c.INTRODUCE_STATE_CHANGE],room:[a.c.ROOM_LOCK,a.c.BYE],socket:[a.c.CHANNEL_OPEN,a.c.CHANNEL_CLOSE,a.c.CHANNEL_ERROR,a.c.CHANNEL_MESSAGE,a.c.CHANNEL_RETRY,a.c.SOCKET_ERROR,a.c.SYSTEM_ACTION],stream:[a.c.ON_INCOMING_STREAM,a.c.ON_INCOMING_SCREEN_STREAM,a.c.STREAM_ENDED,a.c.STREAM_MUTED]},this.registeredEvts=null}return Object(i.a)(e,[{key:"initRegisterEvtLoggers",value:function(){this.registeredEvts={candidate:!1,dataTransfer:!1,dataChannel:!1,media:!1,peer:!1,peerHandshake:!1,room:!1,socket:!1,stream:!1,allEvts:!1}}},{key:"registerAllEvents",value:function(){var t=this;this.evts.candidate.forEach((function(n){t.skylinkEventManager.addEventListener(n,e.evtLogger),t.registeredEvts.candidate=!0})),this.evts.dataTransfer.forEach((function(n){t.skylinkEventManager.addEventListener(n,e.evtLogger),t.registeredEvts.dataTransfer=!0})),this.evts.dataChannel.forEach((function(n){t.skylinkEventManager.addEventListener(n,e.evtLogger),t.registeredEvts.dataChannel=!0})),this.evts.media.forEach((function(n){t.skylinkEventManager.addEventListener(n,e.evtLogger),t.registeredEvts.media=!0})),this.evts.peer.forEach((function(n){t.skylinkEventManager.addEventListener(n,e.evtLogger),t.registeredEvts.peer=!0})),this.evts.peerHandshake.forEach((function(n){t.skylinkEventManager.addEventListener(n,e.evtLogger),t.registeredEvts.peerHandshake=!0})),this.evts.room.forEach((function(n){t.skylinkEventManager.addEventListener(n,e.evtLogger),t.registeredEvts.room=!0})),this.evts.socket.forEach((function(n){t.skylinkEventManager.addEventListener(n,e.evtLogger),t.registeredEvts.socket=!0})),this.evts.stream.forEach((function(n){t.skylinkEventManager.addEventListener(n,e.evtLogger),t.registeredEvts.stream=!0})),this.registeredEvts.allEvts=!0,e.logToConsole("demoLoggerHelper","All evts","registered")}},{key:"isAllEvtsRegistered",value:function(){var e=!0,t=this.registeredEvts;return Object.keys(t).forEach((function(n){t[n]||"allEvts"===n||(e=!1)})),e}},{key:"registerOrUnregisterEvts",value:function(t){var n=this;"allEvts"!==t?this.registeredEvts[t]?(this.evts[t].forEach((function(t){n.skylinkEventManager.removeEventListener(t,e.evtLogger)})),e.logToConsole("demoLoggerHelper","".concat(t," evts"),"unregistered"),this.registeredEvts[t]=!1,this.registeredEvts.allEvts=this.isAllEvtsRegistered()):this.registeredEvts[t]||(this.evts[t].forEach((function(t){n.skylinkEventManager.addEventListener(t,e.evtLogger)})),e.logToConsole("demoLoggerHelper","".concat(t," evts"),"registered"),this.registeredEvts[t]=!0,this.registeredEvts.allEvts=this.isAllEvtsRegistered()):this.registerAllEvents()}}],[{key:"logToConsole",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"METHOD",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3?arguments[3]:void 0;r?console.error("SKYLINK DEMO - [".concat(e,"]"),r):console.log("SKYLINK DEMO - [".concat(e,"] [").concat(t,"] --\x3e"),n)}},{key:"evtLogger",value:function(t){var n=t.detail;e.logToConsole(t.type,"EVT",n)}}]),e}();t.a=o},244:function(e,t,n){"use strict";(function(e){var r=n(27),i=n(6),a=n(7),o=n(25),s=n(24),d=n(12),c=n(26),l=n(0),u=n.n(l),S=n(270),E=n(19),g=n(493),p=n(37),f=n(42),m=n(120),R=n(122),h=n(271),v=n(121),I=n(492),O=n(161),T=n.n(O),A=n(9),C=n(22),_={appKey:"d6e761f0-d8bd-4bc1-b033-de2d6a5e9eca",defaultRoom:"skylinkRoom",enableIceTrickle:!0,enableDataChannel:!0,forceSSL:!0};A.d.setLevel(A.d.logLevels.DEBUG);var N=function(t){function n(t){var r;return Object(i.a)(this,n),r=Object(o.a)(this,Object(s.a)(n).call(this,t)),e.Skylink=A.e,r.skylink=new A.e(_),e.SkylinkDemo=r.skylink,r.skylinkEventManager=A.b,r.demoLoggerHelper=new C.a,r.demoLoggerHelper.initRegisterEvtLoggers(),r.state={hongkong:{username:"",newUsername:"",peerId:"",inRoom:!1,showLoader:!1,message:"",messages:[],title:"Hong Kong",remotePeers:[],selectedPeers:[],messageChannel:"P2P",roomLocked:!1,streamMuted:{videoMuted:!1,audioMuted:!1}},singapore:{username:"",peerId:"",inRoom:!1,showLoader:!1,message:"",messages:[],title:"Singapore",remotePeers:[],selectedPeers:[],messageChannel:"P2P",roomLocked:!1,streamMuted:{videoMuted:!1,audioMuted:!1}},newyork:{username:"",peerId:"",inRoom:!1,showLoader:!1,message:"",messages:[],title:"New York",remotePeers:[],selectedPeers:[],messageChannel:"P2P",roomLocked:!1,streamMuted:{videoMuted:!1,audioMuted:!1}},registeredEvts:r.demoLoggerHelper.registeredEvts},r.toggleEvt=r.toggleEvt.bind(Object(d.a)(r)),r.prefetchedStream=null,r.localFeedRef=u.a.createRef(),r.joinRoom=r.joinRoom.bind(Object(d.a)(r)),r.leaveRoom=r.leaveRoom.bind(Object(d.a)(r)),r.leaveAllRooms=r.leaveAllRooms.bind(Object(d.a)(r)),r.lockRoom=r.lockRoom.bind(Object(d.a)(r)),r.userNameEntered=r.userNameEntered.bind(Object(d.a)(r)),r.onIncomingStream=r.onIncomingStream.bind(Object(d.a)(r)),r.onPeerJoined=r.onPeerJoined.bind(Object(d.a)(r)),r.onRoomLocked=r.onRoomLocked.bind(Object(d.a)(r)),r.onIncomingMessage=r.onIncomingMessage.bind(Object(d.a)(r)),r.messageEntered=r.messageEntered.bind(Object(d.a)(r)),r.sendMessage=r.sendMessage.bind(Object(d.a)(r)),r.getConnectionStatus=r.getConnectionStatus.bind(Object(d.a)(r)),r.refreshDataChannel=r.refreshDataChannel.bind(Object(d.a)(r)),r.refreshConnections=r.refreshConnections.bind(Object(d.a)(r)),r.onPeerLeft=r.onPeerLeft.bind(Object(d.a)(r)),r.shareScreen=r.shareScreen.bind(Object(d.a)(r)),r.shareScreenReplace=r.shareScreenReplace.bind(Object(d.a)(r)),r.onStreamEnded=r.onStreamEnded.bind(Object(d.a)(r)),r.getPeerCustomSettings=r.getPeerCustomSettings.bind(Object(d.a)(r)),r.getUserMedia=r.getUserMedia.bind(Object(d.a)(r)),r.stopStream=r.stopStream.bind(Object(d.a)(r)),r.stopScreen=r.stopScreen.bind(Object(d.a)(r)),r.onPeerSelected=r.onPeerSelected.bind(Object(d.a)(r)),r.onMessageChannelSelected=r.onMessageChannelSelected.bind(Object(d.a)(r)),r.startRecording=r.startRecording.bind(Object(d.a)(r)),r.stopRecording=r.stopRecording.bind(Object(d.a)(r)),r.onSystemAction=r.onSystemAction.bind(Object(d.a)(r)),r.muteStream=r.muteStream.bind(Object(d.a)(r)),r.sendStream=r.sendStream.bind(Object(d.a)(r)),r.prefetchGetUserMedia=r.prefetchGetUserMedia.bind(Object(d.a)(r)),r.onIncomingScreenStream=r.onIncomingScreenStream.bind(Object(d.a)(r)),r.getPeersInRoom=r.getPeersInRoom.bind(Object(d.a)(r)),r.getPeerInfo=r.getPeerInfo.bind(Object(d.a)(r)),r.getUserData=r.getUserData.bind(Object(d.a)(r)),r.setUserData=r.setUserData.bind(Object(d.a)(r)),r.getPeersStream=r.getPeersStream.bind(Object(d.a)(r)),r.getPeersDataChannels=r.getPeersDataChannels.bind(Object(d.a)(r)),r.getPeersScreenshare=r.getPeersScreenshare.bind(Object(d.a)(r)),r.getRecordings=r.getRecordings.bind(Object(d.a)(r)),r.getStreamSources=r.getStreamSources.bind(Object(d.a)(r)),r.getScreenSources=r.getScreenSources.bind(Object(d.a)(r)),r.getPeers=r.getPeers.bind(Object(d.a)(r)),r.toggleAudioVideo=r.toggleAudioVideo.bind(Object(d.a)(r)),r.updateUsername=r.updateUsername.bind(Object(d.a)(r)),r.onServerPeerLeft=r.onServerPeerLeft.bind(Object(d.a)(r)),r.skylinkEventManager.addEventListener(A.c.ON_INCOMING_STREAM,r.onIncomingStream),r.skylinkEventManager.addEventListener(A.c.PEER_LEFT,r.onPeerLeft),r.skylinkEventManager.addEventListener(A.c.ON_INCOMING_MESSAGE,r.onIncomingMessage),r.skylinkEventManager.addEventListener(A.c.PEER_JOINED,r.onPeerJoined),r.skylinkEventManager.addEventListener(A.c.HANDSHAKE_PROGRESS,r.handshakeProgress),r.skylinkEventManager.addEventListener(A.c.STREAM_ENDED,r.onStreamEnded),r.skylinkEventManager.addEventListener(A.c.SYSTEM_ACTION,r.onSystemAction),r.skylinkEventManager.addEventListener(A.c.ROOM_LOCK,r.onRoomLocked),r.skylinkEventManager.addEventListener(A.c.ON_INCOMING_SCREEN_STREAM,r.onIncomingScreenStream),r.skylinkEventManager.addEventListener(A.c.ON_INCOMING_SCREEN_STREAM,r.onIncomingScreenStream),r.skylinkEventManager.addEventListener(A.c.SERVER_PEER_LEFT,r.onServerPeerLeft),r}return Object(c.a)(n,t),Object(a.a)(n,[{key:"toggleEvt",value:function(e){this.demoLoggerHelper.registerOrUnregisterEvts(e.currentTarget.value),this.setState({registeredEvts:this.demoLoggerHelper.registeredEvts})}},{key:"joinRoom",value:function(e){var t=this,n=Object.assign({},this.state[e]),i={audio:!n.streamMuted.audio,video:!n.streamMuted.video,roomName:e,userData:{username:n.username}};n.showJoinRoomLoader=!0,this.setState(Object(r.a)({},e,n)),this.skylink.joinRoom(i,this.prefetchedStream).then((function(n){C.a.logToConsole("joinRoom",void 0,n);var i=Object.assign({},t.state[e]);i.inRoom=!0,i.showJoinRoomLoader=!1,t.setState(Object(r.a)({},e,i),(function(){var t=document.getElementById("local-feed_".concat(e));n.forEach((function(e){e.getVideoTracks().length>0&&window.attachMediaStream(t,e)}))}))})).catch((function(e){C.a.logToConsole("joinRoom",void 0,null,e)}))}},{key:"sendMessage",value:function(e){var t=this.state[e].message,n=this.state[e].selectedPeers;"P2P"===this.state[e].messageChannel?this.skylink.sendP2PMessage(t,n,e):this.skylink.sendMessage(e,t,n)}},{key:"getPeersInRoom",value:function(e){C.a.logToConsole("getPeersInRoom",void 0,this.skylink.getPeersInRoom(e))}},{key:"getPeerInfo",value:function(e){var t=this;Object.keys(this.skylink.getPeersInRoom(e)).forEach((function(n){C.a.logToConsole("getPeerInfo",void 0,t.skylink.getPeerInfo(e,n))}))}},{key:"getUserData",value:function(e){C.a.logToConsole("getUserData",void 0,JSON.parse(this.skylink.getUserData(e)))}},{key:"updateUsername",value:function(e,t){var n=Object.assign({},this.state[e]);n.newUsername=t.target.value,this.setState(Object(r.a)({},e,n))}},{key:"setUserData",value:function(e){var t=Object.assign({},this.state[e]);t.username=t.newUsername,t.newUsername="";var n={username:t.username};C.a.logToConsole("setUserData",void 0,this.skylink.setUserData(e,JSON.stringify(n))),this.setState(Object(r.a)({},e,t))}},{key:"getConnectionStatus",value:function(e){this.skylink.getConnectionStatus(e).then((function(e){C.a.logToConsole("getConnectionStatus",void 0,e)})).catch((function(e){C.a.logToConsole("getConnectionStatus",void 0,void 0,e)}))}},{key:"getPeers",value:function(e){this.skylink.getPeers(e,!0).then((function(e){C.a.logToConsole("getPeers",void 0,e)})).catch((function(e){C.a.logToConsole("getPeers",void 0,null,e)}))}},{key:"getPeersStream",value:function(e){C.a.logToConsole("getPeersStream",void 0,this.skylink.getPeersStream(e))}},{key:"getPeersDataChannels",value:function(e){C.a.logToConsole("getPeersDataChannels",void 0,this.skylink.getPeersDataChannels(e))}},{key:"getPeerCustomSettings",value:function(e){C.a.logToConsole("getPeerCustomSettings",void 0,this.skylink.getPeersCustomSettings(e))}},{key:"refreshDataChannel",value:function(e){for(var t=this.skylink.getPeersInRoom(e),n=Object.keys(t),r=0;r<n.length;r+=1)this.skylink.refreshDatachannel(e,n[r])}},{key:"refreshConnections",value:function(e){this.skylink.refreshConnection(e).then((function(e){C.a.logToConsole("refreshConnection",void 0,e),e.refreshErrors.length>0&&C.a.logToConsole("refreshConnection",void 0,e,e.refreshErrors)})).catch((function(e){C.a.logToConsole("refreshConnection",void 0,void 0,e)}))}},{key:"shareScreen",value:function(e){this.skylink.shareScreen(e,!1).then((function(t){C.a.logToConsole("shareScreen",void 0,t),window.attachMediaStream(document.getElementById("local-feed_screen_".concat(e)),t)}))}},{key:"getPeersScreenshare",value:function(e){C.a.logToConsole("getPeersScreenshare",void 0,this.skylink.getPeersScreenshare(e))}},{key:"prefetchGetUserMedia",value:function(){var e=this;this.skylink.getUserMedia({audio:!1,video:!0}).then((function(t){C.a.logToConsole("getUserMedia",void 0,t),e.prefetchedStream=t})).catch((function(e){C.a.logToConsole("getUserMedia",void 0,void 0,e)}))}},{key:"stopScreen",value:function(e){this.skylink.stopScreen(e)}},{key:"stopStream",value:function(e){var t=this.skylink.getStreams(e);if(t.userMedia){Object.keys(t.userMedia);this.skylink.stopStream(e)}}},{key:"leaveRoom",value:function(e){var t=this;this.skylink.leaveRoom(e).then((function(){var n=t.state[e];n.remotePeers=[],t.setState(Object(r.a)({},e,n)),t.removeFeed(e)})).catch((function(n){C.a.logToConsole("leaveRoom",void 0,void 0,n),t.removeFeed(e)}))}},{key:"leaveAllRooms",value:function(){var e=this;this.skylink.leaveAllRooms().then((function(t){return t.forEach((function(t){return e.removeFeed(t)}))})).catch((function(e){return C.a.logToConsole("leaveAllRooms",void 0,null,e)}))}},{key:"startRecording",value:function(e){this.skylink.startRecording(e).then((function(e){return C.a.logToConsole("startRecording",void 0,e)})).catch((function(e){return C.a.logToConsole("startRecording",void 0,null,e)}))}},{key:"stopRecording",value:function(e){this.skylink.stopRecording(e).then((function(e){return C.a.logToConsole("stopRecording",void 0,e)})).catch((function(e){return C.a.logToConsole("stopRecording",void 0,null,e)}))}},{key:"getRecordings",value:function(e){C.a.logToConsole("getRecordings",void 0,this.skylink.getRecordings(e))}},{key:"lockRoom",value:function(e){this.state[e].roomLocked?(C.a.logToConsole("lockRoom",void 0,null),this.skylink.unlockRoom(e)):(C.a.logToConsole("unlockRoom",void 0,null),this.skylink.lockRoom(e))}},{key:"muteStream",value:function(e,t){var n=this.state[e],r={videoMuted:"video"===t.target.value?!n.streamMuted.videoMuted:n.streamMuted.videoMuted,audioMuted:"audio"===t.target.value?!n.streamMuted.audioMuted:n.streamMuted.audioMuted};n.streamMuted=r,this.setState({location:n});try{console.log(this.skylink);var i=this.skylink.muteStreams;(void 0===i?function(){}:i)(e,r)}catch(a){console.error(a)}}},{key:"getStreamSources",value:function(){this.skylink.getStreamSources().then((function(e){C.a.logToConsole("getStreamSources",void 0,e)}))}},{key:"sendStream",value:function(e){this.skylink.sendStream(e,{audio:!0,video:!1}).then((function(t){C.a.logToConsole("sendStream",void 0,t);var n=document.getElementById("local-feed_".concat(e));window.attachMediaStream(n,t)})).catch((function(e){C.a.logToConsole("sendStream",void 0,null,e)}))}},{key:"getScreenSources",value:function(){this.skylink.getScreenSources().then((function(e){C.a.logToConsole("getScreamSources",void 0,e)}))}},{key:"shareScreenReplace",value:function(e){var t=this.skylink.getStreams(e);Object.keys(t.userMedia);this.skylink.shareScreen(e,!0).then((function(t){C.a.logToConsole("shareScreenReplace",void 0,t),window.attachMediaStream(document.getElementById("local-feed_screen_".concat(e)),t)}))}},{key:"removeFeed",value:function(e){var t=document.getElementById("local-feed_".concat(e));t&&(t.srcObject=null);var n=Object.assign({},this.state[e]);n.inRoom=!1,this.setState(Object(r.a)({},e,n))}},{key:"userNameEntered",value:function(e,t){var n=Object.assign({},this.state[e]);n.username=t.target.value,this.setState(Object(r.a)({},e,n))}},{key:"onStreamEnded",value:function(e){var t=e.detail,n=t.isSelf,r=t.isScreensharing,i=t.room,a=t.peerId;if(n)if(r){document.getElementById("local-feed_screen_".concat(i.roomName)).srcObject=null}else{var o=document.getElementById("local-feed_".concat(i.roomName));o.srcObject=null,o.style.display="none",document.getElementById("local-feed_icon_".concat(i.roomName)).style.display="inline"}else if(this.skylink.getPeersStream(i.roomName,!1))if(r){var s=document.getElementById("remote-feed_screen_".concat(a,"_").concat(i.roomName));s&&(s.srcObject=null)}else{var d=document.getElementById("remote-feed_".concat(a,"_").concat(i.roomName));!0!==d.srcObject.active&&(d.srcObject=null,d.style.display="none");var c=document.getElementById("remote-feed_icon_".concat(i.roomName));c&&d.srcObject&&!0!==d.srcObject.active&&(c.style.display="inline")}else{var l=document.getElementById("remote-feed_screen_".concat(a,"_").concat(i.roomName));l&&(l.srcObject=null);var u=document.getElementById("remote-feed_".concat(a,"_").concat(i.roomName));u&&u.srcObject&&(u.srcObject=null,u.style.display="none");var S=document.getElementById("remote-feed_icon_".concat(i.roomName));S&&(S.style.display="inline")}}},{key:"onSystemAction",value:function(e){e.detail.reason===A.a.SYSTEM_ACTION.LOCKED&&alert("Room is locked.")}},{key:"onRoomLocked",value:function(e){var t=e.detail,n=t.isLocked,i=t.peerInfo.room,a=Object.assign({},this.state[i]);a.roomLocked=n,this.setState(Object(r.a)({},i,a))}},{key:"onIncomingScreenStream",value:function(e){var t=e.detail,n=t.room,r=t.peerId,i=t.stream;if(t.isSelf){var a=document.getElementById("local-feed_screen_".concat(n.roomName));window.attachMediaStream(a,i)}else{var o=document.getElementById("remote-feed_screen_".concat(r,"_").concat(n.roomName));window.attachMediaStream(o,i)}}},{key:"onIncomingStream",value:function(e){var t=e.detail,n=t.stream,r=t.isSelf,i=t.peerId,a=t.room,o=t.isReplace,s=(t.streamId,t.isVideo),d=t.isAudio;if(!r&&!o)if(d&&s||s&&!d){var c=document.getElementById("remote-feed_".concat(i,"_").concat(a.roomName)),l=document.getElementById("remote-feed_icon_".concat(a.roomName));window.attachMediaStream(c,n),c.style.display="inline",l.style.display="none"}else{var u=document.getElementById("remote-feed_audio_".concat(i,"_").concat(a.roomName));window.attachMediaStream(u,n)}}},{key:"messageEntered",value:function(e,t){var n=Object.assign({},this.state[e]);n.message=t.target.value,this.setState(Object(r.a)({},e,n))}},{key:"onPeerJoined",value:function(e){var t=e.detail,n=t.isSelf,i=t.peerId,a=t.room,o=Object.assign([],this.state[a.roomName]);n?o.peerId=i:o.remotePeers.push(i),this.setState(Object(r.a)({},a.roomName,o))}},{key:"onIncomingMessage",value:function(e){var t=e.detail,n=t.room,i=Object.assign({},this.state[n.roomName]);i.messages.push(t),this.setState(Object(r.a)({},n.roomName,i))}},{key:"getUserMedia",value:function(e){this.skylink.getUserMedia(e,{audio:!1,video:!0}).then((function(e){C.a.logToConsole("getUserMedia",void 0,e)})).catch((function(e){console.error(e)}))}},{key:"onPeerLeft",value:function(e){var t=e.detail,n=t.isSelf,i=t.room,a=t.peerId,o=Object.assign([],this.state[i.roomName]);if(n)this.removeFeed(i.roomName);else{var s=o.remotePeers.indexOf(a);-1!==s&&(o.remotePeers.splice(s,1),this.setState(Object(r.a)({},i.roomName,o)))}}},{key:"onServerPeerLeft",value:function(e){}},{key:"onMessageChannelSelected",value:function(e,t,n){var i=Object.assign({},this.state[e]),a=n.value;i.messageChannel=a,this.setState(Object(r.a)({},e,i))}},{key:"onPeerSelected",value:function(e,t,n){var i=Object.assign({},this.state[e]),a=n.value;i.selectedPeers=a,this.setState(Object(r.a)({},e,i))}},{key:"toggleAudioVideo",value:function(e,t,n){var i=Object.assign({},this.state[e]),a={audioMuted:"audio"===n.value?!n.checked:i.streamMuted.audioMuted,videoMuted:"video"===n.value?!n.checked:i.streamMuted.videoMuted};i.streamMuted=a,this.setState(Object(r.a)({},e,i))}},{key:"render",value:function(){var e=this,t=this.state,n=[{stateKey:"hongkong",buttonText:"Join Hong Kong Room",stateObject:t.hongkong},{stateKey:"singapore",buttonText:"Join Singapore Room",stateObject:t.singapore},{stateKey:"newyork",buttonText:"Join New York Room",stateObject:t.newyork}].map((function(t,n){return{key:"panel-".concat(n),title:"".concat(t.stateObject.title),content:{content:u.a.createElement(w,{key:n,sendMessage:e.sendMessage,userNameEntered:e.userNameEntered,updateUsername:e.updateUsername,messageEntered:e.messageEntered,toggleAudioVideo:e.toggleAudioVideo,joinRoom:e.joinRoom,location:t.stateObject,buttonText:t.buttonText,stateKey:t.stateKey,getConnectionStatus:e.getConnectionStatus,refreshDataChannel:e.refreshDataChannel,refreshConnections:e.refreshConnections,shareScreen:e.shareScreen,shareScreenReplace:e.shareScreenReplace,getPeerCustomSettings:e.getPeerCustomSettings,getUserMedia:e.getUserMedia,leaveRoom:e.leaveRoom,stopStream:e.stopStream,stopScreen:e.stopScreen,RoomSegment:e.RoomSegment,onPeerSelected:e.onPeerSelected,onMessageChannelSelected:e.onMessageChannelSelected,startRecording:e.startRecording,stopRecording:e.stopRecording,leaveAllRooms:e.leaveAllRooms,lockRoom:e.lockRoom,muteStream:e.muteStream,sendStream:e.sendStream,getPeersInRoom:e.getPeersInRoom,getPeerInfo:e.getPeerInfo,getUserData:e.getUserData,setUserData:e.setUserData,getPeersStream:e.getPeersStream,getPeersDataChannels:e.getPeersDataChannels,getPeersScreenshare:e.getPeersScreenshare,getRecordings:e.getRecordings,getStreamSources:e.getStreamSources,getScreenSources:e.getScreenSources,getPeers:e.getPeers})}}}));return u.a.createElement(S.a,{fluid:!0,className:"skylink-demo-body",style:{padding:"10px"}},u.a.createElement(S.a,{fluid:!0,style:{padding:"0"}},u.a.createElement("span",{style:{margin:"5px"}},"Registered Demo Events (Logged on console) : "),u.a.createElement("br",null),u.a.createElement(E.a,{disabled:this.state.registeredEvts.allEvts,color:this.state.registeredEvts.allEvts?"green":"red",onClick:this.toggleEvt.bind(this),style:{margin:"5px"},value:"allEvts"},"Register All Evts"),u.a.createElement(E.a,{color:this.state.registeredEvts.candidate?"green":"red",onClick:this.toggleEvt.bind(this),style:{margin:"5px"},value:"candidate"},"Candidate Evts"),u.a.createElement(E.a,{color:this.state.registeredEvts.dataTransfer?"green":"red",onClick:this.toggleEvt.bind(this),style:{margin:"5px"},value:"dataTransfer"},"Data Transfer Evts"),u.a.createElement(E.a,{color:this.state.registeredEvts.dataChannel?"green":"red",onClick:this.toggleEvt.bind(this),style:{margin:"5px"},value:"dataChannel"},"Data Channel Evts"),u.a.createElement(E.a,{color:this.state.registeredEvts.media?"green":"red",onClick:this.toggleEvt.bind(this),style:{margin:"5px"},value:"media"},"Media Evts"),u.a.createElement(E.a,{color:this.state.registeredEvts.peer?"green":"red",onClick:this.toggleEvt.bind(this),style:{margin:"5px"},value:"peer"},"Peer Evts"),u.a.createElement(E.a,{color:this.state.registeredEvts.peerHandshake?"green":"red",onClick:this.toggleEvt.bind(this),style:{margin:"5px"},value:"peerHandshake"},"Peer Handshake Evts"),u.a.createElement(E.a,{color:this.state.registeredEvts.room?"green":"red",onClick:this.toggleEvt.bind(this),style:{margin:"5px"},value:"room"},"Room Evts"),u.a.createElement(E.a,{color:this.state.registeredEvts.socket?"green":"red",onClick:this.toggleEvt.bind(this),style:{margin:"5px"},value:"socket"},"Socket Evts"),u.a.createElement(E.a,{color:this.state.registeredEvts.stream?"green":"red",onClick:this.toggleEvt.bind(this),style:{margin:"5px"},value:"stream"},"Stream Evts")),u.a.createElement(E.a,{primary:!0,onClick:this.prefetchGetUserMedia.bind(this),style:{margin:"5px"}},"Pre-Fetch getUserMedia stream"),u.a.createElement(g.a,{styled:!0,defaultActiveIndex:[0],panels:n,exclusive:!1,fluid:!0}))}}]),n}(l.Component),D=function(e){var t=e.color;return u.a.createElement("div",{style:{borderBottomWidth:"0.5px",borderBottomStyle:"solid",borderBottomColor:t,padding:"5px 5px 10px",opacity:.3}})},y=function(e){var t=e.location,n=e.stateKey,r=e.buttonText,i=e.userNameEntered,a=e.joinRoom,o=e.toggleAudioVideo;return u.a.createElement(p.a.Row,null,u.a.createElement(p.a.Column,{width:3},u.a.createElement(f.a,null,u.a.createElement(f.a.Field,null,u.a.createElement("label",null,"Username"),u.a.createElement("input",{value:t.username,onChange:i.bind(void 0,n),placeholder:"@user"})),u.a.createElement(E.a,{loading:t.showJoinRoomLoader,primary:!0,disabled:""===t.username,onClick:a.bind(void 0,n)},r),u.a.createElement("div",{style:{padding:"5px"}},u.a.createElement("label",{style:{paddingRight:"5px"}},"Audio"),u.a.createElement(m.a,{style:{verticalAlign:"middle"},value:"audio",checked:!t.streamMuted.audioMuted,onClick:o.bind(void 0,n)}),u.a.createElement("br",null),u.a.createElement("label",{style:{paddingRight:"5px"}},"Video"),u.a.createElement(m.a,{style:{verticalAlign:"middle"},value:"video",checked:!t.streamMuted.videoMuted,onClick:o.bind(void 0,n)})))))},M=function(e){var t=e.stateKey,n=e.location;return u.a.createElement(p.a.Column,{width:6},u.a.createElement(R.a,{as:"div",attached:"top"},u.a.createElement(R.a.Content,{style:{padding:"0px"}},n.username," (",n.peerId,")"),u.a.createElement(P,e)),u.a.createElement(h.a,{attached:!0},u.a.createElement("video",{autoPlay:!0,muted:!0,style:{width:"100%"},playsInline:!0,id:"local-feed_".concat(t)}),u.a.createElement("img",{src:T.a,style:{width:"100%",display:"none",padding:"1rem 5rem"},id:"local-feed_icon_".concat(t)}),u.a.createElement("video",{autoPlay:!0,muted:!0,style:{width:"100%"},playsInline:!0,id:"local-feed_screen_".concat(t)}),u.a.createElement(b,e)))},k=function(e){var t=e.stateKey,n=e.location.remotePeers;return u.a.createElement(p.a.Column,{width:10},u.a.createElement(R.a,{as:"div",attached:"top"},u.a.createElement(R.a.Content,{style:{padding:"0px"}},"Remote Peers")),u.a.createElement(h.a,{attached:!0},u.a.createElement(p.a,{columns:4,padded:!0},n.map((function(e){return u.a.createElement(p.a.Column,{key:e},u.a.createElement("label",{id:"remote-feed_peerId_".concat(e,"_").concat(t)},e),u.a.createElement("video",{autoPlay:!0,playsInline:!0,id:"remote-feed_".concat(e,"_").concat(t),style:{width:"100%"}}),u.a.createElement("img",{alt:"The feed of remote peer",src:T.a,style:{width:"100%",display:"none",padding:"0.5rem 1rem"},id:"remote-feed_icon_".concat(t)}),u.a.createElement("video",{autoPlay:!0,playsInline:!0,id:"remote-feed_screen_".concat(e,"_").concat(t),style:{width:"50%"}}),u.a.createElement("audio",{autoPlay:!0,playsInline:!0,id:"remote-feed_audio_".concat(e,"_").concat(t),style:{width:"50%"}}))})))))},P=function(e){var t=e.stateKey,n=e.location,r=e.sendMessage,i=e.messageEntered,a=e.onPeerSelected,o=e.onMessageChannelSelected,s=n.remotePeers.map((function(e){return{text:e,value:e}}));return u.a.createElement(v.a,{trigger:u.a.createElement(E.a,{primary:!0,size:"mini",floated:"right",style:{marginTop:"-5px"}},"Messaging")},u.a.createElement(v.a.Header,null,"Messaging"),u.a.createElement(v.a.Content,null,u.a.createElement(v.a.Description,null,n.messages.map((function(e,t){var n=e.isSelf,r=e.peerInfo,i=e.message,a=i.content,o=i.isPrivate,s=i.isDataChannel,d=n?"You:":"".concat(r.userData.username,":"),c=s?"P2P":"SIG";return d+=" [".concat(o?"Private | ".concat(c," |"):"Public | ".concat(c," |"),"]"),d+=" ".concat(a),u.a.createElement("p",{key:t},d)})),u.a.createElement(f.a,null,u.a.createElement(f.a.Field,null,u.a.createElement(p.a,null,u.a.createElement(p.a.Column,{width:12},u.a.createElement("label",null,"Select Peer"),u.a.createElement(I.a,{placeholder:"Select Peer",multiple:!0,fluid:!0,selection:!0,options:s,onChange:a.bind(void 0,t)})),u.a.createElement(p.a.Column,{width:4},u.a.createElement(f.a,null,u.a.createElement(f.a.Field,null,"Choose Channel ",u.a.createElement("b",null,"1234")),u.a.createElement(f.a.Field,null,u.a.createElement(m.a,{radio:!0,label:"P2P Message",name:"channelRdoGroup",value:"P2P",checked:"P2P"===n.messageChannel,onChange:o.bind(void 0,t)})),u.a.createElement(f.a.Field,null,u.a.createElement(m.a,{radio:!0,label:"Signaling Message",name:"channelRdoGroup",value:"SIG",checked:"SIG"===n.messageChannel,onChange:o.bind(void 0,t)}))))),u.a.createElement("label",null,"Enter Message"),u.a.createElement("input",{onChange:i.bind(void 0,t),placeholder:"@message"})),u.a.createElement(E.a,{disabled:""===n.message,primary:!0,onClick:r.bind(void 0,t)},"Send Message")))))},b=function(e){var t=e.stateKey,n=e.location,r=e.updateUsername,i=e.getConnectionStatus,a=e.refreshDataChannel,o=e.refreshConnections,s=e.shareScreen,d=e.getPeerCustomSettings,c=e.getUserMedia,l=e.stopStream,S=e.stopScreen,g=e.leaveRoom,m=e.lockRoom,R=e.leaveAllRooms,h=e.shareScreenReplace,v=e.muteStream,I=e.stopRecording,O=e.startRecording,T=e.sendStream,A=e.getPeersInRoom,C=e.getPeerInfo,_=e.getUserData,N=e.setUserData,y=e.getPeersStream,M=e.getPeersDataChannels,k=e.getPeersScreenshare,P=e.getRecordings,b=e.getStreamSources,w=e.getScreenSources,L=e.getPeers;return u.a.createElement(p.a.Column,null,u.a.createElement(f.a,null,u.a.createElement(f.a.Field,null,u.a.createElement("input",{value:n.newUsername,onChange:r.bind(void 0,t),placeholder:"@user"}),u.a.createElement(E.a,{username:t.newUsername,compact:!0,className:"public-method-btn",primary:!0,onClick:N.bind(void 0,t)},"Set User Data"),u.a.createElement(E.a,{compact:!0,className:"public-method-btn",primary:!0,onClick:_.bind(void 0,t)},"Get User Data"))),u.a.createElement(D,{color:"light-grey"}),u.a.createElement(E.a,{compact:!0,color:"red",className:"public-method-btn",onClick:g.bind(void 0,t)},"Leave Room"),u.a.createElement(E.a,{compact:!0,color:"red",className:"public-method-btn",onClick:R.bind(void 0,t)},"Leave All Rooms"),u.a.createElement(E.a,{compact:!0,color:"yellow",className:"public-method-btn",onClick:m.bind(void 0,t)},n.roomLocked?"Unlock Room":"Lock Room"),u.a.createElement(D,{color:"light-grey"}),u.a.createElement(E.a,{compact:!0,color:n.streamMuted.audioMuted?"green":"red",className:"public-method-btn",onClick:v.bind(void 0,t),value:"audio"},n.streamMuted.audioMuted?"Unmute Audio":"Mute Audio"),u.a.createElement(E.a,{compact:!0,color:n.streamMuted.videoMuted?"green":"red",className:"public-method-btn",onClick:v.bind(void 0,t),value:"video"},n.streamMuted.videoMuted?"Unmute Video":"Mute Video"),u.a.createElement(D,{color:"light-grey"}),u.a.createElement(E.a,{compact:!0,className:"public-method-btn",primary:!0,onClick:T.bind(void 0,t)},"Send Stream"),u.a.createElement(E.a,{compact:!0,color:"red",className:"public-method-btn",onClick:l.bind(void 0,t)},"Stop Stream"),u.a.createElement(D,{color:"light-grey"}),u.a.createElement(E.a,{compact:!0,className:"public-method-btn",primary:!0,onClick:s.bind(void 0,t)},"Share Screen"),u.a.createElement(E.a,{compact:!0,className:"public-method-btn",primary:!0,onClick:h.bind(void 0,t)},"Share Screen (Replace)"),u.a.createElement(E.a,{compact:!0,color:"red",className:"public-method-btn",onClick:S.bind(void 0,t)},"Stop Screen"),u.a.createElement(D,{color:"light-grey"}),u.a.createElement(E.a,{compact:!0,className:"public-method-btn",primary:!0,onClick:O.bind(void 0,t)},"Start Recording"),u.a.createElement(E.a,{compact:!0,color:"red",className:"public-method-btn",onClick:I.bind(void 0,t)},"Stop Recording"),u.a.createElement(E.a,{compact:!0,className:"public-method-btn",primary:!0,onClick:P.bind(void 0,t)},"Get Recordings"),u.a.createElement(D,{color:"light-grey"}),u.a.createElement(E.a,{compact:!0,className:"public-method-btn",primary:!0,onClick:a.bind(void 0,t)},"Refresh Data Channel"),u.a.createElement(E.a,{compact:!0,className:"public-method-btn",primary:!0,onClick:o.bind(void 0,t)},"Refresh Connections"),u.a.createElement(E.a,{compact:!0,className:"public-method-btn",primary:!0,onClick:i.bind(void 0,t)},"Get Connection Status"),u.a.createElement(E.a,{compact:!0,className:"public-method-btn",primary:!0,onClick:d.bind(void 0,t)},"Get Peer Custom Settings"),u.a.createElement(E.a,{compact:!0,className:"public-method-btn",primary:!0,onClick:c.bind(void 0,t)},"Get User Media"),u.a.createElement(E.a,{compact:!0,className:"public-method-btn",primary:!0,onClick:A.bind(void 0,t)},"Get Peers In Room"),u.a.createElement(E.a,{compact:!0,className:"public-method-btn",primary:!0,onClick:C.bind(void 0,t)},"Get Peer Info"),u.a.createElement(E.a,{compact:!0,className:"public-method-btn",primary:!0,onClick:y.bind(void 0,t)},"Get Peers Stream"),u.a.createElement(E.a,{compact:!0,className:"public-method-btn",primary:!0,onClick:M.bind(void 0,t)},"Get Peers Data Channels"),u.a.createElement(E.a,{compact:!0,className:"public-method-btn",primary:!0,onClick:k.bind(void 0,t)},"Get Peers Screenshare"),u.a.createElement(E.a,{compact:!0,className:"public-method-btn",primary:!0,onClick:b.bind(void 0,t)},"Get Stream Sources"),u.a.createElement(E.a,{compact:!0,className:"public-method-btn",primary:!0,onClick:w.bind(void 0,t)},"Get Screen Sources"),u.a.createElement(E.a,{compact:!0,className:"public-method-btn",primary:!0,onClick:L.bind(void 0,t)},"Get Peers (Privilege Key)"))},w=function(e){var t=e.location,n=e.stateKey,r=e.buttonText,i=e.joinRoom,a=e.toggleAudioVideo,o=e.updateUsername,s=e.userNameEntered,d=e.sendMessage,c=e.messageEntered,l=e.getConnectionStatus,S=e.refreshDataChannel,E=e.refreshConnections,g=e.shareScreen,f=e.getPeerCustomSettings,m=e.getUserMedia,R=e.stopStream,h=e.stopScreen,v=e.leaveRoom,I=e.onPeerSelected,O=e.onMessageChannelSelected,T=e.leaveAllRooms,A=e.lockRoom,C=e.shareScreenReplace,_=e.muteStream,N=e.startRecording,D=e.stopRecording,P=e.sendStream,b=e.getPeersInRoom,w=e.getPeerInfo,L=e.getUserData,U=e.setUserData,G=e.getPeersStream,F=e.getPeersDataChannels,B=e.getPeersScreenshare,j=e.getRecordings,V=e.getStreamSources,x=e.getScreenSources,H=e.getPeers;return u.a.createElement(p.a,{celled:"internally"},t.inRoom?u.a.createElement(p.a.Row,null,u.a.createElement(M,{stateKey:n,location:t,sendMessage:d,messageEntered:c,updateUsername:o,getConnectionStatus:l,refreshDataChannel:S,refreshConnections:E,shareScreen:g,shareScreenReplace:C,getPeerCustomSettings:f,getUserMedia:m,stopStream:R,stopScreen:h,leaveRoom:v,onPeerSelected:I,onMessageChannelSelected:O,startRecording:N,stopRecording:D,leaveAllRooms:T,lockRoom:A,muteStream:_,sendStream:P,getPeersInRoom:b,getPeerInfo:w,getUserData:L,setUserData:U,getPeersStream:G,getPeersDataChannels:F,getPeersScreenshare:B,getRecordings:j,getStreamSources:V,getScreenSources:x,getPeers:H}),u.a.createElement(k,{stateKey:n,location:t})):u.a.createElement(y,{location:t,stateKey:n,buttonText:r,joinRoom:i,toggleAudioVideo:a,userNameEntered:s}))};t.a=N}).call(this,n(89))},281:function(e,t,n){e.exports=n(491)},286:function(e,t,n){},364:function(e,t){},490:function(e,t,n){},491:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),a=n(75),o=n.n(a),s=(n(286),n(6)),d=n(7),c=n(25),l=n(24),u=n(26),S=n(270),E=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return i.a.createElement(S.a,{fluid:!0,className:"skylink-header"},i.a.createElement("p",{className:"text-white"},"SkylinkJS\xa0\xa0",i.a.createElement("span",{className:"text-muted"},"ReactJS Client")))}}]),t}(r.Component),g=n(244),p=(n(489),n(490),function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return i.a.createElement(S.a,{fluid:!0},i.a.createElement(E,null),i.a.createElement(g.a,null))}}]),t}(r.Component)),f=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function m(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}o.a.render(i.a.createElement(p,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/skylinkjs-poc",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/skylinkjs-poc","/service-worker.js");f?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):m(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):m(e)}))}}()},9:function(e,t,n){"use strict";var r={};n.r(r),n.d(r,"ON_INCOMING_STREAM",(function(){return h})),n.d(r,"ON_INCOMING_SCREEN_STREAM",(function(){return v})),n.d(r,"STREAM_ENDED",(function(){return I})),n.d(r,"PEER_UPDATED",(function(){return O})),n.d(r,"PEER_JOINED",(function(){return T})),n.d(r,"PEER_LEFT",(function(){return A})),n.d(r,"PEER_CONNECTION_STATE",(function(){return C})),n.d(r,"DATA_CHANNEL_STATE",(function(){return _})),n.d(r,"ON_INCOMING_MESSAGE",(function(){return N})),n.d(r,"HANDSHAKE_PROGRESS",(function(){return D})),n.d(r,"SERVER_PEER_JOINED",(function(){return y})),n.d(r,"SERVER_PEER_LEFT",(function(){return M})),n.d(r,"CANDIDATE_PROCESSING_STATE",(function(){return k})),n.d(r,"CANDIDATE_GENERATION_STATE",(function(){return P})),n.d(r,"CANDIDATES_GATHERED",(function(){return b})),n.d(r,"DATA_STREAM_STATE",(function(){return w})),n.d(r,"DATA_TRANSFER_STATE",(function(){return L})),n.d(r,"ON_INCOMING_DATA",(function(){return U})),n.d(r,"ON_INCOMING_DATA_REQUEST",(function(){return G})),n.d(r,"ON_INCOMING_DATA_STREAM",(function(){return F})),n.d(r,"ON_INCOMING_DATA_STREAM_STARTED",(function(){return B})),n.d(r,"ON_INCOMING_DATA_STREAM_STOPPED",(function(){return j})),n.d(r,"GET_PEERS_STATE_CHANGE",(function(){return V})),n.d(r,"SESSION_DISCONNECT",(function(){return x})),n.d(r,"STREAM_MUTED",(function(){return H})),n.d(r,"CHANNEL_OPEN",(function(){return W})),n.d(r,"CHANNEL_REOPEN",(function(){return K})),n.d(r,"CHANNEL_CLOSE",(function(){return Y})),n.d(r,"CHANNEL_MESSAGE",(function(){return J})),n.d(r,"CHANNEL_ERROR",(function(){return X})),n.d(r,"CHANNEL_RETRY",(function(){return Q})),n.d(r,"SOCKET_ERROR",(function(){return q})),n.d(r,"SYSTEM_ACTION",(function(){return z})),n.d(r,"MEDIA_ACCESS_FALLBACK",(function(){return Z})),n.d(r,"MEDIA_ACCESS_REQUIRED",(function(){return $})),n.d(r,"MEDIA_ACCESS_STOPPED",(function(){return ee})),n.d(r,"MEDIA_ACCESS_SUCCESS",(function(){return te})),n.d(r,"RECORDING_STATE",(function(){return ne})),n.d(r,"LOCAL_MEDIA_MUTED",(function(){return re})),n.d(r,"MEDIA_ACCESS_ERROR",(function(){return ie})),n.d(r,"GET_CONNECTION_STATUS_STATE_CHANGE",(function(){return ae})),n.d(r,"READY_STATE_CHANGE",(function(){return oe})),n.d(r,"ROOM_LOCK",(function(){return se})),n.d(r,"INTRODUCE_STATE_CHANGE",(function(){return de})),n.d(r,"ICE_CONNECTION_STATE",(function(){return ce})),n.d(r,"BYE",(function(){return le})),n.d(r,"RTMP_STATE",(function(){return ue})),n.d(r,"LOGGED_ON_CONSOLE",(function(){return Se})),n.d(r,"MEDIA_INFO_DELETED",(function(){return Ee})),n.d(r,"STORED_MESSAGES",(function(){return ge})),n.d(r,"ENCRYPT_SECRETS_UPDATED",(function(){return pe})),n.d(r,"PERSISTENT_MESSAGE_STATE",(function(){return fe}));var i={};n.r(i),n.d(i,"DATA_CHANNEL_STATE",(function(){return Ye})),n.d(i,"DATA_CHANNEL_TYPE",(function(){return Je})),n.d(i,"DATA_CHANNEL_MESSAGE_ERROR",(function(){return Xe})),n.d(i,"DATA_TRANSFER_DATA_TYPE",(function(){return Qe})),n.d(i,"DT_PROTOCOL_VERSION",(function(){return qe})),n.d(i,"DATA_TRANSFER_TYPE",(function(){return ze})),n.d(i,"DATA_TRANSFER_SESSION_TYPE",(function(){return Ze})),n.d(i,"DATA_TRANSFER_STATE",(function(){return $e})),n.d(i,"DATA_STREAM_STATE",(function(){return et})),n.d(i,"CANDIDATE_GENERATION_STATE",(function(){return tt})),n.d(i,"CANDIDATE_PROCESSING_STATE",(function(){return nt})),n.d(i,"ICE_CONNECTION_STATE",(function(){return rt})),n.d(i,"TURN_TRANSPORT",(function(){return it})),n.d(i,"PEER_CONNECTION_STATE",(function(){return at})),n.d(i,"GET_CONNECTION_STATUS_STATE",(function(){return ot})),n.d(i,"SERVER_PEER_TYPE",(function(){return st})),n.d(i,"BUNDLE_POLICY",(function(){return dt})),n.d(i,"RTCP_MUX_POLICY",(function(){return ct})),n.d(i,"PEER_CERTIFICATE",(function(){return lt})),n.d(i,"HANDSHAKE_PROGRESS",(function(){return ut})),n.d(i,"GET_PEERS_STATE",(function(){return St})),n.d(i,"INTRODUCE_STATE",(function(){return Et})),n.d(i,"SYSTEM_ACTION",(function(){return gt})),n.d(i,"SYSTEM_ACTION_REASON",(function(){return pt})),n.d(i,"READY_STATE_CHANGE",(function(){return ft})),n.d(i,"READY_STATE_CHANGE_ERROR",(function(){return mt})),n.d(i,"REGIONAL_SERVER",(function(){return Rt})),n.d(i,"PRIORITY_WEIGHT_SCHEME",(function(){return ht})),n.d(i,"LOG_LEVEL",(function(){return vt})),n.d(i,"SOCKET_ERROR",(function(){return It})),n.d(i,"SOCKET_FALLBACK",(function(){return Ot})),n.d(i,"SM_PROTOCOL_VERSION",(function(){return Tt})),n.d(i,"VIDEO_CODEC",(function(){return At})),n.d(i,"AUDIO_CODEC",(function(){return Ct})),n.d(i,"MEDIA_SOURCE",(function(){return _t})),n.d(i,"VIDEO_RESOLUTION",(function(){return Nt})),n.d(i,"MEDIA_ACCESS_FALLBACK_STATE",(function(){return Dt})),n.d(i,"RECORDING_STATE",(function(){return yt})),n.d(i,"CHUNK_FILE_SIZE",(function(){return Mt})),n.d(i,"MOZ_CHUNK_FILE_SIZE",(function(){return kt})),n.d(i,"BINARY_FILE_SIZE",(function(){return Pt})),n.d(i,"MOZ_BINARY_FILE_SIZE",(function(){return bt})),n.d(i,"CHUNK_DATAURL_SIZE",(function(){return wt})),n.d(i,"DC_PROTOCOL_TYPE",(function(){return Lt})),n.d(i,"SIG_MESSAGE_TYPE",(function(){return Ut})),n.d(i,"STREAM_STATUS",(function(){return Gt})),n.d(i,"GROUP_MESSAGE_LIST",(function(){return Ft})),n.d(i,"VIDEO_QUALITY",(function(){return Bt})),n.d(i,"SDP_SEMANTICS",(function(){return jt})),n.d(i,"RTMP_STATE",(function(){return Vt})),n.d(i,"MEDIA_STATUS",(function(){return xt})),n.d(i,"TAGS",(function(){return Ht})),n.d(i,"MEDIA_TYPE",(function(){return Wt})),n.d(i,"TRACK_READY_STATE",(function(){return Kt})),n.d(i,"TRACK_KIND",(function(){return Yt})),n.d(i,"MEDIA_STATE",(function(){return Jt})),n.d(i,"MEDIA_INFO",(function(){return Xt})),n.d(i,"SDK_VERSION",(function(){return Qt})),n.d(i,"SDK_NAME",(function(){return qt})),n.d(i,"API_VERSION",(function(){return zt})),n.d(i,"SIGNALING_VERSION",(function(){return Zt})),n.d(i,"BROWSER_AGENT",(function(){return $t})),n.d(i,"PEER_TYPE",(function(){return en})),n.d(i,"SOCKET_EVENTS",(function(){return tn})),n.d(i,"SOCKET_TYPE",(function(){return nn})),n.d(i,"STATES",(function(){return rn})),n.d(i,"EVENTS",(function(){return an}));var a={};n.r(a),n.d(a,"createSocket",(function(){return An})),n.d(a,"processSignalingMessage",(function(){return Cn})),n.d(a,"handleSocketClose",(function(){return Wn})),n.d(a,"closeSocket",(function(){return Kn})),n.d(a,"setSocketCallbacks",(function(){return or})),n.d(a,"shouldBufferMessage",(function(){return cr}));var o=n(6),s=n(7),d=n(25),c=n(24),l=n(26),u=n(245),S=n.n(u),E=n(21);E.a.options=E.a.options||{},E.a.onwebrtcreadyDone=!1,E.a.WebRTCPlugin={plugin:null},E.a._onwebrtcreadies=[],E.a.webRTCReady=function(e){if("function"!==typeof e)throw new Error("Callback provided is not a function");var t=function(){"function"===typeof window.require&&"function"===typeof E.a._defineMediaSourcePolyfill&&E.a._defineMediaSourcePolyfill(),e(null!==E.a.WebRTCPlugin.plugin)};!0===E.a.onwebrtcreadyDone?t():E.a._onwebrtcreadies.push(t)},E.a.maybeThroughWebRTCReady=function(){E.a.onwebrtcreadyDone||(E.a.onwebrtcreadyDone=!0,E.a._onwebrtcreadies.length?E.a._onwebrtcreadies.forEach((function(e){"function"===typeof e&&e(null!==E.a.WebRTCPlugin.plugin)})):"function"===typeof E.a.onwebrtcready&&E.a.onwebrtcready(null!==E.a.WebRTCPlugin.plugin))},window.webrtcDetectedBrowser=null,window.webrtcDetectedVersion=null,window.webrtcMinimumVersion=null,window.webrtcDetectedDCSupport=null,E.a.parseWebrtcDetectedBrowser=function(){var e=null;if(window.opr&&opr.addons||window.opera||navigator.userAgent.indexOf(" OPR/")>=0)e=navigator.userAgent.match(/OPR\/(\d+)/i)||[],window.webrtcDetectedBrowser="opera",window.webrtcDetectedVersion=parseInt(e[1]||"0",10),window.webrtcMinimumVersion=26,window.webrtcDetectedType="webkit",window.webrtcDetectedDCSupport="SCTP";else if(navigator.userAgent.match(/Bowser\/[0-9.]*/g)){e=navigator.userAgent.match(/Bowser\/[0-9.]*/g)||[];var t=parseInt((navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./i)||[])[2]||"0",10);window.webrtcDetectedBrowser="bowser",window.webrtcDetectedVersion=parseFloat((e[0]||"0/0").split("/")[1],10),window.webrtcMinimumVersion=0,window.webrtcDetectedType="webkit",window.webrtcDetectedDCSupport=t>30?"SCTP":"RTP"}else if(navigator.userAgent.indexOf("OPiOS")>0)e=navigator.userAgent.match(/OPiOS\/([0-9]+)\./),window.webrtcDetectedBrowser="opera",window.webrtcDetectedVersion=parseInt(e[1]||"0",10),window.webrtcMinimumVersion=0,window.webrtcDetectedType=null,window.webrtcDetectedDCSupport=null;else if(navigator.userAgent.indexOf("CriOS")>0)e=navigator.userAgent.match(/CriOS\/([0-9]+)\./)||[],window.webrtcDetectedVersion=parseInt(e[1]||"0",10),window.webrtcMinimumVersion=0,window.webrtcDetectedType=null,window.webrtcDetectedBrowser="chrome",window.webrtcDetectedDCSupport=null;else if(navigator.userAgent.indexOf("FxiOS")>0)e=navigator.userAgent.match(/FxiOS\/([0-9]+)\./)||[],window.webrtcDetectedBrowser="firefox",window.webrtcDetectedVersion=parseInt(e[1]||"0",10),window.webrtcMinimumVersion=0,window.webrtcDetectedType=null,window.webrtcDetectedDCSupport=null;else if(document.documentMode)e=/\brv[ :]+(\d+)/g.exec(navigator.userAgent)||[],window.webrtcDetectedBrowser="IE",window.webrtcDetectedVersion=parseInt(e[1],10),window.webrtcMinimumVersion=9,window.webrtcDetectedType="plugin",window.webrtcDetectedDCSupport="SCTP",webrtcDetectedVersion||(e=/\bMSIE[ :]+(\d+)/g.exec(navigator.userAgent)||[],window.webrtcDetectedVersion=parseInt(e[1]||"0",10));else if(window.StyleMedia||navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))e=navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)||[],window.webrtcDetectedBrowser="edge",window.webrtcDetectedVersion=parseFloat((e[0]||"0/0").split("/")[1],10),window.webrtcMinimumVersion=13.10547,window.webrtcDetectedType="ms",window.webrtcDetectedDCSupport=null;else if("undefined"!==typeof InstallTrigger||navigator.userAgent.indexOf("irefox")>0)e=navigator.userAgent.match(/Firefox\/([0-9]+)\./)||[],window.webrtcDetectedBrowser="firefox",window.webrtcDetectedVersion=parseInt(e[1]||"0",10),window.webrtcMinimumVersion=33,window.webrtcDetectedType="moz",window.webrtcDetectedDCSupport="SCTP";else if(window.chrome&&window.chrome.webstore||navigator.userAgent.indexOf("Chrom")>0)e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./i)||[],window.webrtcDetectedBrowser="chrome",window.webrtcDetectedVersion=parseInt(e[2]||"0",10),window.webrtcMinimumVersion=38,window.webrtcDetectedType="webkit",window.webrtcDetectedDCSupport=window.webrtcDetectedVersion>30?"SCTP":"RTP";else if(/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString()||navigator.userAgent.match(/AppleWebKit\/(\d+)\./)||navigator.userAgent.match(/Version\/(\d+).(\d+)/)){e=navigator.userAgent.match(/version\/(\d+)\.(\d+)/i)||[];var n=navigator.userAgent.match(/AppleWebKit\/(\d+)/i)||[],r=navigator.userAgent.match(/(iPhone|iPad)/gi),i=n.length>=1&&n[1]>=604;if(window.webrtcDetectedBrowser="safari",window.webrtcDetectedVersion=parseInt(e[1]||"0",10),window.webrtcMinimumVersion=7,r)window.webrtcDetectedType=i?"AppleWebKit":null;else{var a=window.webrtcDetectedVersion,o=parseInt(e[2]||"0",10),s=11==a&&o<2;window.webrtcDetectedType=!i||E.a.options.forceSafariPlugin&&s?"plugin":"AppleWebKit"}window.webrtcDetectedDCSupport="SCTP"}E.a.webrtcDetectedBrowser=window.webrtcDetectedBrowser,E.a.webrtcDetectedVersion=window.webrtcDetectedVersion,E.a.webrtcMinimumVersion=window.webrtcMinimumVersion,E.a.webrtcDetectedType=window.webrtcDetectedType,E.a.webrtcDetectedDCSupport=window.webrtcDetectedDCSupport},E.a.addExtensions=function(){var e=null,t=null;navigator.mozGetUserMedia?(e=function(e,t){return e.srcObject=t,e},t=function(e,t){return e.srcObject=t.srcObject,e}):navigator.webkitGetUserMedia?(e=function(e,t){return E.a.webrtcDetectedVersion>=43?e.srcObject=t:"undefined"!==typeof e.src?e.src=URL.createObjectURL(t):console.error("Error attaching stream to element."),e},t=function(e,t){return E.a.webrtcDetectedVersion>=43?e.srcObject=t.srcObject:e.src=t.src,e}):"AppleWebKit"===E.a.webrtcDetectedType&&(e=function(e,t){return e.srcObject=t,e},t=function(e,t){return e.srcObject=t.srcObject,e}),window.attachMediaStream=e,window.reattachMediaStream=t,E.a.attachMediaStream=e,E.a.reattachMediaStream=t},E.a.parseWebrtcDetectedBrowser(),E.a.addExtensions(),E.a.maybeThroughWebRTCReady();var g=E.a,p=n(53),f=n.n(p),m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,r=Yd.getSkylinkState(n),i={audio:!1,video:!1},a=window,o=a.AdapterJS,s=r.currentCodecSupport,d=r.peerInformations,c=Yd.getInitOptions(),l=c.beSilentOnParseLogs;if(!e||!t||!t.sdp){if(i.video=!(!s.video.h264&&!s.video.vp8),i.audio=!!s.audio.opus,e){var u=((d[e]||{}).agent||{}).name||"";o.webrtcDetectedBrowser===u&&(i.video=Object.keys(s.video).length>0,i.audio=Object.keys(s.audio).length>0)}return i}var S=Zs.getSDPCodecsSupport(e,t,l),E=s;for(var g in E.audio)if(E.audio.hasOwnProperty(g)&&E.audio[g]&&S.audio[g]){i.audio=!0;break}for(var p in E.video)if(E.video.hasOwnProperty(p)&&E.video[p]&&S.video[p]){i.video=!0;break}return i},R=n(268),h="onIncomingStream",v="onIncomingScreenStream",I="streamEnded",O="peerUpdated",T="peerJoined",A="peerLeft",C="peerConnectionState",_="dataChannelState",N="onIncomingMessage",D="handshakeProgress",y="serverPeerJoined",M="serverPeerLeft",k="candidateProcessingState",P="candidateGenerationState",b="candidatesGathered",w="dataStreamState",L="dataTransferState",U="onIncomingData",G="onIncomingDataRequest",F="onIncomingDataStream",B="onIncomingDataStreamStarted",j="onIncomingDataStreamStopped",V="getPeersStateChange",x="sessionDisconnect",H="streamMuted",W="channelOpen",K="channelReopen",Y="channelClose",J="channelMessage",X="channelError",Q="channelRetry",q="socketError",z="systemAction",Z="mediaAccessFallback",$="mediaAccessRequired",ee="mediaAccessStopped",te="mediaAccessSuccess",ne="recordingState",re="localMediaMuted",ie="mediaAccessError",ae="getConnectionStatusStateChange",oe="readyStateChange",se="roomLock",de="introduceStateChange",ce="iceConnectionState",le="bye",ue="rtmpState",Se="loggedOnConsole",Ee="mediaInfoDeleted",ge="storedMessages",pe="encryptSecretsUpdated",fe="persistentMessageState",me=function e(t,n){Object(o.a)(this,e),this.name=t,this.detail=n},Re=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(h,{detail:e})},he=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(v,{detail:e})},ve=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(I,{detail:e})},Ie=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(H,{detail:e})},Oe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(_,{detail:e})},Te=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(N,{detail:e})},Ae=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(D,{detail:e})},Ce=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(oe,{detail:e})},_e=function(e){return new me(k,{detail:e})},Ne=function(e){return new me(P,{detail:e})},De=function(e){return new me(ce,{detail:e})},ye=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(se,{detail:e})},Me=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(O,{detail:e})},ke=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(T,{detail:e})},Pe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(A,{detail:e})},be=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(M,{detail:e})},we=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(V,{detail:e})},Le=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(C,{detail:e})},Ue=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(ae,{detail:e})},Ge=function(e){return new me(q,{detail:e})},Fe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(Z,{detail:e})},Be=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(ee,{detail:e})},je=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(te,{detail:e})},Ve=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(ue,{detail:e})},xe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(re,{detail:e})},He=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(ie,{detail:e})},We=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(Ee,{detail:e})},Ke=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(Se,{detail:e})},Ye={CONNECTING:"connecting",OPEN:"open",CLOSING:"closing",CLOSED:"closed",ERROR:"error",CREATE_ERROR:"createError",BUFFERED_AMOUNT_LOW:"bufferedAmountLow",SEND_MESSAGE_ERROR:"sendMessageError"},Je={MESSAGING:"messaging",DATA:"data"},Xe={MESSAGE:"message",TRANSFER:"transfer"},Qe={BINARY_STRING:"binaryString",ARRAY_BUFFER:"arrayBuffer",BLOB:"blob",STRING:"string"},qe="0.1.3",ze={UPLOAD:"upload",DOWNLOAD:"download"},Ze={BLOB:"blob",DATA_URL:"dataURL"},$e={UPLOAD_REQUEST:"request",UPLOAD_STARTED:"uploadStarted",DOWNLOAD_STARTED:"downloadStarted",REJECTED:"rejected",CANCEL:"cancel",ERROR:"error",UPLOADING:"uploading",DOWNLOADING:"downloading",UPLOAD_COMPLETED:"uploadCompleted",DOWNLOAD_COMPLETED:"downloadCompleted",USER_REJECTED:"userRejected",USER_UPLOAD_REQUEST:"userRequest",START_ERROR:"startError"},et={SENDING_STARTED:"sendStart",SENDING_STOPPED:"sendStop",RECEIVING_STARTED:"receiveStart",RECEIVING_STOPPED:"receiveStop",RECEIVED:"received",SENT:"sent",ERROR:"error",START_ERROR:"startError"},tt={NEW:"new",GATHERING:"gathering",COMPLETED:"complete"},nt={RECEIVED:"received",DROPPED:"dropped",BUFFERED:"buffered",PROCESSING:"processing",PROCESS_SUCCESS:"processSuccess",PROCESS_ERROR:"processError"},rt={STARTING:"starting",CHECKING:"checking",CONNECTED:"connected",COMPLETED:"completed",CLOSED:"closed",FAILED:"failed",TRICKLE_FAILED:"trickleFailed",DISCONNECTED:"disconnected"},it={UDP:"udp",TCP:"tcp",ANY:"any",NONE:"none",ALL:"all"},at={STABLE:"stable",HAVE_LOCAL_OFFER:"have-local-offer",HAVE_REMOTE_OFFER:"have-remote-offer",CLOSED:"closed"},ot={RETRIEVING:0,RETRIEVE_SUCCESS:1,RETRIEVE_ERROR:-1},st={MCU:"mcu"},dt={MAX_COMPAT:"max-compat",BALANCED:"balanced",MAX_BUNDLE:"max-bundle",NONE:"none"},ct={REQUIRE:"require",NEGOTIATE:"negotiate"},lt={RSA:"RSA",ECDSA:"ECDSA",AUTO:"AUTO"},ut={ENTER:"enter",WELCOME:"welcome",OFFER:"offer",ANSWER:"answer",ANSWER_ACK:"answerAck",ERROR:"error"},St={ENQUIRED:"enquired",DISPATCHED:"dispatched",RECEIVED:"received"},Et={INTRODUCING:"introducing",ERROR:"error"},gt={WARNING:"warning",REJECT:"reject",LOCKED:"locked"},pt={CREDENTIALS_EXPIRED:"oldTimeStamp",CREDENTIALS_ERROR:"credentialError",DUPLICATED_LOGIN:"duplicatedLogin",ROOM_NOT_STARTED:"notStart",EXPIRED:"expired",ROOM_LOCKED:"locked",FAST_MESSAGE:"fastmsg",ROOM_CLOSING:"toclose",ROOM_CLOSED:"roomclose",SERVER_ERROR:"serverError",KEY_ERROR:"keyFailed"},ft={INIT:0,LOADING:1,COMPLETED:2,ERROR:-1},mt={API_INVALID:4001,API_DOMAIN_NOT_MATCH:4002,API_CORS_DOMAIN_NOT_MATCH:4003,API_CREDENTIALS_INVALID:4004,API_CREDENTIALS_NOT_MATCH:4005,API_INVALID_PARENT_KEY:4006,API_NO_MEETING_RECORD_FOUND:4010,API_OVER_SEAT_LIMIT:4020,API_RETRIEVAL_FAILED:4021,API_WRONG_ACCESS_DOMAIN:5005,XML_HTTP_REQUEST_ERROR:-1,XML_HTTP_NO_REPONSE_ERROR:-2,NO_SOCKET_IO:1,NO_XMLHTTPREQUEST_SUPPORT:2,NO_WEBRTC_SUPPORT:3,NO_PATH:4,ADAPTER_NO_LOADED:7,PARSE_CODECS:8},Rt={APAC1:"",US1:""},ht={ENFORCE_OFFERER:"enforceOfferer",ENFORCE_ANSWERER:"enforceAnswerer",AUTO:"auto"},vt={DEBUG:4,LOG:3,INFO:2,WARN:1,ERROR:0,NONE:-1},It={CONNECTION_FAILED:0,RECONNECTION_FAILED:-1,CONNECTION_ABORTED:-2,RECONNECTION_ABORTED:-3,RECONNECTION_ATTEMPT:-4},Ot={NON_FALLBACK:"nonfallback",FALLBACK_PORT:"fallbackPortNonSSL",FALLBACK_SSL_PORT:"fallbackPortSSL",LONG_POLLING:"fallbackLongPollingNonSSL",LONG_POLLING_SSL:"fallbackLongPollingSSL"},Tt="2.1.0",At={AUTO:"auto",VP8:"VP8",H264:"H264",VP9:"VP9"},Ct={AUTO:"auto",ISAC:"ISAC",OPUS:"opus",ILBC:"ILBC",G722:"G722",PCMU:"PCMU",PCMA:"PCMA"},_t={SCREEN:"screen",WINDOW:"window",TAB:"tab",TAB_AUDIO:"audio",APPLICATION:"application",BROWSER:"browser",CAMERA:"camera"},Nt={QQVGA:{width:160,height:120},HQVGA:{width:240,height:160},QVGA:{width:320,height:240},WQVGA:{width:384,height:240},HVGA:{width:480,height:320},VGA:{width:640,height:480},WVGA:{width:768,height:480},FWVGA:{width:854,height:480},SVGA:{width:800,height:600},DVGA:{width:960,height:640},WSVGA:{width:1024,height:576},HD:{width:1280,height:720},HDPLUS:{width:1600,height:900},FHD:{width:1920,height:1080},QHD:{width:2560,height:1440},WQXGAPLUS:{width:3200,height:1800},UHD:{width:3840,height:2160},UHDPLUS:{width:5120,height:2880},FUHD:{width:7680,height:4320},QUHD:{width:15360,height:8640}},Dt={FALLBACKING:0,FALLBACKED:1,ERROR:-1},yt={START:0,STOP:1,LINK:2,ERROR:-1},Mt=49152,kt=12288,Pt=65456,bt=16384,wt=1212,Lt={WRQ:"WRQ",ACK:"ACK",ERROR:"ERROR",CANCEL:"CANCEL",MESSAGE:"MESSAGE"},Ut={JOIN_ROOM:"joinRoom",IN_ROOM:"inRoom",ENTER:"enter",WELCOME:"welcome",OFFER:"offer",ANSWER:"answer",ANSWER_ACK:"answerAck",CANDIDATE:"candidate",BYE:"bye",REDIRECT:"redirect",UPDATE_USER:"updateUserEvent",ROOM_LOCK:"roomLockEvent",PUBLIC_MESSAGE:"public",PRIVATE_MESSAGE:"private",STREAM:"stream",GROUP:"group",GET_PEERS:"getPeers",PEER_LIST:"peerList",INTRODUCE:"introduce",INTRODUCE_ERROR:"introduceError",APPROACH:"approach",START_RECORDING:"startRecordingRoom",STOP_RECORDING:"stopRecordingRoom",RECORDING:"recordingEvent",END_OF_CANDIDATES:"endOfCandidates",START_SCREENSHARE:"startScreenshare",START_RTMP:"startRTMP",STOP_RTMP:"stopRTMP",RTMP:"rtmpEvent",MEDIA_INFO_EVENT:"mediaInfoEvent",MUTE_VIDEO_EVENT:"muteVideoEvent",MUTE_AUDIO_EVENT:"muteAudioEvent",MESSAGE:"message",GET_STORED_MESSAGES:"getStoredMessages",STORED_MESSAGES:"storedMessages"},Gt={ENDED:"ended",REPLACED_STREAM_ENDED:"replacedStreamEnded",SCREENSHARE_REPLACE_START:"screenshareStart",USER_MEDIA_REPLACE_START:"userMediaReplaceStart"},Ft=[Ut.STREAM,Ut.UPDATE_USER,Ut.MUTE_AUDIO_EVENT,Ut.MUTE_VIDEO_EVENT,Ut.PUBLIC_MESSAGE],Bt={HD:{video:3200,audio:150},HQ:{video:1200,audio:80},SQ:{video:800,audio:30},LQ:{video:400,audio:20}},jt={PLAN_B:"plan-b",UNIFIED:"unified-plan"},Vt={START:0,STOP:1,ERROR:-1},xt={MUTED:0,ACTIVE:1,UNAVAILABLE:-1},Ht={SKYLINK_EVENT:"SKYLINK EVENT",SKYLINK_ERROR:"SKYLINK ERROR",STATS_MODULE:"RTCStatsReport",SESSION_DESCRIPTION:"RTCSessionDescription",PEER_CONNECTION:"RTCPeerConnection",CANDIDATE_HANDLER:"RTCIceCandidate",DATA_CHANNEL:"RTCDataChannel",SIG_SERVER:"SIG SERVER",PEER_MEDIA:"PEER MEDIA",PEER_INFORMATION:"PEER INFORMATION",ROOM:"ROOM",RECORDING:"RECORDING",MEDIA_STREAM:"MEDIA STREAM",MESSAGING:"MESSAGING",ASYNC_MESSAGING:"ASYNC MESSAGING",ENCRYPTED_MESSAGING:"ENCRYPTED MESSAGING"},Wt={AUDIO_MIC:"audioMic",VIDEO_CAMERA:"videoCamera",VIDEO_SCREEN:"videoScreen",VIDEO_OTHER:"videoOther",AUDIO:"audio",VIDEO:"video"},Kt={LIVE:"live",ENDED:"ended"},Yt={AUDIO:"audio",VIDEO:"video"},Jt={MUTED:"muted",ACTIVE:"active",STOPPED:"stopped",UNAVAILABLE:"unavailable"},Xt={PUBLISHER_ID:"publisherId",MEDIA_ID:"mediaId",MEDIA_TYPE:"mediaType",MEDIA_STATE:"mediaState",TRANSCEIVER_MID:"transceiverMid",MEDIA_META_DATA:"mediaMetaData",SIMULCAST:"simulcast",STREAM_ID:"streamId"},Qt="2.0.0",qt={WEB:"Web SDK",ANDROID:"Android SDK",IOS:"iOS SDK",CPP:"C++ SDK"},zt="9.0.0",Zt="sig-v2",$t={CHROME:"chrome",FIREFOX:"firefox",SAFARI:"safari",REACT_NATIVE:"react-native"},en={MCU:"MCU"},tn={CONNECT:"connect",DISCONNECT:"disconnect",RECONNECT_ATTEMPT:"reconnect_attempt",RECONNECT_SUCCESS:"reconnect_success",RECONNECT_FAILED:"reconnect_failed",RECONNECT_ERROR:"reconnect_error",MESSAGE:"message",ERROR:"error"},nn={POLLING:"Polling",WEBSOCKET:"WebSocket",XHR_POLLING:"xhr-polling",JSONP_POLLING:"jsonp-polling"},rn={SIGNALING:tn},an=r,on={INIT:{ERRORS:{NO_ADAPTER:"AdapterJS dependency is not loaded or incorrect AdapterJS dependency is used",NO_SOCKET_IO:"Socket.io not loaded - Please load socket.io",NO_FETCH_SUPPORT:"Fetch API is not supported in your browser. Please make sure you are using a modern browser: https://caniuse.com/#search=fetch",NO_APP_KEY:"Please provide an App Key - Get one at console.temasys.io!",AUTH_CORS:"Promise rejected due to CORS forbidden request - Please visit: http://support.temasys.com.sg/support/solutions/articles/12000006761-i-get-a-403-forbidden-access-is-denied-when-i-load-the-application-why-",AUTH_GENERAL:"Promise rejected due to network issue",SOCKET_CREATE_FAILED:"Failed creating socket connection object ->",SOCKET_ERROR_ABORT:"Reconnection aborted as the connection timed out or there no more available ports, transports and final attempts left"},INFO:{API_SUCCESS:"Promise resolved: APP Authenticated Successfully!"}},JOIN_ROOM:{ERRORS:{CODEC_SUPPORT:"No audio/video codecs available to start connection"}},ROOM:{ERRORS:{STOP:{SCREEN_SHARE:"Error stopping screenshare"},NOT_IN_ROOM:"User is not in room",NO_PEERS:"No peers in room"},LEAVE_ROOM:{ERROR:"Leave room error --\x3e",NO_PEERS:"No peers in room",DROPPING_HANGUP:"Dropping hang-up from remote peer",LEAVE_ALL_ROOMS:{SUCCESS:"Successfully left all rooms",ERROR:"Leave all rooms error --\x3e"},PEER_LEFT:{START:"Initiating peer left process",SUCCESS:"Successfully completed peer left process",ERROR:"Failed peer left process"},SENDING_BYE:"Sending bye message to all peers",DISCONNECT_SOCKET:{SUCCESS:"Successfully disconnected socket"},REMOVE_STATE:{SUCCESS:"Successfully removed room state"}}},ROOM_STATE:{NOT_FOUND:"Could not retrieve room state for room name/key",LEFT:"Peer left room",NO_ROOM_NAME:"No room name specified"},PEER_INFORMATIONS:{NO_PEER_INFO:"Not able to retrieve Peer Information for peerId:",UPDATE_USER_DATA:"Peer updated userData: ",OUTDATED_MSG:"Dropping outdated status ->",USER_DATA_NOT_JSON:"UserData is not JSON"},PEER_CONNECTION:{NO_PEER_CONNECTION:"No Peer Connection detected",ERRORS:{REMOVE_TRACK:"Error removing track from peer connection",REPLACE_TRACK:"Error replacing track in peer connection",REFRESH:"Error refreshing peer connection"},end_of_candidates:"Signaling of end-of-candidates remote ICE gathering",end_of_candidate_failure:"Failed signaling end-of-candidates ->",not_initialised:"Peer connection is not initialised",getstats_api_not_available:"getStats() API is not available",connection_status_no_pc:"There is currently no peer connections to retrieve connection status",ice_connection_state:"Ice connection state changed ->",peer_connection_state:"Peer connection state changed ->",ice_gathering_state:"Ice gathering state changed ->",refresh_start:"START: Refreshing peer connections",refresh_failed:"FAILED: Refreshing peer connections",refresh_completed:"All peer connections refreshed with resolve or errors",refresh_peer_failed:"Peer connection failed to refresh: ",refresh_peer_success:"Peer connection refreshed successfully: ",refresh_no_peer_connection:"There is currently no peer connections to restart",refresh_peerId_no_match:"PeerId does not match existing peer connections",refresh_no_edge_support:"Edge browser currently does not support renegotiation",refresh_not_supported:"Failed restarting with other agents connecting from other SDKs as re-negotiation is not supported by other SDKs",peerId_does_not_exist:"Peer Id does not exist ->"},PEER_PRIVILEGED:{not_privileged:"Please upgrade your key to privileged to use this function",no_appkey:"App key is not defined - Please authenticate again",getPeerListFromServer:"Enquired server for peers within the App space"},ICE_CANDIDATE:{CANDIDATE_HANDLER:{DROPPING_CANDIDATE:"Dropping ICE candidate",INVALID_CANDIDATE:"Received invalid ICE candidate message ->",VALID_CANDIDATE:"Received ICE candidate ->",FILTERED_CANDIDATE:"Dropping received ICE candidate as it matches ICE candidate filtering flag ->",FILTERING_FLAG_NOT_HONOURED:"Not dropping received ICE candidate as TURN connections are enforced as MCU is present (and act as a TURN itself) so filtering of ICE candidate flags are not honoured ->",CANDIDATE_ADDED:"Added ICE candidate successfully",ADDING_CANDIDATE:"Adding ICE Candidate",FAILED_ADDING_CANDIDATE:"Failed adding ICE candidate ->",ADD_BUFFERED_CANDIDATE:"Adding buffered ICE candidate",ADD_CANDIDATE_TO_BUFFER:"Adding ICE candidate to buffer",END_OF_CANDIDATES_SUCCESS:"Signaling of end-of-candidates remote ICE gathering",END_OF_CANDIDATES_FAILURE:"Failed signaling of end-of-candidates remote ICE gathering",ICE_GATHERING_STARTED:"ICE gathering has started",ICE_GATHERING_COMPLETED:"ICE gathering has completed",CANDIDATE_GENERATED:"Generated ICE candidate ->",DROP_EOC:"Dropping of sending ICE candidate end-of-candidates signal or unused ICE candidates ->",ICE_TRICKLE_DISABLED:"Dropping of sending ICE candidate as trickle ICE is disabled ->",SENDING_CANDIDATE:"Sending ICE candidate ->",NO_SDP:"Not sending any session description after ICE gathering completed as it is not present"}},SESSION_DESCRIPTION:{parsing_media_ssrc:"Parsing session description media SSRCs ->"},DATA_CHANNEL:{reviving_dataChannel:"Reviving Datachannel connection",refresh_error:"Not a valid Datachannel connection",CLOSING:"Closing DataChannel",closed:"Datachannel has closed",onclose_error:"Error in data-channel onclose callback",NO_REMOTE_DATA_CHANNEL:"Remote peer does not have data channel",ERRORS:{FAILED_CLOSING:"Failed closing DataChannels --\x3e ",NO_SESSIONS:"Peer Connection does not have DataChannel sessions"}},NEGOTIATION_PROGRESS:{SET_LOCAL_DESCRIPTION:"Successfully set local description --\x3e",SET_REMOTE_DESCRIPTION:"Successfully set remote description --\x3e",APPLYING_BUFFERED_REMOTE_OFFER:"Applying buffered remote offer",ERRORS:{FAILED_SET_LOCAL_DESCRIPTION:"Failed setting local description --\x3e",FAILED_SET_REMOTE_DESCRIPTION:"Failed setting remote description --\x3e",FAILED_SET_REMOTE_ANSWER:"Peer failed to set remote answer.",FAILED_RENEGOTIATION:"Failed renegotiation after answerAck",NOT_STABLE:"Dropping of message as signaling state is not stable",PROCESSING_EXISTING_SDP:"Dropping message as there is another sessionDescription being processed --\x3e",OFFER_TIEBREAKER:"Dropping the received offer: self weight is greater than incoming offer weight --\x3e",NO_LOCAL_BUFFERED_OFFER:"FATAL: No buffered local offer found - Unable to setLocalDescription",ADDING_REMOTE_OFFER_TO_BUFFER:"Adding remote offer received to buffer as current negotiation has not completed"}},SIGNALING:{MESSAGE_ADDED_TO_BUFFER:"Message buffered as enter message has not been sent",ENTER_LISTENER:"Enter listener initialized",BUFFERED_MESSAGES_SENT:"Buffered messages sent",BUFFERED_MESSAGES_DROPPED:"Buffered messages dropped - no mid",OUTDATED_MSG:"Dropping outdated status ->",DROPPING_MUTE_EVENT:"Dropping mute audio / video event message as it is processed by mediaInfoEvent",BUFFER_NOT_NEEDED:"Enter message sent. Messages do not need to be buffered",ABORTING_OFFER:"Aborting offer as current negotiation has not completed"},MESSAGING:{PRIVATE_MESSAGE:"Sending private message to Peer",BROADCAST_MESSAGE:"Broadcasting message to Peers",RECEIVED_MESSAGE:"Received message from Peer",PERSISTENCE:{SEND_MESSAGE:"Sending persisted message",NOT_PERSISTED:"Message will not be persisted as persistent flag is set to false",STORED_MESSAGES:"Received stored messages for room",IS_PERSISTENT_CONFIG:"Persistent message flag is set to",ERRORS:{FAILED_SETTING_PERSISTENCE:"Failed setting persistent message flag",INVALID_TYPE:"Persistent message flag must be of type boolean",PRIVATE_MESSAGE:"Cannot persist private messages",PERSISTENT_MESSAGE_FEATURE_NOT_ENABLED:"Persistent Message feature is not enabled. Enable this feature on the key under 'Advanced Settings' in the Temasys Console"}},ENCRYPTION:{SEND_MESSAGE:"Sending encrypted message",DELETE_ALL:"Deleting all stored secrets",ERRORS:{FAILED_DECRYPTING_MESSAGE:"Failed decrypting message",ENCRYPT_SECRET:"Incorrect secret provided",INVALID_SECRETS:"No or invalid secret and secret id provided",SET_SELECTED_SECRET:"Failed setting selected secret",DELETE_ENCRYPT_SECRETS:"Failed deleting secret",SET_ENCRYPT_SECRET:"Failed setting secret",SECRET_ID_NOT_FOUND:"Secret id not found",NO_SECRET_OR_SECRET_ID:"Secret and / or secret id not provided",INVALID_TYPE:"Secret and secret id must be of type string and not empty",SECRET_ID_NOT_UNIQUE:"Secret id provided is not unique",SECRET_ID_NOT_SELECTED:"Secret id not selected",SECRET_ID_NOT_PROVIDED:"Secret id not provided",SECRETS_NOT_PROVIDED:"Secrets not provided"}},ERRORS:{DROPPING_MESSAGE:"Dropping message",FAILED_SENDING_MESSAGE:"Failed to send user message"}},MEDIA_INFO:{UPDATE_SUCCESS:"Successfully updated media info",ERRORS:{NO_ASSOCIATED_STREAM_ID:"There is no streamId associated with the mediaId and transceiverMid pair",FAILED_PROCESSING_MEDIA_INFO_EVENT:"Failed to process mediaInfoEvent message",FAILED_UPDATING:"Failed to update media info",FAILED_PROCESSING_PEER_MEDIA:"Failed to process media info",FAILED_UPDATING_TRANSCEIVER_MID:"Failed updating media info transceiverMid after setLocalDescription",FAILED_SETTING_PEER_MEDIA_INFO:"Failed setting peer media at offer / answer"},WARN:{READ_ONLY_VALUE:"Attempting to change media info read only value: ",INVALID_MEDIA_TYPE:"Invalid media info media type: "},VIDEO_STATE_CHANGE:"Peers's video state changed to ->",AUDIO_STATE_CHANGE:"Peers's audio state changed to ->",VIDEO_SCREEN_STATE_CHANGE:"Peers's video screen state changed to ->"},MEDIA_STREAM:{STOP_SETTINGS:"Stopped streams with settings:",STOP_SUCCESS:"Successfully stopped and removed stream from state",REMOTE_TRACK_REMOVED:"Remote MediaStreamTrack removed",START_FALLBACK:"Fall back to retrieve audio only stream",NO_OPTIONS:"No user media options provided",DEFAULT_OPTIONS:"Using default options",FALLBACK_SUCCESS:"Successfully retrieved audio fallback stream",START_SCREEN_SUCCESS:"Successfully retrieved screen share stream",STOP_SCREEN_SUCCESS:"Successfully stopped screen share stream",UPDATE_MUTED_SETTINGS:"Updated stream muted setting",UPDATE_MEDIA_STATUS:"Updated stream media status",AUDIO_MUTED:"Peers's audio muted: ",VIDEO_MUTED:"Peers's video muted: ",ERRORS:{STOP_SCREEN:"Error stopping screen share stream",START_SCREEN:"Error starting screen share stream",STOP_ADDED_STREAM:"Error stopping added stream",STOP_REPLACED_STREAM:"Error stopping replaced stream",STOP_USER_MEDIA:"Error stopping user media",STOP_AUDIO_TRACK:"Error stopping audio tracks in stream",STOP_VIDEO_TRACK:"Error stopping video tracks in stream",STOP_MEDIA_TRACK:"Error stopping MediaTrack",STOP_SCREEN_TRACK:"Error stopping screen track in stream",DROPPING_ONREMOVETRACK:"Dropping onremovetrack",NO_STREAM:"No stream to process",INVALID_STREAM_ID:"No stream detected with stream id",NO_USER_MEDIA_STREAMS:"No user media streams detected",INVALID_STREAM_ID_TYPE:"Stream id is not a string",NO_STREAM_ID:"No stream id provided",PEER_SCREEN_ACTIVE:"Peer has existing screen share",REPLACE_SCREEN:"Error replacing user media stream with screenshare stream",FALLBACK:"Error retrieving fallback audio stream",INVALID_GUM_OPTIONS:"Invalid user media options",GET_USER_MEDIA:"Error retrieving stream from 'getUserMedia' method",INVALID_MUTE_OPTIONS:"Invalid muteStreams options provided",NO_STREAMS_MUTED:"No streams to mute",SEND_STREAM:"Error sending stream",INVALID_MEDIA_STREAM_ARRAY:"Array is not of type MediaStream",ACTIVE_STREAMS:"There are currently active streams being sent to remote peers. Please stop streams."}},STATS_MODULE:{NOT_INITIATED:"Stats Module is not initiated",STATS_DISCARDED:"Stats report discarded as peer has left the room",ERRORS:{RETRIEVE_STATS_FAILED:"Failed retrieving stats",POST_FAILED:"Failed posting to stats api",PARSE_FAILED:"Failed parsing stats report",STATS_IS_NULL:"Stats object is null",INVALID_TRACK_KIND:"Media kind is not audio or video"},HANDLE_ICE_GATHERING_STATS:{PROCESS_FAILED:"process_failed",PROCESS_SUCCESS:"process_success",PROCESSING:"processing",DROPPED:"dropped",BUFFERED:"buffered"},HANDLE_NEGOTIATION_STATS:{OFFER:{create:"create_offer",create_error:"error_create_offer",set:"set_offer",set_error:"error_set_offer",offer:"offer",dropped:"dropped_offer"},ANSWER:{create:"create_answer",create_error:"error_create_answer",set:"set_answer",set_error:"error_set_ANSWER",answer:"answer",dropped:"dropped_answer"}},HANDLE_DATA_CHANNEL_STATS:{open:"open",closed:"closed",reconnecting:"reconnecting"},HANDLE_CONNECTION_STATS:{},HANDLE_BANDWIDTH_STATS:{RETRIEVE_FAILED:"Failed posting bandwidth stats: ",NO_STATE:"No room state"},HANDLE_ICE_CONNECTION_STATS:{RETRIEVE_FAILED:"Failed retrieving stats: ",SEND_FAILED:"Failed sending ice connection stats: "},HANDLE_RECORDING_STATS:{START:"start",STOP:"stop",REQUEST_START:"request-start",REQUEST_STOP:"request-stop",ERROR_NO_MCU_START:"error-no-mcu-start",ERROR_NO_MCU_STOP:"error-no-mcu-stop",ERROR_START_ACTIVE:"error-start-when-active",ERROR_STOP_ACTIVE:"error-stop-when-active",ERROR_MIN_STOP:"error-min-stop",MCU_RECORDING_ERROR:"mcu-recording-error"}},RECORDING:{START_SUCCESS:"Started recording",STOP_SUCCESS:"Stopped recording",START_FAILED:"Failed to start recording",STOP_FAILED:"Failed to stop recording",MIN_RECORDING_TIME_REACHED:"4 seconds has been recorded - Recording can be stopped now",ERRORS:{MCU_NOT_CONNECTED:"MCU is not connected",EXISTING_RECORDING_IN_PROGRESS:"There is an existing recording in-progress",NO_RECORDING_IN_PROGRESS:"There is no existing recording in-progress",MIN_RECORDING_TIME:"4 seconds has not been recorded yet",STOP_ABRUPT:"Recording stopped abruptly before 4 seconds",SESSION_EMPTY:'Received request of "off" but the session is empty',MCU_RECORDING_ERROR:"Recording error received from MCU"}},RTMP:{start_no_mcu:"Unable to start RTMP session as MCU is not connected",stop_no_mcu:"Unable to stop RTMP as MCU is not connected",start_no_stream_id:"Unable to start RTMP Session stream id is missing",start_no_endpoint:"Unable to start RTMP Session as Endpoint is missing",starting_rtmp:"Starting RTMP Session",stopping_rtmp:"Stopping RTMP Session",message_received_from_sig:"Received RTMP Session message ->",stop_session_empty:'Received request of "off" but the session is empty',stopped_success:"Stopped RTMP Session",started_success:"Started RTMP Session",error_session_empty:"Received error but the session is empty ->",error_session:"RTMP session failure ->",error_Session_abrupt:"Stopped RTMP session abruptly"},PERSISTENT_MESSAGE:{ERRORS:{NO_DEPENDENCY:"CryptoJS is not available"}},UTILS:{INVALID_BROWSER_AGENT:"Invalid browser agent"},LOGGER:{EVENT_DISPATCHED:"Event dispatched",EVENT_REGISTERED:"Event successfully registered",EVENT_UNREGISTERED:"Event successfully unregistered",EVENT_DISPATCH_ERROR:"Error dispatching event",EVENT_REGISTER_ERROR:"Error registering event",EVENT_UNREGISTER_ERROR:"Error unregistering event",LOGS_NOT_STORED:"Store logs feature is not enabled. Enable it via SkylinkLogger.setLevel(logLevel, storeLogs)",LOGS_CLEARED:"Stored logs cleared",INVALID_CB:"Dropping listener as it is not a function"},BROWSER_AGENT:{REACT_NATIVE:{ERRORS:{DROPPING_ONREMOVETRACK:"Dropping onremovetrack as trackInfo is malformed"}}}},sn=function(e,t){var n=Yd.getSkylinkState(t.room.id),r=e||{};if(n.userData=r.userData||n.userData||"",n.streamsBandwidthSettings={googleX:{},bAS:{}},n.publishOnly=!1,n.sdpSettings={connection:{audio:!0,video:!0,data:!0},direction:{audio:{send:!0,receive:!0},video:{send:!0,receive:!0}}},n.voiceActivityDetection="boolean"!==typeof r.voiceActivityDetection||r.voiceActivityDetection,n.peerConnectionConfig={bundlePolicy:dt.BALANCED,rtcpMuxPolicy:ct.REQUIRE,iceCandidatePoolSize:0,certificate:lt.AUTO,disableBundle:!1},n.bandwidthAdjuster=null,r.bandwidth&&("number"===typeof r.bandwidth.audio&&(n.streamsBandwidthSettings.bAS.audio=r.bandwidth.audio),"number"===typeof r.bandwidth.video&&(n.streamsBandwidthSettings.bAS.video=r.bandwidth.video),"number"===typeof r.bandwidth.data&&(n.streamsBandwidthSettings.bAS.data=r.bandwidth.data)),r.googleXBandwidth&&("number"===typeof r.googleXBandwidth.min&&(n.streamsBandwidthSettings.googleX.min=r.googleXBandwidth.min),"number"===typeof r.googleXBandwidth.max&&(n.streamsBandwidthSettings.googleX.max=r.googleXBandwidth.max)),r.sdpSettings&&(r.sdpSettings.direction&&(r.sdpSettings.direction.audio&&(n.sdpSettings.direction.audio.receive="boolean"!==typeof r.sdpSettings.direction.audio.receive||r.sdpSettings.direction.audio.receive,n.sdpSettings.direction.audio.send="boolean"!==typeof r.sdpSettings.direction.audio.send||r.sdpSettings.direction.audio.send),r.sdpSettings.direction.video&&(n.sdpSettings.direction.video.receive="boolean"!==typeof r.sdpSettings.direction.video.receive||r.sdpSettings.direction.video.receive,n.sdpSettings.direction.video.send="boolean"!==typeof r.sdpSettings.direction.video.send||r.sdpSettings.direction.video.send)),r.sdpSettings.connection&&(n.sdpSettings.connection.audio="boolean"!==typeof r.sdpSettings.connection.audio||r.sdpSettings.connection.audio,n.sdpSettings.connection.video="boolean"!==typeof r.sdpSettings.connection.video||r.sdpSettings.connection.video,n.sdpSettings.connection.data="boolean"!==typeof r.sdpSettings.connection.data||r.sdpSettings.connection.data)),r.publishOnly&&(n.sdpSettings.direction.audio.send=!0,n.sdpSettings.direction.audio.receive=!1,n.sdpSettings.direction.video.send=!0,n.sdpSettings.direction.video.receive=!1,n.publishOnly=!0),r.peerConnection&&"object"===typeof r.peerConnection){if("string"===typeof r.peerConnection.bundlePolicy)for(var i in dt)dt.hasOwnProperty(i)&&dt[i]===r.peerConnection.bundlePolicy&&(n.peerConnectionConfig.bundlePolicy=r.peerConnection.bundlePolicy);if("string"===typeof r.peerConnection.rtcpMuxPolicy)for(var a in ct)ct.hasOwnProperty(a)&&ct[a]===r.peerConnection.rtcpMuxPolicy&&(n.peerConnectionConfig.rtcpMuxPolicy=r.peerConnection.rtcpMuxPolicy);if("number"===typeof r.peerConnection.iceCandidatePoolSize&&r.peerConnection.iceCandidatePoolSize>0&&(n.peerConnectionConfig.iceCandidatePoolSize=r.peerConnection.iceCandidatePoolSize),"string"===typeof r.peerConnection.certificate)for(var o in lt)lt.hasOwnProperty(o)&&lt[o]===r.peerConnection.certificate&&(n.peerConnectionConfig.certificate=r.peerConnection.certificate);n.peerConnectionConfig.disableBundle=!0===r.peerConnection.disableBundle}return r.autoBandwidthAdjustment&&(n.bandwidthAdjuster={interval:10,limitAtPercentage:100,useUploadBwOnly:!1},"object"===typeof r.autoBandwidthAdjustment&&("number"===typeof r.autoBandwidthAdjustment.interval&&r.autoBandwidthAdjustment.interval>=10&&(n.bandwidthAdjuster.interval=r.autoBandwidthAdjustment.interval),"number"===typeof r.autoBandwidthAdjustment.limitAtPercentage&&r.autoBandwidthAdjustment.limitAtPercentage>=0&&r.autoBandwidthAdjustment.limitAtPercentage<=100&&(n.bandwidthAdjuster.limitAtPercentage=r.autoBandwidthAdjustment.limitAtPercentage),"boolean"===typeof r.autoBandwidthAdjustment.useUploadBwOnly&&(n.bandwidthAdjuster.useUploadBwOnly=r.autoBandwidthAdjustment.useUploadBwOnly))),n},dn=n(11),cn=n.n(dn),ln=function(e,t){for(var n=Yd.getSkylinkState(e.id).peerConnections,r=Object.values(n),i=null,a=0;a<r.length;a+=1)for(var o=r[a].getTransceivers(),s=0;s<o.length;s+=1)if(o[s].sender.track&&o[s].sender.track.id===t.id){i=o[s].mid;break}return i},un=function(e){return e.readyState===Kt.ENDED?Jt.UNAVAILABLE:e.muted?Jt.MUTED:Jt.ACTIVE},Sn=function(e,t){var n=e===Yt.AUDIO?"AUDIO":"VIDEO";return"".concat(n,"_").concat(t)},En=function(e,t,n,r,i){return{publisherId:t,mediaId:jo.retrieveMediaId(n.kind,r),mediaType:i,mediaState:jo.retrieveMediaState(n),transceiverMid:jo.retrieveTransceiverMid(e,n),streamId:r,trackId:n.id,mediaMetaData:"",simulcast:""}},gn=function(e,t){return e.id===t.id},pn=function(e,t){for(var n=Yd.getSkylinkState(e.id).streams,r=Object.values(n.userMedia),i=null,a=0;a<r.length;a+=1)for(var o=r[a].stream.getTracks(),s=0;s<o.length;s+=1)if(gn(o[s],t)){i=r[a].id;break}return i},fn=function(e){var t=Yd.getSkylinkState(e.id).streams,n=[];return Object.values(t.userMedia).map((function(e){return e.stream})).forEach((function(e){e.getTracks().forEach((function(e){n.push(e)}))})),n},mn=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=Yd.getSkylinkState(e.id);!o&&i&&a?(s.peerMedias[t][r][i]=a,Xs.log.INFO([t,Ht.PEER_MEDIA,null,"".concat(on.MEDIA_INFO.UPDATE_SUCCESS," -- ").concat(r," - ").concat(i,": ").concat(a)])):!o||i||a||(s.peerMedias[t]=s.peerMedias[t]||{},s.peerMedias[t][r]=o),Yd.setSkylinkState(s,e.id)},Rn=function(e,t,n,r){var i=Yd.getSkylinkState(e.id);i.user.sid===t&&n&&jo.sendMediaInfoMsg(e,i.peerMedias[t][r])},hn=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];try{mn(e,t,n,r,i,a,o),Rn(e,t,n,r)}catch(d){var s=o?JSON.stringify(o):"".concat(r," - ").concat(i,": ").concat(a);Xs.log.ERROR([t,Ht.PEER_MEDIA,null,"".concat(on.MEDIA_INFO.ERRORS.FAILED_UPDATING," -- ").concat(s)],d)}},vn={RECONNECTION_ATTEMPTS:{WEBSOCKET:5,POLLING:4},RECONNECTION_DELAY_MAX:5e3,RECONNECTION_DELAY:1e3,RECONNECTION_FINAL_ATTEMPTS:10},In={SOCKET:function(e){return{forceNew:!0,reconnection:!0,timeout:e.socketTimeout,path:e.socketServerPath,reconnectionAttempts:vn.RECONNECTION_ATTEMPTS.WEBSOCKET,reconnectionDelayMax:vn.RECONNECTION_DELAY_MAX,reconnectionDelay:vn.RECONNECTION_DELAY,transports:[nn.WEBSOCKET.toLowerCase()],query:{Skylink_SDK_type:qt.WEB,Skylink_SDK_version:Qt,Skylink_API_version:zt,"X-Server-Select":Zt},extraHeaders:{Skylink_SDK_type:qt.WEB,Skylink_SDK_version:Qt,Skylink_API_version:zt,"X-Server-Select":Zt}}}},On=vn,Tn=function(e,t){return In[e](t)},An=function(e){var t=Yd.getSkylinkState(e.roomKey),n=Yd.getInitOptions(),r=e.config,i=n.socketServer,a=n.socketTimeout,o=n.socketServerPath,s=t.socketPorts,d=Tn("SOCKET",{socketTimeout:a,socketServerPath:o}),c=[];c=i&&gs(i)&&Array.isArray(i.ports)&&i.ports.length?i.ports:s[r.signalingServerProtocol],!function(e){return!e.signalingServerPort}(r)?function(e,t){return e.indexOf(t.signalingServerPort)===e.length-1}(c,r)||hs(n.socketServer)?r.socketType===nn.WEBSOCKET?(r.socketType=nn.POLLING,r.signalingServerPort=c[0]):(r.socketSession.finalAttempts+=1,r.signalingServerPort=c[0]):r.signalingServerPort=c[c.indexOf(r.signalingServerPort)+1]:(r.signalingServerPort=c[0],r.fallbackType=Ot.NON_FALLBACK),r.socketType===nn.POLLING&&(d.reconnectionDelayMax=On.RECONNECTION_DELAY_MAX,d.reconnectionAttempts=On.RECONNECTION_ATTEMPTS.POLLING,d.transports=[nn.XHR_POLLING,nn.JSONP_POLLING,nn.POLLING.toLowerCase()]);var l=function(e){var t=e.signalingServerProtocol,n=e.signalingServer,r=e.signalingServerPort,i=e.socketServer;return hs(n)?"".concat(t,"//").concat(n):n&&gs(n)&&n.protocol?"".concat(n.protocol,"//").concat(i.url,":").concat(r,"?rand=").concat(Date.now()):"".concat(t,"//").concat(n,":").concat(r,"?rand=").concat(Date.now())}({signalingServerProtocol:r.signalingServerProtocol,signalingServer:t.socketServer,signalingServerPort:r.signalingServerPort,socketServer:i});return r.socketServer=i,r.socketServerPath=o,t.socketSession=r,Yd.setSkylinkState(t,e.roomKey),window.io(l,d)},Cn=function(e,t){var n=t.type;switch(Xs.log.INFO(["SIG SERVER",null,n,"received"]),n){case Ut.IN_ROOM:e.inRoomHandler(t);break;case Ut.ENTER:e.enterRoomHandler(t);break;case Ut.OFFER:e.offerHandler(t);break;case Ut.WELCOME:e.welcomeHandler(t);break;case Ut.ANSWER:e.answerHandler(t);break;case Ut.ANSWER_ACK:e.answerAckHandler(t);break;case Ut.CANDIDATE:e.candidateHandler(t);break;case Ut.PEER_LIST:e.getPeerListHandler(t);break;case Ut.INTRODUCE_ERROR:e.introduceError(t);break;case Ut.BYE:e.byeHandler(t);break;case Ut.STREAM:e.streamHandler(t);break;case Ut.RECORDING:e.recordingHandler(t);break;case Ut.REDIRECT:e.redirectHandler(t);break;case Ut.RTMP:e.rtmpHandler(t);break;case Ut.UPDATE_USER:e.setUserDataHandler(t);break;case Ut.MEDIA_INFO_EVENT:e.mediaInfoEventHandler(t);break;case Ut.MESSAGE:e.userMessageHandler(t,null);break;case Ut.STORED_MESSAGES:e.storedMessagesHandler(t);break;case Ut.MUTE_AUDIO_EVENT:e.muteAudioEventHandler(t);break;case Ut.MUTE_VIDEO_EVENT:e.muteVideoEventHandler(t);break;case Ut.PUBLIC_MESSAGE:e.userMessageHandler(t,!0);break;case Ut.PRIVATE_MESSAGE:e.userMessageHandler(t,!1)}},_n=function(e,t){var n=null;if(!e)return null;var r=Yd.getSkylinkState(t.id);return r?function(e,t){return e===t.user.sid}(e,r)?Hn.getCurrentSessionInfo(t):(n=cn()(r.peerInformations[e]))?(n.room=cn()(t.roomName),n.settings.data=!!(r.dataChannels[e]&&r.dataChannels[e].main&&r.dataChannels[e].main.channel&&r.dataChannels[e].main.channel.readyState===Ye.OPEN),n.connected=r.peerConnStatus[e]&&!!r.peerConnStatus[e].connected,n.init=r.peerConnStatus[e]&&!!r.peerConnStatus[e].init,e===en.MCU?(n.config.receiveOnly=!0,n.config.publishOnly=!1):r.hasMCU&&(n.config.receiveOnly=!1,n.config.publishOnly=!0),n.settings.audio||n.settings.video||(n.config.receiveOnly=!0,n.config.publishOnly=!1),n):(Xs.log.ERROR("".concat(on.PEER_INFORMATIONS.NO_PEER_INFO," ").concat(e)),n):(Yd.logNoRoomState(t.id),n)},Nn=function(e){var t=Yd.getSkylinkState(e.id),n=Yd.getInitOptions(),r=window.AdapterJS,i=n.enableDataChannel,a=n.codecParams,o=e.roomName,s=t.streamsMediaStatus,d=t.userData,c=t.peerPriorityWeight,l=t.enableIceRestart,u=t.publishOnly,S=t.SMProtocolVersion,E=t.DTProtocolVersion,g=t.streams,p=t.streamsBandwidthSettings,f=t.sdpSettings,m=t.user,R={userData:d,settings:{audio:!1,video:!1},mediaStatus:{},agent:{name:r.webrtcDetectedBrowser,version:r.webrtcDetectedVersion,os:window.navigator.platform,pluginVersion:r.WebRTCPlugin.plugin?r.WebRTCPlugin.plugin.VERSION:null,SMProtocolVersion:S,DTProtocolVersion:E,SDKVersion:Qt},room:o,config:{enableDataChannel:i,enableIceRestart:l,priorityWeight:c,receiveOnly:!1,publishOnly:u},sid:m.sid,screenshare:!1};if(g&&g.userMedia){var h=Object.keys(g.userMedia);g.userMedia[h[0]]&&(R.settings=cn()(g.userMedia[h[0]].settings))}return R.mediaStatus=s,R.userData=d||null,R.config.receiveOnly=!R.settings.video&&!R.settings.audio,g.screenshare&&(R.screenshare=!0),R.settings.maxBandwidth=cn()(p.bAS),R.settings.googleXBandwidth=cn()(p.googleX),R.settings.bandwidth&&(R.settings.maxBandwidth=cn()(R.settings.bandwidth),delete R.settings.bandwidth),R.settings.data=i&&f.connection.data,R.settings.audio&&gs(R.settings.audio)&&(Rs(typeof a.audio.opus.stereo)&&(R.settings.audio.stereo=a.audio.opus.stereo),Rs(a.audio.opus.usedtx)&&(R.settings.audio.usedtx=a.audio.opus.usedtx),fs(a.audio.opus.maxplaybackrate)&&(R.settings.audio.maxplaybackrate=a.audio.opus.maxplaybackrate),Rs(a.audio.opus.useinbandfec)&&(R.settings.audio.useinbandfec=a.audio.opus.useinbandfec)),R.settings.video&&gs(R.settings.video)&&(R.settings.video.customSettings={},R.settings.video.frameRate&&gs(R.settings.video.frameRate)&&(R.settings.video.customSettings.frameRate=cn()(R.settings.video.frameRate),R.settings.video.frameRate=-1),R.settings.video.facingMode&&gs(R.settings.video.facingMode)&&(R.settings.video.customSettings.facingMode=cn()(R.settings.video.facingMode),R.settings.video.facingMode="-1"),R.settings.video.resolution&&gs(R.settings.video.resolution)&&(R.settings.video.resolution.width&&gs(R.settings.video.resolution.width)&&(R.settings.video.customSettings.width=cn()(R.settings.video.width),R.settings.video.resolution.width=-1),R.settings.video.resolution.height&&gs(R.settings.video.resolution.height)&&(R.settings.video.customSettings.height=cn()(R.settings.video.height),R.settings.video.resolution.height=-1))),R.settings.audio||R.settings.video||(R.config.receiveOnly=!0,R.config.publishOnly=!1),cn()(R)},Dn=function(e){var t=xn.getCurrentSessionInfo(e);return delete t.room,t},yn=function(e,t){if(t&&e.peerInformations[t]){var n=e.peerInformations[t].userData;return n||(n=""),n}return e.userData},Mn=function(e,t){var n=Yd.getSkylinkState(e.id),r=on.PEER_INFORMATIONS.UPDATE_USER_DATA,i=t||"";n.userData=i,Yd.setSkylinkState(n,n.room.id),(new Bo).setUserData(n),Bs(Me({peerId:n.user.sid,peerInfo:xn.getCurrentSessionInfo(e),isSelf:!0})),Xs.log.INFO(r,i)},kn=function(e,t){var n=e.streams;return!!n.userMedia&&Object.values(n.userMedia).some((function(e){return e.isReplaced&&e.id===t.id}))},Pn=function(e,t){return!(!e||!e[0])&&(e.forEach((function(e){try{e.stop()}catch(n){Xs.log.ERROR([t,Ht.MEDIA_STREAM,null,"".concat(on.MEDIA_STREAM.ERRORS.STOP_MEDIA_TRACK," - track id: ").concat(e.id)],n)}})),!0)},bn=function(e,t,n){var r=e.room,i=e,a=-1;if(i.currentRTCRTPSenders[t]){for(var o=i.currentRTCRTPSenders[t],s=0;s<o.length;s+=1)if(n===o[s]){a=s;break}-1!==a?(o.splice(a,1),i.currentRTCRTPSenders[t]=o,Yd.setSkylinkState(i,r.id)):Xs.log.WARN([t,null,null,"No matching sender was found for the peer."],n)}},wn=function(e,t){var n=e.streams;return!!n.userMedia&&Object.values(n.userMedia).some((function(e){return e.isReplaced&&e.id===t.id}))},Ln={prepStopStreams:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Promise((function(i,a){var o=Yd.getSkylinkState(e),s=o.streams;o&&s||a(new Error("".concat(on.ROOM_STATE.NOT_FOUND," - ").concat(e))),(!s||!r&&!s.userMedia||r&&!s.screenshare||r&&s.screenshare&&s.screenshare.id!==t)&&a(new Error("".concat(on.MEDIA_STREAM.ERRORS.NO_STREAM," - ").concat(t))),r?Ln.prepStopScreenStream(o.room,t,n).then((function(){return i()})).catch((function(e){return a(e)})):Ln.prepStopUserMediaStreams(o,t,n).then((function(){return i()})).catch((function(e){return a(e)}))}))},prepStopUserMediaStreams:function(e,t,n){return new Promise((function(r,i){var a=e.user,o=function(e){var t=e.streams,n={replacedStreams:[],addedStreams:[]};return Object.keys(t.userMedia).forEach((function(r){kn(e,t.userMedia[r].stream)?n.replacedStreams.push(t.userMedia[r].stream):n.addedStreams.push(t.userMedia[r].stream)})),n}(e);try{if(t){var s=e.streams.userMedia[t].stream;kn(e,s)?Ln.stopReplacedStream(e,s,n):Ln.stopAddedStream(e,s,!1,n)}else Ln.stopAddedStreams(e,o.addedStreams,!1,n),Ln.stopReplacedStreams(e,o.replacedStreams,!1,n);return Ln.initRefreshConnectionAndResolve(e.room,n,r,i)}catch(d){Xs.log.DEBUG([a.sid,Ht.MEDIA_STREAM,null,on.MEDIA_STREAM.ERRORS.STOP_USER_MEDIA],d),i(on.MEDIA_STREAM.ERRORS.STOP_USER_MEDIA)}}))},stopAddedStream:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=e.room,a=e.user;try{Ln.tryStopStream(t,a.sid),r||(Ln.removeTracks(i,t),Ln.updateMediaInfoMediaState(i,t),Ln.deleteStreamFromState(i,t,n),Ln.listenForEventAndDeleteMediaInfo(i,t),Ln.dispatchOnLocalStreamEnded(i,t,n),n&&new dd(e).deleteScreensharingInstance(i))}catch(o){Xs.log.ERROR([a.sid,Ht.MEDIA_STREAM,null,on.MEDIA_STREAM.ERRORS.STOP_ADDED_STREAM],o)}},tryStopStream:function(e,t){if(e){try{Pn(e.getAudioTracks())}catch(n){Xs.log.ERROR([t,Ht.MEDIA_STREAM,null,"".concat(on.MEDIA_STREAM.ERRORS.STOP_AUDIO_TRACK," - stream id: ").concat(e.id)],n)}try{Pn(e.getVideoTracks())}catch(n){Xs.log.ERROR([t,Ht.MEDIA_STREAM,null,"".concat(on.MEDIA_STREAM.ERRORS.STOP_VIDEO_TRACK," - stream id: ").concat(e.id)],n)}}},removeTracks:function(e,t){var n=Yd.getSkylinkState(e.id),r=n.peerConnections,i=n.user,a=t.getTracks();try{a.forEach((function(e){!function(e,t,n){for(var r=n.id,i=Object.keys(t),a=0;a<i.length;a+=1)try{var o=i[a],s=t[o];if(s.connectionState===at.CLOSED)break;for(var d=s.getSenders(),c=null,l=0;l<d.length;l+=1)d[l].track&&d[l].track.id===r&&(c=d[l],s.removeTrack(c),bn(e,o,c))}catch(u){Xs.log.ERROR([i[a],Ht.PEER_CONNECTION,null,on.PEER_CONNECTION.ERRORS.REMOVE_TRACK],u)}}(n,r,e)}))}catch(o){Xs.log.ERROR([i.sid,Ht.PEER_CONNECTION,null,on.PEER_CONNECTION.ERRORS.REMOVE_TRACK],o)}},listenForEventAndDeleteMediaInfo:function(e,t){var n=Yd.getSkylinkState(e.id),r=function(r){var i=t,a=n.user;if(r.detail.state===ut.OFFER){var o=Vo.retrieveMediaId(Ms(i)?Yt.AUDIO:Yt.VIDEO,i.id);Vo.deleteUnavailableMedia(e,a.sid,o)}};Gs(an.HANDSHAKE_PROGRESS,r),Gs(an.MEDIA_INFO_DELETED,(function e(){Fs(an.HANDSHAKE_PROGRESS,r),Fs(an.MEDIA_INFO_DELETED,e)}))},stopAddedStreams:function(e,t,n,r){t.forEach((function(t){Ln.stopAddedStream(e,t,n,r)}))},updateMediaInfoMediaState:function(e,t){var n=Yd.getSkylinkState(e.id).user,r=t.id,i=Vo.retrieveMediaId(t.getTracks()[0].kind,r);Vo.setMediaStateToUnavailable(e,n.sid,i)},deleteStreamFromState:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=Yd.getSkylinkState(e.id),i=r.user,a=t.id;n?(delete r.streams.screenshare,delete r.streamsMediaStatus[t.id],delete r.streamsMutedSettings[t.id],r.streams.screenshare=null,Xs.log.INFO([i.sid,Ht.MEDIA_STREAM,null,"".concat(on.MEDIA_STREAM.STOP_SUCCESS," - stream id: ").concat(t.id," (screenshare)")])):(delete r.streams.userMedia[a],delete r.streamsMediaStatus[t.id],delete r.streamsMutedSettings[t.id],us(r.streams.userMedia)&&(r.streams.userMedia=null),Xs.log.INFO([i.sid,Ht.MEDIA_STREAM,null,"".concat(on.MEDIA_STREAM.STOP_SUCCESS," - stream id: ").concat(t.id)])),Yd.setSkylinkState(r,r.room.id)},dispatchOnLocalStreamEnded:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Yd.getSkylinkState(e.id),i=on.MEDIA_STREAM,a=r.user,o=!0;Xs.log.INFO([a.sid,Ht.MEDIA_STREAM,null,i.STOP_SETTINGS],{peerId:a.sid,isSelf:o,isScreensharing:n,stream:t}),Bs(ve({room:e,peerId:a.sid,peerInfo:Hn.getCurrentSessionInfo(e),isSelf:o,isScreensharing:n,streamId:t.id,isVideo:ks(t),isAudio:Ms(t)})),Bs(Be({isScreensharing:n,streamId:t.id})),Bs(Me({peerId:a.sid,peerInfo:xn.getCurrentSessionInfo(e),isSelf:!0}))},prepStopScreenStream:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Promise((function(t,r){var i=Yd.getSkylinkState(e.id),a=i.user,o=i.streams.screenshare.stream;try{wn(i,o)?Ln.stopReplacedStream(i,o,!0,n):Ln.stopAddedStream(i,o,!0,n),Ln.initRefreshConnectionAndResolve(i.room,n,t,r)}catch(s){Xs.log.DEBUG([a.sid,Ht.MEDIA_STREAM,null,on.MEDIA_STREAM.ERRORS.STOP_SCREEN],s),r(new Error(on.MEDIA_STREAM.ERRORS.STOP_SCREEN))}}))},initRefreshConnectionAndResolve:function(e,t,n,r){var i=Yd.getSkylinkState(e.id),a=i.peerConnections;try{if(!t){if(Ss(Object.keys(a)))return function(e){var t=e.room,n=e.user;Bs(Me({peerId:n.sid,isSelf:!0,peerInfo:Hn.getCurrentSessionInfo(t)}))}(i),Vo.deleteUnavailableMedia(i.room,i.user.sid),n();Gs(an.HANDSHAKE_PROGRESS,(function(e){if(e.detail.state===ut.ANSWER_ACK)return n()})),od.refreshConnection(i)}}catch(o){r(o)}},stopReplacedStream:function(e,t,n,r){var i=e.user,a=e.room;try{Ln.tryStopStream(t),r||(!function(e,t){var n=e.room,r=e.user;(new Bo).stream(n.id,r,t,Gt.REPLACED_STREAM_ENDED,null)}(e,t),Ln.deleteStreamFromState(a,t,n),Ln.dispatchOnLocalStreamEnded(a,t))}catch(o){Xs.log.ERROR([i.sid,Ht.MEDIA_STREAM,null,on.MEDIA_STREAM.ERRORS.STOP_REPLACED_STREAM],o)}},stopReplacedStreams:function(e,t,n,r){t.forEach((function(t){Ln.stopReplacedStream(e,t,n,r)}))}},Un=function(){function e(){Object(o.a)(this,e)}return Object(s.a)(e,null,[{key:"getUserMedia",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.room,r=ls.parseMediaOptions(t,e),i=t.audio,a=t.video,o=!!t.useExactConstraints;return Yd.setSkylinkState(r,n.id),ls.prepMediaAccessRequest({useExactConstraints:o,audio:i,video:a,roomKey:n.id})}},{key:"getUserMediaLayer",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(r,i){var a={audio:!0,video:!0};n||Xs.log.WARN([t.user.sid,Ht.MEDIA_STREAM,null,"".concat(on.MEDIA_STREAM.NO_OPTIONS," - ").concat(on.MEDIA_STREAM.DEFAULT_OPTIONS)],a),gs(n)||(Xs.log.ERROR([t.user.sid,Ht.MEDIA_STREAM,null,on.MEDIA_STREAM.ERRORS.INVALID_GUM_OPTIONS],n),i(new Error(on.MEDIA_STREAM.ERRORS.INVALID_GUM_OPTIONS),null)),a=n,e.getUserMedia(t,a).then((function(e){r(e)})).catch((function(e){i(e)}))}))}},{key:"stopStreams",value:function(e,t){return Ln.prepStopStreams(e.room.id,t)}},{key:"addLocalMediaStreams",value:function(e,t){ls.addLocalMediaStreams(e,t)}},{key:"onRemoteTrackAdded",value:function(e,t,n,r,i,a){ls.onRemoteTrackAdded(e,t,n,r,i,a)}},{key:"muteStreams",value:function(e,t,n){return ls.muteStreams(e,t,n)}},{key:"sendStream",value:function(e,t){return ls.sendStream(e,t)}},{key:"getStreamSources",value:function(){return ls.getStreamSources()}},{key:"getScreenSources",value:function(){return ls.getScreenSources()}},{key:"updateRemoteStreams",value:function(e,t,n){return ls.updateRemoteStreams(e,t,n)}},{key:"getStreams",value:function(e){return ls.getStreams(e)}},{key:"usePrefetchedStream",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise((function(r){!t&&n.id&&n.active&&(t=n);var i={audio:0!==t.getAudioTracks().length,video:0!==t.getVideoTracks().length},a=ls.parseStreamSettings(i,Yt.AUDIO),o=ls.parseStreamSettings(i,Yt.VIDEO);return ls.onStreamAccessSuccess(e,t,a,o,!1,r)}))}}]),e}(),Gn=function(e,t){return t?!!e.MCU.maps:!us(e)},Fn=function(e){return e.userMedia?e.userMedia:null},Bn=function(e){return e.screenshare?e.screenshare:null},jn=function(e){return!us(e)},Vn=function(e,t){var n=e.streams,r={};r.settings={audio:!1,video:!1,data:!1,bandwidth:cn()(e.streamsBandwidthSettings.bAS),googleXBandwidth:cn()(e.streamsBandwidthSettings.googleX)};var i=e.hasMCU?en.MCU:t;if(e.peerConnections[i].signalingState!==at.CLOSED){var a=Yd.getInitOptions(),o=Hn.getPeerInfo(i,e.room);r.settings=cn()(o.settings),r.settings.data=a.enableDataChannel&&e.peerInformations[i].config.enableDataChannel,n.userMedia||n.screenshare}if(e.peerCustomConfigs[i]){if(Object.hasOwnProperty.call(e.peerCustomConfigs[i],"bandwidth")){var s=e.peerCustomConfigs[i].bandwidth;gs(s)&&(fs(s.audio)&&(r.settings.bandwidth.audio=s.audio),fs(s.video)&&(r.settings.bandwidth.video=s.video),fs(s.data)&&(r.settings.bandwidth.data=s.data))}if(Object.hasOwnProperty.call(e.peerCustomConfigs[i],"googleXBandwidth")){var d=e.peerCustomConfigs[i].googleXBandwidth;gs(d)&&(fs(d.min)&&(r.settings.googleXBandwidth.min=d.min),fs(d.max)&&(r.settings.googleXBandwidth.max=d.max))}}return r},xn={getPeerInfo:_n,getCurrentSessionInfo:Nn,getUserInfo:Dn,getUserData:yn,setUserData:Mn,getPeersStreams:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n={},r=e.peerConnections,i=e.user,a=e.streams,o=e.hasMCU;if(i&&i.sid&&t){var s=Fn(a),d=Bn(a);n[i.sid]=s||d?{}:null,s&&Object.keys(s).forEach((function(e){n[i.sid].isSelf=!0,n[i.sid][e]=s[e].stream})),d&&(n[i.sid].isSelf=!0,n[i.sid][d.id]=d)}return Gn(r,o)&&function(){for(var t=o?Object.keys(r.MCU.maps):Object.keys(r),i=function(r){n[t[r]]={},Un.retrieveRemoteStreams(e,t[r]).forEach((function(e){n[t[r]][e.id]=e}))},a=0;a<t.length;a+=1)i(a)}(),us(n)?null:n},getPeersDataChannels:function(e){for(var t=e.dataChannels,n={},r=Object.keys(t),a=0;a<r.length;a+=1){var o=r[a];if(n[o]={},jn(t))for(var s=Object.keys(t[o]),d=0;d<s.length;d+=1){var c=t[o][s[d]],l=c.channelName,u=c.channelType,S=c.transferId,E=c.streamId,g=null;(g=od.getDataChannelBuffer(c)).channelProp=s[d],g.channelName=l,g.channelType=u,g.currentTransferId=S,g.currentStreamId=E,g.readyState=c.channel?c.channel.readyState:i.DATA_CHANNEL_STATE.CREATE_ERROR,n[o][l]=g}}return n},getPeersCustomSettings:function(e){var t=e.peerInformations,n={};if(function(e){return!us(e)}(t)){for(var r=Object.keys(t),i=0;i<r.length;i+=1)n[r[i]]=Vn(e,r[i]);return n}return n},setGreatestPeerPriorityWeight:function(e){for(var t=Yd.getSkylinkState(e.room.id),n=t.peerInformations,r=Object.entries(n),i=t.peerPriorityWeight,a=0;a<r.length;a+=1){var o=r[a][1].config.priorityWeight;o>i&&(i=o,t.peerPriorityWeight=i+1)}Yd.setSkylinkState(t,t.room.id),Xs.log.DEBUG("User's priorityWeight is set to ".concat(i))}},Hn=function(){function e(){Object(o.a)(this,e)}return Object(s.a)(e,null,[{key:"getPeerInfo",value:function(e,t){return xn.getPeerInfo(e,t)}},{key:"getCurrentSessionInfo",value:function(e){return xn.getCurrentSessionInfo(e)}},{key:"getUserInfo",value:function(e){return xn.getUserInfo(e)}},{key:"getUserData",value:function(e,t){return xn.getUserData(e,t)}},{key:"setUserData",value:function(e,t){xn.setUserData(e,t)}},{key:"getPeersStreams",value:function(e,t){return xn.getPeersStreams(e,t)}},{key:"getPeersDataChannels",value:function(e){return xn.getPeersDataChannels(e)}},{key:"getPeersCustomSettings",value:function(e){return xn.getPeersCustomSettings(e)}},{key:"setGreatestPeerPriorityWeight",value:function(e){return xn.setGreatestPeerPriorityWeight(e)}}]),e}(),Wn=function(e,t){var n,r=Yd.getSkylinkState(e)||Object.values(Yd.getSkylinkState())[0],i=r.socketSession,a=r.inRoom,o=r.room,s=r.user;Xs.log.INFO([null,"Socket",null,"Channel closed. Reason - ".concat(t)]),r.channelOpen=!1,Yd.setSkylinkState(r,e),Bs((n={socketSession:cn()(i)},new me(Y,{detail:n}))),a&&s&&s.sid&&Bs(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(x,{detail:e})}({peerId:s.sid,peerInfo:Hn.getCurrentSessionInfo(o)}))},Kn=function(e){var t=Yd.getSkylinkState(e).channelOpen,n=new Bo;t&&n.socket&&n.socket.disconnect()},Yn={apiBase:"https://api.temasys.io",stats:{endPoints:{client:"/client",session:"/session",auth:"/auth",signaling:"/signaling",iceConnection:"/client/iceconnection",iceCandidate:"/client/icecandidate",iceGathering:"/client/icegathering",negotiation:"/client/negotiation",bandwidth:"/client/bandwidth",recording:"/client/recording",dataChannel:"/client/datachannel"}}};Yn.stats.statsBase="".concat(Yn.apiBase,"/rest/stats");var Jn=Yn,Xn=function(){function e(){Object(o.a)(this,e),this.endpoints=Jn.stats.endPoints,this.stats_buffer={},this.bufferTimeout=!1}return Object(s.a)(e,[{key:"postStats",value:function(e,t){var n=on.STATS_MODULE,r=window.fetch;try{if(!t.client_id)return;Yd.getInitOptions().enableStatsGathering&&r("".concat(Jn.stats.statsBase).concat(e),{method:"POST",mode:"cors",headers:{"Content-type":"application/json"},body:JSON.stringify(t)})}catch(i){Xs.log.WARN(n.ERRORS.POST_FAILED,i)}}},{key:"addToStatsBuffer",value:function(e,t,n){this.stats_buffer[e]||(this.stats_buffer[e]={},this.stats_buffer[e].url=n,this.stats_buffer[e].data=[]);var r=Object.assign({},t);this.stats_buffer[e].data.push(r)}},{key:"manageStatsBuffer",value:function(){var e=this;this.bufferTimeout||(this.bufferTimeout=!0,setInterval((function(){for(var t=Object.keys(e.stats_buffer),n=0;n<t.length;n+=1)e.stats_buffer[t[n]].data.length>0&&(e.postStats(e.stats_buffer[t[n]].url,e.stats_buffer[t[n]].data),e.stats_buffer[t[n]].data=[])}),5e3))}}]),e}(),Qn=Xn,qn=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(d.a)(this,Object(c.a)(t).call(this))).model={client_id:null,appKey:null,timestamp:null,room_id:null,user_id:null,state:null,signaling_url:null,signaling_transport:null,attempts:null,error:null},e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"send",value:function(e,t,n){var r=Yd.getSkylinkState(e),i=r.socketSession;this.model.room_id=e,this.model.user_id=r&&r.user&&r.user.sid||null,this.model.client_id=r.clientId,this.model.state=t,this.model.signaling_url=r.socketSession.socketServer,this.model.signaling_transport=r.socketSession.socketType.toLowerCase(),this.model.attempts=0===i.socketSession.finalAttempts?i.socketSession.attempts:2*i.socketSession.finalAttempts+i.socketSession.attempts,this.model.appKey=Yd.getInitOptions().appKey,this.model.timestamp=(new Date).toISOString(),this.attempts="number"===typeof n?n:null,this.model.error=("string"===typeof n?n:n&&n.message)||null,this.postStats(this.endpoints.signaling,this.model)}}]),t}(Qn),zn=qn,Zn=function(e,t){var n,r=Yd.getSkylinkState(t),i=r.socketSession;(new zn).send(t,rn.SIGNALING.CONNECT,null),r.channelOpen||(r.channelOpen=!0,Yd.setSkylinkState(r,t)),0!==i.socketSession.finalAttempts||0!==i.socketSession.attempts?(Bs((n={socketSession:cn()(i)},new me(K,{detail:n}))),(new zn).send(t,rn.SIGNALING.RECONNECT_SUCCESS)):Bs(function(e){return new me(W,{detail:e})}({socketSession:cn()(i)})),e()},$n=function(e,t){var n=Yd.getSkylinkState(e)||Object.values(Yd.getSkylinkState())[0],r=n.channelOpen,i=n.room;(new zn).send(i.id,rn.SIGNALING.DISCONNECT,null),(r||!r&&e!==i.roomName)&&lr(i.id,t)},er=function(e,t){var n,r=Yd.getSkylinkState(e).socketSession;(new zn).send(e,rn.SIGNALING.ERROR,t),Xs.log.ERROR([null,"Socket",null,"Exception occurred ->"],t),Bs((n={error:t,socketSession:cn()(r)},new me(X,{detail:n})))},tr=function(e,t){var n,r=Yd.getSkylinkState(e).socketSession,i=0;(new Bo).updateAttempts(e,"attempts",t),i=0===r.socketSession.finalAttempts?t:2*r.socketSession.finalAttempts+r.socketSession.attempts,(new zn).send(e,rn.SIGNALING.RECONNECT_ATTEMPT,i),Bs((n={fallbackType:r.fallbackType,currentAttempt:i,session:cn()(Yd.getSkylinkState(e).socketSession)},new me(Q,{detail:n})))},nr=function(e,t,n){var r=Yd.getSkylinkState(n).socketSession,i=new Bo;r.socketSession.attempts===On.RECONNECTION_ATTEMPTS.WEBSOCKET&&r.socketSession.finalAttempts<On.RECONNECTION_FINAL_ATTEMPTS&&!r.socketTimeout?(i.socket.connect(),i.updateAttempts(n,"attempts",r.socketSession.attempts===On.RECONNECTION_ATTEMPTS.WEBSOCKET?0:r.socketSession.attempts+=1),i.updateAttempts(n,"finalAttempts",r.socketSession.finalAttempts+=1)):((new zn).send(n,rn.SIGNALING.RECONNECT_FAILED,on.INIT.ERRORS.SOCKET_ERROR_ABORT),Bs(Ge({session:cn()(r),errorCode:It.RECONNECTION_ABORTED,type:r.fallbackType,error:new Error(on.INIT.ERRORS.SOCKET_ERROR_ABORT)})),t(new Error(on.INIT.ERRORS.SOCKET_ERROR_ABORT)))},rr=function(e,t){var n=Yd.getSkylinkState(e),r=n.socketSession;(new zn).send(e,rn.SIGNALING.RECONNECT_ERROR,t),!r.socketTimeout&&t&&"timeout"===t&&(Xs.log.ERROR([null,"Socket",null,"".concat(r.socketType," connection timed out.")]),r.socketTimeout=!0,Yd.setSkylinkState(n,e))},ir={onConnection:Zn,onDisconnect:$n,onError:er,onReconnectAttempt:tr,onReconnectFailed:nr,onReconnectError:rr},ar=ir,or=function(e,t,n,r){t.socket.on(tn.CONNECT,ar.onConnection.bind(t,n,e)),t.socket.on(tn.MESSAGE,t.onMessage.bind(t)),t.socket.on(tn.DISCONNECT,ar.onDisconnect.bind(t,e)),t.socket.on(tn.ERROR,ar.onError.bind(t,e)),t.socket.on(tn.RECONNECT_ATTEMPT,ar.onReconnectAttempt.bind(t,e)),t.socket.on(tn.RECONNECT_ERROR,ar.onReconnectError.bind(t,e)),t.socket.on(tn.RECONNECT_FAILED,ar.onReconnectFailed.bind(t,n,r,e))},sr=function(e){return Rs(e)&&e},dr=function e(t,n){var r=Yd.getSkylinkState(t);if(n.detail.state===ut.ENTER){var i=cn()(r.socketMessageQueue);r.user.bufferMessage=!1,r.socketMessageQueue=[],Yd.setSkylinkState(r,r.room.id),Xs.log.DEBUG([r.user.sid,Ht.SIG_SERVER,null,"".concat(on.SIGNALING.BUFFERED_MESSAGES_SENT,": ").concat(i.length)]),function(e,t){for(var n=new Bo,r=t.length-1;r>=0;r-=1){var i=t[r];if(!i.mid){if(!e.user.sid)return void Xs.log.DEBUG([e.user.sid,Ht.SIG_SERVER,null,"".concat(on.SIGNALING.BUFFERED_MESSAGES_DROPPED)]);i.mid=e.user.sid}n.sendMessage(i),t.splice(r,1)}}(r,i),js.removeEventListener(an.HANDSHAKE_PROGRESS,e)}},cr=function(e){var t=e.rid,n=Yd.getSkylinkState(t),r=n.user,i=n.room;return!ps(r.bufferMessage)&&!sr(r.bufferMessage)||function(e){return[Ut.JOIN_ROOM,Ut.ENTER,Ut.WELCOME,Ut.OFFER,Ut.ANSWER,Ut.ANSWER_ACK,Ut.CANDIDATE,Ut.END_OF_CANDIDATES].indexOf(e.type)>-1}(e)?(e.type===ut.ENTER&&ps(r.bufferMessage)&&(Xs.log.DEBUG([r.sid,Ht.SIG_SERVER,null,on.SIGNALING.BUFFER_NOT_NEEDED]),n.user.bufferMessage=!1,n.socketMessageQueue=[],Yd.setSkylinkState(n,n.room.id)),!1):(Xs.log.DEBUG([r.sid,Ht.SIG_SERVER,null,on.SIGNALING.MESSAGE_ADDED_TO_BUFFER]),n.socketMessageQueue.unshift(e),sr(r.bufferMessage)||(n.user.bufferMessage=!0,Xs.log.DEBUG([r.sid,Ht.SIG_SERVER,null,on.SIGNALING.ENTER_LISTENER]),js.addEventListener(an.HANDSHAKE_PROGRESS,dr.bind(void 0,t))),Yd.setSkylinkState(n,i.id),!0)},lr=function(){Wn.apply(a,arguments)},ur=function(e,t,n){var r={encryptSecrets:e,selectedSecretId:t};if(n){if(!r.encryptSecrets[n])throw new Error(on.MESSAGING.ENCRYPTION.ERRORS.SECRET_ID_NOT_FOUND);r.selectedSecretId===n&&(r.selectedSecretId=Mr.setSelectedSecretId()),delete r.encryptSecrets[n]}else Xs.log.DEBUG([null,Ht.ENCRYPTED_MESSAGING,null,"".concat(on.MESSAGING.ENCRYPTION.DELETE_ALL)]),r.selectedSecretId=Mr.setSelectedSecretId(),r.encryptSecrets={};return r},Sr=function(e,t,n){var r=e;if(function(e){if(!e)throw new Error(on.MESSAGING.ENCRYPTION.ERRORS.NO_SECRET_OR_SECRET_ID);if(!Mr.utils.isValidString(e))throw new Error(on.MESSAGING.ENCRYPTION.ERRORS.INVALID_TYPE);return!0}(t)&&function(e,t){if(!e)throw new Error(on.MESSAGING.ENCRYPTION.ERRORS.NO_SECRET_OR_SECRET_ID);if(!Mr.utils.isValidString(e))throw new Error(on.MESSAGING.ENCRYPTION.ERRORS.INVALID_TYPE);if(Mr.utils.isExisting(e,t))throw new Error(on.MESSAGING.ENCRYPTION.ERRORS.SECRET_ID_NOT_UNIQUE);return!0}(n,r))return r[n]=t,r},Er=n(63),gr=n.n(Er),pr={isExisting:function(e,t){return Object.keys(t).filter((function(t){return t===e})).length>0},isValidString:function(e){if(!hs(e)||!hs(e)||Es(e))throw new Error(on.MESSAGING.ENCRYPTION.ERRORS.INVALID_TYPE);return!0},hasCrypto:function(){return gr.a?gr.a:(Xs.log.ERROR([null,Ht.ASYNC_MESSAGING,null,on.PERSISTENT_MESSAGE.ERRORS.NO_DEPENDENCY]),!1)},canEncrypt:function(e,t){if(us(t)&&Es(e))throw new Error("".concat(on.MESSAGING.ENCRYPTION.ERRORS.SECRETS_NOT_PROVIDED,", ").concat(on.MESSAGING.ENCRYPTION.ERRORS.SECRET_ID_NOT_PROVIDED));if(Es(e))throw new Error(on.MESSAGING.ENCRYPTION.ERRORS.SECRET_ID_NOT_SELECTED);if(us(t))throw new Error(on.MESSAGING.ENCRYPTION.ERRORS.SECRETS_NOT_PROVIDED);return!0},canDecrypt:function(e){if(us(e))throw new Error(on.MESSAGING.ENCRYPTION.ERRORS.SECRETS_NOT_PROVIDED);return!0}},fr=pr,mr=function(e,t){if(!t)return"";if(!Mr.utils.isValidString(t))throw new Error(on.MESSAGING.ENCRYPTION.ERRORS.INVALID_TYPE);if(!e[t])throw new Error(on.MESSAGING.ENCRYPTION.ERRORS.SECRET_ID_NOT_FOUND);return t},Rr=function(e,t){var n,r=e.peerInformations,i=e.inRoom,a=e.user,o=!1;if(!i||!a)throw Error(on.ROOM.ERRORS.NOT_IN_ROOM);return Array.isArray(t)&&!Ss(t)?(n=t,o=!0):t&&hs(t)?(n=[t],o=!0):n=Object.keys(r),n.forEach((function(e,t){r[e]?e===en.MCU&&n.splice(t,1):(Xs.log.WARN([e,Ht.MESSAGING,null,"".concat(on.MESSAGING.ERRORS.DROPPING_MESSAGE," - ").concat(on.PEER_CONNECTION.NO_PEER_CONNECTION)]),n.splice(t,1))})),0===n.length&&Xs.log.WARN([null,Ht.MESSAGING,null,on.PEER_CONNECTION.NO_PEER_CONNECTION]),{listOfPeers:n,isPrivate:o}},hr=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4?arguments[4]:void 0,a=new Bo;a.sendUserMessage(e,t,r||n),Cr.dispatchOnIncomingMessage(e,t,n,!0,i)},vr=function(e,t,n,r,i){var a=e.room,o=e.user;Xs.log.DEBUG([r?null:i,Ht.MESSAGING,null,"".concat(on.MESSAGING.RECEIVED_MESSAGE," - isPrivate: ").concat(t.isPrivate)]);var s={targetPeerId:r?t.isPrivate?i:null:o.sid,content:n,senderPeerId:r?o.sid:i,isDataChannel:!1,isPrivate:t.isPrivate,timeStamp:Ls()};r&&(s.listOfPeers=t.listOfPeers),Bs(Te({room:a,message:s,isSelf:r,peerId:r?o.sid:i,peerInfo:r?Hn.getCurrentSessionInfo(a):Hn.getPeerInfo(i,a)}))},Ir=function(){function e(){Object(o.a)(this,e)}return Object(s.a)(e,null,[{key:"throwError",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";throw Xs.log.ERROR([null,Ht.SKYLINK_ERROR,null,"".concat(e).concat(t?" - ".concat(t):"")]),new Error("".concat(e).concat(t?" - ".concat(t):""))}}]),e}(),Or=Ir,Tr=function(e,t,n){try{var r=Cr.getMessageConfig(e,n);Cr.sendMessageToSig(e,r,t,null,n)}catch(i){Or.throwError(on.MESSAGING.ERRORS.FAILED_SENDING_MESSAGE)}},Ar={getMessageConfig:Rr,sendMessageToSig:hr,dispatchOnIncomingMessage:vr,trySendMessage:Tr},Cr=Ar,_r=function(e,t,n,r,i){var a=Cr.getMessageConfig(e,t);return Mr.utils.hasCrypto()&&Mr.utils.canEncrypt(r,n)&&(a.secretId=r),i&&(a.isPersistent=i),a},Nr=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n)try{var r=gr.a.AES.decrypt(e,t);return r.toString(gr.a.enc.Utf8)}catch(a){throw new Error(on.MESSAGING.ENCRYPTION.ERRORS.ENCRYPT_SECRET)}var i=gr.a.AES.encrypt(e,t);return i.toString()},Dr=function(e,t,n){var r=Mr.encryptMessage(e,n[t],!0);if(Es(r))throw new Error(on.MESSAGING.ENCRYPTION.ERRORS.ENCRYPT_SECRET);return r},yr={deleteEncryptSecrets:ur,setEncryptSecret:Sr,setSelectedSecretId:mr,utils:fr,getMessageConfig:_r,encryptMessage:Nr,tryDecryptMessage:Dr},Mr=yr,kr={},Pr=function(){function e(t){Object(o.a)(this,e);var n=t.room,r=t.user;return kr[n.id]||(kr[n.id]=this),this.room=n,this.peerId=r.sid,this.encryptSecrets={},this.selectedSecretId="",kr[n.id]}return Object(s.a)(e,[{key:"setEncryptSecret",value:function(e,t){try{this.encryptSecrets=Mr.setEncryptSecret(this.encryptSecrets,e,t),this.dispatchEncryptSecretEvent()}catch(n){Or.throwError(on.MESSAGING.ENCRYPTION.ERRORS.SET_ENCRYPT_SECRET,n.message)}}},{key:"getEncryptSecrets",value:function(){return this.encryptSecrets}},{key:"deleteEncryptSecrets",value:function(e){try{var t=Mr.deleteEncryptSecrets(this.encryptSecrets,this.selectedSecretId,e);this.encryptSecrets=t.encryptSecrets,this.selectedSecretId=t.selectedSecretId,this.dispatchEncryptSecretEvent()}catch(n){Or.throwError(on.MESSAGING.ENCRYPTION.ERRORS.DELETE_ENCRYPT_SECRETS,n.message)}}},{key:"setSelectedSecretId",value:function(e){try{this.selectedSecretId=Mr.setSelectedSecretId(this.encryptSecrets,e),this.dispatchEncryptSecretEvent()}catch(t){Or.throwError(on.MESSAGING.ENCRYPTION.ERRORS.SET_SELECTED_SECRET,t.message)}}},{key:"getSelectedSecretId",value:function(){return this.selectedSecretId}},{key:"dispatchEncryptSecretEvent",value:function(){Bs(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(pe,{detail:e})}({room:this.room,encryptSecrets:this.encryptSecrets,selectedSecretId:this.selectedSecretId,peerInfo:Dn(this.room),peerId:this.peerId}))}},{key:"canEncrypt",value:function(e){try{return!!Mr.utils.canEncrypt(this.selectedSecretId,this.encryptSecrets)&&(Mr.utils.isValidString(this.selectedSecretId)&&Mr.utils.isValidString(this.encryptSecrets[this.selectedSecretId]))}catch(t){if(e)throw new Error(t.message);return!1}}},{key:"decryptStoredMessages",value:function(e,t){if(Mr.utils.canEncrypt(t,this.encryptSecrets)&&!Object.keys(this.encryptSecrets).filter((function(e){return e===t})).length)throw new Error(on.MESSAGING.ENCRYPTION.ERRORS.SECRET_ID_NOT_FOUND);return this.decryptMessage(e,t)}},{key:"decryptMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(t&&Mr.utils.canDecrypt(this.encryptSecrets))return Mr.tryDecryptMessage(e,t,this.encryptSecrets);throw new Error(on.MESSAGING.ENCRYPTION.ERRORS.INVALID_SECRETS)}},{key:"sendMessage",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=Ts(e);if(vs(t,"message","sendMessage")&&i)try{Xs.log.DEBUG([null,Ht.ASYNC_MESSAGING,null,on.MESSAGING.ENCRYPTION.SEND_MESSAGE]);var a=Mr.getMessageConfig(i,n,this.encryptSecrets,this.selectedSecretId,r),o=Mr.encryptMessage(t,this.encryptSecrets[this.selectedSecretId]);Cr.sendMessageToSig(i,a,t,o,n)}catch(s){Or.throwError(on.MESSAGING.ERRORS.DROPPING_MESSAGE,s.message)}}}],[{key:"deleteEncryptedInstance",value:function(e){delete kr[e.id]}}]),e}(),br=Pr,wr=function(e,t){var n=Mr.getMessageConfig(e,t);return n.isPersistent=!0,n},Lr=function(e,t){return{targetPeerId:t,senderPeerId:e.mid,content:e.data,timeStamp:ws(e.timeStamp),isPrivate:!1,isDataChannel:!1}},Ur={getMessageConfig:wr,parseDecryptedMessageData:Lr},Gr=Ur,Fr={},Br=function(){function e(t){Object(o.a)(this,e);var n=t.user,r=t.room,i=t.hasPersistentMessage;return Fr[r.id]||(Fr[r.id]=this),this.room=r,this.peerId=n.sid,this.isPersistent=i,this.hasPersistentMessage=i,Fr[r.id]}return Object(s.a)(e,[{key:"setMessagePersistence",value:function(e){if(!Rs(e))throw Or.throwError(on.MESSAGING.PERSISTENCE.ERRORS.FAILED_SETTING_PERSISTENCE,on.MESSAGING.PERSISTENCE.ERRORS.INVALID_TYPE);if(!this.hasPersistentMessage)throw this.isPersistent=e,Or.throwError(on.MESSAGING.PERSISTENCE.ERRORS.PERSISTENT_MESSAGE_FEATURE_NOT_ENABLED);this.isPersistent=e,Bs(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(fe,{detail:e})}({room:this.room,isPersistent:this.isPersistent,peerInfo:Dn(this.room),peerId:this.peerId}))}},{key:"getMessagePersistence",value:function(){return this.isPersistent}},{key:"sendMessage",value:function(e,t,n){var r=Ts(e),i=!n||Array.isArray(n)&&Ss(n);if(vs(t,"message","sendMessage")&&r)try{Xs.log.DEBUG([null,Ht.ASYNC_MESSAGING,null,on.MESSAGING.PERSISTENCE.SEND_MESSAGE]);var a=new br(r);if(!i)throw new Error(on.MESSAGING.PERSISTENCE.ERRORS.PRIVATE_MESSAGE);a.canEncrypt(!0)&&a.sendMessage(e,t,n,this.isPersistent)}catch(o){Or.throwError(on.MESSAGING.ERRORS.DROPPING_MESSAGE,o.message)}}},{key:"getStoredMessages",value:function(){var e=Yd.getSkylinkState(this.room.id);this.hasPersistentMessage?(new Bo).getStoredMessages(e):Xs.log.WARN([this.peerId,Ht.ASYNC_MESSAGING,null,"".concat(on.MESSAGING.PERSISTENCE.ERRORS.PERSISTENT_MESSAGE_FEATURE_NOT_ENABLED)])}},{key:"canPersist",value:function(){if(this.hasPersistentMessage)return!!this.isPersistent||(Xs.log.DEBUG([null,Ht.ASYNC_MESSAGING,null,on.MESSAGING.PERSISTENCE.NOT_PERSISTED]),!1);if(this.isPersistent)throw Xs.log.DEBUG([null,Ht.ASYNC_MESSAGING,null,"".concat(on.MESSAGING.PERSISTENCE.IS_PERSISTENT_CONFIG," ").concat(this.isPersistent)]),new Error(on.MESSAGING.PERSISTENCE.ERRORS.PERSISTENT_MESSAGE_FEATURE_NOT_ENABLED);return!1}}],[{key:"processStoredMessages",value:function(e){var t=Yd.getSkylinkState(e.rid),n=t.room,r=e.mid,i=JSON.parse(e.data),a=new br(t),o=[];Xs.log.DEBUG([r,Ht.ASYNC_MESSAGING,null,on.MESSAGING.PERSISTENCE.STORED_MESSAGES],i);try{for(var s=0;s<i.length;s+=1)i[s].data=a.decryptStoredMessages(i[s].data,i[s].secretId),o.push(Gr.parseDecryptedMessageData(i[s],r))}catch(d){throw Or.throwError(on.MESSAGING.ENCRYPTION.ERRORS.FAILED_DECRYPTING_MESSAGE,d.message)}Bs(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(ge,{detail:e})}({room:n,storedMessages:o,isSelf:!1,peerId:r,peerInfo:Hn.getPeerInfo(r,n)}))}},{key:"deleteAsyncInstance",value:function(e){delete Fr[e.id]}}]),e}(),jr=Br,Vr=function(){function e(){Object(o.a)(this,e)}return Object(s.a)(e,null,[{key:"sendMessage",value:function(e,t,n){var r=Ts(e);if(vs(t,"message","sendMessage")&&r){var i=new br(r),a=new jr(r);a.canPersist()?a.sendMessage(e,t,n):i.canEncrypt()?i.sendMessage(e,t,n):Cr.trySendMessage(r,t,n)}}},{key:"sendP2PMessage",value:function(e,t,n){var r=Ts(e);vs(t,"message","sendP2PMessage")&&r&&od.sendP2PMessage(e,t,n)}},{key:"processMessage",value:function(e,t){var n=e.mid,r=e.target,i=e.rid,a=e.secretId,o=e.data,s=Yd.getSkylinkState(i),d=n,c=o;if(a)try{c=new br(s).decryptMessage(o,a)}catch(l){Or.throwError(on.MESSAGING.ENCRYPTION.ERRORS.FAILED_DECRYPTING_MESSAGE,l.message)}Cr.dispatchOnIncomingMessage(s,{isPrivate:Rs(t)?!t:!!r},c,!1,d)}}]),e}(),xr=Vr,Hr=function(e,t){xr.processMessage(e,t)},Wr=function(){var e={fulfilled:!0,message:""},t=window,n=t.AdapterJS,r=t.io,i=t.fetch;return"function"!==typeof(n||window.AdapterJS||window.AdapterJS||{}).webRTCReady?(e.message=on.INIT.ERRORS.NO_ADAPTER,e.fulfilled=!1,e.readyStateChangeErrorCode=mt.ADAPTER_NO_LOADED):r||window.io?i&&window.fetch||(e.message=on.INIT.ERRORS.NO_FETCH_SUPPORT,e.fulfilled=!1,e.readyStateChangeErrorCode=mt.NO_XMLHTTPREQUEST_SUPPORT):(e.message=on.INIT.ERRORS.NO_SOCKET_IO,e.fulfilled=!1,e.readyStateChangeErrorCode=mt.NO_SOCKET_IO),e.fulfilled||Xs.log.ERROR(["Validating Dependencies",null,null,e.message]),e},Kr=function(e){var t=e.forceTURNSSL,n=e.CONSTANTS,r=e.serverConfig,i=window.AdapterJS,a={tcp:r.iceServerPorts.tcp,udp:r.iceServerPorts.udp,both:r.iceServerPorts.both,iceServerProtocol:r.iceServerProtocol,iceServerPorts:r.iceServerPorts};return"edge"===i.webrtcDetectedBrowser?(a.tcp=[],a.udp=[3478],a.iceServerPorts.both=[],a.iceServerProtocol=n.TURN):t?"firefox"===i.webrtcDetectedBrowser&&i.webrtcDetectedVersion<53?(a.udp=[],a.tcp=[443],a.both=[],a.iceServerProtocol=n.TURN):(a.iceServerPorts.udp=[],a.iceServerProtocol="turns"):"firefox"===i.webrtcDetectedBrowser&&(a.udp=[3478],a.tcp=[443,80],a.both=[]),a},Yr=function(e){var t=e.getSenders,n=e.removeTrack;return function(e){for(var r=e.getTracks,i=t(),a=0;a<i.length;a+=1)for(var o=r(),s=0;s<o.length;s+=1)o[s]===i[a].track&&n(i[a])}},Jr={udp:[3478,19302,19303,19304],tcp:[80,443],both:[19305,19306,19307,19308]},Xr={STUN:"stun",TURN:"turn",TEMASYS:"temasys",DEFAULT_TURN_SERVER:"turn.temasys.io",TCP:"TCP",UDP:"UDP"},Qr=function(e,t){return[{urls:e.urls,username:t.iceServers[1].username||null,credential:t.iceServers[1].credential||null}]},qr=function(e){var t=Yd.getInitOptions(),n={iceServerName:null,iceServerPorts:Jr,iceServerProtocol:Xr.STUN,iceServers:[{urls:[]},{urls:[]}]},r=t.iceServer,i=t.enableTURNServer,a=t.forceTURNSSL,o=t.TURNServerTransport,s=t.enableSTUNServer,d=t.usePublicSTUN;if(e.forEach((function(e){if(0===e.url.indexOf("".concat(Xr.STUN,":")))e.url.indexOf("".concat(Xr.TEMASYS))>0?n.iceServerName=(e.url.split(":")[1]||"").split("?")[0]||null:n.iceServers[0].urls.push(e.url);else if(0===e.url.indexOf("turn:")&&e.url.indexOf("@")>0&&e.credential&&!n.iceServers[1].username&&!n.iceServers[1].credential){var t=(e.url.split(":")[1]||"").split("@");n.iceServerName=(t[1]||"").split("?")[0],n.iceServers[1].username=t[0],n.iceServers[1].credential=e.credential,n.iceServerProtocol=Xr.TURN}})),r)return{iceServers:Qr(r,n)};if(n.iceServerName=n.iceServerName||Xr.DEFAULT_TURN_SERVER,n.iceServerProtocol!==Xr.TURN||i||a){var c=Kr({forceTURNSSL:a,enableTURNServer:i,CONSTANTS:Xr,serverConfig:n});n.iceServerPorts.tcp=c.tcp,n.iceServerPorts.udp=c.udp,n.iceServerPorts.both=c.both,n.iceServerProtocol=c.iceServerProtocol}else n.iceServerProtocol=Xr.STUN;var l=function(e){var t=e.TURNServerTransport,n=e.forceTURNSSL,r=e.udp,i=e.tcp,a=e.both,o={udp:[],tcp:[],both:[]};return t!==it.UDP||n?t===it.TCP?(o.tcp=i.concat(a),o.udp=[],o.both=[]):t===it.NONE?(o.tcp=[],o.udp=[]):(o.tcp=i,o.udp=r,o.both=a):(o.udp=r.concat(a),o.tcp=[],o.both=[]),o}({forceTURNSSL:a,TURNServerTransport:o,udp:n.iceServerPorts.udp,tcp:n.iceServerPorts.tcp,both:n.iceServerPorts.both});return n.iceServerPorts.tcp=l.tcp,n.iceServerPorts.udp=l.udp,n.iceServerPorts.both=l.both,n.iceServerProtocol===Xr.STUN&&(n.iceServerPorts.tcp=[]),n.iceServerProtocol!==Xr.STUN||s?(n.iceServerPorts.tcp.forEach((function(e){n.iceServers[1].urls.push("".concat(n.iceServerProtocol,":").concat(n.iceServerName,":").concat(e,"?transport=tcp"))})),n.iceServerPorts.udp.forEach((function(e){n.iceServers[1].urls.push("".concat(n.iceServerProtocol,":").concat(n.iceServerName,":").concat(e,"?transport=udp"))})),n.iceServerPorts.both.forEach((function(e){n.iceServers[1].urls.push("".concat(n.iceServerProtocol,":").concat(n.iceServerName,":").concat(e))})),d||n.iceServers.splice(0,1),{iceServers:n.iceServers}):(n.iceServers=[],null)},zr=function(e,t){for(var n=Yd.getSkylinkState(t.id),r=n.peerCandidatesQueue[e]||[],i=n.peerConnections[e],a=window.AdapterJS,o=Ht,s=at,d=0;d<r.length;d+=1){var c=r[d];if(c){var l=c[1],u=c[0],S=l.candidate.split(" ")[7];Xs.log.DEBUG([e,o.CANDIDATE_HANDLER,"".concat(u,":").concat(S),on.ICE_CANDIDATE.CANDIDATE_HANDLER.ADD_BUFFERED_CANDIDATE]),ui.addIceCandidate(e,u,S,l,n)}else if(i&&i.signalingState!==s.CLOSED&&a&&As(a.VERSION,"0.14.0"))try{i.addIceCandidate(null),Xs.log.DEBUG([e,o.CANDIDATE_HANDLER,null,on.ICE_CANDIDATE.CANDIDATE_HANDLER.END_OF_CANDIDATES_SUCCESS])}catch(E){Xs.log.DEBUG([e,o.CANDIDATE_HANDLER,null,on.ICE_CANDIDATE.CANDIDATE_HANDLER.END_OF_CANDIDATES_FAILURE])}}delete n.peerCandidatesQueue[e],od.signalingEndOfCandidates(e,n)},Zr=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(d.a)(this,Object(c.a)(t).call(this))).model={client_id:null,appKey:null,timestamp:null,room_id:null,user_id:null,peer_id:null,state:null,is_remote:!1,candidate_id:null,candidate_sdp_mid:null,candidate_sdp_mindex:null,candidate_candidate:null,error:null},e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"send",value:function(e,t,n,r,i,a){var o=Yd.getSkylinkState(e);this.model.room_id=e,this.model.user_id=o&&o.user&&o.user.sid||null,this.model.peer_id=n,this.model.client_id=o.clientId,this.model.state=t,this.model.is_remote=!!r,this.model.candidate_id=r||null,this.model.candidate_sdp_mid=i.sdpMid,this.model.candidate_sdp_mindex=i.sdpMLineIndex,this.model.candidate_candidate=i.candidate,this.model.appKey=Yd.getInitOptions().appKey,this.model.timestamp=(new Date).toISOString(),this.model.error=("string"===typeof a?a:a&&a.message)||null,this.addToStatsBuffer("iceCandidate",this.model,this.endpoints.iceCandidate),this.manageStatsBuffer()}}]),t}(Qn),$r=Zr,ei=new $r,ti=function(e,t,n,r,i,a){var o=on.STATS_MODULE,s=on.ICE_CANDIDATE,d=nt,c=Ht;Xs.log.ERROR([t,c.CANDIDATE_HANDLER,"".concat(n,":").concat(r),s.CANDIDATE_HANDLER.FAILED_ADDING_CANDIDATE],a),Bs(_e({room:e,state:d.PROCESS_ERROR,peerId:t,candidateId:n,candidateType:r,candidate:i,error:a})),ei.send(e.id,o.HANDLE_ICE_GATHERING_STATS.PROCESS_FAILED,t,n,i,a)},ni=function(e,t,n,r,i){var a=Yd.getSkylinkState(i.room.id),o=a.peerConnections,s=a.room,d=o[e],c={candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex},l=on.STATS_MODULE,u=on.ICE_CANDIDATE,S=on.PEER_CONNECTION,E=nt,g=at,p=Ht;Xs.log.DEBUG([e,p.CANDIDATE_HANDLER,"".concat(t,":").concat(n),u.CANDIDATE_HANDLER.ADDING_CANDIDATE]),Bs(_e({peerId:e,room:s,candidateType:n,candidate:c,candidateId:t,state:E.PROCESSING,error:null})),ei.send(s.id,l.HANDLE_ICE_GATHERING_STATS.PROCESSING,e,t,c),d&&d.signalingState!==g.CLOSED&&d.remoteDescription&&d.remoteDescription.sdp&&d.remoteDescription.sdp.indexOf("\r\na=mid:".concat(c.sdpMid,"\r\n"))>-1||(Xs.log.WARN([e,p.CANDIDATE_HANDLER,"".concat(t,":").concat(n),"".concat(u.CANDIDATE_HANDLER.DROPPING_CANDIDATE," - ").concat(S.NO_PEER_CONNECTION)]),Bs(_e({peerId:e,room:i.room,candidateType:n,candidate:c,candidateId:t,state:nt.DROPPED,error:new Error(S.NO_PEER_CONNECTION)})),ei.send(s.id,l.HANDLE_ICE_GATHERING_STATS.PROCESS_FAILED,e,t,c,S.NO_PEER_CONNECTION));try{d.addIceCandidate(c).then((function(){!function(e,t,n,r,i){var a=on.STATS_MODULE,o=on.ICE_CANDIDATE,s=nt,d=Ht;Xs.log.INFO([t,d.CANDIDATE_HANDLER,"".concat(n,":").concat(r),o.CANDIDATE_HANDLER.CANDIDATE_ADDED]),Bs(_e({room:e,state:s.PROCESS_SUCCESS,peerId:t,candidateId:n,candidateType:r,candidate:i,error:null})),ei.send(e.id,a.HANDLE_ICE_GATHERING_STATS.PROCESS_SUCCESS,t,n,i)}(s,e,t,n,c)})).catch((function(r){ti(s,e,t,n,c,r)}))}catch(f){ti.bind(d,s,e,t,n,c,f)}},ri=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(d.a)(this,Object(c.a)(t).call(this))).model={client_id:null,appKey:null,timestamp:null,room_id:null,user_id:null,peer_id:null,state:null,is_remote:null,bundlePolicy:null,rtcpMuxPolicy:null},e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"send",value:function(e,t,n,r){var i=Yd.getSkylinkState(e);this.model.client_id=i.clientId,this.model.appKey=Yd.getInitOptions().appKey,this.model.timestamp=(new Date).toISOString(),this.model.room_id=e,this.model.user_id=i&&i.user&&i.user.sid||null,this.model.peer_id=n,this.model.state=t,this.model.is_remote=r,this.model.bundlePolicy=i.peerConnectionConfig.bundlePolicy,this.model.rtcpMuxPolicy=i.peerConnectionConfig.rtcpMuxPolicy,this.addToStatsBuffer("iceGathering",this.model,this.endpoints.iceGathering),this.manageStatsBuffer()}}]),t}(Qn),ii=new ri,ai=ii,oi=function(e,t,n){var r=Yd.getSkylinkState(n.id),i=Yd.getInitOptions(),a=r.peerConnections[e],o=new Bo,s=r.gatheredCandidates[e],d=tt,c=Ht;if(!a)return Xs.log.WARN([e,c.CANDIDATE_HANDLER,null,on.ICE_CANDIDATE.CANDIDATE_HANDLER.no_peer_connection],t),null;if(t.candidate){a.gathering||(Xs.log.WARN([e,c.CANDIDATE_HANDLER,null,on.ICE_CANDIDATE.CANDIDATE_HANDLER.ICE_GATHERING_STARTED],t),a.gathering=!0,a.gathered=!1,Bs(Ne({room:n,peerId:e,state:tt.GATHERING})),ai.send(n.id,d.GATHERING,e,!1));var l=t.candidate.split(" ")[7];if(Xs.log.DEBUG([e,c.CANDIDATE_HANDLER,l,on.ICE_CANDIDATE.CANDIDATE_HANDLER.CANDIDATE_GENERATED],t),"endOfCandidates"===l||!(a&&a.localDescription&&a.localDescription.sdp&&a.localDescription.sdp.indexOf("\r\na=mid:".concat(t.sdpMid,"\r\n"))>-1))return Xs.log.WARN([e,c.CANDIDATE_HANDLER,l,on.ICE_CANDIDATE.CANDIDATE_HANDLER.DROP_EOC],t),null;if(i.filterCandidatesType[l]){if(!r.hasMCU||!i.forceTURN)return Xs.log.WARN([e,c.CANDIDATE_HANDLER,l,on.ICE_CANDIDATE.CANDIDATE_HANDLER.FILTERED_CANDIDATE],t),null;Xs.log.WARN([e,c.CANDIDATE_HANDLER,l,on.ICE_CANDIDATE.CANDIDATE_HANDLER.FILTERING_FLAG_NOT_HONOURED],t)}s||(s={sending:{host:[],srflx:[],relay:[]},receiving:{host:[],srflx:[],relay:[]}}),s.sending[l].push({sdpMid:t.sdpMid,sdpMLineIndex:t.sdpMLineIndex,candidate:t.candidate}),r.gatheredCandidates[e]=s,Yd.setSkylinkState(r,n.id),Xs.log.DEBUG([e,c.CANDIDATE_HANDLER,l,on.ICE_CANDIDATE.CANDIDATE_HANDLER.SENDING_CANDIDATE],t),o.sendCandidate(e,r,t)}else{if(Xs.log.INFO([e,c.CANDIDATE_HANDLER,null,on.ICE_CANDIDATE.CANDIDATE_HANDLER.ICE_GATHERING_COMPLETED]),a.gathered)return null;if(a.gathering=!1,a.gathered=!0,Bs(Ne({peerId:e,state:tt.COMPLETED,room:n})),ai.send(n.id,d.COMPLETED,e,!1),r.gatheredCandidates[e]){setTimeout((function(){r.gatheredCandidates[e]&&(Yd.getSkylinkState(n.id)?o.sendMessage({type:Ut.END_OF_CANDIDATES,noOfExpectedCandidates:r.gatheredCandidates[e].sending.srflx.length+r.gatheredCandidates[e].sending.host.length+r.gatheredCandidates[e].sending.relay.length,mid:r.user.sid,target:e,rid:n.id}):Xs.log.WARN([e,c.CANDIDATE_HANDLER,null,"".concat(on.ICE_CANDIDATE.CANDIDATE_HANDLER.DROP_EOC," peer has left the room")]))}),6e3)}}return null},si=function(e,t,n,r,i){var a=on.STATS_MODULE.HANDLE_ICE_GATHERING_STATS,o=i,s=o.room,d=new $r;Xs.log.DEBUG([e,Ht.CANDIDATE_HANDLER,"".concat(t,":").concat(n),on.ICE_CANDIDATE.CANDIDATE_HANDLER.ADD_CANDIDATE_TO_BUFFER]),d.send(s.id,a.BUFFERED,e,t,r),Bs(_e({room:s,state:nt.BUFFERED,peerId:e,candidateId:t,candidateType:n,candidate:r.candidate,error:null})),o.peerCandidatesQueue[e]=o.peerCandidatesQueue[e]||[],o.peerCandidatesQueue[e].push([t,r]),Yd.setSkylinkState(o,s.id)},di={setIceServers:qr,addIceCandidateFromQueue:zr,addIceCandidate:ni,onIceCandidate:oi,addIceCandidateToQueue:si},ci=di,li=function(){function e(){Object(o.a)(this,e)}return Object(s.a)(e,null,[{key:"setIceServers",value:function(e){return ci.setIceServers(e)}},{key:"addIceCandidateFromQueue",value:function(e,t){return ci.addIceCandidateFromQueue(e,t)}},{key:"addIceCandidateToQueue",value:function(e,t,n,r,i){return ci.addIceCandidateToQueue(e,t,n,r,i)}},{key:"addIceCandidate",value:function(e,t,n,r,i){return ci.addIceCandidate(e,t,n,r,i)}},{key:"onIceCandidate",value:function(e,t,n){return ci.onIceCandidate(e,t,n)}}]),e}(),ui=li,Si=function(e){var t=e.pc_config.iceServers,n=e.sid,r=e.rid,i=e.tieBreaker,a=Yd.getSkylinkState(r),o=Yd.getInitOptions().priorityWeightScheme,s=new Bo,d=0;(a.room.connection.peerConfig=ui.setIceServers(t),a.room.inRoom=!0,d=o===ht.AUTO?0:o===ht.ENFORCE_OFFERER?2e15:-2e15,a.peerPriorityWeight=i+d,a.user.sid=n,a.inRoom=!0,Vo.updatePeerMediaWithUserSid(a.room,n),Yd.setSkylinkState(a,r),Bs(ke({peerId:a.user.sid,peerInfo:Hn.getCurrentSessionInfo(a.room),isSelf:!0,room:a.room})),a.streams.userMedia)&&Object.keys(a.streams.userMedia).forEach((function(e){var t=a.streams.userMedia[e].stream;Bs(Re({stream:t,streamId:t.id,peerId:a.user.sid,room:a.room,isSelf:!0,peerInfo:Hn.getCurrentSessionInfo(a.room),isVideo:ks(t),isAudio:Ms(t)}))}));s.enterRoom(a)},Ei=function(e){var t=Yd.getSkylinkState(e.rid),n={},r=t.hasMCU,i=e.rid,a=e.mid,o=e.enableIceRestart,s=e.enableDataChannel,d=e.weight,c=e.receiveOnly,l=e.publishOnly,u=e.agent,S=e.os,E=e.temasysPluginVersion,g=e.SMProtocolVersion,p=e.DTProtocolVersion,f=e.version,m=e.parentId,R=e.publisherId;return n.publisherId=R||null,n.rid=i,n.mid=a,n.agent=u&&hs(u)?u:"other",n.version=function(e){if(!e||"string"!==typeof e)return 0;if(e.indexOf(".")>-1){var t=e.split(".");if(t.length>2){var n=t[0]||"0";return t.splice(0,1),parseFloat("".concat(n,".").concat(t.join("0")),10)}return parseFloat(e||"0",10)}return parseInt(e||"0",10)}(f),n.SMProtocolVersion=hs(g)?g:Tt,n.DTProtocolVersion=hs(p)?p:r||a===en.MCU?qe:"0.1.0",n.weight=fs(d)?d:0,n.receiveOnly=c&&!1!==c,n.enableDataChannel=!Rs(s)||s,n.enableIceRestart=!!Rs(o)&&o,n.os=S&&hs(S)?S:null,n.temasysPluginVersion=E&&hs(E)?E:null,n.publishOnly=!!l,n.parentId=l&&m&&hs(m)?m:null,n.userInfo=fi.parseUserInfo(t,e,n),r&&(n.peersInRoom=e.peersInRoom),cn()(n)},gi=function(e,t,n){var r=Object.assign({},t.userInfo);return r.config=r.config?r.config:{enableDataChannel:n.enableDataChannel,enableIceRestart:n.enableIceRestart,priorityWeight:n.weight,receiveOnly:n.receiveOnly,publishOnly:n.publishOnly},r.agent=r.agent?r.agent:{name:n.agent,version:n.version,os:n.os,pluginVersion:n.temasysPluginVersion,SMProtocolVersion:n.SMProtocolVersion,DTProtocolVersion:n.DTProtocolVersion},r.settings=r.settings?r.settings:{},r.mediaStatus=r.mediaStatus?r.mediaStatus:{},r},pi={enterAndWelcome:Ei,parseUserInfo:gi},fi=pi,mi=function(e,t,n){var r=e.room;e.peerInformations[t]=od.buildPeerInformations(n,e),Yd.setSkylinkState(e,r.id)},Ri=function(e){var t=e.currentRoom,n=e.targetMid,r=e.cert,i=e.userInfo,a=e.message,o=e.caller,s=!1,d=Yd.getSkylinkState(t.id),c=d.hasMCU,l=d.peerInformations;if(!l[n]&&!c||c&&n===en.MCU&&!l.MCU){var u=!!i.screenshare;s=!0,d.peerInformations[n]=od.buildPeerInformations(a.userInfo,d);var S={agent:i.agent.name,version:i.agent.version,os:i.agent.os};Yd.setSkylinkState(d,t.id),od.addPeer({currentRoom:t,targetMid:n,peerBrowser:S,cert:r,receiveOnly:a.receiveOnly,hasScreenshare:u}),n===en.MCU?(Xs.log.INFO([n,"RTCPeerConnection",null,"MCU feature has been enabled"]),d.hasMCU=!0,Bs(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(y,{detail:e})}({peerId:n,serverPeerType:st.MCU,room:t}))):Bs(ke({peerId:n,peerInfo:Hn.getPeerInfo(n,t),isSelf:!1,room:t}))}if(d.peerMessagesStamps[n]=d.peerMessagesStamps[n]||{userData:0,audioMuted:0,videoMuted:0},o===Oi.WELCOME&&(d.peerMessagesStamps[n].hasWelcome=!1),o===Oi.WELCOME&&c&&Array.isArray(a.peersInRoom)&&a.peersInRoom.length)for(var E=d.user.sid,g=0;g<a.peersInRoom.length;g+=1){var p=a.peersInRoom[g].mid;if(p!==E){var f=fi.enterAndWelcome(a.peersInRoom[g]).userInfo;mi(d,p,f),Bs(ke({peerId:p,peerInfo:Hn.getPeerInfo(p,t),isSelf:!1,room:t}))}}else c&&n!==d.user.sid&&n!==en.MCU&&(mi(d,n,i),Bs(ke({peerId:n,peerInfo:Hn.getPeerInfo(n,t),isSelf:!1,room:t})));Yd.setSkylinkState(d,t.id),s&&Bs(Ae({peerId:n,state:ut.WELCOME,error:null,room:t}))},hi=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(d.a)(this,Object(c.a)(t).call(this))).model={client_id:null,appKey:null,timestamp:null,room_id:null,user_id:null,peer_id:null,state:null,is_remote:null,weight:null,sdp_type:null,sdp_sdp:null,error:null},e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"send",value:function(e,t,n,r,i,a){var o=Yd.getSkylinkState(e);this.model.client_id=o.clientId,this.model.appKey=Yd.getInitOptions().appKey,this.model.timestamp=(new Date).toISOString(),this.model.room_id=e,this.model.user_id=o&&o.user&&o.user.sid||null,this.model.peer_id=n,this.model.state=t,this.model.is_remote=i,this.model.weight=r.weight||null,this.model.error=("string"===typeof a?a:a&&a.msg)||null,this.model.sdp_type=null,this.model.sdp_sdp=null,-1===["enter","welcome"].indexOf(this.model.state)&&(this.model.weight=this.model.is_remote&&Hn.getPeerInfo(this.model.peer_id,o.room).config&&Hn.getPeerInfo(this.model.peer_id,o.room).config.priorityWeight?Hn.getPeerInfo(this.model.peer_id,o.room).config.priorityWeight:Hn.getCurrentSessionInfo(o.room).config.priorityWeight,this.model.sdp_type=r&&r.type||null,this.model.sdp_sdp=r&&r.sdp||null),this.addToStatsBuffer("negotiation",this.model,this.endpoints.negotiation),this.manageStatsBuffer()}}]),t}(Qn),vi=new hi,Ii=vi,Oi={ENTER:"enterHandler",WELCOME:"welcomeHander"},Ti=function(e){var t=e.currentRoom,n=e.targetMid,r=e.message,i=Yd.getSkylinkState(t.id),a=i.peerConnections,o=i.hasMCU,s=on.STATS_MODULE,d=on.NEGOTIATION_PROGRESS,c=new Bo,l=function(e){var t="welcome";if(e.caller===Oi.WELCOME){var n=Yd.getSkylinkState(e.currentRoom.id),r=n.peerMessagesStamps,i=n.peerPriorityWeight;(n.hasMCU||i>e.message.weight)&&(r[e.targetMid].hasWelcome?(t="noop",Xs.log.WARN([e.targetMid,"RTCPeerConnection",null,'Discarding extra "welcome" received.'])):(t="offer",n.peerMessagesStamps[e.targetMid].hasWelcome=!0,Yd.setSkylinkState(n,e.currentRoom.id)))}return t}(e);if("offer"===l){if(!a[n])return Xs.log.WARN([n,"RTCSessionDescription","offer",d.ERRORS.no_peer_connection]),Ii.send(t.id,s.HANDLE_NEGOTIATION_STATS.OFFER.dropped,n,r,!1,d.ERRORS.no_peer_connection),null;var u=a[n].signalingState;if(u!==at.STABLE)return Xs.log.WARN([n,"RTCSessionDescription","offer",d.ERRORS.NOT_STABLE],u),Ii.send(t.id,s.HANDLE_NEGOTIATION_STATS.OFFER.dropped,n,r,!1,d.ERRORS.NOT_STABLE),null;c[l](e.currentRoom,e.targetMid)}else o||c[l](e.currentRoom,e.targetMid)},Ai=function(e,t){var n=fi.enterAndWelcome(e),r=n.rid,i=n.mid,a=n.userInfo,o=n.publisherId,s=Yd.getSkylinkState(r),d=s.hasMCU,c=d&&o?o:i,l=window.RTCPeerConnection;!function(e,t,n,r){var i=n.room,a="enter";e===Oi.WELCOME&&(a="welcome"),Xs.log.INFO([t,"RTCPeerConnection",null,"Peer ".concat(a," received ->")],r),Ii.send(i.id,a,t,r,!0)}(t,c,s,n);var u="enter";if(t===Oi.WELCOME&&(u="welcome"),c!==en.MCU&&d&&s.publishOnly)Xs.log.WARN([c,"RTCPeerConnection",null,"Discarding ".concat(u," for publishOnly case -> ")],e);else{var S={currentRoom:s.room,targetMid:c,userInfo:a,message:n,caller:t};if(s.peerConnectionConfig.certificate!==lt.AUTO&&"function"===typeof l.generateCertificate){var E={};E=s.peerConnectionConfig.certificate===lt.ECDSA?{name:"ECDSA",namedCurve:"P-256"}:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},l.generateCertificate(E).then((function(e){S.cert=e,Ri(S),Ti(S)}))}else Ri(S),Ti(S)}},Ci=function(e){Ai(e,Oi.ENTER)},_i=n(27),Ni=function(e,t,n,r){var i=on.STATS_MODULE.HANDLE_NEGOTIATION_STATS,a=e.peerConnections,o=e.bufferedLocalOffer,s=e.room,d=a[t],c="offer"===n.type?"OFFER":"ANSWER";Ii.send(s.id,i[c].set,t,n,r),r&&Bs(Ae({state:ut[c],peerId:t,room:s})),r?("offer"===n.type?d.setOffer="remote":d.setAnswer="remote",ui.addIceCandidateFromQueue(t,s)):(o[t]=null,"offer"===n.type?d.setOffer="local":d.setAnswer="local"),Yd.setSkylinkState(e,s.id)},Di=function(e,t,n,r,i){var a=e.room,o=e.user,s=on.STATS_MODULE.HANDLE_NEGOTIATION_STATS,d="offer"===n.type?"OFFER":"ANSWER";Ii.send(a.id,s[d].set_error,t,n,r,i),Bs(Ae({state:ut.ERROR,peerId:r?t:o.sid,error:i,room:a}))},yi=function(e,t,n){var r=Yd.getSkylinkState(e.id).peerConnections,i=n.type,a=r[t],o=on.STATS_MODULE,s="offer"===i?"OFFER":"ANSWER";return a.processingLocalSDP=!0,Ii.send(e.id,o.HANDLE_NEGOTIATION_STATS[s][i],t,n,!1),a.setLocalDescription(n).then((function(){return a}))},Mi=function(e,t,n,r){var i=Yd.getSkylinkState(t.id),a=i.peerConnections,o=on.NEGOTIATION_PROGRESS,s=a[n]=e;Xs.log.DEBUG([n,Ht.SESSION_DESCRIPTION,r.type,o.SET_LOCAL_DESCRIPTION],r),s.processingLocalSDP=!1,Ni(i,n,r,!1)},ki=function(e,t,n,r){var i=Yd.getSkylinkState(e.id),a=i.peerConnections[t],o=on.NEGOTIATION_PROGRESS;Xs.log.ERROR([t,Ht.SESSION_DESCRIPTION,n.type,o.FAILED_SET_LOCAL_DESCRIPTION],r),a.processingLocalSDP=!1,a.negotiating=!1,Di(i,t,n,!1,r)},Pi=function(e,t,n){var r=Yd.getSkylinkState(e.id).peerConnections,i=n.type,a=on.STATS_MODULE,o=r[t],s="offer"===i?"OFFER":"ANSWER";o.processingRemoteSDP=!0,Ii.send(e.id,a.HANDLE_NEGOTIATION_STATS[s][i],t,n,!0);var d=function(e,t,n){var r=t;return r.sdp=$s.setSDPBitrate(e,r,n),r}(t,n,e.id);return o.setRemoteDescription(d).then((function(){return o}))},bi=function(e,t,n){var r=e;r.peerConnections[t].negotiating=!1,Yd.setSkylinkState(r,t),(new Bo).answerAck(e,t,n)},wi=function(e,t,n,r){var i=new Bo,a=r.type,o=on.NEGOTIATION_PROGRESS,s=on.DATA_CHANNEL,d=Yd.getSkylinkState(t.id),c=d.peerConnections[n]=e;return Xs.log.DEBUG([n,Ht.SESSION_DESCRIPTION,a,o.SET_REMOTE_DESCRIPTION],r),c.processingRemoteSDP=!1,"offer"===a?(Ni(d,n,r,!0),i.answer(d,n)):(d.peerMessagesStamps[n]&&(d.peerMessagesStamps[n].hasRestart=!1),d.dataChannels[n]&&(-1===c.remoteDescription.sdp.indexOf("m=application")||c.remoteDescription.sdp.indexOf("m=application 0")>0)&&(Xs.log.WARN([n,Ht.PEER_CONNECTION,null,"".concat(s.CLOSING," - ").concat(s.NO_REMOTE_DATA_CHANNEL)]),od.closeDataChannel(d,n)),Ni(d,n,r,!0),bi(d,n,!0),!0)},Li=function(e,t,n,r){var i=Yd.getSkylinkState(e.id),a=i.peerConnections[t],o=n.type;Xs.log.ERROR([t,Ht.SESSION_DESCRIPTION,o,"".concat(on.NEGOTIATION_PROGRESS.ERRORS.FAILED_SET_REMOTE_DESCRIPTION," ->")],Object(_i.a)({error:r,state:a.signalingState},o,n)),a.processingRemoteSDP=!1,a.negotiating=!1,Di(i,t,n,!0,r),"answer"===o&&bi(i,t,!1)},Ui=function(e){var t=e.rid,n=e.mid,r=e.type,i=e.sdp,a=e.mediaInfoList,o=Yd.getSkylinkState(t),s=o.hasMCU,d=o.room,c=o.bufferedLocalOffer,l=n,u="offer"===r?"OFFER":"ANSWER",S=on.NEGOTIATION_PROGRESS;if(Xs.log.INFO([l,null,r,"Received ".concat(r," from peer. ").concat(u,":")],e),function(e,t){var n=t.weight,r=t.type,i=t.mid,a=t.sdp,o=t.resend,s=e.peerPriorityWeight,d=e.bufferedLocalOffer,c=e.room,l=e.peerConnections,u=i,S=l[u],E=S.processingRemoteSDP,g=S.processingLocalSDP,p=S.negotiating,f=on.STATS_MODULE,m=on.NEGOTIATION_PROGRESS,R=on.NO_PEER_CONNECTION,h="offer"===r?"OFFER":"ANSWER",v=null;if(l[u]||(Xs.log.ERROR([u,null,r,"".concat(R.NO_PEER_CONNECTION,". Unable to set").concat("offer"===r?"Remote":"Local","Offer.")]),v=R.NO_PEER_CONNECTION),"offer"===r&&l[u].signalingState!==at.STABLE&&(Xs.log.WARN([u,null,r,m.ERRORS.NOT_STABLE],{signalingState:l[u].signalingState,isRestart:!!o}),v="Peer connection state is ".concat(l[u].signalingState,".")),"offer"===r&&d[u]&&s>n&&(Xs.log.WARN([u,null,r,m.ERRORS.OFFER_TIEBREAKER],{selfWeight:s,messageWeight:n}),v=m.ERRORS.OFFER_TIEBREAKER),E)Xs.log.WARN([u,Ht.SESSION_DESCRIPTION,r,m.ERRORS.PROCESSING_EXISTING_SDP],a),v=m.ERRORS.PROCESSING_EXISTING_SDP;else if(!g&&!E&&p&&"offer"===r){var I=e;Xs.log.DEBUG([u,Ht.SESSION_DESCRIPTION,r,m.ERRORS.ADDING_REMOTE_OFFER_TO_BUFFER],t),I.bufferedRemoteOffers[u]=I.bufferedRemoteOffers[u]?I.bufferedRemoteOffers[u]:[],I.bufferedRemoteOffers[u].push(t),Yd.setSkylinkState(I,c.id)}return v&&Ii.send(c.id,f.HANDLE_NEGOTIATION_STATS[h].dropped,u,t,!0,v),!v}(o,e))try{if(function(e,t){var n=e,r=t.userInfo,i=t.rid,a=r,o=t.mid;r&&"object"===typeof r&&(a.settings.data=!!(n.dataChannels[o]&&n.dataChannels[o].main&&n.dataChannels[o].main.channel&&n.dataChannels[o].main.channel.readyState===Ye.OPEN),n.peerInformations[o].settings=a.settings||{},n.peerInformations[o].mediaStatus=a.mediaStatus||{},n.peerInformations[o].userData=a.userData),n.peerConnections[o].negotiating=!0,Yd.setSkylinkState(n,i)}(o,e),Vo.setPeerMediaInfo(d,l,a),Vo.deleteUnavailableMedia(d,l),"offer"===r){var E=null,g={type:r,sdp:s?i.replace(/\r\n/g,"\n").split("\n").join("\r\n"):i};Pi(d,l,g).then((function(e){return wi(e,d,l,g)})).catch((function(e){return Li(d,l,g,e)})).then((function(e){return E={type:e.type,sdp:e.sdp},yi(d,l,E)})).then((function(e){return Mi(e,d,l,E)})).catch((function(e){return ki(d,l,E,e)}))}else if(c[l]){var p=c[l],f={type:r,sdp:s?i.replace(/\r\n/g,"\n").split("\n").join("\r\n"):i};yi(d,l,p).then((function(e){return Mi(e,d,l,p)})).catch((function(e){return ki(d,l,p,e)})).then((function(){return Pi(d,l,f)})).then((function(e){return wi(e,d,l,f)})).catch((function(e){return Li(d,l,f,e)}))}else Xs.log.ERROR([l,Ht.PEER_CONNECTION,null,S.ERRORS.NO_LOCAL_BUFFERED_OFFER])}catch(m){Xs.log.ERROR([l,Ht.SESSION_DESCRIPTION,r,"Failed processing ".concat(u," ->")],m)}return null},Gi=function(e){Ui(e)},Fi=function(e){Ui(e)},Bi=function(e,t){var n=e.peerConnections,r=e.currentRTCRTPSenders;return new Promise((function(e){var i=n[t],a=i.getSenders()?i.getSenders():[],o=[],s=r[t]||[],d=!1;a.forEach((function(e){o.push(e.getStats())}));var c={};Promise.all(o).then((function(t){t.forEach((function(e,t){e.forEach((function(e){e&&e.ssrc?c[e.ssrc]=a[t]:e&&"ssrc"===e.type&&e.id.indexOf("send")>1&&e.values.forEach((function(e){e.ssrc&&(c[e.ssrc]=a[t])}))}))}));var n=Object.keys(c);if(n.length!==s.length)d=!0;else{for(var r=0,i=0;i<n.length;i+=1)for(var o=c[n[i]],l=0;l<s.length;l+=1){if(o===s[l]){r+=1;break}}d=r!==n.length}e(d)}))}))},ji=function(e,t,n,r){var i=Yd.getSkylinkState(t.id),a=i.hasMCU,o=i.peerInformations,s=i.enableIceRestart,d=Hn.getPeersCustomSettings(i),c={};return c[e]={iceRestart:!a&&o[e]&&o[e].config&&o[e].config.enableIceRestart&&s&&n,customSettings:d[e]||{}},r&&(c.errors=r),c},Vi=function(e,t,n){var r={};return r.listOfPeers=e,r.refreshErrors=t,r.refreshSettings=n,r},xi=function(e,t,n){var r=[];return Object.keys(e).forEach((function(i){r.push(ji(e[i],t,n))})),r},Hi=function(e,t){var n={};return n[e]=t,n},Wi=function(e,t,n,r){return new Promise((function(i,a){e||a(new Error(on.ROOM_STATE.NO_ROOM_NAME));var o=e.peerConnections,s=e.hasMCU,d=e.room,c=Yd.getInitOptions().mcuUseRenegoRestart,l=on.PEER_CONNECTION,u=function(e,t,n,r){var i=!1,a={},o=Object.keys(r);return Array.isArray(e)?o=e:hs(e)?o=[e]:Rs(e)?i=e:e&&gs(e)&&(a=e),Rs(t)?i=t:t&&gs(t)&&(a=t),n&&gs(n)&&(a=n),{listOfPeers:o,doIceRestart:i,bwOptions:a}}(t,n,r,o),S=u.listOfPeers,E=u.doIceRestart,g=u.bwOptions;try{!Ss(S)||s&&!c||(Xs.log.ERROR(l.refresh_no_peer_connection),a({refreshErrors:{self:l.refresh_no_peer_connection},listOfPeers:S})),Xs.log.INFO([null,"PeerConnection",null,l.refresh_start]),od.refreshPeerConnection(S,e,E,g).then((function(e){for(var t=s?[e]:e,n=[],r=0;r<t.length;r+=1)if(Array.isArray(t[r])){var o=t[r];n.push(Hi(o[0],o[1])),Xs.log.WARN([S,"PeerConnection",null,l.refresh_peer_failed],o[0])}else"string"===typeof t[r]&&Xs.log.INFO([S,"PeerConnection",null,l.refresh_peer_success],t[r]);n.length===S.length?a(Vi(S,n,xi(S,d,E))):i(Vi(S,n,xi(S,d,E)))})).catch((function(e){return Xs.log.ERROR([null,"RTCPeerConnection",null,l.refresh_failed],e)})).finally((function(){return Xs.log.INFO(l.refresh_completed)}))}catch(p){a(p)}}))},Ki=function(e){var t=e.mid,n=e.rid,r=e.success,i=Yd.getSkylinkState(n),a=t;Bs(Ae({state:ut.ANSWER_ACK,peerId:a,room:i.room})),i.peerConnections[a].negotiating=!1,Yd.setSkylinkState(i,n),r?function(e,t){if(e.bufferedRemoteOffers[t]&&!Ss(e.bufferedRemoteOffers[t])){var n=e.bufferedRemoteOffers[t].shift();return Xs.log.DEBUG([t,"RTCSessionDescription",n.type,on.NEGOTIATION_PROGRESS.APPLYING_BUFFERED_REMOTE_OFFER],n),Ui(n),Yd.setSkylinkState(e,e.room.id),!0}return!1}(i,a)||Bi(i,a).then((function(e){e&&Wi(i,a).catch((function(e){Xs.log.ERROR([t,Ht.SESSION_DESCRIPTION,ut.ANSWER_ACK,on.NEGOTIATION_PROGRESS.ERRORS.FAILED_RENEGOTIATION],e)}))})):Xs.log.ERROR([a,Ht.SESSION_DESCRIPTION,ut.ANSWER,on.NEGOTIATION_PROGRESS.ERRORS.FAILED_SET_REMOTE_ANSWER])},Yi=function(e){Ai(e,Oi.WELCOME)},Ji=function(e){var t=e.candidate,n=e.mid,r=e.rid,i=Yd.getSkylinkState(r),a=i.room,o=Yd.getInitOptions(),s=i.peerConnections[n],d=i.peerEndOfCandidatesCounter[n]||{},c=window.RTCIceCandidate,l=on.ICE_CANDIDATE.CANDIDATE_HANDLER,u=on.PEER_CONNECTION,S=on.STATS_MODULE.HANDLE_ICE_GATHERING_STATS,E=new $r;if(!t&&!e.id)return Xs.log.WARN([n,l.tag,null,l.INVALID_CANDIDATE],e),null;var g=new c({sdpMLineIndex:e.label,candidate:t,sdpMid:e.id}),p="can-".concat(g.foundation),f=g.candidate.split(" ")[7]||"";Xs.log.DEBUG([n,l.tag,"".concat(p,":").concat(f),l.VALID_CANDIDATE],g),d.len=d.len||0,d.hasSet=!1,d.len+=1,Yd.setSkylinkState(i,r);var m={candidate:{candidate:g.candidate,sdpMid:g.sdpMid,sdpMLineIndex:g.sdpMLineIndex},error:null};if(Bs(_e({room:a,state:nt.RECEIVED,peerId:n,candidateId:p,candidateType:f,candidate:m.candidate,error:m.error})),!s||s.signalingState===at.CLOSED)return Xs.log.WARN([n,l.tag,"".concat(p,":").concat(f),u.NO_PEER_CONNECTION]),m.error=new Error(u.NO_PEER_CONNECTION),E.send(a.id,S.PROCESS_FAILED,n,p,m.candidate,m.error),Bs(_e({room:a,state:nt.DROPPED,peerId:n,candidateId:p,candidateType:f,candidate:m.candidate,error:m.error})),od.signalingEndOfCandidates(n,i),null;if(o.filterCandidatesType[f]){if(!i.hasMCU||!o.forceTURN)return Xs.log.WARN([n,l.tag,"".concat(p,":").concat(f),l.FILTERED_CANDIDATE],g),m.error=new Error(l.FILTERED_CANDIDATE),E.send(a.id,S.DROPPED,n,p,m.candidate,m.error),Bs(_e({room:a,state:nt.DROPPED,peerId:n,candidateId:p,candidateType:f,candidate:m.candidate,error:m.error})),od.signalingEndOfCandidates(n,i),null;Xs.log.WARN([n,l.tag,"".concat(p,":").concat(f),l.FILTERING_FLAG_NOT_HONOURED],g)}s.remoteDescription&&s.remoteDescription.sdp&&s.localDescription&&s.localDescription.sdp?ui.addIceCandidate(n,p,f,g,i):ui.addIceCandidateToQueue(n,p,f,g,i),od.signalingEndOfCandidates(n,i);var R=i.gatheredCandidates[n];return R||(R={sending:{host:[],srflx:[],relay:[]},receiving:{host:[],srflx:[],relay:[]}}),R.receiving[f].push({sdpMid:g.sdpMid,sdpMLineIndex:g.sdpMLineIndex,candidate:g.candidate}),i.gatheredCandidates[n]=R,Yd.setSkylinkState(i,r),null},Xi=function(e){var t=e.result,n=e.type,r=t;Xs.log.INFO(["Server",null,n,"Received list of peers"],r),Bs(we({state:St.DISPATCHED,privilegePeerId:null,peerList:r}))},Qi=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(d.a)(this,Object(c.a)(t).call(this))).model={client_id:null,appKey:null,timestamp:null,room_id:null,user_id:null,state:null,contents:null},e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"send",value:function(e,t){var n=Yd.getSkylinkState(e);this.model.room_id=e,this.model.user_id=n&&n.user&&n.user.sid||null,this.model.client_id=n.clientId,this.model.state=t.type,this.model.contents=t,this.model.appKey=Yd.getInitOptions().appKey,this.model.timestamp=(new Date).toISOString(),this.postStats(this.endpoints.session,this.model)}}]),t}(Qn),qi=Qi,zi=function(e){var t=Yd.getSkylinkState(),n=t.room,r=t.user;Xs.log.WARN(["Server",null,e.type,"Introduce failed. Reason: ".concat(e.reason)]),(new qi).send(n.id,e),Bs(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(de,{detail:e})}({state:de.ERROR,privilegedPeerId:r.sid,receivingPeerId:e.receivingPeerId,sendingPeerId:e.sendingPeerId,reason:e.reason}))},Zi=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(d.a)(this,Object(c.a)(t).call(this))).model={client_id:null,appKey:null,timestamp:null,room_id:null,user_id:null,peer_id:null,state:null,local_candidate:{},remote_candidate:{}},e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"send",value:function(e,t,n){var r=this;try{var i=Yd.getSkylinkState(e);if(!i)return;this.model.room_id=e,this.model.user_id=i&&i.user&&i.user.sid||null,this.model.peer_id=n,this.model.client_id=i.clientId,this.model.state=t,this.model.appKey=Yd.getInitOptions().appKey,this.model.timestamp=(new Date).toISOString(),od.retrieveStatistics(e,n,Yd.getInitOptions().beSilentOnStatsLogs).then((function(e){e&&["local","remote"].forEach((function(t){var n=e.selectedCandidatePair[t];if(n){var i=r.model["".concat(t,"_candidate")];i.ip_address=n.ipAddress||null,i.port_number=n.portNumber||null,i.candidate_type=n.candidateType||null,i.protocol=n.transport||null,i.priority=n.priority||null,"local"===t&&(r.model.local_candidate.network_type=n.networkType||null)}})),r.postStats(r.endpoints.iceConnection,r.model)})).catch((function(e){Xs.log.DEBUG(on.STATS_MODULE.HANDLE_ICE_CONNECTION_STATS.RETRIEVE_FAILED,e)}))}catch(a){Xs.log.DEBUG(on.STATS_MODULE.HANDLE_ICE_CONNECTION_STATS.SEND_FAILED,a)}}}]),t}(Qn),$i=Zi,ea=function(e,t){var n=Yd.getSkylinkState(e);n.peerConnections[t].signalingState!==at.CLOSED&&(n.peerConnections[t].close(),Ps($t.SAFARI)&&bs(11)&&(function(e,t){var n=e;n.peerConnections[t].signalingStateClosed||(n.peerConnections[t].signalingStateClosed=!0,Bs(Le({peerId:t,state:at.CLOSED})))}(n,t),function(e,t){var n=e;n.peerConnections[t].iceConnectionStateClosed||(n.peerConnections[t].iceConnectionStateClosed=!0,(new $i).send(n.room.id,t,e),Bs(De({peerId:t,state:rt.CLOSED})))}(n,t)))},ta=function(e,t){var n=Yd.getSkylinkState(e);if(function(e,t){var n=e;return!!n&&(!(!n.peerConnections[t]&&!n.peerInformations[t])||(Xs.log.DEBUG([t,Ht.PEER_CONNECTION,null,"".concat(on.ROOM.LEAVE_ROOM.DROPPING_HANGUP," - ").concat(on.PEER_CONNECTION.NO_PEER_CONNECTION)]),!1))}(n,t)){var r=n.room,i=Hn.getPeerInfo(t,r);if(t===en.MCU){var a=n;return Bs(be({peerId:t,serverPeerType:st.MCU,room:r})),a.hasMCU=!1,void Yd.setSkylinkState(a,r.id)}Bs(Pe({peerId:t,peerInfo:i,isSelf:!1,room:r}))}},na=function(e){var t=e.mid,n=e.rid,r=e.publisherId,i=n,a=t;Yd.getSkylinkState(i).hasMCU&&(a=r),Xs.log.INFO([a,Ht.PEER_CONNECTION,null,on.ROOM.LEAVE_ROOM.PEER_LEFT.START]);try{ta(i,a),function(e,t){Yd.getSkylinkState(e).peerConnections[t]&&ea(e,t)}(i,a),function(e,t){var n=Yd.getSkylinkState(e);setTimeout((function(){delete n.peerConnections[t],Yd.setSkylinkState(n,n.room.id),Xs.log.INFO([t,Ht.PEER_CONNECTION,null,on.ROOM.LEAVE_ROOM.PEER_LEFT.SUCCESS])}),500),delete n.peerInformations[t],delete n.peerMedias[t],delete n.remoteStreams[t],delete n.peerMessagesStamps[t],delete n.peerEndOfCandidatesCounter[t],delete n.peerCandidatesQueue[t],delete n.sdpSessions[t],delete n.peerStats[t],delete n.peerBandwidth[t],delete n.gatheredCandidates[t],delete n.peerCustomConfigs[t],delete n.peerConnStatus[t]}(i,a),function(e,t){var n=Yd.getSkylinkState(e);od.closeDataChannel(n,t)}(i,a)}catch(o){Xs.log.DEBUG([a,Ht.ROOM,null,on.ROOM.LEAVE_ROOM.PEER_LEFT.ERROR],o)}},ra=function(e,t,n,r,i){var a=Yd.getSkylinkState(n.room.id),o=a.peerConnections,s=a.peerConnectionConfig,d=a.bufferedLocalOffer,c=a.peerPriorityWeight,l=a.room,u=on.STATS_MODULE.HANDLE_NEGOTIATION_STATS,S=window.AdapterJS,E=o[t],g={type:r.type,sdp:r.sdp};if(E.processingLocalSDP=!0,"firefox"===S.webrtcDetectedBrowser&&($s.setOriginalDTLSRole(a,g,!1),g.sdp=$s.modifyDTLSRole(a,r)),s.disableBundle&&(g.sdp=g.sdp.replace(/a=group:BUNDLE.*\r\n/gi,"")),Xs.log.INFO([t,"RTCSessionDescription",r.type,"Local session description updated ->"],g.sdp),r.type===ut.OFFER){Ii.send(l.id,u.OFFER.offer,t,r,!1),Xs.log.INFO([t,"RTCSessionDescription",r.type,"Local offer saved."]),d[t]=r;var p={type:g.type,sdp:g.sdp,mid:a.user.sid,target:t,rid:n.room.id,userInfo:Hn.getUserInfo(n.room),weight:c,mediaInfoList:Vo.retrieveMediaInfoForOfferAnswer(l,g)};if(i&&Object.keys(i).length)for(var f=Object.keys(i),m=Object.keys(p),R=0;R<f.length;R+=1){var h=f[R];-1===m.indexOf(h)&&(p[h]=i[h])}e(p)}else{Ii.send(l.id,u.ANSWER.answer,t,r,!1),e({type:g.type,sdp:g.sdp,mid:a.user.sid,target:t,rid:n.room.id,userInfo:Hn.getUserInfo(n.room),mediaInfoList:Vo.retrieveMediaInfoForOfferAnswer(l,g)})}},ia=on.STATS_MODULE.HANDLE_NEGOTIATION_STATS,aa=function(e,t,n,r,i){var a=n.room;Xs.log.DEBUG([t,null,null,"Created offer"],i),Ii.send(a.id,ia.OFFER.create,t,i,!1),ra(e,t,n,i,r)},oa=function(e,t,n,r){var i=n.room;Xs.log.ERROR([t,null,null,"Failed creating an offer:"],r),Ii.send(i.id,ia.OFFER.create_error,t,null,!1,r),Bs(Ae({state:ut.ERROR,peerId:t,error:r,room:n.room})),e(r)},sa=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,i=Yd.getSkylinkState(e.id),a=Yd.getInitOptions(),o=a.enableDataChannel,s=i.peerConnections,d=i.hasMCU,c=i.enableIceRestart,l=i.peerInformations,u=i.voiceActivityDetection,S=i.peerConnStatus,E=i.dataChannels,g=window,p=g.AdapterJS,f=s[t],m={offerToReceiveAudio:!(!i.sdpSettings.connection.audio&&t!==en.MCU)&&$s.getSDPCommonSupports(t,null,e.id).video,offerToReceiveVideo:!(!i.sdpSettings.connection.video&&t!==en.MCU)&&$s.getSDPCommonSupports(t,null,e.id).audio,iceRestart:!!((l[t]||{}).config||{}).enableIceRestart&&n&&c,voiceActivityDetection:u};return d&&"function"!==typeof f.addTransceiver&&(m.offerToReceiveVideo=!0),d&&t!==en.MCU||Un.addLocalMediaStreams(t,i),o&&l[t].config.enableDataChannel&&(E[t]&&E[t].main||(od.createDataChannel({peerId:t,roomState:i,createAsMessagingChannel:!0}),i.peerConnections[t].hasMainChannel=!0)),Xs.log.DEBUG([t,null,null,"Creating offer with config:"],m),f.endOfCandidates=!1,f.negotiating=!0,S[t]&&(i.peerConnStatus[t].sdpConstraints=m),Yd.setSkylinkState(i,e.id),new Promise((function(e,n){f.createOffer("plugin"===p.webrtcDetectedType?{mandatory:{OfferToReceiveAudio:m.offerToReceiveAudio,OfferToReceiveVideo:m.offerToReceiveVideo,iceRestart:m.iceRestart,voiceActivityDetection:m.voiceActivityDetection}}:m).then((function(n){return aa(e,t,i,r,n)})).catch((function(e){return oa(n,t,i,e)}))}))},da=function(e){var t=null,n=e.currentRoom,r=e.targetMid,i=e.cert,a=(e.hasScreenShare,Yd.getInitOptions().filterCandidatesType),o=Yd.getSkylinkState(n.id),s=o.peerConnectionConfig,d=o.room,c={iceServers:o.room.connection.peerConfig.iceServers,iceTransportPolicy:a.host&&a.srflx&&!a.relay?"relay":"all",bundlePolicy:s.bundlePolicy===dt.NONE?dt.BALANCED:s.bundlePolicy,rtcpMuxPolicy:s.rtcpMuxPolicy,iceCandidatePoolSize:s.iceCandidatePoolSize},l={optional:[{DtlsSrtpKeyAgreement:!0},{googIPv6:!0}]};i&&(c.certificates=[i]),o.peerConnStatus[r]&&(o.peerConnStatus[r].constraints=c,o.peerConnStatus[r].optional=l),Yd.setSkylinkState(o,n.id);try{t=function(e,t,n,r,i){var a,o,s,d,c,l,u=Yd.getInitOptions(),S=Yd.getSkylinkState(i.id),E=window.AdapterJS;Xs.log.DEBUG([e,"RTCPeerConnection",null,"Creating peer connection ->"],{constraints:t,optional:n});var g,p=window,f=p.RTCPeerConnection,m=p.msRTCPeerConnection,R=new(u.useEdgeWebRTC&&m?window.msRTCPeerConnection:f)(t,n),h=[R,e,S];(R.setOffer="",R.setAnswer="",R.negotiating=!1,R.hasStream=!1,R.hasMainChannel=!1,R.firefoxStreamId="",R.processingLocalSDP=!1,R.processingRemoteSDP=!1,R.gathered=!1,R.gathering=!1,R.localStream=null,R.localStreamId=null,R.iceConnectionStateClosed=!1,R.signalingStateClosed=!1,S.gatheredCandidates[e]={sending:{host:[],srflx:[],relay:[]},receiving:{host:[],srflx:[],relay:[]}},S.peerEndOfCandidatesCounter[e]=S.peerEndOfCandidatesCounter[e]||{},S.sdpSessions[e]={local:{},remote:{}},S.peerBandwidth[e]={},e===en.MCU&&(Xs.log.INFO("Creating an empty transceiver of kind video with MCU"),"function"===typeof R.addTransceiver&&R.addTransceiver("video")),Yd.setSkylinkState(S,i.id),"firefox"===E.webrtcDetectedBrowser&&(R.removeStream=Yr(R)),R.ontrack=(a=lo.ontrack).bind.apply(a,[R].concat(h)),R.ondatachannel=(o=lo.ondatachannel).bind.apply(o,[R].concat(h)),R.onicecandidate=(s=lo.onicecandidate).bind.apply(s,[R].concat(h)),R.oniceconnectionstatechange=(d=lo.oniceconnectionstatechange).bind.apply(d,[R].concat(h)),R.onsignalingstatechange=(c=lo.onsignalingstatechange).bind.apply(c,[R].concat(h)),R.onicegatheringstatechange=(l=lo.onicegatheringstatechange).bind.apply(l,[R].concat(h)),E.webrtcDetectedBrowser===$t.REACT_NATIVE)&&(R.onsenderadded=(g=lo.onsenderadded).bind.apply(g,[R].concat(h)),R.onremovetrack=lo.onremovetrack.bind(R,e,S.room,!1));return R}(r,c,l,0,n)}catch(u){Xs.log.ERROR([r,null,null,"Failed creating peer connection:"],u),t=null,Bs(Ae({state:ut.ERROR,peerId:r,error:u,room:d}))}return t},ca=function(e){var t=null,n=e.currentRoom,r=e.targetMid,i=e.peerBrowser,a=e.cert,o=e.receiveOnly,s=e.hasScreenShare,d=Yd.getInitOptions(),c=Yd.getSkylinkState(n.id),l=c.peerConnections,u=c.room,S=new $i;if(l[r])Xs.log.WARN([r,null,null,"Connection to peer has already been made."]);else{c.peerConnStatus[r]={connected:!1,init:!1},Xs.log.INFO([r,null,null,"Starting the connection to peer. Options provided:"],{peerBrowser:i,receiveOnly:o,enableDataChannel:d.enableDataChannel}),t=da({currentRoom:n,targetMid:r,hasScreenShare:s,cert:a,sdpSemantics:jt.UNIFIED});try{var E=t.getConfiguration();E.sdpSemantics===jt.UNIFIED?Xs.log.INFO([r,"SDP Semantics",null,"Peer Connection has Unified plan."]):E.sdpSemantics===jt.PLAN_B?Xs.log.INFO([r,"SDP Semantics",null,"Peer Connection has Plan-B."]):Xs.log.INFO([r,"SDP Semantics",null,"The sdpSemantics parameter is not supported by this browser version."])}catch(g){Xs.log.INFO([r,"SDP Semantics",null,"getConfiguration() is not available in this browser version. Ex : "],g)}c.peerConnections[r]=t,Yd.setSkylinkState(c,n.id),S.send(u.id,t.iceConnectionState,r),ai.send(u.id,"new",r,!1)}return t},la=on.STATS_MODULE.HANDLE_NEGOTIATION_STATS,ua=function(e,t){var n=Yd.getSkylinkState(e.room.id),r=n.peerConnections,i=n.hasMCU,a=n.peerConnStatus,o=n.voiceActivityDetection,s=r[t],d=window.AdapterJS;Xs.log.INFO([t,null,null,"Creating answer with config:"],e.room.connection.sdpConstraints);var c="edge"===d.webrtcDetectedBrowser?{offerToReceiveVideo:!(!n.sdpSettings.connection.audio&&t!==en.MCU)&&$s.getSDPCommonSupports(t,s.remoteDescription,e.room.id).video,offerToReceiveAudio:!(!n.sdpSettings.connection.video&&t!==en.MCU)&&$s.getSDPCommonSupports(t,s.remoteDescription,e.room.id).audio,voiceActivityDetection:o}:void 0;return i&&t!==en.MCU||Un.addLocalMediaStreams(t,e),a[t]&&(n.peerConnStatus[t].sdpConstraints=c),new Promise((function(n,r){return s.createAnswer(c).then((function(r){return function(e,t,n,r){var i=n.room;Xs.log.DEBUG([t,null,null,"Created answer"],r),Ii.send(i.id,la.ANSWER.create,t,r,!1),ra(e,t,n,r)}(n,t,e,r)})).catch((function(n){return function(e,t,n,r){var i=n.room;Xs.log.ERROR([t,null,null,"Failed creating an answer:"],r),Ii.send(i.id,la.ANSWER.create_error,t,null,!1,r),Bs(Ae({state:ut.ERROR,peerId:t,error:r,room:n.room})),e(r)}(r,t,e,n)}))}))},Sa=function(e,t,n,r,i){var a=Yd.getSkylinkState(e.room.id),o=a.peerConnections[t],s=a.dataChannels[t],d=r;if(d&&d!==t||(d="main"),("object"!==typeof n||!n)&&(!n||"string"!==typeof n))return Xs.log.WARN([t,"RTCDataChannel",d,"Dropping invalid data ->"],n),null;if(!o||o.signalingState===at.CLOSED)return Xs.log.WARN([t,"RTCDataChannel",d,"Dropping for sending message as Peer connection does not exists or is closed ->"],n),null;if(!s||!s[d])return Xs.log.WARN([t,"RTCDataChannel",d,"Dropping for sending message as Datachannel connection does not exists ->"],n),null;var c=s[d].channelName,l=s[d].channelType,u=s[d].channel.readyState,S="object"===typeof n&&n.type===Lt.MESSAGE?Xe.MESSAGE:Xe.TRANSFER;if(u!==Ye.OPEN){var E=new Error("Failed sending message as Datachannel connection state is not opened. Current readyState is ".concat(u));throw Xs.log.ERROR([t,"RTCDataChannel",d,E],n),Bs(Oe({peerId:t,channelName:c,channelType:l,messageType:S,error:E,state:Ye.SEND_MESSAGE_ERROR,bufferAmount:od.getDataChannelBuffer(s[d].channel)})),E}try{i||"object"!==typeof n?(Xs.log.DEBUG([t,"RTCDataChannel",d,"Sending data with size ->"],n.size||n.length||n.byteLength),s[d].channel.send(n)):(Xs.log.DEBUG([t,"RTCDataChannel",d,"Sending ".concat(n.type," protocol message ->")],n),s[d].channel.send(JSON.stringify(n)))}catch(g){throw Xs.log.ERROR([t,"RTCDataChannel",d,"Failed sending data)"],{error:g,data:n}),Bs(Oe({peerId:t,channelName:c,channelType:l,messageType:S,error:g,state:Ye.SEND_MESSAGE_ERROR,bufferAmount:od.getDataChannelBuffer(s[d].channel)})),g}return null},Ea=function(e,t,n,r,i){var a=Yd.getSkylinkState(e.room.id),o=null,s=null,d=i===Je.MESSAGING?"main":r,c=a.dataChannels[n]||{};if(!c.hasOwnProperty(d)||"object"!==typeof c[d])return null;if(o=c[d].transferId,(s=c[d].streamId)&&a.dataStreams[s]&&("string"===a.dataStreams[s].sessionChunkType?"string"===typeof t:"object"===typeof t),!a.peerConnections[n])return Xs.log.WARN([n,"RTCDataChannel",d,"Dropping data received from Peer as connection is not present ->"],t),null;if(!a.dataChannels[n]||!a.dataChannels[n][d])return Xs.log.WARN([n,"RTCDataChannel",d,"Dropping data received from Peer as Datachannel connection is not present ->"],t),null;if("string"===typeof t)try{var l=JSON.parse(t);if(!1,Xs.log.DEBUG([n,"RTCDataChannel",d,"Received protocol ".concat(l.type," message ->")],l),[Lt.ACK,Lt.ERROR,Lt.CANCEL].indexOf(l.type)>-1&&!(o&&a.dataTransfers[o]&&a.dataTransfers[o].sessions[n]))return Xs.log.WARN([n,"RTCDataChannel",d,"Discarded protocol message as data transfer session is not present ->"],l),null;switch(l.type){case Lt.WRQ:if(o&&a.dataTransfers[o]&&a.dataTransfers[o].sessions[n]){Xs.log.WARN([n,"RTCDataChannel",d,"Rejecting bidirectional data transfer request as it is currently not supported in the SDK ->"],l),Sa(e,n,{type:Lt.ACK,ackN:-1,sender:a.user.sid},d);break}break;case Lt.MESSAGE:!function(e,t,n,r){var i=n.sender||t;Xs.log.INFO([i,"RTCDataChannel",r,"Received P2P message from peer:"],n),Bs(Te({room:e.room,message:{targetPeerId:n.target,content:n.data,senderPeerId:i,isDataChannel:!0,isPrivate:n.isPrivate},isSelf:!1,peerId:i,peerInfo:Hn.getPeerInfo(i,e.room)}))}(a,n,l,d);break;default:Xs.log.WARN([n,"RTCDataChannel",d,"Discarded unknown ".concat(l.type," message ->")],l)}}catch(u){Bs(Oe({peerId:n,channelName:r,channelType:i,error:u,state:Ye.ERROR,bufferAmount:od.getDataChannelBuffer(a.dataChannels[n][d].channel)}))}return null},ga=function(e,t){var n=e.peerId,r=e.channelName,i=e.channelType,a=e.roomState;Ea(a,t.data,n,r,i)},pa=function(e){function t(){var e;Object(o.a)(this,t),e=Object(d.a)(this,Object(c.a)(t).call(this));var n=window.AdapterJS;return e.model={client_id:null,appKey:null,timestamp:null,room_id:null,user_id:null,peer_id:null,state:null,channel_id:null,channel_label:null,channel_type:null,channel_binary_type:null,error:null,agent_name:n.webrtcDetectedBrowser,agent_type:n.webrtcDetectedType,agent_version:n.webrtcDetectedVersion},e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"send",value:function(e,t,n,r,i,a){var o=Yd.getSkylinkState(e);this.model.room_id=e,this.model.user_id=o&&o.user&&o.user.uid||null,this.model.peer_id=n,this.model.client_id=o.clientId,this.model.state=t,this.model.channel=r,this.model.channel_id=r.id,this.model.channel_label=r.label,this.model.channel_type="main"===i?"persistent":"temporal",this.model.channel_binary_type=r.binaryType,this.model.appKey=Yd.getInitOptions().appKey,this.model.timestamp=(new Date).toISOString(),this.error=("string"===typeof a?a:a&&a.message)||null,"plugin"===this.model.agent_name&&(this.model.channel_binary_type="int8Array","IE"===this.model.agent_name&&this.model.agent_version<11&&(this.model.channel_binary_type="none")),this.postStats(this.endpoints.dataChannel,this.model)}}]),t}(Qn),fa=pa,ma=function(e,t){var n=e.dataChannel,r=e.peerId,i=e.channelName,a=e.channelProp,o=e.channelType,s=e.roomState;if("NONE"!==t.error.errorDetail){var d=Yd.getSkylinkState(s.room.id).room,c=new fa;Xs.log.ERROR([r,"RTCDataChannel",a,"Datachannel has an exception ->"],t),c.send(d.id,Ye.ERROR,r,n,a,t),Bs(Oe({state:Ye.ERROR,room:d,peerId:r,channelName:i,channelType:o,bufferAmount:od.getDataChannelBuffer(n),error:t}))}else Xs.log.DEBUG([r,"RTCDataChannel",a,"Datachannel state ->"],t.error.message)},Ra=function(e){var t=e.dataChannel,n=e.channelProp,r=e.channelName,i=e.channelType,a=e.peerId,o=e.roomState,s=e.bufferThreshold,d=new fa,c=o.room,l=on.STATS_MODULE;Xs.log.DEBUG([a,"RTCDataChannel",n,"Datachannel has opened"]),t.bufferedAmountLowThreshold=s||0,d.send(c.id,l.HANDLE_DATA_CHANNEL_STATS.closed,a,t,n),Bs(Oe({state:Ye.OPEN,peerId:a,channelName:r,channelType:i,bufferAmount:od.getDataChannelBuffer(t)}))},ha=function(e){var t=e.dataChannel,n=e.peerId,r=e.channelName,i=e.channelProp,a=e.channelType,o=e.roomState,s=Yd.getSkylinkState(o.room.id).room;Xs.log.DEBUG([n,"RTCDataChannel",i,"Datachannel buffering data transfer low"]),Bs(Oe({state:Ye.BUFFERED_AMOUNT_LOW,room:s,peerId:n,channelName:r,channelType:a,bufferAmount:od.getDataChannelBuffer(t)}))},va=function(e){var t=e.dataChannel,n=e.peerId,r=e.channelName,i=e.channelProp,a=e.channelType,o=e.roomState,s=on.DATA_CHANNEL,d=on.STATS_MODULE,c=Yd.getSkylinkState(o.room.id)||Object.values(Yd.getSkylinkState())[0];if(c){var l,u=c.room,S=c.peerConnections,E=function(e,t){for(var n=t.dataTransfers,r=Object.keys(n),i=0;i<r.length;i+=1)if(-1!==r[i].indexOf(e))return r[i];return null}(n,c),g=new fa;Xs.log.DEBUG([n,"RTCDataChannel",i,s.closed]);try{if(g.send(u.id,d.HANDLE_DATA_CHANNEL_STATS.closed,n,t,i),Bs(Oe({state:Ye.CLOSED,peerId:n,room:u,channelName:r,channelType:a,bufferAmount:od.getDataChannelBuffer(t)})),E&&Bs((l={state:Ye.ERROR,transferId:E,peerId:n,transferInfo:null,error:new Error(s.closed)},new me(L,{detail:l}))),S[n]&&S[n].remoteDescription&&S[n].remoteDescription.sdp&&(-1===S[n].remoteDescription.sdp.indexOf("m=application")||S[n].remoteDescription.sdp.indexOf("m=application 0")>0))return;a===Je.MESSAGING&&setTimeout((function(){S[n]&&S[n].signalingState!==at.CLOSED&&S[n].localDescription&&S[n].localDescription.type===ut.OFFER&&(Xs.log.DEBUG([n,"RTCDataChannel",i,s.reviving_dataChannel]),od.createDataChannel({peerId:n,dataChannel:t,bufferThreshold:od.getDataChannelBuffer(t),createAsMessagingChannel:!0,roomState:c}),g.send(u.id,d.HANDLE_DATA_CHANNEL_STATS.reconnecting,n,{label:r},"main"))}),100)}catch(p){Xs.log.WARN([n,"RTCDataChannel",i,s.closed])}}},Ia={onopen:Ra,onmessage:ga,onerror:ma,onbufferedamountlow:ha,onclose:va},Oa=Ia,Ta=function(e){var t=e.peerId,n=e.dataChannel,r=e.bufferThreshold,i=e.createAsMessagingChannel,a=e.roomState,o=Yd.getSkylinkState(a.room.id),s=o.user,d=o.peerConnections,c=o.dataChannels,l=d[t],u="-_".concat(t),S=!0===i?Je.MESSAGING:Je.DATA,E=S===Je.MESSAGING?"main":u;if(!s||!s.sid)return Xs.log.ERROR([t,"RTCDataChannel",E,"Aborting of creating or initializing DataChannel as User does not have Room session"]),null;if(u="".concat(s.sid,"_").concat(t),!l||l.signalingState===at.CLOSED)return Xs.log.ERROR([t,"RTCDataChannel",E,"Aborting of creating or initializing Datachannel as Peer connection does not exists"]),null;if(n&&"object"===typeof n?u=n.label:"string"===typeof n&&(u=n,n=null),c[t]?c[t].main&&c[t].main.channel.label===u&&(E="main",S=Je.MESSAGING):(E="main",S=Je.MESSAGING,c[t]={},Xs.log.DEBUG([t,"RTCDataChannel",E,"initializing main DataChannel"])),!n)try{n=l.createDataChannel(u,{reliable:!0,ordered:!0})}catch(R){Xs.log.ERROR([t,"RTCDataChannel",E,"Failed creating Datachannel ->"],R);var g=new fa,p=a.room;return g.send(p.id,Ye.ERROR,t,{label:u},E,R),Bs(Oe({state:Ye.CREATE_ERROR,peerId:t,error:R,channelName:u,channelType:S,buferAmount:od.getDataChannelBuffer(n)})),null}var f={dataChannel:n,peerId:t,channelName:u,channelProp:E,channelType:S,roomState:a,bufferThreshold:r};n.onopen=Oa.onopen.bind(n,f),n.onmessage=Oa.onmessage.bind(n,f),n.onerror=Oa.onerror.bind(n,f),n.onbufferedamountlow=Oa.onbufferedamountlow.bind(n,f),n.onclose=Oa.onclose.bind(n,f);var m=S===Je.MESSAGING?"main":u;return o.dataChannels[t][m]={channelName:u,channelType:S,transferId:null,streamId:null,channel:n},Yd.setSkylinkState(o,a.room.id),null},Aa=function(e,t,n){var r=Yd.getInitOptions(),i=e.dataChannels,a=e.inRoom,o=e.user,s=e.hasMCU,d=Object.keys(i),c=!1;if(Array.isArray(n)&&n.length?(d=n,c=!0):n&&"string"===typeof n&&(d=[n],c=!0),!a||!o||!o.sid)return Xs.log.ERROR("Unable to send message as User is not in Room. ->",t),null;if(!r.enableDataChannel)return Xs.log.ERROR("Unable to send message as User does not have DataChannel enabled. ->",t),null;for(var l=0;l<d.length;l+=1){var u=d[l];i[u]||s?u===en.MCU?(d.splice(l,1),l-=1):s||(Xs.log.DEBUG([u,"RTCDataChannel",null,"Sending ".concat(c?"private":""," P2P message to Peer.")]),Sa(e,u,{type:Lt.MESSAGE,isPrivate:c,sender:o.sid,target:n?u:null,data:t},"main")):(Xs.log.ERROR([u,"RTCDataChannel",null,"Dropping of sending message to Peer as DataChannel connection does not exist."]),d.splice(l,1),l-=1)}return 0===d.length&&Xs.log.WARN("Currently there are no Peers to send P2P message to."),s&&(Xs.log.DEBUG([en.MCU,"RTCDataChannel",null,"Broadcasting ".concat(c?"private":""," P2P message to Peers.")]),Sa(e,en.MCU,{type:Lt.MESSAGE,isPrivate:c,sender:o.sid,target:d,data:t},"main")),!n&&s||Bs(Te({room:e.room,message:{targetPeerId:n||null,content:t,senderPeerId:o.sid,isDataChannel:!0,isPrivate:c},isSelf:!0,peerId:o.sid,peerInfo:Hn.getCurrentSessionInfo(e.room)})),null},Ca=function(e,t,n){var r=Ts(e);if(r)Aa(r,t,n);else for(var i=Yd.getSkylinkState(),a=Object.keys(i),o=0;o<a.length;o+=1){var s=i[a[o]];Aa(s,t,n)}},_a=function(e){var t=Ts(e);if(t){for(var n={},r=Object.keys(t.peerInformations),i=0;i<r.length;i+=1)n[r[i]]=Object.assign({},Hn.getPeerInfo(r[i],t.room)),n[r[i]].isSelf=!1;return t.user&&t.user.sid&&(n[t.user.sid]=Object.assign({},Hn.getCurrentSessionInfo(t.room)),n[t.user.sid].isSelf=!0),n}return null},Na=function(e,t){var n,r=Yd.getSkylinkState(t.room.id),i=r.peerEndOfCandidatesCounter[e],a=r.peerConnections[e],o=r.peerCandidatesQueue[e],s=r.peerConnectionConfig[e],d=r.gatheredCandidates[e],c=window,l=c.AdapterJS,u=c.RTCIceCandidate,S=Ht,E=on.PEER_CONNECTION;if(!i)return null;if(a&&a.signalingState!==at.CLOSED&&a.remoteDescription&&a.remoteDescription.sdp&&"number"===typeof i.expectedLen&&i.len>=i.expectedLen&&(!o||0===o.length)&&!i.hasSet){Xs.log.DEBUG([e,S.PEER_CONNECTION,null,E.end_of_candidates]),i.hasSet=!0;try{if("edge"===l.webrtcDetectedBrowser){for(var g=-1,p=[],f=a.remoteDescription.sdp.split("\r\n"),m=!1,R=0;R<f.length;R+=1)if(0===f[R].indexOf("m="))m="0"===f[R].split(" ")[1],g+=1;else if(0===f[R].indexOf("a=mid:")&&!m){var h=f[R].split("a=mid:")[1]||"";if(h&&-1===p.indexOf(h)&&(p.push(h),ui.addIceCandidate(e,"endofcan-".concat((new Date).getTime()),"endOfCandidates",new u({sdpMid:h,sdpMLineIndex:g,candidate:"candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates"}),r),s.bundlePolicy===dt.MAX_BUNDLE))break}}else l&&!As(l.VERSION,"0.14.0")&&a.addIceCandidate(null);if(d){var v={expected:i.expectedLen||0,received:i.len||0,processed:d.receiving.srflx.length+d.receiving.relay.length+d.receiving.host.length};Bs((n={room:r.room,peerId:e,candidatesLength:v},new me(b,{detail:n})))}r.peerEndOfCandidatesCounter[e]=i,Yd.setSkylinkState(r,t.room.id)}catch(I){Xs.log.ERROR([e,S.PEER_CONNECTION,null,E.end_of_candidate_failure],I)}}return null},Da=function(e){return{bufferedAmountLow:parseInt(e.bufferedAmountLow,10)||0,bufferedAmountLowThreshold:parseInt(e.bufferedAmountLowThreshold,10)||0}},ya=function(e,t){var n=e.dataChannels,r=e.peerConnections;if(function(e){return!us(e)}(n)&&Object.hasOwnProperty.call(n,t)){if(Object.hasOwnProperty.call(n[t],"main")){var i=n[t].main,a=i.channelName,o=i.channelType,s=i.channel.bufferedAmountLowThreshold||0;o===Je.MESSAGING&&setTimeout((function(){Object.hasOwnProperty.call(r,t)&&r[t].signalingState!==at.CLOSED&&r[t].localDescription.type===ut.OFFER&&(od.closeDataChannel(e,t),Xs.log.DEBUG([t,"RTCDataChannel","main",on.DATA_CHANNEL.reviving_dataChannel]),od.createDataChannel({roomState:e,peerId:t,dataChannel:a,bufferThreshold:s,createAsMessagingChannel:!0}))}),100)}}else Xs.log.DEBUG([t,"RTCDataChannel",on.DATA_CHANNEL.refresh_error])},Ma=function(e,t,n){var r=e.dataChannels,i=r[t][n],a=i.channelName,o=a.channelName,s=a.channelType;if(i.readyState!==Ye.CLOSED){var d=e.room,c=new fa;Xs.log.DEBUG([t,Ht.DATA_CHANNEL,n,on.DATA_CHANNEL.CLOSING]),c.send(d.id,Ye.CLOSING,t,i.channel,n),Bs(Oe({room:d,peerId:t,state:Ye.CLOSING,channelName:o,channelType:s,bufferAmount:od.getDataChannelBuffer(i.channel)})),i.channel.close(),delete r[t][n]}},ka=function(e,t){for(var n=e.dataChannels,r=Object.keys(n[t]),i=0;i<r.length;i+=1)Object.hasOwnProperty.call(n[t],r[i])&&Ma(e,t,r[i]);delete n[t]},Pa=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"main";try{var r=Yd.getSkylinkState(e.room.id),i=r.dataChannels,a=r.room;if(!i[t]||!i[t][n])return void Xs.log.WARN([t,Ht.DATA_CHANNEL,n||null,on.DATA_CHANNEL.ERRORS.NO_SESSIONS]);if("main"===n)return void ka(r,t);Ma(r,t,n),Yd.setSkylinkState(r,a.id)}catch(o){Xs.log.ERROR([t,Ht.DATA_CHANNEL,n||null,on.DATA_CHANNEL.ERRORS.FAILED_CLOSING],o)}},ba=function(e,t,n){var r=e.room,i=new Bo;try{var a=i.messageBuilder.getRestartOfferMessage(r.id,t,n);return i.offer(r,t,n,a),t}catch(o){return[t,o]}},wa=function(e,t,n){var r=Yd.getSkylinkState(t.room.id),i=window.AdapterJS,a=r.peerConnections,o=r.peerCustomConfigs,s=r.peerEndOfCandidatesCounter,d=r.room,c=r.user,l=n.doIceRestart,u=n.bwOptions,S=new Bo,E=on.PEER_CONNECTION,g=[];return new Promise((function(t){if(!a[e])return Xs.log.ERROR([e,null,null,E.refresh_peerId_no_match]),g.push(E.refresh_peerId_no_match),t([e,g]);var n=a[e];if("edge"===i.webrtcDetectedBrowser&&(Xs.log.WARN([e,"RTCPeerConnection",null,E.refresh_not_supported]),g.push(E.refresh_no_edge_support)),0!==g.length)return t([e,g]);if(n.signalingState===at.STABLE)return Xs.log.INFO([e,null,null,"Sending restart message to signaling server ->"],{iceRestart:l,options:u}),o[e]=o[e]||{},o[e].bandwidth=o[e].bandwidth||{},o[e].googleXBandwidth=o[e].googleXBandwidth||{},u.bandwidth&&"object"===typeof u.bandwidth&&("number"===typeof u.bandwidth.audio&&(o[e].bandwidth.audio=u.bandwidth.audio),"number"===typeof u.bandwidth.video&&(o[e].bandwidth.video=u.bandwidth.video),"number"===typeof u.bandwidth.data&&(o[e].bandwidth.data=u.bandwidth.data)),u.googleXBandwidth&&"object"===typeof u.googleXBandwidth&&("number"===typeof u.googleXBandwidth.min&&(o[e].googleXBandwidth.min=u.googleXBandwidth.min),"number"===typeof u.googleXBandwidth.max&&(o[e].googleXBandwidth.max=u.googleXBandwidth.max)),s[e]=s[e]||{},s[e].len=0,t(ba(r,e,l));var p=n.localDescription&&n.localDescription.sdp;if(n.signalingState===at.HAVE_LOCAL_OFFER&&p)return S.sendMessage({type:n.localDescription.type,sdp:n.localDescription.sdp,mid:c.sid,target:e,rid:d.id,restart:!0}),t(e);var f="Failed restarting as peer connection state is ".concat(n.signalingState," and there is no localDescription set to connection. There could be a handshaking step error.");return Xs.log.DEBUG([e,"RTCPeerConnection",null,f],{localDescription:n.localDescription,remoteDescription:n.remoteDescription}),g.push(f),t([e,g]),null}))},La=function(e,t,n){return new Promise((function(r){var i=e,a=Yd.getInitOptions().mcuUseRenegoRestart;try{n.bandwidth&&"object"===typeof n.bandwidth&&("number"===typeof n.bandwidth.audio&&(i.streamsBandwidthSettings.bAS.audio=n.bandwidth.audio),"number"===typeof n.bandwidth.video&&(i.streamsBandwidthSettings.bAS.video=n.bandwidth.video),"number"===typeof n.bandwidth.data&&(i.streamsBandwidthSettings.bAS.data=n.bandwidth.data)),n.googleXBandwidth&&"object"===typeof n.googleXBandwidth&&("number"===typeof n.googleXBandwidth.min&&(i.streamsBandwidthSettings.googleX.min=n.googleXBandwidth.min),"number"===typeof n.googleXBandwidth.max&&(i.streamsBandwidthSettings.googleX.max=n.googleXBandwidth.max)),a&&(i.peerEndOfCandidatesCounter.MCU=i.peerEndOfCandidatesCounter.MCU||{},i.peerEndOfCandidatesCounter.MCU.len=0,Yd.setSkylinkState(i),r(ba(i,en.MCU,t)))}catch(o){r([en.MCU,o])}}))},Ua=function(e,t,n){return Xs.log.INFO([e,"PeerConnection",null,"Restarting peer connection."]),wa(e,t,n)},Ga=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=Yd.getSkylinkState(t.room.id),a=i.hasMCU;try{if(!a){for(var o=[],s=0;s<e.length;s+=1){var d=e[s],c={doIceRestart:n,bwOptions:r},l=Ua(d,i,c);o.push(l)}return Promise.all(o)}return La(t,n,r)}catch(u){return Xs.log.ERROR([null,"RTCPeerConnection",null,"Failed restarting."],u),null}},Fa=function(e,t){var n=e,r=n.sid;return n.room=t.room.roomName,n.settings.data=!!(t.dataChannels[r]&&t.dataChannels[r].main&&t.dataChannels[r].main.channel&&t.dataChannels[r].main.channel.readyState===Ye.OPEN),delete n.publishOnly,n},Ba=function(e,t){var n=e.peerConnections,r=e.room,i=on.PEER_CONNECTION,a=null,o=null;return Ss(Object.keys(n))?o=i.not_initialised:Array.isArray(t)?(a=t).forEach((function(e){ys(r,e)||(o="".concat(i.peerId_does_not_exist," ").concat(e))})):hs(t)?(ys(r,t)||(o="".concat(i.peerId_does_not_exist," ").concat(t)),a=[t]):a=Object.keys(n),{peerIds:a,errorMsg:o}},ja=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=on.ROOM_STATE;if(!e)return Xs.log.WARN(n.NO_ROOM_NAME),Ds(n.NO_ROOM_NAME);var r=e.room,i=Ba(e,t);if(i.errorMsg)return Xs.log.WARN(i.errorMsg),Ds(i.errorMsg);for(var a=i.peerIds,o=[],s=0;s<a.length;s+=1){var d=new nd(r.id,a[s]);o.push(d.getConnectionStatus())}return Promise.all(o)},Va=function(e,t){var n=Yd.getSkylinkState(e.room.id),r=n.peerConnections,i=n.room,a=window.AdapterJS;r[t].close(),"AppleWebKit"===a.webrtcDetectedType&&(n.peerConnections[t].signalingStateClosed||(n.peerConnections[t].signalingStateClosed=!0),n.peerConnections[t].iceConnectionStateClosed||(n.peerConnections[t].iceConnectionStateClosed=!0)),Yd.setSkylinkState(n,i.id)},xa=function(e,t,n,r){var i=Yd.getSkylinkState(e.id);i.peerInformations[t].mediaStatus=function(e,t,n,r){var i=e.peerMedias,a=e.peerInformations,o=i[t],s=a[t].mediaStatus||{};return Object.values(o).forEach((function(e){e.transceiverMid===n.mid&&(s[r.id]={audioMuted:Ms(r)?e.mediaState===Jt.MUTED?0:1:-1,videoMuted:ks(r)?e.mediaState===Jt.MUTED?0:1:-1})})),delete s.audioMuted,delete s.videoMuted,s}(i,t,n,r),Yd.setSkylinkState(i,e.id)},Ha=function(e,t,n){var r=e;r.currentRTCRTPSenders[t]||(r.currentRTCRTPSenders[t]=[]),r.currentRTCRTPSenders[t].push(n),Yd.setSkylinkState(r,r.room.id)},Wa={createOffer:sa,createAnswer:ua,addPeer:ca,createDataChannel:Ta,sendP2PMessage:Ca,getPeersInRoom:_a,signalingEndOfCandidates:Na,getDataChannelBuffer:Da,refreshDataChannel:ya,closeDataChannel:Pa,refreshConnection:Wi,refreshPeerConnection:Ga,restartPeerConnection:wa,buildPeerInformations:Fa,getConnectionStatus:ja,closePeerConnection:Va,updatePeerInformationsMediaStatus:xa,processNewSender:Ha},Ka=Wa,Ya=function(e,t,n,r){var i=r.channel||r,a=Yd.getInitOptions(),o=Yd.getSkylinkState(n.room.id).peerInformations,s=a.enableDataChannel;Xs.log.DEBUG([t,"RTCDataChannel",i.label,"Received datachannel ->"],i),s&&o[t].config.enableDataChannel?(e.hasMainChannel||(e.hasMainChannel=!0),Ka.createDataChannel({peerId:t,dataChannel:i,roomState:n})):Xs.log.WARN([t,"RTCDataChannel",i.label,"Not adding datachannel as enable datachannel is set to false"])},Ja=function(e,t,n,r){ui.onIceCandidate(t,r.candidate||r,n.room)},Xa=function(e,t,n,r){var i=e[t]["send"===n?"sending":"receiving"][r];return["number","string","boolean"].indexOf(typeof i)>-1?i:null},Qa=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(d.a)(this,Object(c.a)(t).call(this))).model={client_id:null,appKey:null,timestamp:null,room_id:null,user_id:null,peer_id:null,audio_send:{tracks:[]},audio_recv:{},video_send:{tracks:[]},video_recv:{},error:null},e.stats=null,e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"gatherSendAudioPacketsStats",value:function(){this.model.audio_send.bytes=Xa(this.stats,"audio","send","bytes"),this.model.audio_send.packets=Xa(this.stats,"audio","send","packets"),this.model.audio_send.echo_return_loss=Xa(this.stats,"audio","send","echoReturnLoss"),this.model.audio_send.echo_return_loss_enhancement=Xa(this.stats,"audio","send","echoReturnLossEnhancement"),this.model.audio_send.round_trip_time=Xa(this.stats,"audio","send","roundTripTime"),this.model.audio_send.audio_level=Xa(this.stats,"audio","send","audioLevel"),this.model.audio_send.jitter=Xa(this.stats,"audio","send","jitter")}},{key:"gatherReceiveAudioPacketsStats",value:function(){this.model.audio_recv.bytes=Xa(this.stats,"audio","recv","bytes"),this.model.audio_recv.packets=Xa(this.stats,"audio","recv","packets"),this.model.audio_recv.packets_lost=Xa(this.stats,"audio","recv","packetsLost"),this.model.audio_recv.jitter=Xa(this.stats,"audio","recv","jitter"),this.model.audio_recv.audio_level=Xa(this.stats,"audio","recv","audioLevel")}},{key:"gatherSendVideoPacketsStats",value:function(){this.model.video_send.bytes=Xa(this.stats,"video","send","bytes"),this.model.video_send.packets=Xa(this.stats,"video","send","packets"),this.model.video_send.nack_count=Xa(this.stats,"video","send","nacks"),this.model.video_send.firs_count=Xa(this.stats,"video","send","firs"),this.model.video_send.plis_count=Xa(this.stats,"video","send","plis"),this.model.video_send.frames_encoded=Xa(this.stats,"video","send","framesEncoded"),this.model.video_send.frame_width=Xa(this.stats,"video","send","frameWidth"),this.model.video_send.frame_height=Xa(this.stats,"video","send","frameHeight"),this.model.video_send.round_trip_time=Xa(this.stats,"video","send","roundTripTime"),this.model.video_send.qp_sum=Xa(this.stats,"video","send","qpSum"),this.model.video_send.jitter=Xa(this.stats,"video","send","jitter"),this.model.video_send.frames=Xa(this.stats,"video","send","frames"),this.model.video_send.hugeFrames=Xa(this.stats,"video","send","hugeFramesSent"),this.model.video_send.framesPerSecond=Xa(this.stats,"video","send","framesPerSecond")}},{key:"gatherReceiveVideoPacketsStats",value:function(){this.model.video_recv.bytes=Xa(this.stats,"video","recv","bytes"),this.model.video_recv.packets=Xa(this.stats,"video","recv","packets"),this.model.video_recv.packets_lost=Xa(this.stats,"video","recv","packetsLost"),this.model.video_recv.nack_count=Xa(this.stats,"video","recv","nacks"),this.model.video_recv.firs_count=Xa(this.stats,"video","recv","firs"),this.model.video_recv.plis_count=Xa(this.stats,"video","recv","plis"),this.model.video_recv.frames_decoded=Xa(this.stats,"video","recv","framesDecoded"),this.model.video_recv.qp_sum=Xa(this.stats,"video","recv","qpSum"),this.model.video_recv.frames_decoded=Xa(this.stats,"video","recv","framesDecoded"),this.model.video_recv.frames_dropped=Xa(this.stats,"video","recv","framesDropped"),this.model.video_recv.decoderImplementation=Xa(this.stats,"video","recv","decoderImplementation")}},{key:"buildTrackInfo",value:function(e){var t=this,n=Yd.getSkylinkState(e).streams,r=[];n.userMedia&&(r=Object.values(Object.values(n.userMedia))),n.screenshare&&r.push(n.screenshare),r.forEach((function(e){if(e){var n=e.stream?e.stream:e[Object.keys(e)[0]].stream,r=e.settings?e.settings:e[Object.keys(e)[0]].settings,i=n.getAudioTracks(),a=n.getVideoTracks();i.forEach((function(e){var r=function(e,t){return{stream_id:e.id,id:t.id,label:t.label,muted:!t.enabled}}(n,e);t.model.audio_send.tracks.push(r)})),a.forEach((function(e){var i=function(e,t,n){return{stream_id:e.id,id:t.id,label:t.label,height:n.video.resolution.height,width:n.video.resolution.width,muted:!t.enabled}}(n,e,r);t.model.video_send.tracks.push(i)}))}}))}},{key:"send",value:function(e,t,n){var r=this,i=on.STATS_MODULE,a=Yd.getSkylinkState(e);a?(a.streams.userMedia||a.streams.screenshare)&&(this.model.client_id=a.clientId,this.model.appKey=Yd.getInitOptions().appKey,this.model.timestamp=(new Date).toISOString(),this.model.room_id=e,this.model.user_id=a&&a.user&&a.user.sid||null,this.model.peer_id=n,od.retrieveStatistics(e,n,Yd.getInitOptions().beSilentOnStatsLogs).then((function(t){t&&(r.stats=t,r.gatherSendAudioPacketsStats(),r.gatherReceiveAudioPacketsStats(),r.gatherSendVideoPacketsStats(),r.gatherReceiveVideoPacketsStats(),r.buildTrackInfo(e),r.postStats(r.endpoints.bandwidth,r.model))})).catch((function(e){r.model.error=e?e.message:null,Xs.log.DEBUG(i.HANDLE_BANDWIDTH_STATS.RETRIEVE_FAILED,e)}))):Xs.log.DEBUG([n,"Statistics","Bandwidth_Stats",i.HANDLE_BANDWIDTH_STATS.NO_STATE])}}]),t}(Qn),qa=Qa,za={},Za=function(){function e(t){Object(o.a)(this,e);var n=t.peerConnection,r=t.state,i=t.targetMid;if(za[i])return za[i];this.peerId=i,this.state=r,this.peerConnection=n,this.bandwidth=null,za[this.peerId]=this}return Object(s.a)(e,[{key:"setAdjustmentInterval",value:function(){var t=this,n=this.state,r=n.bandwidthAdjuster,i=n.peerBandwidth,a=n.room,o=at;if(!this.bandwidth){var s={audio:{send:[],recv:[]},video:{send:[],recv:[]}},d=0,c=setInterval((function(){t.peerConnection&&t.peerConnection.signalingState!==o.CLOSED&&r&&i[t.peerId]?od.retrieveStatistics(a.id,t.peerId,Yd.getIniOptions().beSilentOnStatsLogs,!0).then((function(n){if(t.peerConnection&&t.peerConnection.signalingState!==o.CLOSED&&r||clearInterval(c),s.audio.send.push(8*n.audio.sending.bytes),s.audio.recv.push(8*n.audio.receiving.bytes),s.video.send.push(8*n.video.sending.bytes),s.video.recv.push(8*n.video.receiving.bytes),(d+=1)===r.interval){d=0;var i=e.formatTotalFn(s.audio.send),a=e.formatTotalFn(s.video.send);r.useUploadBwOnly||(i+=e.formatTotalFn(s.audio.recv),a+=e.formatTotalFn(s.video.recv),i/=2,a/=2),i=parseInt(i*(r.limitAtPercentage/100)/1e3,10),a=parseInt(a*(r.limitAtPercentage/100)/1e3,10),od.refreshConnection(t.state,t.peerId,!1,{bandwidth:{audio:i,video:a}})}})).catch((function(){s.audio.send.push(0),s.audio.recv.push(0),s.video.send.push(0),s.video.recv.push(0)})):clearInterval(c)}),1e3);this.bandwidth=s}}}],[{key:"formatTotalFn",value:function(e){for(var t=0,n=0;n<e.length;n+=1)t+=e[n];return t/e.length}}]),e}(),$a=Za,eo=function(e){var t=rt;return[t.COMPLETED,t.CONNECTED].indexOf(e)>-1},to=function(e,t,n){var r=on.PEER_CONNECTION,i=rt,a=at,o=$t,s=window.AdapterJS,d=s.webrtcDetectedBrowser,c=s.webrtcDetectedType,l=Yd.getSkylinkState(n.room.id),u=l.streams;if(l){var S=l.hasMCU,E=l.bandwidthAdjuster,g=l.peerInformations,p=l.peerConnStatus,f=l.peerStats,m=new $i,R=null,h=e.iceConnectionState;if(Xs.log.DEBUG([t,"RTCIceConnectionState",null,r.ice_connection_state],h),"edge"===d&&("connecting"===h?h=i.CHECKING:"new"===h&&(h=i.FAILED)),"AppleWebKit"!==c||h!==i.CLOSED){if(l&&e.iceConnectionState!==i.CONNECTED&&m.send(n.room.id,e.iceConnectionState,t),Bs(De({state:h,peerId:t})),h===i.FAILED){if(s.webrtcDetectedBrowser===o.FIREFOX&&!u.userMedia)return;Bs(De({state:i.TRICKLE_FAILED,peerId:t}))}p&&p[t]&&(p[t].connected=eo(h)),R||!eo(h)||f[t]||(R=!0,f[t]={},Xs.log.DEBUG([t,"RTCStatsReport",null,"Retrieving first report to tabulate results"]),od.getConnectionStatus(l,t).then((function(){m.send(n.room.id,e.iceConnectionState,t),R=setInterval((function(){e.signalingState===a.CLOSED||e.iceConnectionState===a.CLOSED?clearInterval(R):(new qa).send(l.room.id,e,t)}),2e4)}))),!S&&eo(h)&&E&&"edge"!==s.webrtcDetectedBrowser&&"edge"!==(((g[t]||{}).agent||{}).name||"edge")&&new $a({targetMid:t,state:l,peerConnection:e}).setAdjustmentInterval()}else setTimeout((function(){e.iceConnectionStateClosed||(m.send(n.room.id,i.CLOSED,t),Bs(De({state:i.CLOSED,peerId:t})))}),10)}else Xs.log.DEBUG([t,"RTCIceConnectionState",null,r.no_room_state])},no=function(e,t,n){var r=on.PEER_CONNECTION,i=e.iceGatheringState;Xs.log.INFO([t,"RTCIceGatheringState",null,r.ice_gathering_state],i),Bs(Ne({state:i,room:n.room,peerId:t}))},ro=function(e,t){var n=window.AdapterJS,r=on.PEER_CONNECTION,i=at,a=e.signalingState,o=e.signalingStateClosed;Xs.log.DEBUG([t,"RTCSignalingState",null,r.peer_connection_state],a),"AppleWebKit"!==n.webrtcDetectedType||a!==i.CLOSED?Bs(Le({state:a,peerId:t})):setTimeout((function(){o||Bs(Le({state:i.CLOSED,peerId:t}))}),10)},io=void 0,ao=function(e,t,n,r){var i,a=Yd.getSkylinkState(n.room.id),o=a.peerConnections,s=a.room,d=a.hasMCU,c=r.receiver,l=window.AdapterJS,u=r.streams[0],S=r.transceiver,E=r.track,g=t;if(!u)return Xs.log.WARN("ontrack stream is null"),null;"safari"===l.webrtcDetectedBrowser&&o[t].getTransceivers().forEach((function(e){e.receiver.track.id===c.track.id&&(S=e)}));if(null===S.mid&&Xs.log.WARN("Transceiver mid is null",S),!o[g])return null;d&&(g=function(e,t){for(var n=e.peerMedias,r=e.user,i=Object.keys(n),a=0;a<i.length;a+=1)if(i[a]!==r.sid)for(var o=Object.values(n[i[a]]),s=0;s<o.length;s+=1)if(o[s].transceiverMid===t.mid)return i[a];return null}(a,S));var p=Vo.isVideoScreenTrack(a,g,S.mid),f=[g,s,p];return u.onremovetrack=(i=lo.onremovetrack).bind.apply(i,[io].concat(f)),Vo.updateStreamIdFromOntrack(a.room,g,S.mid,u.id),od.updatePeerInformationsMediaStatus(a.room,g,S,u),Un.updateRemoteStreams(a.room,g,u),Un.onRemoteTrackAdded(u,n,g,p,E.kind===Yt.VIDEO,E.kind===Yt.AUDIO),null},oo=function(e,t,n,r){var i=window.AdapterJS,a=Os(t.id),o=a.peerInformations,s=on.MEDIA_STREAM,d=on.PEER_INFORMATIONS,c=i.webrtcDetectedBrowser===$t.REACT_NATIVE?r.stream:r.target;Xs.log.INFO([e,Ht.MEDIA_STREAM,null,s.REMOTE_TRACK_REMOVED],{peerId:e,isSelf:!1,isScreensharing:n,track:r.track}),o[e]?c?(function(e,t,n){var r=e;delete r.peerInformations[t].mediaStatus[n],Yd.setSkylinkState(r,r.room.id)}(a,e,c.id),function(e,t,n,r,i){Bs(ve({room:e.room,peerId:t,peerInfo:Hn.getPeerInfo(t,e.room),isSelf:!1,isScreensharing:n,streamId:i.id,isVideo:r.track.kind===Yt.VIDEO,isAudio:r.track.kind===Yt.AUDIO}))}(a,e,n,r,c),n&&function(e){var t=e.streams,n=e.room,r=e.user;(t.userMedia?Object.values(t.userMedia):[]).forEach((function(e){ks(e.stream)&&Bs(Re({stream:e.stream,streamId:e.id,peerId:r.sid,room:n,isSelf:!0,peerInfo:Hn.getCurrentSessionInfo(n),isVideo:!0,isAudio:!1}))}))}(a),function(e,t){Bs(Me({peerId:t,peerInfo:Hn.getPeerInfo(t,e.room),isSelf:!1}))}(a,e)):Xs.log.DEBUG([e,Ht.MEDIA_STREAM,null,"".concat(s.ERRORS.DROPPING_ONREMOVETRACK)-"".concat(s.NO_STREAM)]):Xs.log.DEBUG([e,Ht.MEDIA_STREAM,null,"".concat(s.ERRORS.DROPPING_ONREMOVETRACK)-"".concat(d.NO_PEER_INFO," ").concat(e)])},so=function(e,t,n,r){var i=Yd.getSkylinkState(n.room.id),a=r.sender;Ka.processNewSender(i,t,a)},co={ontrack:ao,ondatachannel:Ya,onicecandidate:Ja,oniceconnectionstatechange:to,onicegatheringstatechange:no,onsignalingstatechange:ro,onremovetrack:oo,onsenderadded:so},lo=co,uo=function(e){var t=e.mid,n=e.rid,r=e.status,i=e.streamId,a=e.settings,o=Is(n),s=o.room,d=o.peerInformations;if(r===Gt.SCREENSHARE_REPLACE_START&&(d[t].screenshare=!0,Yd.setSkylinkState(o,s.id),Bs(he({room:s,peerId:t,isSelf:!1,peerInfo:Hn.getPeerInfo(t,s),stream:null,isReplace:!0,streamId:i,isVideo:!!a.audio,isAudio:!!a.video}))),r===Gt.USER_MEDIA_REPLACE_START&&Bs(Re({room:s,peerId:t,isSelf:!1,peerInfo:Hn.getPeerInfo(t,s),stream:null,streamId:i,isReplace:!0,replacedStreamId:a.replacedStreamId,isVideo:!!a.audio,isAudio:!!a.video})),r===Gt.ENDED&&(a.isScreensharing&&(d[t].screenshare=!1,Yd.setSkylinkState(o,s.id)),Bs(ve({room:s,peerId:t,peerInfo:Hn.getPeerInfo(t,s),streamId:i,isSelf:!1,isScreensharing:a.isScreensharing,options:a,isVideo:!!a.audio,isAudio:!!a.video}))),r===Gt.REPLACED_STREAM_ENDED){var c=Un.retrieveRemoteStreams(o,t);if(!c)return null;for(var l=Object.values(c),u=null,S=0;S<l.length;S+=1)if(c[S].id===i){u=l[S];break}if(!u)return null;u.getTracks().forEach((function(e){lo.onremovetrack(t,s,i,e,!1)}))}return null},So=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(d.a)(this,Object(c.a)(t).call(this))).model={client_id:null,appKey:null,timestamp:null,room_id:null,user_id:null,state:null,recording_id:null,recordings:null,error:null},e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"send",value:function(e,t,n,r,i){var a=Yd.getSkylinkState(e);this.model.client_id=a.clientId,this.model.appKey=Yd.getInitOptions().appKey,this.model.timestamp=(new Date).toISOString(),this.model.room_id=e,this.model.user_id=a&&a.user&&a.user.sid||null,this.model.state=t,this.model.recording_id=n,this.model.recordings=r,this.error=("string"===typeof i?i:i&&i.message)||null,this.postStats(this.endpoints.recording,this.model)}}]),t}(Qn),Eo=So,go=new Eo,po=function(e,t,n){var r={state:e,recordingId:t};n&&(r.error=n),Bs(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new me(ne,{detail:e})}(r))},fo=function(e){var t=e.action,n=e.rid,r=e.recordingId,i=e.error,a=Is(n);"on"===t?function(e,t){var n=Object.assign({},e),r=n.room;Xs.log.DEBUG([en.MCU,Ht.RECORDING,t,on.RECORDING.START_SUCCESS]),go.send(r.id,on.STATS_MODULE.HANDLE_RECORDING_STATS.START,t,null,null),n.currentRecordingId=t,n.recordings[t]={active:!0,state:yt.START,startedDateTime:(new Date).toISOString(),endedDateTime:null,error:null},n.recordingStartInterval=setTimeout((function(){Xs.log.INFO([en.MCU,Ht.RECORDING,t,on.RECORDING.MIN_RECORDING_TIME_REACHED]),n.recordingStartInterval=null}),4e3),Yd.setSkylinkState(n,r.id),po(yt.START,t)}(a,r):"off"===t?function(e,t){var n=Object.assign({},e),r=n.room,i=n.recordings;go.send(r.id,on.STATS_MODULE.HANDLE_RECORDING_STATS.STOP,t,null,null),i[t]?(n.currentRecordingId=null,n.recordingStartInterval&&(clearTimeout(n.recordingStartInterval),Xs.log.WARN([en.MCU,Ht.RECORDING,t,on.RECORDING.ERRORS.STOP_ABRUPT]),n.recordingStartInterval=null),Xs.log.DEBUG([en.MCU,Ht.RECORDING,t,on.RECORDING.STOP_SUCCESS]),n.recordings[t].active=!1,n.recordings[t].state=yt.STOP,n.recordings[t].endedDateTime=(new Date).toISOString(),Yd.setSkylinkState(n,r.id),po(yt.STOP,t)):Xs.log.ERROR([en.MCU,Ht.RECORDING,t,on.RECORDING.ERRORS.SESSION_EMPTY])}(a,r):"error"===t&&(po(null,r,i),Xs.log.ERROR([en.MCU,Ht.RECORDING,r,on.RECORDING.ERRORS.MCU_RECORDING_ERROR],i),go.send(a.room.id,on.STATS_MODULE.HANDLE_RECORDING_STATS.MCU_RECORDING_ERROR,r,null,i))},mo=function(e){var t;Xs.log.INFO(["Server",null,e.type,"System action warning:"],e),Object.keys((new ld).getAllStates()).length>1&&e.action===gt.REJECT&&Cs(),"toClose"===e.reason&&(e.reason="toclose"),Yd.removeSkylinkState(Yd.getSkylinkState(e.rid)),Bs((t={action:e.action,info:e.info,reason:e.reason,rid:e.rid},new me(z,{detail:t})))},Ro="startSuccess",ho="stopSuccess",vo=function(e){var t=e.action,n=e.rid,r=Is(n);Xs.log.DEBUG([en.MCU,"RTMP",null,on.RTMP.message_received_from_sig]),t===Ro?function(e,t){var n=e.rtmpSessions,r=t.rtmpId,i=t.peerId,a=t.streamId;if(!n[r]){var o=Object.assign({},e);Xs.log.DEBUG([en.MCU,"RTMP",on.RTMP.started_success]),o.rtmpSessions[r]={active:!0,state:Vt.START,startedDateTime:(new Date).toISOString(),endedDateTime:null,peerId:i,streamId:a},Bs(Ve({state:Vt.START,rtmpId:r,error:null})),Yd.setSkylinkState(o,o.room.id)}}(r,e):t===ho?function(e,t){var n=e.rtmpSessions,r=t.rtmpId,i=Object.assign({},e);n[r]?(Xs.log.DEBUG([en.MCU,"RTMP",on.RTMP.stopped_success]),i.rtmpSessions[r].active=!1,i.rtmpSessions[r].state=Vt.STOP,i.rtmpSessions[r].endedDateTime=(new Date).toISOString(),Bs(Ve({state:Vt.STOP,rtmpId:r,error:null})),Yd.setSkylinkState(i,i.room.id)):Xs.log.DEBUG([en.MCU,"RTMP",on.RTMP.stop_session_empty])}(r,e):function(e,t){var n=t.error,r=t.rtmpId,i=e.rtmpSessions,a=new Error(n||"Unkown Error"),o=Object.assign({},e);i[r]?(Xs.log.DEBUG([en.MCU,"RTMP",on.RTMP.error_session]),o.rtmpSessions[r].state=Vt.ERROR,o.rtmpSessions[r].error=a,i[r].active&&(Xs.log.DEBUG([en.MCU,"RTMP",on.RTMP.error_Session_abrupt]),o.rtmpSessions[r].active=!1),Bs(Ve({state:Vt.ERROR,rtmpId:r,error:a})),Yd.setSkylinkState(o,o.room.id)):Xs.log.DEBUG([en.MCU,"RTMP",on.RTMP.error_session_empty])}(r,e)},Io=function(e){var t=e.type,n=e.mid,r=e.rid,i=e.userData,a=e.stamp,o=Yd.getSkylinkState(r),s=o.peerInformations,d=o.peerMessagesStamps,c=n,l=on.PEER_INFORMATIONS,u=i.replace(/&quot;/g,'"');try{u=JSON.parse(u)}catch(S){Xs.log.INFO([c,null,t,"".concat(l.USER_DATA_NOT_JSON)],u)}finally{Xs.log.INFO([c,null,t,"".concat(l.UPDATE_USER_DATA)],u)}if(s[c]){if(d[c]&&fs(a)){if(a<d[c].userData)return void Xs.log.WARN([c,null,t,"".concat(l.OUTDATED_MSG)],e);d[c].userData=a}s[c].userData=u||{},Bs(Me({peerId:c,peerInfo:Hn.getPeerInfo(c,o.room),isSelf:!1}))}else Xs.log.INFO([c,null,t,"".concat(l.NO_PEER_INFO," ").concat(c)])},Oo=function(e,t,n,r,i){var a=Hn.getPeerInfo(n,e.room);Bs(Ie({isSelf:!1,peerId:n,peerInfo:a,streamId:t,isAudio:r===Yt.AUDIO,isVideo:r===Yt.VIDEO,isScreensharing:i})),Bs(Me({isSelf:!1,peerId:n,peerInfo:a}))},To={dispatchMediaStateChangeEvents:Oo},Ao=To,Co=function(e,t){var n=t.type,r=t.rid,i=t.mediaId,a=t.mediaState,o=t.transceiverMid,s=Yd.getSkylinkState(r),d=s.room,c=Vo.retrieveStreamId(d,e,i,o),l=(new Date).toISOString();if(Xs.log.INFO([e,Ht.SIG_SERVER,n,on.MEDIA_INFO.AUDIO_STATE_CHANGE,a,c],t),s.peerInformations[e]){if(s.peerMessagesStamps[e]){if(l<s.peerMessagesStamps[e].audioMuted)return void Xs.log.WARN([e,Ht.SIG_SERVER,n,on.SIGNALING.OUTDATED_MSG],t);s.peerMessagesStamps[e].audioMuted=l}s.peerInformations[e].mediaStatus[c]||(s.peerInformations[e].mediaStatus[c]={}),s.peerInformations[e].mediaStatus[c].audioMuted=a===Jt.MUTED||a===Jt.STOPPED?xt.MUTED:xt.ACTIVE,Yd.setSkylinkState(s,d.id),Ao.dispatchMediaStateChangeEvents(s,c,e,Yt.AUDIO,!1)}else Xs.log.WARN([e,Ht.PEER_INFORMATION,n,"".concat(on.PEER_INFORMATIONS.NO_PEER_INFO," ").concat(e)])},_o=function(e,t){var n=t.type,r=t.rid,i=t.mediaId,a=t.mediaState,o=t.transceiverMid,s=t.mediaType,d=Yd.getSkylinkState(r),c=d.room,l=Vo.retrieveStreamId(c,e,i,o),u=(new Date).toISOString();if(Xs.log.INFO([e,Ht.SIG_SERVER,n,on.MEDIA_INFO.VIDEO_STATE_CHANGE,a,l],t),d.peerInformations[e]){if(d.peerMessagesStamps[e]){if(u<d.peerMessagesStamps[e].videoMuted)return void Xs.log.WARN([e,Ht.SIG_SERVER,n,on.SIGNALING.OUTDATED_MSG],t);d.peerMessagesStamps[e].videoMuted=u}d.peerInformations[e].mediaStatus[l]||(d.peerInformations[e].mediaStatus[l]={}),d.peerInformations[e].mediaStatus[l].videoMuted=a===Jt.MUTED||a===Jt.STOPPED?xt.MUTED:xt.ACTIVE,Yd.setSkylinkState(d,c.id),Ao.dispatchMediaStateChangeEvents(d,l,e,Yt.VIDEO,s===Wt.VIDEO_SCREEN)}else Xs.log.WARN([e,Ht.PEER_INFORMATION,n,"".concat(on.PEER_INFORMATIONS.NO_PEER_INFO," ").concat(e)])},No=function(e,t,n){Xs.log.WARN([e,Ht.SIG_SERVER,"".concat(on.MEDIA_INFO.WARN.READ_ONLY_VALUE," ").concat(n)],t)},Do=function(e,t){var n=t.rid,r=t.mediaId,i=t.transceiverMid,a=Yd.getSkylinkState(n);Vo.updatePeerMediaInfo(a.room,e,r,Xt.TRANSCEIVER_MID,i)},yo=function(e,t,n,r){if(r.mediaState===Jt.UNAVAILABLE)!function(e,t,n,r){var i=r.mediaId;Vo.setMediaStateToUnavailable(e,n,i),Vo.deleteUnavailableMedia(e,n,i)}(e,0,n,r);else switch(t){case Wt.VIDEO_SCREEN:case Wt.VIDEO_CAMERA:case Wt.VIDEO_OTHER:case Wt.VIDEO:_o(n,r);break;case Wt.AUDIO_MIC:case Wt.AUDIO:Co(n,r);break;default:Xs.log.ERROR([n,Ht.SIG_SERVER,"".concat(on.MEDIA_INFO.WARN.INVALID_MEDIA_TYPE," ").concat(t)],r)}},Mo=function(e,t,n,r,i){var a=Yd.getSkylinkState(e).peerMedias[t][n];return a[r]&&a[r]!==i},ko={dispatchMuteEvents:Oo,shouldDropMessage:function(e,t){var n=Hn.getPeerInfo(t,e.room);return!(!n.agent.SDKVersion||n.agent.SDKVersion!==Qt)&&(Xs.log.INFO([t,Ht.SIG_SERVER,null,on.SIGNALING.DROPPING_MUTE_EVENT]),!0)}},Po={userMessageHandler:Hr,answer:Fi,answerAck:Ki,inRoom:Si,enter:Ci,offer:Gi,welcome:Yi,candidate:Ji,getPeerList:Xi,introduceError:zi,stream:uo,bye:na,recording:fo,redirect:mo,rtmp:vo,muteVideoEvent:function(e){var t=e.type,n=e.mid,r=e.muted,i=e.rid,a=e.stamp,o=e.streamId,s=n,d=Yd.getSkylinkState(i),c=d.room;if(!ko.shouldDropMessage(d,s))if(Xs.log.INFO([s,null,t,on.MEDIA_STREAM.VIDEO_MUTED,r,o],e),d.peerInformations[s]){if(d.peerMessagesStamps[s]){if(a<d.peerMessagesStamps[s].videoMuted)return void Xs.log.WARN([s,Ht.SIG_SERVER,t,on.SIGNALING.OUTDATED_MSG],e);d.peerMessagesStamps[s].videoMuted=a}d.peerInformations[s].mediaStatus[o]||(d.peerInformations[s].mediaStatus[o]={}),d.peerInformations[s].mediaStatus[o].videoMuted=r?xt.MUTED:xt.ACTIVE,Yd.setSkylinkState(d,c.id),ko.dispatchMuteEvents(d,o,s)}else Xs.log.WARN([s,Ht.PEER_INFORMATION,t,"".concat(on.PEER_INFORMATIONS.NO_PEER_INFO," ").concat(s)])},muteAudioEvent:function(e){var t=e.type,n=e.mid,r=e.rid,i=e.muted,a=e.stamp,o=e.streamId,s=n,d=Yd.getSkylinkState(r),c=d.room;if(!ko.shouldDropMessage(d,s))if(Xs.log.INFO([s,Ht.SIG_SERVER,t,on.MEDIA_STREAM.AUDIO_MUTED,i,o],e),d.peerInformations[s]){if(d.peerMessagesStamps[s]){if(a<d.peerMessagesStamps[s].audioMuted)return void Xs.log.WARN([s,Ht.SIG_SERVER,t,on.SIGNALING.OUTDATED_MSG],e);d.peerMessagesStamps[s].audioMuted=a}d.peerInformations[s].mediaStatus[o]||(d.peerInformations[s].mediaStatus[o]={}),d.peerInformations[s].mediaStatus[o].audioMuted=i?xt.MUTED:xt.ACTIVE,Yd.setSkylinkState(d,c.id),ko.dispatchMuteEvents(d,o,s)}else Xs.log.WARN([s,Ht.PEER_INFORMATION,t,"".concat(on.PEER_INFORMATIONS.NO_PEER_INFO," ").concat(s)])},setUserData:Io,mediaInfoEvent:function(e){var t=e.mid,n=e.rid,r=e.mediaType,i=e.mediaId,a=e.publisherId,o=Yd.getSkylinkState(n),s=o.hasMCU,d=o.room,c=s?a:t;try{if(!function(e,t){var n=e,r=t.mediaId,i=t.publisherId;return n.peerMedias[i]=n.peerMedias[i]||{},!n.peerMedias[i][r]&&(n.peerMedias[i][r]=t,Yd.setSkylinkState(n,n.room.id),!0)}(o,e))for(var l=Object.values(Xt),u=0;u<l.length;u+=1)if(Mo(n,c,i,l[u],e[l[u]])){if(Vo.updatePeerMediaInfo(o.room,c,i,l[u],e[l[u]]),l[u]===Xt.MEDIA_STATE)return void yo(d,r,c,e);if(l[u]===Xt.TRANSCEIVER_MID)return void Do(c,e);No(c,e,l[u])}}catch(S){Xs.log.ERROR([c,Ht.SIG_SERVER,on.MEDIA_INFO.FAILED_PROCESSING_MEDIA_INFO_EVENT],S)}},storedMessages:function(e){jr.processStoredMessages(e)}},bo=function(){function e(){Object(o.a)(this,e)}return Object(s.a)(e,[{key:"userMessageHandler",value:function(){Po.userMessageHandler.apply(Po,arguments)}},{key:"answerHandler",value:function(){Po.answer.apply(Po,arguments)}},{key:"answerAckHandler",value:function(){Po.answerAck.apply(Po,arguments)}},{key:"inRoomHandler",value:function(){Po.inRoom.apply(Po,arguments)}},{key:"enterRoomHandler",value:function(){Po.enter.apply(Po,arguments)}},{key:"offerHandler",value:function(){Po.offer.apply(Po,arguments)}},{key:"welcomeHandler",value:function(){Po.welcome.apply(Po,arguments)}},{key:"candidateHandler",value:function(){Po.candidate.apply(Po,arguments)}},{key:"getPeerListHandler",value:function(){Po.getPeerList.apply(Po,arguments)}},{key:"introduceErrorHandler",value:function(){Po.introduceError.apply(Po,arguments)}},{key:"byeHandler",value:function(){Po.bye.apply(Po,arguments)}},{key:"streamHandler",value:function(){Po.stream.apply(Po,arguments)}},{key:"recordingHandler",value:function(){Po.recording.apply(Po,arguments)}},{key:"redirectHandler",value:function(){Po.redirect.apply(Po,arguments)}},{key:"rtmpHandler",value:function(){Po.rtmp.apply(Po,arguments)}},{key:"setUserDataHandler",value:function(){Po.setUserData.apply(Po,arguments)}},{key:"mediaInfoEventHandler",value:function(){Po.mediaInfoEvent.apply(Po,arguments)}},{key:"muteAudioEventHandler",value:function(){Po.muteAudioEvent.apply(Po,arguments)}},{key:"muteVideoEventHandler",value:function(){Po.muteVideoEvent.apply(Po,arguments)}},{key:"storedMessagesHandler",value:function(){Po.storedMessages.apply(Po,arguments)}}]),e}(),wo={joinRoom:function(e){var t=e.room,n=Yd.getSkylinkState(t.id),r=Yd.getInitOptions();return{type:Ut.JOIN_ROOM,uid:n.user.uid,cid:n.key,rid:t.id,userCred:n.user.token,timeStamp:n.user.timeStamp,apiOwner:n.appKeyOwner,roomCred:t.token,start:t.startDateTime,len:t.duration,isPrivileged:n.isPrivileged,autoIntroduce:n.autoIntroduce,key:r.appKey}},enterRoom:function(e){var t=e.room,n=Yd.getSkylinkState(t.id),r=Yd.getInitOptions(),i=n.user,a=n.peerPriorityWeight,o=n.enableIceRestart,s=n.hasMCU,d=r.enableDataChannel,c=window.AdapterJS,l=Hn.getUserInfo(t),u={type:Ut.ENTER,mid:i.sid,rid:t.id,agent:c.webrtcDetectedBrowser,version:(c.webrtcDetectedVersion||0).toString(),os:window.navigator.platform,userInfo:l,receiveOnly:Hn.getCurrentSessionInfo(t).config.receiveOnly,weight:a,temasysPluginVersion:c.WebRTCPlugin.plugin?c.WebRTCPlugin.plugin.VERSION:null,enableDataChannel:d,enableIceRestart:o,SMProtocolVersion:Tt,DTProtocolVersion:qe};return s&&(u.target=en.MCU,u.publisherId=i.sid),u},welcome:function(e,t){var n=Yd.getSkylinkState(e.id),r=Yd.getInitOptions(),i=n.user,a=n.peerPriorityWeight,o=n.enableIceRestart,s=n.room,d=r.enableDataChannel,c=window.AdapterJS,l=Hn.getUserInfo(s);return{type:Ut.WELCOME,mid:i.sid,rid:s.id,agent:c.webrtcDetectedBrowser,version:(c.webrtcDetectedVersion||0).toString(),os:window.navigator.platform,userInfo:l,receiveOnly:Hn.getCurrentSessionInfo(s).config.receiveOnly,weight:a,temasysPluginVersion:c.WebRTCPlugin.plugin?c.WebRTCPlugin.plugin.VERSION:null,enableDataChannel:d,enableIceRestart:o,SMProtocolVersion:Tt,DTProtocolVersion:qe,target:t}},offer:function(){return od.createOffer.apply(od,arguments)},answer:function(){return od.createAnswer.apply(od,arguments)},answerAck:function(e,t,n){var r=e.room,i=e.user;return{type:Ut.ANSWER_ACK,rid:r.id,mid:i.sid,target:t,success:n}},candidate:function(e,t,n){var r=t.room.id,i=Yd.getSkylinkState(r);return{type:Ut.CANDIDATE,label:n.sdpMLineIndex,id:n.sdpMid,candidate:n.candidate,mid:i.user.sid,target:e,rid:r}},setUserData:function(e){return{type:Ut.UPDATE_USER,mid:e.user.sid,rid:e.room.id,userData:hs(e.userData)?e.userData:JSON.stringify(e.userData),stamp:(new Date).getTime()}},getPeerList:function(e){return{type:Ut.GET_PEERS,showAll:e}},restartOffer:function(e,t,n){var r=Yd.getSkylinkState(e),i=window.AdapterJS,a=Yd.getInitOptions(),o=r.user,s=r.room,d=r.enableIceRestart,c=r.peerInformations,l=r.peerPriorityWeight;return{type:Ut.RESTART,mid:o.sid,rid:s.id,agent:i.webrtcDetectedBrowser,version:(i.webrtcDetectedVersion||0).toString(),os:window.navigator.platform,userInfo:Hn.getUserInfo(s),target:t,weight:l,receiveOnly:Hn.getCurrentSessionInfo(s).config.receiveOnly,publishOnly:Hn.getCurrentSessionInfo(s).config.publishOnly,enableDataChannel:a.enableDataChannel,enableIceRestart:d,doIceRestart:!0===n&&d&&c[t]&&c[t].config.enableIceRestart,isRestartResend:!1,temasysPluginVersion:i.WebRTCPlugin.plugin?i.WebRTCPlugin.plugin.VERSION:null,SMProtocolVersion:Tt,DTProtocolVersion:qe}},stream:function(e,t,n,r,i){return{type:Ut.STREAM,mid:t.sid,rid:e,status:r,streamId:n.id,settings:i}},recording:function(e,t){return{type:t,rid:e,target:en.MCU}},rtmp:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o={type:e,rid:t,rtmpId:r,streamId:i,endpoint:a,mid:n,target:en.MCU};return e===Ut.STOP_RTMP&&(delete o.endpoint,delete o.streamId),o},bye:function(e,t){var n=e.room,r=e.user,i=e.hasMCU,a={type:Ut.BYE,rid:n.id,mid:r.sid,target:t};return i&&(a.publisherId=r.sid),a},roomLock:function(e){var t=e.user,n=e.room,r=e.roomLocked;return{type:Ut.ROOM_LOCK,mid:t.sid,rid:n.id,lock:r}},mediaInfoEvent:function(e,t,n){return{type:Ut.MEDIA_INFO_EVENT,rid:e.room.id,mid:n.publisherId,target:t,publisherId:n.publisherId,mediaId:n.mediaId,mediaType:n.mediaType,mediaState:n.mediaState,transceiverMid:n.transceiverMid}},muteAudioEvent:function(e,t){var n=Yd.getSkylinkState(e.id),r=n.user,i=n.streamsMutedSettings;return{type:Ut.MUTE_AUDIO_EVENT,mid:r.sid,rid:e.id,muted:i[t].audioMuted,stamp:(new Date).getTime(),streamId:t}},muteVideoEvent:function(e,t){var n=Yd.getSkylinkState(e.id),r=n.user,i=n.streamsMutedSettings;return{type:Ut.MUTE_VIDEO_EVENT,mid:r.sid,rid:e.id,muted:i[t].videoMuted,stamp:(new Date).getTime(),streamId:t}},getStoredMessages:function(e){var t=e.user,n=e.room;return{mid:t.sid,rid:n.id,target:t.sid,type:Ut.GET_STORED_MESSAGES}},userMessages:function(e,t,n){var r=[],i=e.user,a=e.room,o=t.listOfPeers,s=t.isPrivate,d=t.isPersistent,c=t.secretId,l={data:n,mid:i.sid,rid:a.id,msgId:_s(),type:Ut.MESSAGE};if(c&&(l.secretId=c),s)for(var u=0;u<o.length;u+=1){var S=o[u],E=Object.assign({},l);E.target=S,r.push(E),Xs.log.DEBUG([S,Ht.MESSAGING,null,on.MESSAGING.PRIVATE_MESSAGE],{message:n})}else d&&(l.isPersistent=d),r.push(l),Xs.log.DEBUG([null,Ht.MESSAGING,null,on.MESSAGING.BROADCAST_MESSAGE],{message:n});return r}},Lo=function(){function e(){Object(o.a)(this,e),this.messageBuilders=wo}return Object(s.a)(e,[{key:"getJoinRoomMessage",value:function(){var e;return(e=this.messageBuilders).joinRoom.apply(e,arguments)}},{key:"getWelcomeMessage",value:function(){var e;return(e=this.messageBuilders).welcome.apply(e,arguments)}},{key:"getEnterRoomMessage",value:function(){var e;return(e=this.messageBuilders).enterRoom.apply(e,arguments)}},{key:"getAnswerMessage",value:function(){var e;return(e=this.messageBuilders).answer.apply(e,arguments)}},{key:"getAnswerAckMessage",value:function(){var e;return(e=this.messageBuilders).answerAck.apply(e,arguments)}},{key:"getOfferMessage",value:function(){var e;return(e=this.messageBuilders).offer.apply(e,arguments)}},{key:"getCandidateMessage",value:function(){var e;return(e=this.messageBuilders).candidate.apply(e,arguments)}},{key:"getSetUserDataMessage",value:function(e){return this.messageBuilders.setUserData(e)}},{key:"getPeerListMessage",value:function(){var e;return(e=this.messageBuilders).getPeerList.apply(e,arguments)}},{key:"getRestartOfferMessage",value:function(){var e;return(e=this.messageBuilders).restartOffer.apply(e,arguments)}},{key:"getStreamMessage",value:function(){var e;return(e=this.messageBuilders).stream.apply(e,arguments)}},{key:"getRecordingMessage",value:function(){var e;return(e=this.messageBuilders).recording.apply(e,arguments)}},{key:"getPeerMessagesForSignaling",value:function(){var e;return(e=this.messageBuilders).signalingMessages.apply(e,arguments)}},{key:"getMuteAudioMessage",value:function(){var e;return(e=this.messageBuilders).muteAudioEvent.apply(e,arguments)}},{key:"getMuteVideoMessage",value:function(){var e;return(e=this.messageBuilders).muteVideoEvent.apply(e,arguments)}},{key:"getRTMPMessage",value:function(){var e;return(e=this.messageBuilders).rtmp.apply(e,arguments)}},{key:"getByeMessage",value:function(){var e;return(e=this.messageBuilders).bye.apply(e,arguments)}},{key:"getRoomLockMessage",value:function(){var e;return(e=this.messageBuilders).roomLock.apply(e,arguments)}},{key:"getMediaInfoEventMessage",value:function(){var e;return(e=this.messageBuilders).mediaInfoEvent.apply(e,arguments)}},{key:"getGetStoredMessagesMessage",value:function(){var e;return(e=this.messageBuilders).getStoredMessages.apply(e,arguments)}},{key:"getUserMessages",value:function(){var e;return(e=this.messageBuilders).userMessages.apply(e,arguments)}}]),e}(),Uo="Polling",Go="WebSocket",Fo=null,Bo=function(){function e(){return Object(o.a)(this,e),Fo||(Fo=this),this.socket=null,this.attempts=0,this.timestamp=(new Date).valueOf(),this.messageHandler=new bo,this.messageBuilder=new Lo,this.config=null,Fo}return Object(s.a)(e,[{key:"resetSocketConfig",value:function(e){return{protocol:e,socketType:window.WebSocket?Go:Uo,signalingServerProtocol:e,socketSession:{finalAttempts:0,attempts:0},fallbackType:null,signalingServerPort:null,socketTimeout:!1}}},{key:"createSocket",value:function(e){var t=this,n=Yd.getSkylinkState(e);return n.socketSession=this.resetSocketConfig(n.signalingServerProtocol),Yd.setSkylinkState(n,e),new Promise((function(n,r){try{null!==t.socket&&t.socket instanceof window.io.Socket&&t.socket.connected?n():t.tryCreateSocket(e,n,r)}catch(i){t.handleCreateSocketFailure(e,n,r,i)}}))}},{key:"tryCreateSocket",value:function(e,t,n){var r=Yd.getSkylinkState(e).socketSession;this.socket=An({config:r,roomKey:e}),function(){or.apply(a,arguments)}(e,this,t,n)}},{key:"handleCreateSocketFailure",value:function(e,t,n,r){var i=Yd.getSkylinkState(e).socketSession;Xs.log.ERROR(on.INIT.SOCKET_CREATE_FAILED,r),Bs(Ge({session:cn()(i),errorCode:It.CONNECTION_FAILED,type:i.fallbackType,error:r})),n(r)}},{key:"dispatchHandshakeProgress",value:function(e,t){Bs(Ae({peerId:e.user.sid,state:ut[t],error:null,room:e.room}))}},{key:"answer",value:function(){for(var e,t=this,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=this.messageBuilder).getAnswerMessage.apply(e,r).then((function(e){var n=r[0];return t.sendMessage(e),t.dispatchHandshakeProgress(n,"ANSWER"),e}))}},{key:"answerAck",value:function(){var e,t=(e=this.messageBuilder).getAnswerAckMessage.apply(e,arguments),n=arguments.length<=0?void 0:arguments[0];this.sendMessage(t),this.dispatchHandshakeProgress(n,"ANSWER_ACK")}},{key:"enterRoom",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=(e=this.messageBuilder).getEnterRoomMessage.apply(e,n);this.sendMessage(i),this.dispatchHandshakeProgress.apply(this,n.concat(["ENTER"]))}},{key:"joinRoom",value:function(){var e,t=(e=this.messageBuilder).getJoinRoomMessage.apply(e,arguments);this.sendMessage(t)}},{key:"offer",value:function(){var e,t=this,n=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1],i=Yd.getSkylinkState(n.id);i.peerConnections[r].negotiating?Xs.log.DEBUG([r,Ht.SIG_SERVER,null,"".concat(on.SIGNALING.ABORTING_OFFER)]):(e=this.messageBuilder).getOfferMessage.apply(e,arguments).then((function(e){t.sendMessage(e),t.dispatchHandshakeProgress(i,"OFFER")}))}},{key:"welcome",value:function(){var e,t=(e=this.messageBuilder).getWelcomeMessage.apply(e,arguments);this.sendMessage(t)}},{key:"noop",value:function(){return null}},{key:"sendCandidate",value:function(){var e,t=(e=this.messageBuilder).getCandidateMessage.apply(e,arguments);t&&this.sendMessage(t)}},{key:"setUserData",value:function(e){var t=this.messageBuilder.getSetUserDataMessage(e);t&&this.sendMessage(t)}},{key:"getPeerList",value:function(e){var t=this.messageBuilder.getPeerListMessage(e);t&&this.sendMessage(t)}},{key:"stream",value:function(){var e,t=(e=this.messageBuilder).getStreamMessage.apply(e,arguments);t&&this.sendMessage(t)}},{key:"recording",value:function(){var e,t=(e=this.messageBuilder).getRecordingMessage.apply(e,arguments);this.sendMessage(t)}},{key:"rtmp",value:function(){var e,t=(e=this.messageBuilder).getRTMPMessage.apply(e,arguments);this.sendMessage(t)}},{key:"muteAudioEvent",value:function(e,t){var n=this.messageBuilder.getMuteAudioMessage(e,t);n&&this.sendMessage(n)}},{key:"muteVideoEvent",value:function(e,t){var n=this.messageBuilder.getMuteVideoMessage(e,t);n&&this.sendMessage(n)}},{key:"roomLock",value:function(e){var t=this.messageBuilder.getRoomLockMessage(e);t&&this.sendMessage(t)}},{key:"bye",value:function(){var e,t=(e=this.messageBuilder).getByeMessage.apply(e,arguments);this.sendMessage(t)}},{key:"mediaInfoEvent",value:function(e,t,n){var r=this.messageBuilder.getMediaInfoEventMessage(e,t,n);r&&this.sendMessage(r)}},{key:"getStoredMessages",value:function(e){var t=this.messageBuilder.getGetStoredMessagesMessage(e);t&&this.sendMessage(t)}},{key:"onMessage",value:function(e){var t=Yd.getSkylinkState(JSON.parse(e).rid);if(t){var n,r=t.socketSession;Bs((n={message:e,socketSession:cn()(r)},new me(J,{detail:n}))),function(){Cn.apply(a,arguments)}(this.messageHandler,JSON.parse(e))}}},{key:"sendMessage",value:function(e){(function(){return cr.apply(a,arguments)})(e)||(Xs.log.INFO(["SIG SERVER",null,e.type,"sent"]),function(e,t){e.send(JSON.stringify(t))}(this.socket,e))}},{key:"sendUserMessage",value:function(e,t,n){var r=this,i=this.messageBuilder.getUserMessages(e,t,n);Array.isArray(i)&&i.length&&i.map((function(e){return r.sendMessage(e),null}))}},{key:"updateAttempts",value:function(e,t,n){this.attempts=n;var r=Yd.getSkylinkState(e);r.socketSession.socketSession[t]=n,Yd.setSkylinkState(r,e)}},{key:"getAttempts",value:function(){return this.attempts}}]),e}(),jo={retrieveTransceiverMid:ln,retrieveMediaState:un,retrieveMediaId:Sn,buildPeerMediaInfo:En,retrieveStreamIdOfTrack:pn,retrieveTracks:fn,updatePeerMediaInfo:hn,sendMediaInfoMsg:function(e,t){var n=new Bo,r=Yd.getSkylinkState(e.id),i=r.user,a=r.hasMCU,o=r.peerConnections;(a?[en.MCU]:Object.keys(o).filter((function(e){return e!==i.sid&&e!==en.MCU}))).forEach((function(e){n.mediaInfoEvent(r,e,t)}))},parseSDPForTransceiverMid:function(e,t,n){for(var r=Yd.getSkylinkState(e.id).peerMedias,i=Yd.getInitOptions().beSilentOnParseLogs,a=Object.values(r[t]),o=$s.getTransceiverMid(n,i),s=o.audio,d=o.video,c=0;c<a.length;c+=1){var l=a[c];l.transceiverMid=l.mediaState===Jt.UNAVAILABLE?l.transceiverMid:null;for(var u=0;u<s.length;u+=1)if(s[u].streamId===l.streamId&&("sendonly"===s[u].direction||"sendrecv"===s[u].direction)){jo.updatePeerMediaInfo(e,t,!1,l.mediaId,Xt.TRANSCEIVER_MID,s[u].transceiverMid);break}for(var S=0;S<d.length;S+=1)if(d[S].streamId===l.streamId&&("sendonly"===d[S].direction||"sendrecv"===d[S].direction)){jo.updatePeerMediaInfo(e,t,!1,l.mediaId,Xt.TRANSCEIVER_MID,d[S].transceiverMid);break}}},retrieveValueGivenTransceiverMid:function(e,t,n,r){for(var i=e.peerMedias,a=Object.values(i[t]),o=0;o<a.length;o+=1)if(a[o].transceiverMid===n)return a[o][r];return null},retrieveFormattedMediaInfo:function(e,t){for(var n=Yd.getSkylinkState(e.id).peerMedias,r=Object.values(n[t]),i=[],a=0;a<r.length;a+=1){var o=r[a],s=cn()(o);delete s.trackId,delete s.streamId,i.push(s)}return i},resetPeerMedia:function(e,t){var n=Yd.getSkylinkState(e.id);return n.peerMedias[t]&&(n.peerMedias[t]={}),n},populatePeerMediaInfo:function(e,t,n){var r=e.peerMedias[n.publisherId]||{};return r[n.mediaId]=n,function(e,t){return!us(e)&&e[t]}(t,n.mediaId)&&(r[n.mediaId].streamId=n.transceiverMid===t[n.mediaId].transceiverMid?t[n.mediaId].streamId:""),r},processOnRemoveTrack:function(e,t,n){if(window.AdapterJS.webrtcDetectedBrowser===$t.REACT_NATIVE&&n){var r=e.room,i={track:{id:null,kind:null}},a={id:null};if(i.track.id=n.trackId,i.track.kind=n.mediaType===Wt.AUDIO||n.mediaType===Wt.AUDIO_MIC?Yt.AUDIO:Yt.VIDEO,a.id=n.streamId,i.stream=a,!(i.track.id||i.track.kind||a.id))return void Xs.log.DEBUG([t,Ht.MEDIA_STREAM,null,"".concat(on.BROWSER_AGENT.REACT_NATIVE.ERRORS.DROPPING_ONREMOVETRACK)],i);lo.onremovetrack(t,r,n.mediaType===Wt.VIDEO_SCREEN,i)}}},Vo=function(){function e(){Object(o.a)(this,e)}return Object(s.a)(e,null,[{key:"updatePeerMediaWithUserSid",value:function(e,t){var n=Yd.getSkylinkState(e.id);n.peerMedias[t]=Object.assign({},n.peerMedias.null),delete n.peerMedias.null,Yd.setSkylinkState(n,e.id),Object.keys(n.peerMedias[t]).forEach((function(n){jo.updatePeerMediaInfo(e,t,!1,n,Xt.PUBLISHER_ID,t)}))}},{key:"updateStreamIdFromOntrack",value:function(e,t,n,r){var i=Yd.getSkylinkState(e.id),a=jo.retrieveValueGivenTransceiverMid(i,t,n,Xt.MEDIA_ID);jo.updatePeerMediaInfo(e,t,!1,a,Xt.STREAM_ID,r)}},{key:"isVideoScreenTrack",value:function(e,t,n){for(var r=e.peerMedias,i=Object.values(r[t]),a=0;a<i.length;a+=1)if(i[a].transceiverMid===n)return i[a].mediaType===Wt.VIDEO_SCREEN;return!1}},{key:"setMediaStateToUnavailable",value:function(e,t,n){jo.updatePeerMediaInfo(e,t,!1,n,Xt.MEDIA_STATE,Jt.UNAVAILABLE)}},{key:"deleteUnavailableMedia",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=Yd.getSkylinkState(e.id);if(t!==en.MCU&&r.peerMedias[t]){var i;if(n)i=cn()(r.peerMedias[t][n]),delete r.peerMedias[t][n];else{var a=r.peerMedias[t];Object.values(a).forEach((function(e){e.mediaState===Jt.UNAVAILABLE&&(i=cn()(e),delete r.peerMedias[t][e.mediaId])}))}Yd.setSkylinkState(r,e.id),jo.processOnRemoveTrack(r,t,i),i&&Bs(We({mediaInfo:i}))}}},{key:"updatePeerMediaInfo",value:function(e,t,n,r,i){jo.updatePeerMediaInfo(e,t,!0,n,r,i)}},{key:"updateTransceiverMid",value:function(e,t){try{jo.retrieveTracks(e).forEach((function(n){var r=jo.retrieveTransceiverMid(e,n),i=jo.retrieveStreamIdOfTrack(e,n),a=jo.retrieveMediaId(n.kind,i);jo.updatePeerMediaInfo(e,t,!1,a,Xt.TRANSCEIVER_MID,r)}))}catch(n){Xs.log.ERROR([t,Ht.PEER_MEDIA,null,on.MEDIA_INFO.ERRORS.FAILED_UPDATING_TRANSCEIVER_MID],n)}}},{key:"setPeerMediaInfo",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];try{var i=Yd.getSkylinkState(e.id);if(t!==en.MCU||Ss(r)){if(t!==en.MCU){var a=cn()(i.peerMedias[t])||{},o=jo.resetPeerMedia(e,t);r.forEach((function(e){o.peerMedias[e.publisherId]=jo.populatePeerMediaInfo(o,a,e)})),Yd.setSkylinkState(o,e.id)}}else{var s=[];r.forEach((function(e){-1===s.indexOf(e.publisherId)&&s.push(e.publisherId)})),s.forEach((function(t){return n.setPeerMediaInfo(e,t,r)}))}}catch(d){Xs.log.ERROR([t,Ht.PEER_MEDIA,null,on.MEDIA_INFO.ERRORS.FAILED_SETTING_PEER_MEDIA_INFO])}}},{key:"retrieveStreamId",value:function(e,t,n,r){var i=Yd.getSkylinkState(e.id).peerMedias[t][n],a=i.transceiverMid===r?i.streamId:null;return a||Xs.log.ERROR([t,Ht.PEER_MEDIA,null,on.MEDIA_INFO.ERRORS.NO_ASSOCIATED_STREAM_ID]),a}},{key:"retrieveMediaId",value:function(e,t){return jo.retrieveMediaId(e,t)}},{key:"retrieveMediaInfoForOfferAnswer",value:function(e,t){var n=Yd.getSkylinkState(e.id).user.sid;return jo.parseSDPForTransceiverMid(e,n,t),jo.retrieveFormattedMediaInfo(e,n)}},{key:"processPeerMedia",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=Yd.getSkylinkState(e.id),o=a.peerMedias[t]||{},s=n.getTracks(),d=null;try{s.forEach((function(a){d=jo.retrieveMediaId(a.kind,n.id),o[d]=jo.buildPeerMediaInfo(e,t,a,n.id,a.kind===Yt.AUDIO?Wt.AUDIO_MIC:r?Wt.VIDEO_SCREEN:Wt.VIDEO_CAMERA),jo.updatePeerMediaInfo(e,t,i,d,null,null,o[d])}))}catch(c){Xs.log.ERROR([t,Ht.MEDIA_INFO,on.MEDIA_INFO.ERRORS.FAILED_PROCESSING_PEER_MEDIA],c)}}}]),e}(),xo=function(e,t){var n=e.streams;return!(!n.userMedia&&!n.screenshare)&&(!!(n.userMedia?Object.values(n.userMedia):[]).some((function(e){return e.id===t.id}))||n.screenshare&&n.screenshare.id===t.id)},Ho=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(e){var a=Yd.getSkylinkState(n);xo(a,e)||(ls.processNewStream(a.room,e,t,r),Vo.processPeerMedia(a.room,a.user.sid,e,r),i&&Xs.log.DEBUG([a.user.sid,Ht.MEDIA_STREAM,null,on.MEDIA_STREAM.FALLBACK_SUCCESS]),r&&Xs.log.DEBUG([a.user.sid,Ht.MEDIA_STREAM,null,on.MEDIA_STREAM.START_SCREEN_SUCCESS]),Bs(je({stream:e,isScreensharing:r,isAudioFallback:i,streamId:e.id,isAudio:Ms(e),isVideo:ks(e)})))}},Wo=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=window,r=n.AdapterJS,i={settings:{audio:!1,video:!1},mutedSettings:{shouldAudioMuted:!1,shouldVideoMuted:!1},getUserMediaSettings:{audio:!1,video:!1}};return(e.audio&&!t||e.audio&&t===Yt.AUDIO)&&(i.settings.audio={stereo:!1,exactConstraints:!!e.useExactConstraints,echoCancellation:!0},i.getUserMediaSettings.audio={echoCancellation:!0},"object"===typeof e.audio&&("boolean"===typeof e.audio.stereo&&(i.settings.audio.stereo=e.audio.stereo),"boolean"===typeof e.audio.useinbandfec&&(i.settings.audio.useinbandfec=e.audio.useinbandfec),"boolean"===typeof e.audio.usedtx&&(i.settings.audio.usedtx=e.audio.usedtx),"number"===typeof e.audio.maxplaybackrate&&e.audio.maxplaybackrate>=8e3&&e.audio.maxplaybackrate<=48e3&&(i.settings.audio.maxplaybackrate=e.audio.maxplaybackrate),"boolean"===typeof e.audio.mute&&(i.mutedSettings.shouldAudioMuted=e.audio.mute),"edge"!==r.webrtcDetectedBrowser&&("boolean"===typeof e.audio.echoCancellation&&(i.settings.audio.echoCancellation=e.audio.echoCancellation,i.getUserMediaSettings.audio.echoCancellation=e.audio.echoCancellation),Array.isArray(e.audio.optional)&&(i.settings.audio.optional=cn()(e.audio.optional),i.getUserMediaSettings.audio.optional=cn()(e.audio.optional)),e.audio.deviceId&&"string"===typeof e.audio.deviceId&&"firefox"!==r.webrtcDetectedBrowser&&(i.settings.audio.deviceId=e.audio.deviceId,i.getUserMediaSettings.audio.deviceId=e.useExactConstraints?{exact:e.audio.deviceId}:{ideal:e.audio.deviceId}))),"edge"===r.webrtcDetectedBrowser&&(i.getUserMediaSettings.audio=!0)),(e.video&&!t||e.video&&t===Yt.VIDEO)&&(i.settings.video={resolution:cn()(Nt.VGA),exactConstraints:!!e.useExactConstraints},i.getUserMediaSettings.video={},"object"===typeof e.video?("boolean"===typeof e.video.mute&&(i.mutedSettings.shouldVideoMuted=e.video.mute),Array.isArray(e.video.optional)&&(i.settings.video.optional=cn()(e.video.optional),i.getUserMediaSettings.video.optional=cn()(e.video.optional)),e.video.deviceId&&"string"===typeof e.video.deviceId&&(i.settings.video.deviceId=e.video.deviceId,i.getUserMediaSettings.video.deviceId=e.useExactConstraints?{exact:e.video.deviceId}:{ideal:e.video.deviceId}),e.video.resolution&&"object"===typeof e.video.resolution&&((e.video.resolution.width&&"object"===typeof e.video.resolution.width||"number"===typeof e.video.resolution.width)&&(i.settings.video.resolution.width=e.video.resolution.width),(e.video.resolution.height&&"object"===typeof e.video.resolution.height||"number"===typeof e.video.resolution.height)&&(i.settings.video.resolution.height=e.video.resolution.height)),i.getUserMediaSettings.video.width="object"===typeof i.settings.video.resolution.width?i.settings.video.resolution.width:e.useExactConstraints?{exact:i.settings.video.resolution.width}:{max:i.settings.video.resolution.width},i.getUserMediaSettings.video.height="object"===typeof i.settings.video.resolution.height?i.settings.video.resolution.height:e.useExactConstraints?{exact:i.settings.video.resolution.height}:{max:i.settings.video.resolution.height},(e.video.frameRate&&"object"===typeof e.video.frameRate||"number"===typeof e.video.frameRate&&"plugin"!==r.webrtcDetectedType)&&(i.settings.video.frameRate=e.video.frameRate,i.getUserMediaSettings.video.frameRate="object"===typeof i.settings.video.frameRate?i.settings.video.frameRate:e.useExactConstraints?{exact:i.settings.video.frameRate}:{max:i.settings.video.frameRate}),e.video.facingMode&&["string","object"].indexOf(typeof e.video.facingMode)>-1&&"plugin"===r.webrtcDetectedType&&(i.settings.video.facingMode=e.video.facingMode,i.getUserMediaSettings.video.facingMode="object"===typeof i.settings.video.facingMode?i.settings.video.facingMode:e.useExactConstraints?{exact:i.settings.video.facingMode}:{max:i.settings.video.facingMode})):i.getUserMediaSettings.video={width:e.useExactConstraints?{exact:i.settings.video.resolution.width}:{max:i.settings.video.resolution.width},height:e.useExactConstraints?{exact:i.settings.video.resolution.height}:{max:i.settings.video.resolution.height}},"edge"===r.webrtcDetectedBrowser&&(i.settings.video={exactConstraints:!!e.useExactConstraints},i.getUserMediaSettings.video=!0)),i},Ko=n(269),Yo=function e(t,n,r){var i=n,a=t.streams.userMedia,o=r||Object.keys(a).filter((function(e){return a[e].isReplaced}));if(0===o.length)return i;if(o.indexOf(i)>-1&&o.splice(o.indexOf(i),1),o.length>1)for(var s=0;s<o.length;s+=1)if(a[o[s]].newStream&&a[o[s]].newStream.id===i){e(t,i=o[s],o);break}return o[0]},Jo=function(e,t,n,r){var i=Yd.getSkylinkState(n.id),a=Yo(i,r),o=i.streamsMutedSettings;if(e){var s=Vo.retrieveMediaId(Yt.VIDEO,a);Vo.updatePeerMediaInfo(n,i.user.sid,s,Xt.MEDIA_STATE,o[a].videoMuted?Jt.MUTED:Jt.ACTIVE)}if(t){var d=Vo.retrieveMediaId(Yt.AUDIO,a);setTimeout((function(){return Vo.updatePeerMediaInfo(n,i.user.sid,d,Xt.MEDIA_STATE,o[a].audioMuted?Jt.MUTED:Jt.ACTIVE)}),e?1050:0)}},Xo=function(e,t,n){var r=e.streams,i=e.streamsMutedSettings,a=!1,o=!1;return r.screenshare&&r.screenshare.id===n&&i[n].videoMuted!==t.videoMuted?o=!0:r.userMedia&&r.userMedia[n]&&(Ms(r.userMedia[n].stream)&&i[n].audioMuted!==t.audioMuted&&(a=!0),ks(r.userMedia[n].stream)&&i[n].videoMuted!==t.videoMuted&&(o=!0)),{hasToggledAudio:a,hasToggledVideo:o}},Qo=function(e,t,n){var r=Yd.getSkylinkState(e),i=r.streams,a=r.room,o=r.peerConnections,s=r.peerInformations,d=Xo(r,n,t),c=d.hasToggledAudio,l=d.hasToggledVideo,u=null,S=!1;if(i.userMedia&&i.userMedia[t]?u=i.userMedia[t].stream:i.screenshare&&i.screenshare.id===t&&(u=i.screenshare.stream,S=!0),u)if(function(e,t,n){var r=e,i=r.room;t.hasToggledAudio&&(r.streamsMutedSettings[n].audioMuted=!r.streamsMutedSettings[n].audioMuted),t.hasToggledVideo&&(r.streamsMutedSettings[n].videoMuted=!r.streamsMutedSettings[n].videoMuted),Xs.log.DEBUG(on.MEDIA_STREAM.UPDATE_MUTED_SETTINGS,r.streamsMutedSettings,n),Yd.setSkylinkState(r,i.id)}(r,d,t),function(e,t){var n=t,r=n.room,i=function(e){return e.getAudioTracks()}(e),a=function(e){return e.getVideoTracks()}(e);n.streamsMediaStatus[e.id].audioMuted=xt.UNAVAILABLE,n.streamsMediaStatus[e.id].videoMuted=xt.UNAVAILABLE,i.forEach((function(t){t.enabled=!n.streamsMutedSettings[e.id].audioMuted,n.streamsMediaStatus[e.id].audioMuted=n.streamsMutedSettings[e.id].audioMuted?xt.MUTED:xt.ACTIVE})),a.forEach((function(t){t.enabled=!n.streamsMutedSettings[e.id].videoMuted,n.streamsMediaStatus[e.id].videoMuted=n.streamsMutedSettings[e.id].videoMuted?xt.MUTED:xt.ACTIVE})),Yd.setSkylinkState(n,r.id),Xs.log.DEBUG(on.MEDIA_STREAM.UPDATE_MEDIA_STATUS,n.streamsMediaStatus,e.id)}(u,r),function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=Yd.getSkylinkState(r);(ks(n)&&e||Ms(n)&&t)&&Bs(xe({streamId:n.id,isScreensharing:i,mediaStatus:a.streamsMediaStatus[n.id]}))}(l,c,u,a.id,S),function(e){var t=Yd.getSkylinkState(e.id).user.sid,n=Hn.getCurrentSessionInfo(e);Bs(Me({isSelf:!0,peerId:t,peerInfo:n}))}(a),function(e,t,n){var r=Yd.getSkylinkState(e.id);Bs(Ie({isSelf:!0,peerId:r.user.sid,peerInfo:Hn.getUserInfo(e),streamId:t.id,isScreensharing:n,isAudio:Ms(t),isVideo:ks(t)}))}(a,u,S),!o[en.MCU]&&Ss(Object.keys(o))||o[en.MCU]&&Ss(Object.keys(s))){Gs(an.HANDSHAKE_PROGRESS,(function e(n){n.detail.state===ut.ANSWER_ACK&&(Jo(l,c,a,t),Fs(an.HANDSHAKE_PROGRESS,e))}))}else setTimeout((function(){Jo(l,c,a,t)}),500)},qo=function(e){switch(e){case 1:return!1;case 0:default:return!0}},zo=function(e,t){var n=t.streams,r=!1;return Object.keys(n.userMedia).forEach((function(t){t===e&&(r=!0)})),n.screenshare&&n.screenshare.id===e&&(r=!0),r},Zo=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=e.streams,i=e.room;if(gs(t))if(r.userMedia||r.screenshare)if(!n||zo(n,e)){var a={audioMuted:Rs(t.audioMuted)?t.audioMuted:!fs(t.audioMuted)||qo(t.audioMuted),videoMuted:Rs(t.videoMuted)?t.videoMuted:!fs(t.videoMuted)||qo(t.videoMuted)},o=[];if(n&&(r.userMedia[n]&&!r.userMedia[n].isReplaced||r.screenshare.id===n&&!r.screenshare.isReplaced)?o.push(n):(o=Object.keys(r.userMedia).filter((function(e){return!r.userMedia[e].isReplaced})),r.screenshare&&!r.screenshare.isReplaced&&o.push(r.screenshare.id)),Ss(o))Xs.log.ERROR(on.MEDIA_STREAM.ERRORS.NO_STREAMS_MUTED,t);else{var s=Object.values(o).filter((function(t){return Xo(e,a,t).hasToggledAudio||Xo(e,a,t).hasToggledVideo}));s.forEach((function(e,t){setTimeout((function(){return Qo(i.id,e,a)}),0===t?0:1050)}))}}else Xs.log.ERROR(on.MEDIA_STREAM.ERRORS.INVALID_MUTE_OPTIONS,t);else Xs.log.WARN(on.MEDIA_STREAM.ERRORS.NO_STREAM);else Xs.log.ERROR(on.MEDIA_STREAM.ERRORS.INVALID_MUTE_OPTIONS,t)},$o=function(e,t){for(var n=0;n<t.length;n+=1)if(e.id===t[n].id)return!0;return!1},es=function(e,t){var n=e.getTransceivers?e.getTransceivers():[],r=t.getTracks();if(Ss(n))return!1;for(var i=0;i<n.length;i+=1)if(n[i].sender.track&&$o(n[i].sender.track,r))return!0;return!1},ts=function(e,t,n,r){for(var i=e,a=n.getTracks(),o=0;o<a.length;o+=1){var s=r.addTrack(a[o],n);s&&Ka.processNewSender(i,t,s)}Yd.setSkylinkState(i,i.room.id)},ns=function(e,t,n,r){var i=e.peerConnections[t].getSenders(),a=null;return n?(i.forEach((function(e){e.track&&e.track.id===n&&e.track.kind===r&&(a=e)})),a):a},rs=function(e,t){var n=e.user,r=e.room,i=n.sid,a=Hn.getCurrentSessionInfo(r);Bs(Re({room:r,stream:t,streamId:t.id,isSelf:!0,peerId:i,peerInfo:a,isScreensharing:!1,isVideo:ks(t),isAudio:Ms(t)})),Bs(Me({isSelf:!0,peerId:i,peerInfo:a}))},is=function(e,t,n,r){var i=window.AdapterJS,a=e.peerConnections,o=e.hasMCU;"edge"===i.webrtcDetectedBrowser&&r(new Error(on.PEER_CONNECTION.refresh_no_edge_support));try{if(function(e,t){for(var n=0;n<t.length;n+=1)if(t[n])if(Array.isArray(t[n]))for(var r=0;r<t[n].length;r+=1)t[n][r]&&rs(e,t[n][r]);else rs(e,t[n])}(e,t),Object.keys(a).length>0||o)od.refreshPeerConnection(Object.keys(a),e,!1,{}).then((function(){n(t)})).catch((function(e){Xs.log.ERROR(on.PEER_CONNECTION.ERRORS.REFRESH),r(e)}));else Xs.log.WARN(on.ROOM.ERRORS.NO_PEERS),n(t)}catch(s){Xs.log.ERROR(s)}},as=function(e,t,n,r){return Un.getUserMedia(e,t).then((function(t){is(e,t,n,r)})).catch((function(e){r(e)}))},os=function(e,t,n,r){return Un.usePrefetchedStream(e.room.id,t).then((function(t){is(e,t,n,r)})).catch((function(e){r(e)}))},ss=function(e,t,n,r){var i=[];return t.forEach((function(t){i.push(Un.usePrefetchedStream(e.room.id,t))})),Promise.all(i).then((function(t){is(e,t,n,r)})).catch((function(e){r(e)}))},ds=function(e){var t={audio:{input:[],output:[]},video:{input:[]}};return e.forEach((function(e){var n={deviceId:e.deviceId||e.sourceId||"default",label:e.label,groupId:e.groupId||null};n.label=n.label||"Source for ".concat(n.deviceId),["audio","audioinput"].indexOf(e.kind)>-1?t.audio.input.push(n):["video","videoinput"].indexOf(e.kind)>-1?t.video.input.push(n):"audiooutput"===e.kind&&t.audio.output.push(n)})),t},cs=function(e,t,n,r){return{id:n.id,stream:n,isReplaced:!1,settings:r.settings,constraints:r.getUserMediaSettings}},ls={parseMediaOptions:sn,processStreamInState:Ho,parseStreamSettings:Wo,prepMediaAccessRequest:function(e){return new Promise((function(t,n){var r=e.roomKey,i=Object(Ko.a)(e,["roomKey"]),a=ls.parseStreamSettings(i,Yt.AUDIO),o=ls.parseStreamSettings(i,Yt.VIDEO),s=window.AdapterJS;a.getUserMediaSettings.audio||o.getUserMediaSettings.video||n(on.MEDIA_STREAM.ERRORS.INVALID_GUM_OPTIONS),s.webRTCReady((function(){window.navigator.mediaDevices.getUserMedia({audio:a.getUserMediaSettings.audio,video:o.getUserMediaSettings.video}).then((function(e){var n=ls.onStreamAccessSuccess(r,e,a,o,!1),i=Yd.getSkylinkState(r);n[0]&&a.mutedSettings.shouldAudioMuted&&Zo(i,{audioMuted:a.mutedSettings.shouldAudioMuted,videoMuted:o.mutedSettings.shouldVideoMuted},n[0].id),n[1]&&o.mutedSettings.shouldVideoMuted&&Zo(i,{audioMuted:a.mutedSettings.shouldAudioMuted,videoMuted:o.mutedSettings.shouldVideoMuted},n[1].id),t(n)})).catch((function(e){return ls.onStreamAccessError(e,n,t,r,a,o)}))}))}))},addLocalMediaStreams:function(e,t){var n=Yd.getSkylinkState(t.room.id),r=n.peerConnections,i=n.streams,a=r[e];i.userMedia&&function(e,t,n,r){for(var i=Object.keys(n),a=0;a<i.length;a+=1){var o=n[i[a]].stream;es(r,o)||ts(e,t,o,r)}}(n,e,i.userMedia,a),i.screenshare&&function(e,t,n,r){var i=n.stream;es(r,i)||ts(e,t,i,r)}(n,e,i.screenshare,a)},onRemoteTrackAdded:function(e,t,n,r,i,a){var o=t.user,s=t.hasMCU,d=t.room,c={dispatchOnIncomingStream:function(e){Bs(Re(e))},dispatchOnIncomingScreenStream:function(e){e.isReplace=!1,Bs(he(e))}},l=r?"dispatchOnIncomingScreenStream":"dispatchOnIncomingStream",u={stream:e,peerId:n,room:d,isSelf:s&&n===o.sid||!1,peerInfo:Hn.getPeerInfo(n,d),streamId:e.id,isVideo:i,isAudio:a};c[l](u),Bs(Me({peerId:n,peerInfo:Hn.getPeerInfo(n,d),isSelf:s&&n===o.sid||!1,room:d}))},onStreamAccessError:function(e,t,n,r,i,a){var o=Yd.getInitOptions(),s=Yd.getSkylinkState(r),d=o.audioFallback;if(i.settings.audio&&a.settings.video&&d){return Xs.log.DEBUG([s.user.sid,Ht.MEDIA_STREAM,null,on.MEDIA_STREAM.START_FALLBACK]),Bs(Fe({error:e,state:Dt.FALLBACKING,isAudioFallback:!0})),window.navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){return ls.onStreamAccessSuccess(r,e,i,a,!0,n)})).catch((function(n){Xs.log.ERROR([s.user.sid,Ht.MEDIA_STREAM,null,on.MEDIA_STREAM.ERRORS.FALLBACK,n]),Bs(He({error:n,isAudioFallbackError:!0})),Bs(Fe({error:e,state:Dt.ERROR,isAudioFallback:!0})),t(n)}))}Xs.log.ERROR([s.user.sid,Ht.MEDIA_STREAM,null,on.MEDIA_STREAM.ERRORS.GET_USER_MEDIA],e),Bs(He({error:e,isAudioFallbackError:!1})),t(e)},replaceTrack:function(e,t,n,r){var i=e.getVideoTracks()[0],a=e.getAudioTracks()[0],o=ns(r,n,i?i.id:null,"video"),s=ns(r,n,a?a.id:null,"audio"),d=t.getVideoTracks()[0],c=t.getAudioTracks()[0];try{i&&d&&o&&o.replaceTrack(d),a&&c&&s&&s.replaceTrack(c)}catch(l){Xs.log.ERROR([n,Ht.PEER_CONNECTION,null,on.PEER_CONNECTION.ERRORS.REPLACE_TRACK],l)}},muteStreams:Zo,sendStream:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(n,r){if(!e)return r(new Error(on.ROOM_STATE.NO_ROOM_NAME));var i=e.inRoom,a=window.AdapterJS,o=(!gs(t)||null===t)&&!(a&&a.WebRTCPlugin&&a.WebRTCPlugin.plugin);if(!i)return Xs.log.WARN(on.ROOM.ERRORS.NOT_IN_ROOM),r(new Error("".concat(on.ROOM.ERRORS.NOT_IN_ROOM)));if(o)return r(new Error("".concat(on.MEDIA_STREAM.ERRORS.INVALID_GUM_OPTIONS," ").concat(t)));try{if(Array.isArray(t)){var s=!0;return t.forEach((function(e){ms(e.getAudioTracks)&&ms(e.getVideoTracks)||(s=!1)})),s?ss(e,t,n,r):r(new Error(on.MEDIA_STREAM.ERRORS.INVALID_MEDIA_STREAM_ARRAY))}return!!t&&(ms(t.getAudioTracks)||ms(t.getVideoTracks))?os(e,t,n,r):as(e,t,n,r)}catch(d){Xs.log.ERROR(on.MEDIA_STREAM.ERRORS.SEND_STREAM,d)}}))},getStreamSources:function(){var e=window.navigator;return new Promise((function(t,n){e.mediaDevices&&ms(e.mediaDevices.enumerateDevices)?e.mediaDevices.enumerateDevices().then((function(e){t(ds(e))})):n(ds([]))}))},getStreams:function(e){var t=e.streams,n=t.userMedia,r=t.screenshare,i={userMedia:null,screenshare:null};if(!n&&!r)return i;if(n){var a=Object.keys(n);i.userMedia={},a.forEach((function(e){i.userMedia[e]=n[e].stream}))}return r&&(i.screenshare=r.stream),i},getScreenSources:function(){return new Promise((function(e){var t=window,n=t.navigator,r=t.AdapterJS,i={mediaSource:[],mediaSourceInput:[]};return n.userAgent.toLowerCase().indexOf("android")>-1?("chrome"===r.webrtcDetectedBrowser&&r.webrtcDetectedVersion>=59&&(i.mediaSource=["screen"]),e(i),null):(("chrome"===r.webrtcDetectedBrowser&&r.webrtcDetectedVersion>=34||"firefox"===r.webrtcDetectedBrowser&&r.webrtcDetectedVersion>=38||"opera"===r.webrtcDetectedBrowser&&r.webrtcDetectedVersion>=21)&&("opera"!==r.webrtcDetectedBrowser||r.extensionInfo&&r.extensionInfo.opera&&r.extensionInfo.opera.extensionId||Xs.log.WARN("Please ensure that your application allows Opera screensharing!"),i.mediaSource=["window","screen"],"chrome"===r.webrtcDetectedBrowser&&r.webrtcDetectedVersion>=52||"opera"===r.webrtcDetectedBrowser&&r.webrtcDetectedVersion>=39?i.mediaSource.push("tab","audio"):"firefox"===r.webrtcDetectedBrowser&&i.mediaSource.push("browser","camera","application")),e(i),null)}))},updateStreamsMediaStatus:function(e,t,n){var r=Yd.getSkylinkState(e),i=r.room,a=r.streamsMediaStatus,o=t.mutedSettings.shouldAudioMuted,s=t.settings,d=s.audio,c=s.video;a[n.id]={},a[n.id].audioMuted=d?o?xt.MUTED:xt.ACTIVE:xt.UNAVAILABLE,a[n.id].videoMuted=c?o?xt.MUTED:xt.ACTIVE:xt.UNAVAILABLE,Yd.setSkylinkState(r,i.id)},updateRemoteStreams:function(e,t,n){var r=Yd.getSkylinkState(e.id);r.remoteStreams[t]=r.remoteStreams[t]||{},r.remoteStreams[t][n.id]=n,Yd.setSkylinkState(r,e.id)},retrieveVideoStreams:function(e){var t=Yd.getSkylinkState(e.id).streams,n=[];return Object.values(t.userMedia).forEach((function(e){e.stream.getVideoTracks().length>0&&n.push(e.stream)})),n},splitAudioAndVideoStream:function(e){var t=window.MediaStream,n=[],r=e.getAudioTracks(),i=e.getVideoTracks();return Ms(e)?n.push(new t(r)):n.push(null),ks(e)?n.push(new t(i)):n.push(null),n},processNewStream:function(e,t,n,r){!function(e,t,n,r){var i=Yd.getSkylinkState(e.id),a=r?"screenshare":"userMedia";r?i.streams[a]=cs(i.room,i.user,t,n):(i.streams[a]=i.streams[a]?i.streams[a]:{},i.streams[a][t.id]=cs(i.room,i.user,t,n)),Yd.setSkylinkState(i,e.id)}(e,t,n,r),ls.updateStreamsMutedSettings(e.id,n,t),ls.updateStreamsMediaStatus(e.id,n,t)},updateStreamsMutedSettings:function(e,t,n){var r=Yd.getSkylinkState(e),i=r.room,a=r.streamsMutedSettings,o=t.settings,s=o.audio,d=o.video;a[n.id]={},a[n.id].audioMuted=!s,a[n.id].videoMuted=!d,Yd.setSkylinkState(r,i.id)},onStreamAccessSuccess:function(e,t,n,r,i){var a=ls.splitAudioAndVideoStream(t);return a.forEach((function(t){t&&ls.processStreamInState(t,Ms(t)?n:r,e,!1,i)})),a}},us=function(e){return 0===Object.keys(e).length},Ss=function(e){return 0===e.length},Es=function(e){return""===e},gs=function(e){return"object"===typeof e&&null!==e},ps=function(e){return"object"===typeof e&&null==e},fs=function(e){return"number"===typeof e},ms=function(e){return"function"===typeof e},Rs=function(e){return"undefined"!==typeof e&&"boolean"===typeof e},hs=function(e){return"string"===typeof e},vs=function(e,t,n){var r=!0;return null!==e&&"undefined"!==typeof e&&hs(e)||(Xs.log.ERROR("".concat(n,": ").concat(t," is null, undefined or not a string.")),r=!1),r},Is=function(e){if(vs(e,"roomId","getStateByRid")){for(var t=Yd.getSkylinkState(),n=Object.keys(t),r=null,i=0;i<n.length;i+=1){var a=n[i];if(a===e){r=t[a];break}}return r}return Xs.log.ERROR("getRoomStateByRid: ".concat(on.ROOM_STATE.NOT_FOUND," - ").concat(e)),null},Os=function(e){return Is(e)},Ts=function(e){var t=null;if(vs(e,"roomName","getRoomStateByName"))for(var n=Yd.getSkylinkState(),r=Object.keys(n),i=0;i<r.length;i+=1){var a=n[r[i]];if(a.room.roomName.toLowerCase()===e.toLowerCase()){t=a;break}}return t||Xs.log.ERROR("getRoomStateByName: ".concat(on.ROOM_STATE.NOT_FOUND," - ").concat(e)),t},As=function(e,t){for(var n=(e||"").split("."),r=(t||"").split("."),i=0;i<r.length;i+=1)if((n[i]||"0")<(r[i]||"0"))return!0;return!1},Cs=function(){try{(new Bo).socket.disconnect()}catch(e){Xs.log.ERROR(e)}},_s=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:n&&15).toString(16)}))},Ns=function(e){return new Promise((function(t,n){var r=window.navigator;e&&gs(e)||n(new Error("".concat(on.MEDIA_STREAM.ERRORS.INVALID_GUM_OPTIONS," ").concat(e))),r.mediaDevices.getUserMedia(e).then((function(e){var n=ls.splitAudioAndVideoStream(e);t(n)})).catch((function(e){n(e)}))}))},Ds=function(e){return new Promise((function(t,n){n(new Error(e))}))},ys=function(e,t){var n=Yd.getSkylinkState(e.id).peerConnections,r=Object.keys(n),i=!1;return r.forEach((function(e){e===t&&(i=!0)})),i},Ms=function(e){return e.getAudioTracks().length>0},ks=function(e){return e.getVideoTracks().length>0},Ps=function(e){var t=window.AdapterJS;switch(e){case $t.CHROME:return t.webrtcDetectedBrowser===$t.CHROME;case $t.SAFARI:return t.webrtcDetectedBrowser===$t.SAFARI;case $t.FIREFOX:return t.webrtcDetectedBrowser===$t.FIREFOX;default:return Xs.log.DEBUG(on.UTILS.INVALID_BROWSER_AGENT),!1}},bs=function(e){return window.AdapterJS.webrtcDetectedVersion===e},ws=function(e){return new Date(e).toISOString()},Ls=function(){return(new Date).toISOString()},Us=new(function(){function e(){Object(o.a)(this,e),this.events={},this.privateEvents={}}return Object(s.a)(e,[{key:"addPrivateEventListener",value:function(e,t){this.addListener(e,t,!0)}},{key:"addEventListener",value:function(e,t){this.addListener(e,t,!1)}},{key:"addListener",value:function(e,t,n){try{var r=n?"privateEvents":"events";if(!ms(t))return void Xs.log.DEBUG([null,Ht.SKYLINK_EVENT,e,on.LOGGER.INVALID_CB]);this[r][e]||(this[r][e]={}),this[r][e].callbacks||(this[r][e].callbacks=[]),this[r][e].callbacks.push(t),n||Xs.log.DEBUG([null,Ht.SKYLINK_EVENT,e,on.LOGGER.EVENT_REGISTERED])}catch(i){Xs.log.ERROR([null,Ht.SKYLINK_EVENT,e,on.LOGGER.EVENT_REGISTER_ERROR],i)}}},{key:"dispatchEvent",value:function(e){if(e.name!==an.LOGGED_ON_CONSOLE){var t=[];if(this.events[e.name]){var n=this.events[e.name].callbacks;t=t.concat(n)}else Xs.log.DEBUG([null,Ht.SKYLINK_EVENT,e.name,on.LOGGER.EVENT_DISPATCHED]);if(this.privateEvents[e.name]){var r=this.privateEvents[e.name]?this.privateEvents[e.name].callbacks:[];t=t.concat(r)}t.forEach((function(t){try{t(e.detail)}catch(n){Xs.log.ERROR([null,Ht.SKYLINK_EVENT,e.name,on.LOGGER.EVENT_DISPATCH_ERROR],n)}}))}}},{key:"removeEventListener",value:function(e,t){this.removeListener(e,t,!1)}},{key:"removePrivateEventListener",value:function(e,t){this.removeListener(e,t,!0)}},{key:"removeListener",value:function(e,t,n){var r=this,i=n?"privateEvents":"events";if(n||this.events[e]&&this.events[e].callbacks)try{this[i][e].callbacks.forEach((function(a,o){a===t&&(delete r[i][e].callbacks[o],n||Xs.log.DEBUG([null,Ht.SKYLINK_EVENT,e,on.LOGGER.EVENT_UNREGISTERED]))}))}catch(a){Xs.log.ERROR([null,Ht.SKYLINK_EVENT,e,on.LOGGER.EVENT_DISPATCH_ERROR],a)}else Xs.log.WARN([null,Ht.SKYLINK_EVENT,e,on.LOGGER.EVENT_UNREGISTERED])}}]),e}()),Gs=Us.addPrivateEventListener.bind(Us),Fs=Us.removePrivateEventListener.bind(Us),Bs=Us.dispatchEvent.bind(Us),js=Us,Vs=["trace","debug","info","warn","error"],xs=function(e){var t=!0;return"undefined"===typeof console?t=!1:"undefined"===typeof console[e]&&(t=!1),t},Hs=function(e){var t="SkylinkJS -";if(Array.isArray(e)){var n=Object(R.a)(e,4),r=n[0],i=n[1],a=n[2],o=n[3];if(t+=r?" [".concat(r,"]"):" -",t+=i?" <<".concat(i,">>"):r?"":" <<Method>>",a)if(Array.isArray(a))for(var s=0;s<a.length;s+=1)t+=" (".concat(a[s],")");else t+=" (".concat(a,")");t+=" ".concat(o)}else t+=" ".concat(e);return t},Ws=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i="[".concat((new Date).toISOString(),"]"),a=e.level,o=e.logLevels;if(a<=t&&a!==o.SILENT){var s=Vs[t],d=xs(s);if(!d)return;var c=Hs(n);if(xs(s)&&(console[s](i,c,r||""),Bs(Ke({level:s,message:c,debugObject:r}))),Xs.storeLogs){var l=[i,s.toUpperCase(),c];r&&l.push(r),Xs.storedLogs.push(l)}}},Ks=function(e){window.localStorage.setItem("loglevel:skylinkjs",e)},Ys=function(){function e(){Object(o.a)(this,e),this.logLevels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},this.level=function(e){var t=window.localStorage.getItem("loglevel:skylinkjs");return null===t||Number.isNaN(+t)?e.ERROR:+t}(this.logLevels),this.storeLogs=!1,this.storedLogs=[]}return Object(s.a)(e,[{key:"setLevel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.levels.ERROR,t=arguments.length>1?arguments[1]:void 0;"number"===typeof e?(this.level=e,Ks(this.level)):this.level=this.levels.ERROR,t&&(this.storeLogs=t)}},{key:"enableAll",value:function(){this.setLevel(this.logLevels.TRACE)}},{key:"disableAll",value:function(){this.setLevel(this.logLevels.SILENT)}},{key:"getLogs",value:function(){return this.storeLogs?this.storedLogs:(this.log.WARN(on.LOGGER.LOGS_NOT_STORED),null)}},{key:"clearLogs",value:function(){this.log.INFO(on.LOGGER.LOGS_CLEARED),this.storedLogs=[]}}]),e}(),Js=new Ys;Ys.prototype.log={TRACE:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Ws.apply(void 0,[Js,Js.logLevels.TRACE].concat(t))},DEBUG:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Ws.apply(void 0,[Js,Js.logLevels.DEBUG].concat(t))},INFO:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Ws.apply(void 0,[Js,Js.logLevels.INFO].concat(t))},WARN:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Ws.apply(void 0,[Js,Js.logLevels.WARN].concat(t))},ERROR:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Ws.apply(void 0,[Js,Js.logLevels.ERROR].concat(t))}};var Xs=Js,Qs=function(e,t,n,r,i){var a=e.sdp.match(new RegExp("m="+t+" .*\r\n","gi"));if(Array.isArray(a)&&a.length>0){var o=e.sdp.match(new RegExp("a=rtpmap:.* "+n+"/"+(r?r+("audio"===t?"[/]*.*":".*"):".*")+"\r\n","gi"));if(Array.isArray(o)&&o.length>0)for(var s=0;s<o.length;s+=1){var d=(o[s].split("a=rtpmap:")[1]||"").split(" ")[0];if(d){var c=e.sdp.match(new RegExp("a=fmtp:"+d+" .*\r\n","gi")),l="a=fmtp:"+d+" ",u=[];if(Array.isArray(c)&&c.length>0){for(var S=(c[0].split("a=fmtp:"+d+" ")[1]||"").replace(/ /g,"").replace(/\r\n/g,"").split(";"),E=0;E<S.length;E+=1)if(S[E]){var g=S[E].split("=");i.hasOwnProperty(g[0])?l+="boolean"===typeof i[g[0]]?i[g[0]]?g[0]+"=1;":"":g[0]+"="+i[g[0]]+";":l+=S[E]+";",u.push(g[0])}e.sdp=e.sdp.replace(c[0],"")}for(var p in i)i.hasOwnProperty(p)&&-1===u.indexOf(p)&&(l+="boolean"===typeof i[p]?i[p]?p+"=1;":"":p+"="+i[p]+";",u.push(p));l!=="a=fmtp:"+d+" "&&(e.sdp=e.sdp.replace(o[s],o[s]+l+"\r\n"))}}}},qs=function(e){return(e.match(/a=rtpmap:.*\ rtx\/.*\r\n/gi)||[]).forEach((function(t){var n=(t.split("a=rtpmap:")[1]||"").split(" ")[0]||"",r=(e.match(new RegExp("a=fmtp:"+n+" .*\r\n","gi"))||[])[0];if(r){var i=(r.split(" apt=")[1]||"").replace(/\r\n/gi,"");e.match(new RegExp("a=rtpmap:"+i+" .*\r\n","gi"))||(e=(e=e.replace(new RegExp(t,"g"),"")).replace(new RegExp(r,"g"),""))}else e=e.replace(new RegExp(t,"g"),"")})),e},zs=function(e){return(e.match(/a=(fmtp|rtcp-fb):.*\ rtx\/.*\r\n/gi)||[]).forEach((function(t){var n=(t.split("a="+(t.indexOf("rtcp")>0?"rtcp-fb":"fmtp"))[1]||"").split(" ")[0]||"";e.match(new RegExp("a=rtpmap:"+n+" .*\r\n","gi"))||(e=e.replace(new RegExp(t,"g"),""))})),e},Zs={getSDPCommonSupports:m,getSDPCodecsSupport:function(e,t,n){var r={audio:{},video:{}};if(!t||!t.sdp)return r;for(var i=t.sdp.split("\r\n"),a="",o=0;o<i.length;o+=1)if(0!==i[o].indexOf("m=")){if(0===i[o].indexOf("a=rtpmap:")){var s=(i[o].split(" ")[1]||"").split("/"),d=(s[0]||"").toLowerCase(),c=s[1]+(s[2]?"/".concat(s[2]):"");if(["ulpfec","red","telephone-event","cn","rtx"].indexOf(d)>-1)continue;r[a][d]=r[a][d]||[],-1===r[a][d].indexOf(c)&&r[a][d].push(c)}}else a=(i[o].split("m=")[1]||"").split(" ")[0];return n||Xs.log.INFO([e||null,"RTCSessionDescription",t.type,"Parsed codecs support ->"],r),r},getCodecsSupport:function(e){return new Promise((function(t,n){var r=Yd.getSkylinkState(e),i=Yd.getInitOptions().beSilentOnParseLogs,a=r,o=window,s=o.AdapterJS,d=o.RTCRtpSender,c=o.RTCPeerConnection;r.currentCodecSupport&&t(r.currentCodecSupport),a.currentCodecSupport={audio:{},video:{}},"AppleWebKit"===s.webrtcDetectedType&&(a.currentCodecSupport.audio={opus:["48000/2"]},a.currentCodecSupport.video={h264:["48000"]},t(a.currentCodecSupport));try{if("edge"===window.webrtcDetectedBrowser){for(var l=d.getCapabilities().codecs,u=0;u<l.length;u+=1)if(["audio","video"].indexOf(l[u].kind)>-1&&l[u].name){var S=l[u].name.toLowerCase();a.currentCodecSupport[l[u].kind][S]=l[u].clockRate+(l[u].numChannels>1?"/".concat(l[u].numChannels):"")}t(a.currentCodecSupport)}else{var E=new c(null),g="plugin"!==s.webrtcDetectedType?{offerToReceiveAudio:!0,offerToReceiveVideo:!0}:{mandatory:{OfferToReceiveVideo:!0,OfferToReceiveAudio:!0}};try{var p=E.createDataChannel("test");a.binaryChunkType=p.binaryType||r.binaryChunkType,a.binaryChunkType=r.binaryChunkType.toLowerCase().indexOf("array")>-1?Qe.ARRAY_BUFFER:r.binaryChunkType;for(var f=Object.keys(Qe),m=0;m<f.length;m+=1)if(Qe.hasOwnProperty(f)&&r.binaryChunkType.toLowerCase()===Qe[f].toLowerCase()){a.binaryChunkType=Qe[f];break}}catch(R){}E.createOffer(g).then((function(e){a.currentCodecSupport=$s.getSDPCodecsSupport(null,e,i),t(a.currentCodecSupport)})).catch((function(e){n(e)}))}}catch(h){n(h)}}))},setSDPCodecParams:function(e,t,n){var r=Yd.getSkylinkState(n),i=Yd.getInitOptions();return Qs(t,"audio",Ct.OPUS,48e3,function(){var e={},t=Object.keys(r.streams.userMedia),n=r.streams.userMedia?r.streams.userMedia[t[0]].settings.audio:{};return n=n&&"object"===typeof n?n:{},"boolean"===typeof i.codecParams.audio.opus.stereo?e.stereo=i.codecParams.audio.opus.stereo:"boolean"===typeof n.stereo&&(e.stereo=n.stereo),"boolean"===typeof i.codecParams.audio.opus["sprop-stereo"]?e["sprop-stereo"]=i.codecParams.audio.opus["sprop-stereo"]:"boolean"===typeof n.stereo&&(e["sprop-stereo"]=n.stereo),"boolean"===typeof i.codecParams.audio.opus.usedtx?e.usedtx=i.codecParams.audio.opus.usedtx:"boolean"===typeof n.usedtx&&(e.usedtx=n.usedtx),"boolean"===typeof i.codecParams.audio.opus.useinbandfec?e.useinbandfec=i.codecParams.audio.opus.useinbandfec:"boolean"===typeof n.useinbandfec&&(e.useinbandfec=n.useinbandfec),"number"===typeof i.codecParams.audio.opus.maxplaybackrate?e.maxplaybackrate=i.codecParams.audio.opus.maxplaybackrate:"number"===typeof n.maxplaybackrate&&(e.maxplaybackrate=n.maxplaybackrate),"number"===typeof i.codecParams.audio.opus.minptime?e.minptime=i.codecParams.audio.opus.minptime:"number"===typeof n.minptime&&(e.minptime=n.minptime),e}()),Qs(t,"video",At.VP8,null,function(){var e={};return"number"===typeof i.codecParams.video.vp8.maxFr&&(e["max-fr"]=i.codecParams.video.vp8.maxFr),"number"===typeof i.codecParams.video.vp8.maxFs&&(e["max-fs"]=i.codecParams.video.vp8.maxFs),e}()),Qs(t,"video",At.VP9,null,function(){var e={};return"number"===typeof i.codecParams.video.vp9.maxFr&&(e["max-fr"]=i.codecParams.video.vp9.maxFr),"number"===typeof i.codecParams.video.vp9.maxFs&&(e["max-fs"]=i.codecParams.video.vp9.maxFs),e}()),Qs(t,"video",At.H264,null,function(){var e={};return"string"===typeof i.codecParams.video.h264.levelAsymmetryAllowed&&(e["profile-level-id"]=i.codecParams.video.h264.profileLevelId),"boolean"===typeof i.codecParams.video.h264.levelAsymmetryAllowed&&(e["level-asymmetry-allowed"]=i.codecParams.video.h264.levelAsymmetryAllowed),"boolean"===typeof i.codecParams.video.h264.packetizationMode&&(e["packetization-mode"]=i.codecParams.video.h264.packetizationMode),e}()),t.sdp},removeSDPFilteredCandidates:function(e,t,n){var r=Yd.getInitOptions(),i=Yd.getSkylinkState(n);return e===en.MCU&&t.type===ut.ANSWER&&"firefox"===window.webrtcDetectedBrowser&&(t.sdp=t.sdp.replace(/ generation 0/g,""),t.sdp=t.sdp.replace(/ udp /g," UDP ")),r.forceTURN&&i.hasMCU?(Xs.log.WARN([e,"RTCSessionDesription",t.type,"Not filtering ICE candidates as TURN connections are enforced as MCU is present (and act as a TURN itself) so filtering of ICE candidate flags are not honoured"]),t.sdp):(r.filterCandidatesType.host&&(Xs.log.INFO([e,"RTCSessionDesription",t.type,'Removing "host" ICE candidates.']),t.sdp=t.sdp.replace(/a=candidate:.*host.*\r\n/g,"")),r.filterCandidatesType.srflx&&(Xs.log.INFO([e,"RTCSessionDesription",t.type,'Removing "srflx" ICE candidates.']),t.sdp=t.sdp.replace(/a=candidate:.*srflx.*\r\n/g,"")),r.filterCandidatesType.relay&&(Xs.log.INFO([e,"RTCSessionDesription",t.type,'Removing "relay" ICE candidates.']),t.sdp=t.sdp.replace(/a=candidate:.*relay.*\r\n/g,"")),t.sdp)},setSDPCodec:function(e,t,n,r){var a=Yd.getInitOptions(n),o=function(n,r){var a="object"===typeof r?r.codec:r,o="object"===typeof r?r.samplingRate:null,s="object"===typeof r?r.channels:null;if(a!==i["audio"===n?"AUDIO_CODEC":"VIDEO_CODEC"].AUTO){var d=t.sdp.match(new RegExp("m="+n+" .*\r\n","gi"));if(Array.isArray(d)&&d.length>0){var c=function(r,i,c){if(Array.isArray(r)&&r.length>0){i||(o=null),c||(s=null),Xs.log.INFO([e,"RTCSessionDesription",t.type,'Preferring "'+a+'" (samplingRate: '+(o||"n/a")+", channels: "+(s||"n/a")+') for "'+n+'" streaming.']);var l=d[0],u=l.replace("\r\n","").split(" ");l=u[0]+" "+u[1]+" "+u[2]+" ",u.splice(0,3);for(var S=0;S<r.length;S+=1){var E=(r[S].split("a=rtpmap:")[1]||"").split(" ");E.length<2||(l+=E[0]+" ")}for(var g=0;g<u.length;g+=1)l.indexOf(" "+u[g])>0?(u.splice(g,1),g-=1):t.sdp.match(new RegExp("a=rtpmap:"+u[g]+" "+a+"/.*\r\n","gi"))&&(l+=u[g]+" ",u.splice(g,1),g-=1);return l+=u.join(" ")+"\r\n",t.sdp=t.sdp.replace(d[0],l),!0}};if(o){if("audio"===n&&s&&c(t.sdp.match(new RegExp("a=rtpmap:.* "+a+"/"+o+(1===s?"[/1]*":"/"+s)+"\r\n","gi")),!0,!0))return;if(c(t.sdp.match(new RegExp("a=rtpmap:.* "+a+"/"+o+"[/]*.*\r\n","gi")),!0))return}"audio"===n&&s&&c(t.sdp.match(new RegExp("a=rtpmap:.* "+a+"/.*/"+s+"\r\n","gi")),!1,!0)||c(t.sdp.match(new RegExp("a=rtpmap:.* "+a+"/.*\r\n","gi")))}else Xs.log.ERROR([e,"RTCSessionDesription",t.type,"Not preferring any codec for ".concat(n," streaming as m= line is not found.")])}else Xs.log.WARN([e,"RTCSessionDesription",t.type,"Not preferring any codec for ".concat(n," streaming. Using browser selection.")])};return o("audio",r?r.audio:a.audioCodec),o("video",r?r.video:a.videoCodec),t.sdp},setSDPBitrate:function(e,t,n){var r=Yd.getSkylinkState(n),i=t.sdp.split("\r\n"),a=function(n,r){var a=n,o=-1,s=-1;"data"===n&&(a="application");for(var d=0;d<i.length;d+=1)if(0===i[d].indexOf("m="+a))o=d;else if(o>0){if(0===i[d].indexOf("m="))break;0===i[d].indexOf("c=")?s=d:0!==i[d].indexOf("b=AS:")&&0!==i[d].indexOf("b:TIAS:")||(i.splice(d,1),d-=1)}"number"===typeof r&&r>0?-1!==s?(Xs.log.INFO([e,"RTCSessionDesription",t.type,"Limiting maximum sending ".concat(n," bandwidth ->")],r),i.splice(s+1,0,"firefox"===window.webrtcDetectedBrowser?"b=TIAS:"+(1e3*r*(window.webrtcDetectedVersion>52&&window.webrtcDetectedVersion<55?1e3:1)).toFixed(0):"b=AS:"+r)):Xs.log.ERROR([e,"RTCSessionDesription",t.type,"Failed setting ".concat(n," bandwidth as c-line is missing.")]):Xs.log.WARN([e,"RTCSessionDesription",t.type,"Not limiting ".concat(n," bandwidth")])},o=r.streamsBandwidthSettings.bAS.audio,s=r.streamsBandwidthSettings.bAS.video,d=r.streamsBandwidthSettings.bAS.data,c=r.streamsBandwidthSettings.googleX.min,l=r.streamsBandwidthSettings.googleX.max;if(r.peerCustomConfigs[e]&&(r.peerCustomConfigs[e].bandwidth&&"object"===typeof r.peerCustomConfigs[e].bandwidth&&("number"===typeof r.peerCustomConfigs[e].bandwidth.audio&&(o=r.peerCustomConfigs[e].bandwidth.audio),"number"===typeof r.peerCustomConfigs[e].bandwidth.video&&(s=r.peerCustomConfigs[e].bandwidth.video),"number"===typeof r.peerCustomConfigs[e].bandwidth.data&&(d=r.peerCustomConfigs[e].bandwidth.data)),r.peerCustomConfigs[e].googleXBandwidth&&"object"===typeof r.peerCustomConfigs[e].googleXBandwidth&&("number"===typeof r.peerCustomConfigs[e].googleXBandwidth.min&&(c=r.peerCustomConfigs[e].googleXBandwidth.min),"number"===typeof r.peerCustomConfigs[e].googleXBandwidth.max&&(l=r.peerCustomConfigs[e].googleXBandwidth.max))),a("audio",o),a("video",s),a("data",d),"number"===typeof c||"number"===typeof l){for(var u=null,S=-1,E=-1,g=0;g<i.length;g+=1)if(0===i[g].indexOf("m=video"))u=i[g].split(" ")[3];else if(u){if(0===i[g].indexOf("m="))break;if(0===i[g].indexOf("a=rtpmap:"+u+" "))S=g;else if(0===i[g].indexOf("a=fmtp:"+u+" ")){i[g]=i[g].replace(/x-google-(min|max)-bitrate=[0-9]*[;]*/gi,""),E=g;break}}if(S>-1){var p="";"number"===typeof c&&(p+="x-google-min-bitrate="+c+";"),"number"===typeof l&&(p+="x-google-max-bitrate="+l+";"),Xs.log.INFO([e,"RTCSessionDesription",t.type,"Limiting x-google-bitrate ->"],p),E>-1?i[E]+=(i[E].split(" ")[1]?";":"")+p:i.splice(S+1,0,"a=fmtp:"+u+" "+p)}}return i.join("\r\n")},removeSDPCodecs:function(e,t,n){var r=Yd.getSkylinkState(n),i=Hn.getCurrentSessionInfo(r.room).settings.audio,a=Yd.getInitOptions(),o=function(n,r){var i=t.sdp.match(new RegExp("a=rtpmap:(\\d*)\\ "+r+".*","gi"));if(Array.isArray(i)&&i.length>0)for(var a=0;a<i.length;a+=1){var o=i[a].split(" ")[0].split(":")[1];Xs.log.INFO([e,"RTCSessionDesription",t.type,'Removing "'+r+'" payload ->'],o),t.sdp=t.sdp.replace(new RegExp("a=rtpmap:"+o+"\\ .*\\r\\n","g"),""),t.sdp=t.sdp.replace(new RegExp("a=fmtp:"+o+"\\ .*\\r\\n","g"),""),t.sdp=t.sdp.replace(new RegExp("a=rtpmap:\\d+ rtx\\/\\d+\\r\\na=fmtp:\\d+ apt="+o+"\\r\\n","g"),"");for(var s=t.sdp.split("\r\n"),d=0;d<s.length;d+=1)if(0===s[d].indexOf("m="+n)){var c=s[d].split(" ");c.indexOf(o)>=3&&c.splice(c.indexOf(o),1),s[d]=c.join(" ");break}t.sdp=s.join("\r\n")}else Xs.log.WARN([e,"RTCSessionDesription",t.type,"Not removing ".concat(r," as it does not exists.")])};return a.disableVideoFecCodecs&&(r.hasMCU?Xs.log.WARN([e,"RTCSessionDesription",t.type,'Not removing "ulpfec" or "red" codecs as connected to MCU to prevent connectivity issues.']):(o("video","red"),o("video","ulpfec"))),a.disableComfortNoiseCodec&&i&&"object"===typeof i&&i.stereo&&o("audio","CN"),"edge"===window.webrtcDetectedBrowser&&"edge"!==(((r.peerInformations[e]||{}).agent||{}).name||"unknown").name&&(t.sdp=t.sdp.replace(/a=rtcp-fb:.*\ x-message\ .*\r\n/gi,"")),t.sdp},removeSDPREMBPackets:function(e,t){return Yd.getInitOptions().disableREMB?(Xs.log.INFO([e,"RTCSessionDesription",t.type,"Removing REMB packets."]),t.sdp.replace(/a=rtcp-fb:\d+ goog-remb\r\n/g,"")):t.sdp},handleSDPConnectionSettings:function(e,t,n,r){var i=Yd.getSkylinkState(n);if(!i.sdpSessions[e])return t.sdp;var a=t.sdp.split("\r\n"),o=((i.peerInformations[e]||{}).agent||{}).name||"",s=[],d=cn()(i.sdpSettings),c="",l=-1,u=-1;if(e===en.MCU&&(d.connection.audio=!0,d.connection.video=!0,d.connection.data=!0),i.hasMCU){var S=cn()(Hn.getPeerInfo(e,i.room)).settings||{};d.direction.audio.receive=e===en.MCU||!!S.audio,d.direction.audio.send=e===en.MCU,d.direction.video.receive=e===en.MCU||!!S.video,d.direction.video.send=e===en.MCU}if("remote"===r){var E=$s.getSDPCommonSupports(e,t,n);E.audio||(d.connection.audio=!1),E.video||(d.connection.video=!1)}i.sdpSessions[e][r].mLines=[],i.sdpSessions[e][r].bundleLine="",i.sdpSessions[e][r].connection={audio:null,video:null,data:null};for(var g=0;g<a.length;g+=1){if(0===a[g].indexOf("a=group:BUNDLE"))i.sdpSessions[e][r].bundleLine=a[g],l=g;else if(0===a[g].indexOf("m=")&&(c="application"===(c=(a[g].split("m=")[1]||"").split(" ")[0]||"")?"data":c,u+=1,i.sdpSessions[e][r].mLines[u]=a[g],!d.connection[c])){if(Xs.log.INFO([e,"RTCSessionDesription",t.type,"Removing rejected m=".concat(c," line ->")],a[g]),i.peerConnectionConfig.bundlePolicy===dt.MAX_BUNDLE&&l>-1&&0===u&&("remote"===r?t.type===ut.OFFER:t.type===ut.ANSWER)){Xs.log.WARN([e,"RTCSessionDesription",t.type,"Not removing rejected m='".concat(c," line ->")],a[g]),d.connection[c]=!0,["audio","video"].indexOf(c)>-1&&(d.direction[c].send=!1,d.direction[c].receive=!1);continue}if("edge"===window.webrtcDetectedBrowser){a.splice(g,1),g-=1;continue}if("remote"===r||t.type===ut.ANSWER){var p=a[g].split(" ");p[1]=0,a[g]=p.join(" ");continue}}if(c)if(d.connection[c]){if(0===a[g].indexOf("a=mid:"))s.push(a[g].split("a=mid:")[1]||"");else if(c&&["a=sendrecv","a=sendonly","a=recvonly"].indexOf(a[g])>-1){if(-1===["audio","video"].indexOf(c)){i.sdpSessions[e][r].connection.data=a[g];continue}if("local"===r)d.direction[c].send&&!d.direction[c].receive?a[g]=a[g].indexOf("send")>-1?"a=sendonly":"a=inactive":!d.direction[c].send&&d.direction[c].receive?a[g]=a[g].indexOf("recv")>-1?"a=recvonly":"a=inactive":d.direction[c].send||d.direction[c].receive||(a[g]="a=inactive"),i.hasMCU||"firefox"===window.webrtcDetectedBrowser||"firefox"!==o||t.type!==ut.OFFER||"a=recvonly"!==a[g]||(Xs.log.WARN([e,"RTCSessionDesription",t.type,"Overriding any original settings to receive only to send and receive to resolve chrome BUNDLE errors."]),a[g]="a=sendrecv",d.direction[c].send=!0,d.direction[c].receive=!0);else if(t.type===ut.ANSWER){var f=i.sdpSessions[e].local.connection[c];"a=sendonly"===f?a[g]=-1===["a=inactive","a=recvonly"].indexOf(a[g])?"a=sendonly"===a[g]?"a=inactive":"a=recvonly":a[g]:"a=recvonly"===f?a[g]=-1===["a=inactive","a=sendonly"].indexOf(a[g])?"a=recvonly"===a[g]?"a=inactive":"a=sendonly":a[g]:"a=inactive"===f&&(a[g]="a=inactive")}i.sdpSessions[e][r].connection[c]=a[g]}}else a.splice(g,1),g-=1;(a[g]||"").replace(/\n|\r|\s|\ /gi,"")||(a.splice(g,1),g-=1)}return l>-1&&(i.peerConnectionConfig.bundlePolicy===dt.MAX_BUNDLE?a[l]="a=group:BUNDLE "+s.join(" "):i.peerConnectionConfig.bundlePolicy===dt.NONE&&a.splice(l,1)),"edge"!==window.webrtcDetectedBrowser&&(a[a.length-1].replace(/\n|\r|\s/gi,"")?a.push(""):a[a.length-1]=""),Xs.log.INFO([e,"RTCSessionDesription",t.type,"Handling connection lines and direction ->"],d),a.join("\r\n")},removeSDPUnknownAptRtx:function(e,t){for(var n=t.sdp.split("m="),r=0;r<n.length;r+=1)n[r]=qs(n[r]),n[r]=zs(n[r]);return n.join("m=")},removeSDPFirefoxH264Pref:function(e,t){return Xs.log.INFO([e,"RTCSessionDesription",t.type,"Removing Firefox experimental H264 flag to ensure interopability reliability"]),t.sdp.replace(/a=fmtp:0 profile-level-id=0x42e00c;packetization-mode=1\r\n/g,"")},renderSDPOutput:function(e,t,n){var r=Yd.getSkylinkState(n),i=null,a=null;if(t&&t.sdp){if(!r.peerConnections[e])return t.sdp;r.peerConnections[e].localStream&&(i=r.peerConnections[e].localStream,a=r.peerConnections[e].localStreamId||r.peerConnections[e].localStream.id);var o=t.sdp.split("\r\n");if(i)for(var s="",d=0;d<o.length;d+=1)if(0===o[d].indexOf("m="))s=(o[d].split("m=")[1]||"").split(" ")[0]||"",s=-1===["audio","video"].indexOf(s)?"":s;else if(s)if(0===o[d].indexOf("a=msid:")){var c=o[d].split(" ");c[0]="a=msid:"+a,o[d]=c.join(" ")}else if(0===o[d].indexOf("a=ssrc:")){var l=null;if(o[d].indexOf(" msid:")>0?l=o[d].split(" msid:"):o[d].indexOf(" mslabel:")>0&&(l=o[d].split(" mslabel:")),l){var u=(l[1]||"").split(" ");u[0]=a,l[1]=u.join(" "),o[d].indexOf(" msid:")>0?o[d]=l.join(" msid:"):o[d].indexOf(" mslabel:")>0&&(o[d]=l.join(" mslabel:"))}}if(t.type===ut.ANSWER&&r.sdpSessions[e]){for(var S=-1,E=0;E<o.length;E+=1)if(0===o[E].indexOf("a=group:BUNDLE")&&r.sdpSessions[e].remote.bundleLine&&r.peerConnectionConfig.bundlePolicy===dt.MAX_BUNDLE)o[E]=r.sdpSessions[e].remote.bundleLine;else if(0===o[E].indexOf("m=")){S+=1;var g=o[E].split(" "),p=(r.sdpSessions[e].remote.mLines[S]||"").split(" ");g[0]&&p[0]&&g[0]!==p[0]&&(p[1]=0,Xs.log.INFO([e,"RTCSessionDesription",t.type,"Appending middle rejected m= line ->"],p.join(" ")),o.splice(E,0,p.join(" ")),E+=1,S+=1)}for(;r.sdpSessions[e].remote.mLines[S+1];){S+=1;var f=o.length;o[f-1].replace(/\s/gi,"")||(f-=1);var m=(r.sdpSessions[e].remote.mLines[S]||"").split(" ");m[1]=0,Xs.log.INFO([e,"RTCSessionDesription",t.type,"Appending later rejected m= line ->"],m.join(" ")),o.splice(f,0,m.join(" "))}}return"edge"!==window.webrtcDetectedBrowser||t.type!==ut.OFFER||o[o.length-1].replace(/\s/gi,"")||(Xs.log.INFO([e,"RTCSessionDesription",t.type,"Removing last empty space for Edge browsers"]),o.splice(o.length-1,1)),Xs.log.INFO([e,"RTCSessionDescription",t.type,"Formatted output ->"],o.join("\r\n")),o.join("\r\n")}},getSDPICECandidates:function(e,t,n){var r=window.RTCIceCandidate,i={host:[],srflx:[],relay:[]};return t&&t.sdp?(t.sdp.split("m=").forEach((function(e,t){if(0!==t){var n=((e.match(/a=mid:.*\r\n/gi)||[])[0]||"").replace(/a=mid:/gi,"").replace(/\r\n/,""),a=t-1;(e.match(/a=candidate:.*\r\n/gi)||[]).forEach((function(e){var t=(e.split(" ")[7]||"host").replace(/\r\n/g,"");i[t]=i[t]||[],i[t].push(new r({sdpMid:n,sdpMLineIndex:a,candidate:(e.split("a=")[1]||"").replace(/\r\n/g,"")}))}))}})),n||Xs.log.INFO([e,"RTCSessionDesription",t.type,"Parsing session description ICE candidates ->"],i),i):i},getSDPSelectedCodec:function(e,t,n,r){var i={name:null,implementation:null,clockRate:null,channels:null,payloadType:null,params:null};return t&&t.sdp?(t.sdp.split("m=").forEach((function(e,t){if(0!==t&&0===e.indexOf("".concat(n," "))){var r=(e.split("\r\n")[0]||"").split(" ");r.splice(0,3);var a=function(t){var n=e.match(new RegExp("a=rtpmap:".concat(r[t],".*\r\n"),"gi"));if(!n)return"continue";var a=((n[0]||"").replace(/\r\n/g,"").split(" ")[1]||"").split("/");return["red","ulpfec","telephone-event","cn","rtx"].indexOf(a[0].toLowerCase())>-1?"continue":(i.name=a[0],i.clockRate=parseInt(a[1],10)||0,i.channels=parseInt(a[2]||"1",10)||1,i.payloadType=parseInt(r[t],10),i.params="",(e.match(new RegExp("a=fmtp:".concat(r[t],".*\r\n"),"gi"))||[]).forEach((function(e){i.params+=e.replace(new RegExp("a=fmtp:".concat(r[t]),"gi"),"").replace(/ /g,"").replace(/\r\n/g,"")})),"break")};e:for(var o=0;o<r.length;o+=1){switch(a(o)){case"continue":continue;case"break":break e}}}})),r||Xs.log.INFO([e,"RTCSessionDesription",t.type,'Parsing session description "'.concat(n,'" codecs ->')],i),i):i},setOriginalDTLSRole:function(e,t,n){var r=e.room,i=t.type,a=t.sdp.match(/a=setup:([a-z]+)/);if(null===e.originalDTLSRole&&"offer"!==i&&a){var o=a[1];e.originalDTLSRole=n?{active:"passive",passive:"active"}[o]:o,Yd.setSkylinkState(e,r.id)}},modifyDTLSRole:function(e,t){var n=e.originalDTLSRole,r=t.type;return null===n||"offer"===r?t.sdp:(t.sdp=t.sdp.replace(/a=setup:[a-z]+/g,"a=setup:".concat(n)),t.sdp)},getTransceiverMid:function(e,t){var n={audio:[],video:[]};return e.sdp.split("m=").forEach((function(e,t){var r=e.split(/\n/),i=r[0].split(" ")[0];if("application"!==i&&0!==t)for(var a={},o=0;o<r.length;o+=1){if(r[o].match(/a=recvonly|a=sendonly|a=sendrecv|a=inactive/)){var s=r[o].split("=");a.direction=s[1].trim()}if(r[o].match(/a=mid:*/)&&(a.transceiverMid=r[o].split(/:/)[1].trim()),r[o].match(/a=msid:([\w|-|{]+)/)){var d=r[o].split(" "),c=d[0].split(/:/)[1].trim();a.streamId="-"===c?"":c,a.trackId=d[1].trim()}a.transceiverMid&&a.streamId&&a.trackId&&(n[i].push(a),a={})}})),t||Xs.log.INFO([null,"RTCSessionDesription",e.type,'Parsing session description "'.concat(e.type,'" transceivers ->')],n),n}},$s=function(){function e(){Object(o.a)(this,e)}return Object(s.a)(e,null,[{key:"getSDPCommonSupports",value:function(){return Zs.getSDPCommonSupports.apply(Zs,arguments)}},{key:"getCodecsSupport",value:function(){return Zs.getCodecsSupport.apply(Zs,arguments)}},{key:"setSDPCodecParams",value:function(){return Zs.setSDPCodecParams.apply(Zs,arguments)}},{key:"removeSDPFilteredCandidates",value:function(){return Zs.removeSDPFilteredCandidates.apply(Zs,arguments)}},{key:"setSDPCodec",value:function(){return Zs.setSDPCodec.apply(Zs,arguments)}},{key:"setSDPBitrate",value:function(){return Zs.setSDPBitrate.apply(Zs,arguments)}},{key:"removeSDPCodecs",value:function(){return Zs.removeSDPCodecs.apply(Zs,arguments)}},{key:"removeSDPREMBPackets",value:function(){return Zs.removeSDPREMBPackets.apply(Zs,arguments)}},{key:"handleSDPConnectionSettings",value:function(){return Zs.handleSDPConnectionSettings.apply(Zs,arguments)}},{key:"removeSDPUnknownAptRtx",value:function(){return Zs.removeSDPUnknownAptRtx.apply(Zs,arguments)}},{key:"getSDPCodecsSupport",value:function(){return Zs.getSDPCodecsSupport.apply(Zs,arguments)}},{key:"removeSDPFirefoxH264Pref",value:function(){return Zs.removeSDPFirefoxH264Pref.apply(Zs,arguments)}},{key:"renderSDPOutput",value:function(){return Zs.renderSDPOutput.apply(Zs,arguments)}},{key:"getSDPICECandidates",value:function(){return Zs.getSDPICECandidates.apply(Zs,arguments)}},{key:"getSDPSelectedCodec",value:function(){return Zs.getSDPSelectedCodec.apply(Zs,arguments)}},{key:"setOriginalDTLSRole",value:function(){return Zs.setOriginalDTLSRole.apply(Zs,arguments)}},{key:"modifyDTLSRole",value:function(){return Zs.modifyDTLSRole.apply(Zs,arguments)}},{key:"getTransceiverMid",value:function(){return Zs.getTransceiverMid.apply(Zs,arguments)}}]),e}(),ed=function(e){return"relay"===e?"relayed":"host"===e||e.indexOf("host")>-1?"local":"srflx"===e?"serverreflexive":"prflx"===e?"peerreflexive":e},td={parseSelectedCandidatePair:function(e,t,n,r,i,a,o){var s=e.peerBandwidth,d=e.peerStats,c=t.raw,l=t.selectedCandidatePair,u=window.AdapterJS,S=Object.keys(t.raw),E=null,g=null,p=null;if(u.webrtcDetectedBrowser===$t.CHROME)for(var f=0;f<S.length;f+=1)"transport"===c[S[f]].type&&(E=c[S[f]]);else u.webrtcDetectedBrowser===$t.FIREFOX&&(E={});if(E)for(var m=0;m<S.length;m+=1){var R=c[S[m]];if("candidate-pair"===R.type&&R.id===E.selectedCandidatePairId||"candidate-pair"===R.type&&R.selected){var h=R;g=h.localCandidateId,p=h.remoteCandidateId,l.id=h.id,l.writable=h.writable,l.priority=h.priority,l.nominated=h.nominated;var v=o?s[a][R.id]:d[a][R.id],I=parseInt(R.totalRoundTripTime||"0",10);l.totalRoundTripTime=I,l.roundTripTime=td.tabulateStats(v,R,"totalRoundTripTime");var O=parseInt(R.consentRequestsSent||"0",10);l.consentRequests.totalSent=O,l.consentRequests.sent=td.tabulateStats(v,R,"consentRequestsSent");var T=parseInt(R.requestsReceived||"0",10);l.requests.totalReceived=T,l.requests.received=td.tabulateStats(v,R,"requestsReceived");var A=parseInt(R.requestsSent||"0",10);l.requests.totalSent=A,l.requests.sent=td.tabulateStats(v,R,"requestsSent");var C=parseInt(R.responsesSent||"0",10);l.responses.totalSent=C,l.responses.sent=td.tabulateStats(v,R,"responsesSent");var _=parseInt(R.responsesReceived||"0",10);l.responses.totalReceived=_,l.responses.received=td.tabulateStats(v,R,"responsesReceived")}}if(g&&p){if("remote-candidate"===n){var N=r;N.id===p&&(l.remote.ipAddress=N.ip?N.ip:N.address,l.remote.portNumber=N.port,l.remote.transport=N.protocol,l.remote.priority=N.priority,l.remote.candidateType=ed(N.candidateType))}if("local-candidate"===n){var D=r;D.id===g&&(l.local.ipAddress=D.ip?D.ip:D.address,l.local.portNumber=D.port,l.local.transport=D.protocol,l.local.priority=D.priority,l.local.networkType=D.networkType,l.local.candidateType=ed(D.candidateType))}}},parseCertificates:function(e,t){for(var n=e.certificate,r=e.raw,i=Object.keys(e.raw),a=null,o=0;o<i.length;o+=1)"transport"===r[i[o]].type&&(a=r[i[o]]);if(a){n.srtpCipher=a.srtpCipher,n.dtlsCipher=a.dtlsCipher,n.tlsVersion=a.tlsVersion;var s=a,d=s.localCertificateId,c=s.remoteCertificateId;t.id===d?(n.local={},n.local.base64Certificate=t.base64Certificate,n.local.fingerprintAlgorithm=t.fingerprintAlgorithm):t.id===c&&(n.remote={},n.remote.base64Certificate=t.base64Certificate,n.remote.fingerprintAlgorithm=t.fingerprintAlgorithm)}},tabulateStats:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=t.timestamp,i=e&&e.timestamp||0,a=parseFloat(t[n]||"0",10),o=parseFloat(e&&e[n]||"0",10);return new Date(r).getTime()===new Date(i).getTime()?a:parseFloat(((a-o)/(r-i)*1e3).toFixed(3)||"0",10)},parseAudio:function(e,t,n,r,i,a,o){var s=e.peerBandwidth,d=e.peerStats,c=a?s[i][r.id]:d[i][r.id];switch(o){case"receiving":!function(e,t,n){var r=e.audio.receiving,i=parseInt(t.packetsReceived||"0",10);r.totalPackets=i,r.packets=td.tabulateStats(n,t,"packetsReceived");var a=parseInt(t.bytesReceived||"0",10);r.totalBytes=a,r.bytes=td.tabulateStats(n,t,"bytesReceived");var o=parseInt(t.packetsLost||"0",10);r.totalPacketsLost=o,r.packetsLost=td.tabulateStats(n,t,"packetsLost"),r.jitter=parseInt(t.jitter||"0",10),r.ssrc=t.ssrc;var s=t.trackId,d=e.raw[s];d&&(r.audioLevel=parseFloat(d.audioLevel).toFixed(5),r.totalSamplesReceived=parseInt(d.totalSamplesReceived||"0",10),r.totalSamplesDuration=parseInt(d.totalSamplesDuration||"0",10))}(t,r,c);break;case"sending":!function(e,t,n){var r=e.audio.sending;if(t.bytesSent){var i=parseInt(t.bytesSent||"0",10);r.totalBytes=i,r.bytes=td.tabulateStats(n,t,"bytesSent")}if(t.packetsSent){var a=parseInt(t.packetsSent||"0",10);r.totalPackets=a,r.packets=td.tabulateStats(n,t,"packetsSent")}if(t.retransmittedBytesSent||fs(t.retransmittedBytesSent)){var o=parseInt(t.retransmittedBytesSent||"0",10);r.totalRetransmittedBytesSent=o,r.retransmittedBytesSent=td.tabulateStats(n,t,"retransmittedBytesSent")}if(t.retransmittedPacketsSent||fs(t.retransmittedPacketsSent)){var s=parseInt(t.retransmittedPacketsSent||"0",10);r.totalRetransmittedPacketsSent=s,r.retransmittedPacketsSent=td.tabulateStats(n,t,"retransmittedPacketsSent")}r.ssrc=t.ssrc,t.jitter&&(r.jitter=parseInt(t.jitter||"0",10)),t.roundTripTime&&(r.roundTripTime=parseInt(t.roundTripTime||"0",10));var d=t.trackId,c=t.mediaSourceId,l=e.raw[d];l&&(r.echoReturnLoss=parseInt(l.echoReturnLoss||"0",10),r.echoReturnLossEnhancement=parseInt(l.echoReturnLossEnhancement||"0",10));var u=e.raw[c];u&&(r.audioLevel=parseFloat(u.audioLevel).toFixed(5),r.totalSamplesDuration=parseInt(u.totalSamplesDuration||"0",10))}(t,r,c);break;default:Xs.log.DEBUG([i,Ht.STATS_MODULE,null,on.STATS_MODULE.ERRORS.PARSE_FAILED])}},parseVideo:function(e,t,n,r,i,a,o){var s=e.peerBandwidth,d=e.peerStats,c=a?s[i][r.id]:d[i][r.id];switch(o){case"receiving":!function(e,t,n){var r=e.video.receiving;if(t.bytesReceived){var i=parseInt(t.bytesReceived||"0",10);r.totalBytes=i,r.bytes=td.tabulateStats(n,t,"bytesReceived")}if(t.packetsReceived){var a=parseInt(t.packetsReceived||"0",10);r.totalPackets=a,r.packets=td.tabulateStats(n,t,"packetsReceived")}if(Number.isInteger(t.packetsLost)){var o=parseInt(t.packetsLost||"0",10);r.totalPacketsLost=o,r.packetsLost=td.tabulateStats(n,t,"packetsLost")}if(Number.isInteger(t.firCount)){var s=parseInt(t.firCount||"0",10);r.totalFirs=s,r.firs=td.tabulateStats(n,t,"firCount")}if(Number.isInteger(t.nackCount)){var d=parseInt(t.nackCount||"0",10);r.totalNacks=d,r.nacks=td.tabulateStats(n,t,"nackCount")}if(t.pliCount||Number.isInteger(t.pliCount)){var c=parseInt(t.pliCount||"0",10);r.totalPlis=c,r.plis=td.tabulateStats(n,t,"pliCount")}r.ssrc=t.ssrc,r.qpSum=parseInt(t.qpSum||"0",10),r.decoderImplementation=t.decoderImplementation;var l=t.trackId,u=e.raw[l];u&&(r.framesDropped=parseFloat(u.framesDropped||"0"),r.frames=parseInt(u.framesReceived||"0",10),r.framesDecoded=parseInt(u.framesDecoded||"0",10),r.frameWidth=parseInt(u.frameWidth||"0",10),r.frameHeight=parseInt(u.frameHeight||"0",10))}(t,r,c);break;case"sending":!function(e,t,n){var r=e.video.sending;if(t.bytesSent){var i=parseInt(t.bytesSent||"0",10);r.totalBytes=i,r.bytes=td.tabulateStats(n,t,"bytesSent")}if(t.packetsSent){var a=parseInt(t.packetsSent||"0",10);r.totalPackets=a,r.packets=td.tabulateStats(n,t,"packetsSent")}if(Number.isInteger(t.firCount)){var o=parseInt(t.firCount||"0",10);r.totalFirs=o,r.firs=td.tabulateStats(n,t,"firCount")}if(Number.isInteger(t.nackCount)){var s=parseInt(t.nackCount||"0",10);r.totalNacks=s,r.nacks=td.tabulateStats(n,t,"nackCount")}if(Number.isInteger(t.pliCount)){var d=parseInt(t.pliCount||"0",10);r.totalPlis=d,r.plis=td.tabulateStats(n,t,"pliCount")}t.jitter&&(r.jitter=parseInt(t.jitter||"0",10)),t.roundTripTime&&(r.roundTripTime=parseInt(t.roundTripTime||"0",10)),Number.isInteger(t.framesEncoded)&&(r.framesEncoded=parseInt(t.framesEncoded||"0",10)),r.ssrc=t.ssrc,r.qpSum=parseInt(t.qpSum||"0",10);var c=t.trackId,l=t.mediaSourceId,u=e.raw[c];u&&(r.frameWidth=parseInt(u.frameWidth||"0",10),r.frameHeight=parseInt(u.frameHeight||"0",10),r.frames=parseInt(u.framesSent||"0",10),r.hugeFramesSent=parseInt(u.hugeFramesSent||"0",10));var S=e.raw[l];S&&(r.framesPerSecond=parseInt(S.framesPerSecond||"0",10))}(t,r,c);break;default:Xs.log.DEBUG([i,Ht.STATS_MODULE,null,on.STATS_MODULE.ERRORS.PARSE_FAILED])}},parseMedia:function(e,t,n,r,i,a,o,s){var d=r.kind||r.mediaType;d===Yt.AUDIO?td.parseAudio(e,t,n,r,a,o,s):d===Yt.VIDEO?td.parseVideo(e,t,n,r,a,o,s):Xs.log.DEBUG([(void 0).peerId,Ht.STATS_MODULE,null,on.STATS_MODULE.INVALID_TRACK_KIND],r)}},nd=function(){function e(t,n){Object(o.a)(this,e),this.roomState=Yd.getSkylinkState(t),this.peerConnection=this.roomState.peerConnections[n]||null,this.peerConnStatus=this.roomState.peerConnStatus[n]||null,this.dataChannel=this.roomState.dataChannels[n]||null,this.peerId=n,this.roomKey=t,this.output={peerId:n,raw:{},connection:{},audio:{sending:{},receiving:{}},video:{sending:{},receiving:{}},selectedCandidatePair:{id:null,local:{},remote:{},consentRequests:{},responses:{},requests:{}},certificate:{}},this.beSilentOnLogs=Yd.getInitOptions().beSilentOnStatsLogs,this.beSilentOnParseLogs=Yd.getInitOptions().beSilentOnParseLogs,this.isAutoBwStats=!1,this.bandwidth=null}return Object(s.a)(e,[{key:"getConnectionStatus",value:function(){return this.getStatistics(!1,!1)}},{key:"getStatsSuccess",value:function(e,t,n){var r=this,i=window.AdapterJS;if(n||i.webrtcDetectedBrowser!==$t.REACT_NATIVE){var a=this.roomState,o=a.peerBandwidth,s=a.peerStats,d=a.room;"function"===typeof n.forEach?n.forEach((function(e,t){r.output.raw[t]=e})):this.output.raw=n;try{if(us(s))return void Xs.log.DEBUG([this.peerId,Ht.STATS_MODULE,null,on.STATS_MODULE.STATS_DISCARDED]);Object.entries(this.output.raw).forEach((function(e){var t=e[0],n=e[1],i=n.type;switch(i){case"remote-inbound-rtp":case"outbound-rtp":case"inbound-rtp":"inbound-rtp"===i?td.parseMedia(r.roomState,r.output,i,n,r.peerConnection,r.peerId,r.isAutoBwStats,"receiving"):td.parseMedia(r.roomState,r.output,i,n,r.peerConnection,r.peerId,r.isAutoBwStats,"sending");break;case"certificate":td.parseCertificates(r.output,n);break;case"local-candidate":case"remote-candidate":case"media-source":td.parseSelectedCandidatePair(r.roomState,r.output,i,n,r.peerConnection,r.peerId,r.isAutoBwStats)}r.isAutoBwStats&&!o[r.peerId][t]?o[r.peerId][t]=r.output.raw[t]:r.isAutoBwStats||s[r.peerId][t]||(s[r.peerId][t]=r.output.raw[t]),Yd.setSkylinkState(r.roomState,d.id)}))}catch(c){this.getStatsFailure(t,on.STATS_MODULE.ERRORS.PARSE_FAILED,c)}Bs(Ue({state:ot.RETRIEVE_SUCCESS,peerId:this.peerId,stats:this.output})),e(this.output)}else e(this.output)}},{key:"getStatsFailure",value:function(e,t,n){var r=t||on.STATS_MODULE.RETRIEVE_STATS_FAILED;this.beSilentOnLogs||(Xs.log.ERROR([this.peerId,Ht.STATS_MODULE,null,r],n),Bs(Ue({state:ot.RETRIEVE_ERROR,peerId:this.peerId,error:n}))),e(n)}},{key:"getStatistics",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=on.STATS_MODULE;return new Promise((function(i,a){if(e.roomState.peerStats[e.peerId]||n){e.beSilentOnLogs=t,e.isAutoBwStats=n;try{e.gatherRTCPeerConnectionDetails(),e.gatherSDPIceCandidates(),e.gatherSDPCodecs(),e.gatherRTCDataChannelDetails()}catch(o){Xs.log.WARN([e.peerId,Ht.STATS_MODULE,null,on.STATS_MODULE.ERRORS.PARSE_FAILED],o)}"function"!==typeof e.peerConnection.getStats&&e.getStatsFailure(a,on.PEER_CONNECTION.getstats_api_not_available),Bs(Ue({state:ot.RETRIEVING,peerId:e.peerId})),e.peerConnection.getStats().then((function(t){e.getStatsSuccess(i,a,t)})).catch((function(t){t.message!==on.STATS_MODULE.ERRORS.STATS_IS_NULL?e.getStatsFailure(a,null,t):Xs.log.WARN([e.peerId,Ht.STATS_MODULE,null,on.STATS_MODULE.ERRORS.RETRIEVE_STATS_FAILED],t.message)}))}else Xs.log.WARN(r.NOT_INITIATED),i(null)}))}},{key:"gatherRTCPeerConnectionDetails",value:function(){var e=this.peerConnection;this.output.connection.iceConnectionState=e.iceConnectionState,this.output.connection.iceGatheringState=e.iceGatheringState,this.output.connection.signalingState=e.signalingState,this.output.connection.remoteDescription={type:e.remoteDescription&&e.remoteDescription.type||"",sdp:e.remoteDescription&&e.remoteDescription.sdp||""},this.output.connection.localDescription={type:e.localDescription&&e.localDescription.type||"",sdp:e.localDescription&&e.localDescription.sdp||""},this.output.connection.constraints=this.peerConnStatus?this.peerConnStatus.constraints:null,this.output.connection.optional=this.peerConnStatus?this.peerConnStatus.optional:null,this.output.connection.sdpConstraints=this.peerConnStatus?this.peerConnStatus.sdpConstraints:null}},{key:"gatherSDPIceCandidates",value:function(){var e=this.peerConnection,t=this.beSilentOnParseLogs;this.output.connection.candidates={sending:$s.getSDPICECandidates(this.peerId,e.localDescription,t),receiving:$s.getSDPICECandidates(this.peerId,e.remoteDescription,t)}}},{key:"gatherSDPCodecs",value:function(){var e=this.peerConnection,t=this.beSilentOnParseLogs;this.output.audio.sending.codec=$s.getSDPSelectedCodec(this.peerId,e.remoteDescription,"audio",t),this.output.video.sending.codec=$s.getSDPSelectedCodec(this.peerId,e.remoteDescription,"video",t),this.output.audio.receiving.codec=$s.getSDPSelectedCodec(this.peerId,e.localDescription,"audio",t),this.output.video.receiving.codec=$s.getSDPSelectedCodec(this.peerId,e.localDescription,"video",t)}},{key:"gatherRTCDataChannelDetails",value:function(){var e=this,t=this.dataChannel;if(t){var n=Object.keys(t);this.output.connection.dataChannels={},n.forEach((function(n){var r=t[n];e.output.connection.dataChannels[r.channel.label]={label:r.channel.label,readyState:r.channel.readyState,channelType:Je["main"===n?"MESSAGING":"DATA"],currentTransferId:r.transferId||null,currentStreamId:r.streamId||null}}))}}}]),e}(),rd=function(e){for(var t=e.peerMedias,n=e.user,r={},i=Object.keys(t).filter((function(e){return e!==n.sid})),a=function(e){var n=i[e];Object.values(t[n]).forEach((function(e){e.mediaType===Wt.VIDEO_SCREEN&&(r[n]=e.streamId)}))},o=0;o<i.length;o+=1)a(o);return r},id=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=!0;Ln.prepStopStreams(e.id,t.id,r,i).then((function(){return Xs.log.DEBUG([n,Ht.MEDIA_STREAM,null,"".concat(on.MEDIA_STREAM.STOP_SCREEN_SUCCESS)])})).catch((function(e){return Xs.log.DEBUG([n,Ht.MEDIA_STREAM,null,"".concat(on.MEDIA_STREAM.ERRORS.STOP_SCREEN)],e)}))},ad={handleScreenStreamStates:{addScreenStreamToState:function(e,t){var n=e.room,r=e.user,i=ls.parseStreamSettings({video:!0});ls.processStreamInState(t,i,n.id,!0,!1),Bs(he({stream:t,peerId:r.sid,room:n,isSelf:!0,peerInfo:Hn.getCurrentSessionInfo(n),streamId:t.id,isVideo:t.getVideoTracks().length>0,isAudio:t.getAudioTracks().length>0}))},removeScreenStreamFromState:function(e){var t=e.room;e.streams.screenshare=null,Yd.setSkylinkState(e,t.id)},setScreenStateToUnavailable:function(e,t){var n=e.user,r=e.room,i=Vo.retrieveMediaId(Yt.VIDEO,t.id);Vo.setMediaStateToUnavailable(r,n.sid,i)}},addScreenStreamCallbacks:function(e,t){t.getTracks().forEach((function(n){n.onended=function(){return id(e.room,t,e.user.sid)}}))},retrievePeersScreenStreamId:rd,retrievePeerScreenStream:function(e){var t=e.remoteStreams,n=rd(e);if(us(n))return null;var r={};return Object.keys(n).forEach((function(e){var i=Object.values(t[e]);r[e]=i.filter((function(t){return t.id===n[e].id}))})),r},stopScreenStream:id},od=function(){function e(){Object(o.a)(this,e)}return Object(s.a)(e,null,[{key:"addPeer",value:function(e){Ka.addPeer(e)}},{key:"createOffer",value:function(){return Ka.createOffer.apply(Ka,arguments)}},{key:"createAnswer",value:function(){return Ka.createAnswer.apply(Ka,arguments)}},{key:"createDataChannel",value:function(){return Ka.createDataChannel.apply(Ka,arguments)}},{key:"sendP2PMessage",value:function(){return Ka.sendP2PMessage.apply(Ka,arguments)}},{key:"getPeersInRoom",value:function(){return Ka.getPeersInRoom.apply(Ka,arguments)}},{key:"retrieveStatistics",value:function(e,t,n,r){return new nd(e,t).getStatistics(n,r)}},{key:"signalingEndOfCandidates",value:function(){return Ka.signalingEndOfCandidates.apply(Ka,arguments)}},{key:"getConnectionStatus",value:function(e,t){return Ka.getConnectionStatus(e,t)}},{key:"getDataChannelBuffer",value:function(e){return Ka.getDataChannelBuffer(e)}},{key:"refreshDataChannel",value:function(e,t){return Ka.refreshDataChannel(e,t)}},{key:"closeDataChannel",value:function(e,t){return Ka.closeDataChannel(e,t)}},{key:"refreshConnection",value:function(e,t,n,r,i){return Ka.refreshConnection(e,t,n,r,i)}},{key:"refreshPeerConnection",value:function(e,t,n,r){return Ka.refreshPeerConnection(e,t,n,r)}},{key:"getPeerScreenshare",value:function(e){return ad.retrievePeerScreenStream(e)}},{key:"buildPeerInformations",value:function(){return Ka.buildPeerInformations.apply(Ka,arguments)}},{key:"closePeerConnection",value:function(e,t){return Ka.closePeerConnection(e,t)}},{key:"updatePeerInformationsMediaStatus",value:function(e,t,n,r){return Ka.updatePeerInformationsMediaStatus(e,t,n,r)}}]),e}(),sd={},dd=function(){function e(t){Object(o.a)(this,e);var n=t.room;if(sd[n.id])return sd[n.id];this.roomState=t,this.stream=null,this.signaling=new Bo,this.isReplace=null,this.streamId=null,sd[n.id]=this}return Object(s.a)(e,[{key:"streamExists",value:function(){for(var e=ls.getStreams(this.roomState,this.roomState.room.name),t=Object.keys(e.userMedia),n=0;n<t.length;n+=1)if(t[n]===this.streamId)return!0;return!1}},{key:"hasMoreThanOneVideoStream",value:function(){return ls.retrieveVideoStreams(this.roomState.room).length>1}},{key:"hasUserMediaStream",value:function(){return this.roomState.streams.userMedia}},{key:"start",value:function(e){var t,n=arguments;return f.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>1&&void 0!==n[1]?n[1]:null,this.isReplace=!1,this.streamId=t,e.prev=3,this.checkForExistingScreenStreams(),this.checksForReplaceScreen(),e.next=8,f.a.awrap(this.startScreenCapture());case 8:if(this.stream=e.sent,this.stream){e.next=12;break}return this.deleteScreensharingInstance(this.roomState.room),e.abrupt("return",null);case 12:ad.handleScreenStreamStates.addScreenStreamToState(this.roomState,this.stream,this.isReplace),ad.addScreenStreamCallbacks(this.roomState,this.stream),this.isReplace?this.replaceUserMediaStream():this.addScreenshareStream(),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),Xs.log.ERROR([this.roomState.user.sid,Ht.MEDIA_STREAM,null,on.MEDIA_STREAM.ERRORS.REPLACE_SCREEN],e.t0);case 20:return e.abrupt("return",this.stream);case 21:case"end":return e.stop()}}),null,this,[[3,17]])}},{key:"stop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.stream)return Xs.log.DEBUG([this.roomState.user.sid,Ht.MEDIA_STREAM,null,"".concat(on.MEDIA_STREAM.ERRORS.STOP_SCREEN," - ").concat(on.MEDIA_STREAM.ERRORS.NO_STREAM)]),null;try{ad.stopScreenStream(this.roomState.room,this.stream,this.roomState.user.sid,e),this.isReplace=null,this.streamId=null,this.stream=null}catch(t){Xs.log.ERROR([this.roomState.user.sid,Ht.MEDIA_STREAM,null,"".concat(on.MEDIA_STREAM.ERRORS.STOP_SCREEN)],t)}return null}},{key:"startScreenCapture",value:function(){var e=window.navigator;return e.mediaDevices.getDisplayMedia?e.mediaDevices.getDisplayMedia({video:!0}).then((function(e){return e})).catch((function(e){return"NotAllowedError"===e.name?Xs.log.WARN(e):Xs.log.ERROR(e),null})):e.mediaDevices.getUserMedia({video:{mediaSource:"screen"}}).then((function(e){return e})).catch((function(e){return Xs.log.ERROR(e),null}))}},{key:"checksForReplaceScreen",value:function(){if(this.isReplace){if(!this.hasUserMediaStream())throw new Error(on.MEDIA_STREAM.ERRORS.NO_USER_MEDIA_STREAMS);if(this.hasMoreThanOneVideoStream()&&!this.streamId)throw new Error(on.MEDIA_STREAM.ERRORS.NO_STREAM_ID);if(this.streamId&&!hs(this.streamId))throw new Error(on.MEDIA_STREAM.ERRORS.INVALID_STREAM_ID_TYPE);if(this.streamId&&!this.streamExists())throw new Error("".concat(on.MEDIA_STREAM.ERRORS.INVALID_STREAM_ID," - ").concat(this.streamId))}}},{key:"checkForExistingScreenStreams",value:function(){var e=ad.retrievePeersScreenStreamId(this.roomState);us(e)||Xs.log.WARN([this.roomState.user.sid,Ht.MEDIA_STREAM,null,on.MEDIA_STREAM.ERRORS.PEER_SCREEN_ACTIVE])}},{key:"replaceUserMediaStream",value:function(){var e=this,t=this.roomState,n=t.peerConnections,r=t.streams,i=Object.keys(n),a=this.streamId?r.userMedia[this.streamId].stream:ls.retrieveVideoStreams(this.roomState.room)[0],o=this.stream;this.streamId=a.id,function(e,t,n,r){for(var i=n.streams,a=n.room,o=Object.values(i.userMedia),s=0;s<o.length;s+=1)o[s].id===e.id&&(o[s].isReplaced=r,o[s].newStream=t);Yd.setSkylinkState(n,a.id)}(a,o,this.roomState,!0),i.forEach((function(t){ls.replaceTrack(a,o,t,e.roomState)}))}},{key:"addScreenshareStream",value:function(){var e=this,t=this.roomState.peerConnections;us(t)||od.refreshConnection(this.roomState).catch((function(t){return Xs.log.ERROR([e.roomState.user.sid,Ht.MEDIA_STREAM,null,on.MEDIA_STREAM.ERRORS.START_SCREEN],t)}))}},{key:"deleteScreensharingInstance",value:function(e){delete sd[e.id]}},{key:"isReplaceScreenStream",value:function(){return this.isReplace}}]),e}(),cd=null,ld=function(){function e(){return Object(o.a)(this,e),cd||(cd=this),this.states={},cd}return Object(s.a)(e,[{key:"setState",value:function(e){this.states[e.room.id]=e}},{key:"getAllStates",value:function(){return this.states}},{key:"getState",value:function(e){return this.states[e]}},{key:"removeStateByRoomId",value:function(e){return delete this.states[e]}},{key:"clearRoomStateFromSingletons",value:function(e){var t=this.getState(e);new dd(t).deleteScreensharingInstance(t.room),jr.deleteAsyncInstance(t.room),br.deleteEncryptedInstance(t.room)}}]),e}(),ud=function(){function e(){Object(o.a)(this,e)}return Object(s.a)(e,null,[{key:"shouldProceed",value:function(e,t,n){var r=null;return e.isPrivileged||(r=on.PEER_PRIVILEGED.not_privileged),t||(r=on.PEER_PRIVILEGED.no_appkey),r&&(Xs.log.DEBUG(r),n(new Error(r))),!r}},{key:"getPeerList",value:function(e,t){var n=this;return new Promise((function(r,a){try{var o=Yd.getSkylinkState(e.id),s=Yd.getInitOptions(),d=t||!1;n.shouldProceed(o,s.appKey,a)&&((new Bo).getPeerList(d),Bs(we({state:St.ENQUIRED,privilegePeerId:o.user.sid,peerList:null})),Xs.log.INFO(on.PEER_PRIVILEGED.getPeerListFromServer),Gs(i.EVENTS.GET_PEERS_STATE_CHANGE,(function e(t){var n=t.detail;n.state===St.DISPATCHED&&(Fs(i.EVENTS.GET_PEERS_STATE_CHANGE,e),Bs(we({state:St.RECEIVED,privilegePeerId:o.user.sid,peerList:n.peerList})),r(n.peerList))})))}catch(c){Xs.log.ERROR(c),a(c)}}))}}]),e}(),Sd=n(166),Ed={defaultRoom:(new Date).valueOf(),appKey:null,roomServer:"//api.temasys.io",enableDataChannel:!0,enableSTUNServer:!0,enableTURNServer:!0,socketServerPath:null,enableStatsGathering:!0,audioFallback:!0,socketTimeout:7e3,apiTimeout:4e3,forceTURNSSL:!1,forceTURN:!1,forceSSL:!0,usePublicSTUN:!1,disableVideoFecCodecs:!1,disableComfortNoiseCodec:!1,disableREMB:!1,throttleShouldThrowError:!1,mcuUseRenegoRestart:!0,useEdgeWebRTC:!1,enableSimultaneousTransfers:!0,TURNServerTransport:it.ANY,credentials:null,filterCandidatesType:{host:!1,srflx:!1,relay:!1},throttleIntervals:{shareScreen:1e4,refreshConnection:5e3,getUserMedia:0},iceServer:null,socketServer:null,audioCodec:Ct.AUTO,videoCodec:At.AUTO,codecParams:{audio:{opus:{stereo:null,"sprop-stereo":null,usedtx:null,useinbandfec:null,maxplaybackrate:null,minptime:null}},video:{h264:{profileLevelId:null,levelAsymmetryAllowed:null,packetizationMode:null},vp8:{maxFs:null,maxFr:null},vp9:{maxFs:null,maxFr:null}}},beSilentOnStatsLogs:!1,beSilentOnParseLogs:!1},gd=function(){function e(t){Object(o.a)(this,e),this.id=t.room_key,this.token=t.roomCred,this.startDateTime=t.start,this.duration=t.len,this.roomName=t.roomName,this.connection={peerConstraints:JSON.parse(t.pc_constraints),offerConstraints:JSON.parse(t.offer_constraints),sdpConstraints:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},peerConfig:{iceServers:[]},mediaConstraints:JSON.parse(t.media_constraints)}}return Object(s.a)(e,[{key:"getRoomKey",value:function(){return this.id}},{key:"getRoomName",value:function(){return this.roomName}}]),e}(),pd=function e(t){Object(o.a)(this,e),this.uid=t.username,this.token=t.userCred,this.timeStamp=t.timeStamp,this.info={},this.sid=null,this.bufferMessage=null},fd=function e(t){Object(o.a)(this,e);var n=t.offer_constraints,r=t.pc_constraints,i=t.cid,a=t.apiOwner,s=t.ipSigserver,d=t.isPrivileged,c=t.autoIntroduce,l=t.httpPortList,u=t.httpsPortList,S=t.hasMCU,E=t.ipSigserverPath,g=t.hasPersistentMessage;n||r||Xs.log.ERROR(["API",null,"init","pc_constraints or offer_constraints are null"]),Xs.log.DEBUG(["API",null,"init","Parsed Peer Connection constraints:"],JSON.parse(r)),Xs.log.DEBUG(["API",null,"init","Parsed Offer constraints"],JSON.parse(n)),this.key=i,this.appKeyOwner=a,this.isPrivileged=d,this.autoIntroduce=c,this.room=new gd(t),this.user=new pd(t),this.hasMCU=S,this.socketServer=s,this.socketServerPath=E,this.socketPorts={"http:":Array.isArray(l)&&l.length>0?l:[80,3e3],"https:":Array.isArray(u)&&u.length>0?u:[443,3443]},this.hasPersistentMessage=g},md=function(e){var t=e.roomServer,n=e.appKey,r=e.defaultRoom,i=e.credentials,a=e.forceSSL,o="".concat(t,"/api/").concat(n,"/").concat(r),s="?";if(o=a?"https:".concat(o):"".concat(window.location.protocol).concat(o),i){var d=i.startDateTime,c=i.duration;o+="/".concat(d,"/").concat(c,"?cred=").concat(i.credentials),s="&"}return o+="".concat(s,"rand=").concat(Date.now())},Rd=function(e){var t=e.appKey,n={isValid:!0,message:""};return Xs.log.INFO(["API",null,"init","API initialised with options:"],e),t||(n.isValid=!1,n.message=on.INIT.ERRORS.NO_APP_KEY,Bs(Ce({readyState:ft.ERROR,error:{status:-2,content:new Error(on.INIT.ERRORS.NO_APP_KEY),errorCode:mt.NO_PATH},room:null}))),n.isValid||Xs.log.ERROR(["API",null,"init",n.message]),n},hd=function(e){var t=e.ok;return function(e){var t=e.status,n=e.ok,r=n?"INFO":"ERROR",i=on.INIT.INFO.API_SUCCESS;n||(i=on.INIT.ERRORS.AUTH_GENERAL,403===t&&(i=on.INIT.ERRORS.AUTH_CORS)),Xs.log[r](["API",null,"auth",i],e)}(e),t},vd=function(e){var t=e;return!0===t.forceTURN&&(t.enableTURNServer=!0,t.enableSTUNServer=!1,t.filterCandidatesType.host=!0,t.filterCandidatesType.srflx=!0,t.filterCandidatesType.relay=!1),t},Id=function(){var e=window.AdapterJS,t={ready:!0,message:""};return function(){try{var e=new window.RTCPeerConnection(null);return["object","function"].indexOf(typeof e.createOffer)>-1&&null!==e.createOffer}catch(t){return!1}}()||(window.RTCPeerConnection&&"plugin"===e.webrtcDetectedType?t.message="Plugin is not available. Please check plugin status.":t.message="WebRTC not supported. Please upgrade your browser",t.ready=!1,Bs(Ce({readyState:ft.ERROR,error:{status:-2,content:new Error("plugin"===e.webrtcDetectedType&&window.RTCPeerConnection?"Plugin is not available":"WebRTC not available"),errorCode:mt.NO_WEBRTC_SUPPORT},room:null}))),t},Od=null,Td=function(){function e(){return Object(o.a)(this,e),Od||(Od=this),this.options={},Od}return Object(s.a)(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ed;e&&(e.socketServer&&(e.socketServerPath=""),Yd.setUserInitOptions(e)),Bs(Ce({readyState:ft.INIT,error:null,room:null}));var t=Wr(),n=window,r=n.AdapterJS;if(!t.fulfilled)throw Bs(Ce({readyState:ft.ERROR,error:{status:-2,content:new Error(t.message),errorCode:t.readyStateChangeErrorCode},room:null})),new Error(t.message);var i=Object.assign({},Ed,e),a=Rd(i);if(!a.isValid)throw new Error(a.message);return r.webRTCReady((function(){var e=Id();if(!e.ready)throw new Error(e.message)})),i=vd(i)}},{key:"createRoom",value:function(e){return new Promise((function(t,n){var r=Yd.getInitOptions();r.defaultRoom=e,function(e){var t,n,r,i;return f.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t=window,n=t.fetch,r=md(e),a.next=4,f.a.awrap(n(r,{headers:{Skylink_SDK_type:qt.WEB,Skylink_SDK_version:Qt,Skylink_API_version:zt,"X-Server-Select":Zt}}));case 4:return i=a.sent,a.abrupt("return",{endpoint:r,response:i});case 6:case"end":return a.stop()}}))}(r).then((function(r){var i=r.endpoint,a=r.response;hd(a)?(Bs(Ce({readyState:ft.COMPLETED,error:null,room:e})),a.json().then((function(e){t({endpoint:i,response:e})}))):(Bs(Ce({readyState:ft.ERROR,error:{status:a.status,content:new Error(a.info||"XMLHttpRequest status not OK\nStatus was: ".concat(a.status)),errorCode:a.error||a.status},room:e})),n(a.json()))})).catch((function(t){Bs(Ce({readyState:ft.ERROR,error:{status:t.status||-1,content:new Error(t.message||"Network error occurred"),errorCode:mt.XML_HTTP_REQUEST_ERROR},room:e}))}))}))}},{key:"checkCodecSupport",value:function(e){return function(e){return new Promise((function(t,n){$s.getCodecsSupport(e).then((function(r){var i=Yd.getSkylinkState(e),a=i.room;0===Object.keys(r.audio).length&&0===Object.keys(r.video).length?(Xs.log.ERROR(on.JOIN_ROOM.ERRORS.CODEC_SUPPORT),Bs(Ce({readyState:ft.ERROR,error:{status:-2,content:new Error(on.JOIN_ROOM.ERRORS.CODEC_SUPPORT),errorCode:mt.PARSE_CODECS},room:a.roomName})),n(new Error(on.JOIN_ROOM.ERRORS.CODEC_SUPPORT))):t(!0),i.currentCodecSupport=r,Yd.setSkylinkState(i)})).catch((function(t){var r=Yd.getSkylinkState(e).room;Xs.log.ERROR(t),Bs(Ce({readyState:ft.ERROR,error:{status:-2,content:new Error(t.message||t.toString()),errorCode:mt.PARSE_CODECS},room:r.roomName})),n(new Error(t.message||t.toString()))}))}))}(e)}},{key:"enforceUserInitOptions",value:function(e){return function(e){var t=Yd.getUserInitOptions(),n=Yd.getInitOptions(),r=Object.assign(n,e,t),i=Rd(r);if(!i.isValid)throw new Error(i.message);return r=vd(r),Yd.setInitOptions(r),r}(e)}}],[{key:"parseAPIResponseBody",value:function(e){return new fd(e)}},{key:"getRoomNameFromParams",value:function(e){var t=Yd.getInitOptions(),n=e.roomName,r=t.defaultRoom;return"undefined"!==typeof n&&""!==n&&r!==n?n:r}},{key:"getStateByKey",value:function(e){return Os(e)}}]),e}(),Ad=function(e){return new Promise((function(t){var n=Yd.getSkylinkState(e.room.id),r=n.room,a=n.peerConnections,o=on.ROOM.LEAVE_ROOM,s=new Bo,d=Object.keys(Yd.getSkylinkState()).length>1;if(n.inRoom=!1,Yd.setSkylinkState(n,r.id),d)Xs.log.INFO([r.roomName,null,null,o.SENDING_BYE]),Object.keys(a).forEach((function(e){s.bye(n,e)})),t(n);else{s.config=s.resetSocketConfig(window.location.protocol);Gs(i.EVENTS.CHANNEL_CLOSE,(function e(){Xs.log.INFO([r.roomName,null,null,o.DISCONNECT_SOCKET.SUCCESS]),Fs(i.EVENTS.CHANNEL_CLOSE,e),t(n)})),s.socket.connected?s.socket.disconnect():t(n)}}))},Cd=function(e){var t=e.room,n=e.streams;n.userMedia&&Ln.prepStopStreams(t.id,null,!0),n.screenshare&&new dd(e).stop(!0)},_d=function(e){Yd.clearRoomStateFromSingletons(e),Yd.removeSkylinkState(e)},Nd=function(e){return new Promise((function(t,n){var r=e.peerConnections,a=e.peerInformations,o=e.room,s=e.hasMCU,d=e.user,c=on.ROOM.LEAVE_ROOM;try{var l=s?[en.MCU]:Array.from(new Set([].concat(Object(Sd.a)(Object.keys(r)),Object(Sd.a)(Object.keys(a)))));if(Ss(l))Xs.log.DEBUG([o.roomName,null,null,c.NO_PEERS]),Cd(e),Ad(e).then((function(e){Xs.log.INFO([o.roomName,null,null,c.REMOVE_STATE.SUCCESS]),Bs(Pe({peerId:d.sid,peerInfo:Hn.getCurrentSessionInfo(o),isSelf:!0,room:o})),_d(e.room.id),t(e.room.roomName)}));else{var u=[];l.forEach((function(t){u.push(function(e,t){return new Promise((function(n){var r=e.room,a=e.peerConnections,o=on.ROOM.LEAVE_ROOM,s=Yd.getInitOptions().enableDataChannel;Xs.log.INFO([t,r.roomName,null,o.PEER_LEFT.START]),t===en.MCU?Bs(be({peerId:t,serverPeerType:st.MCU,room:r})):Bs(Pe({peerId:t,peerInfo:Hn.getCurrentSessionInfo(r),isSelf:!1,room:r})),a[t]&&a[t].signalingState!==at.CLOSED&&od.closePeerConnection(e,t),s?(Gs(i.EVENTS.DATA_CHANNEL_STATE,(function(e){var t=e.detail;t.state!==Ye.CLOSED&&t.state!==Ye.CLOSING||(Xs.log.INFO([t.peerId,r.roomName,null,o.PEER_LEFT.SUCCESS]),n(t.peerId))})),od.closeDataChannel(e,t)):n(t)}))}(e,t))})),Promise.all(u).then((function(){return Cd(e),Ad(e)})).then((function(e){Xs.log.INFO([o.roomName,null,null,c.REMOVE_STATE.SUCCESS]),Bs(Pe({peerId:d.sid,peerInfo:Hn.getCurrentSessionInfo(o),isSelf:!0,room:o})),_d(e.room.id),t(e.room.roomName)}))}}catch(S){Xs.log.ERROR([o.roomName,null,null,c.ERROR],S),n(S)}}))},Dd=function(e){function t(){var e;Object(o.a)(this,t),e=Object(d.a)(this,Object(c.a)(t).call(this));var n=window,r=n.AdapterJS,i=n.navigator;return e.model={client_id:null,appKey:null,timestamp:null,username:null,sdk_name:qt.WEB,sdk_version:null,agent_name:r.webrtcDetectedBrowser,agent_version:r.webrtcDetectedVersion,agent_platform:i.platform,agent_plugin_version:r.WebRTCPlugin.plugin&&r.WebRTCPlugin.plugin.VERSION||null,device_version:null,enumerated_devices:null,device_muted:null,network_type:i.connection?i.connection.type:"-",language:i.language},e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"send",value:function(e){var t=Yd.getSkylinkState(e);this.model.username=t.user&&t.user.uid||null,this.model.sdk_version=t.VERSION,this.model.client_id=t.clientId,this.model.appKey=Yd.getInitOptions().appKey,this.model.timestamp=(new Date).toISOString(),this.postStats(this.endpoints.client,this.model)}}]),t}(Qn),yd=function e(t){Object(o.a)(this,e),this.dataChannels={},this.dataTransfers={},this.dataStreams={},this.peerCandidatesQueue={},this.peerEndOfCandidatesCounter={},this.gatheredCandidates={},this.retryCounters={},this.peerConnections={},this.peerStats={},this.peerBandwidth={},this.peerCustomConfigs={},this.peerInformations={},this.user=t.user,this.userData="",this.peerPriorityWeight=0,this.autoIntroduce=t.autoIntroduce,this.isPrivileged=t.isPrivileged,this.selectedRoom=null,this.roomLocked=!1,this.inRoom=!1,this.timestamp={socketMessage:null,shareScreen:null,refreshConnection:null,getUserMedia:null,lastRestart:null},this.socketSession={},this.socketMessageQueue=[],this.socketMessageTimeout=null,this.socketPorts=t.socketPorts,this.channelOpen=!1,this.socketServer=t.socketServer,this.signalingServerProtocol=t.forceSSL?"https:":window.location.protocol,this.signalingServerPort=null,this.socket=null,this.socketUseXDR=!1,this.enableIceRestart=!1,this.hasMCU=t.hasMCU,this.path=null,this.key=t.key,this.appKeyOwner=t.appKeyOwner,this.room=t.room,this.peerMessagesStamps={},this.streams={userMedia:null,screenshare:null},this.streamsDefaultSettings={userMedia:{audio:{stereo:!1},video:{resolution:{width:640,height:480},frameRate:50}},screenshare:{video:!0}},this.streamsMutedSettings={},this.streamsBandwidthSettings={googleX:{},bAS:{}},this.sdpSettings={connection:{audio:!0,video:!0,data:!0},direction:{audio:{send:!0,receive:!0},video:{send:!0,receive:!0}}},this.publishOnly=!1,this.recordings={},this.currentRecordingId=!1,this.recordingStartInterval=null,this.currentCodecSupport=null,this.sdpSessions={},this.voiceActivityDetection=!0,this.binaryChunkType=Qe.ARRAY_BUFFER,this.peerConnectionConfig={},this.bandwidthAdjuster=null,this.peerConnStatus={},this.joinRoomManager={timestamp:0,socketsFn:[]},this.statIdRandom=Date.now()+Math.floor(1e8*Math.random()),this.rtmpSessions={},this.SMProtocolVersion=Tt,this.DTProtocolVersion=qe,this.originalDTLSRole=null,this.bufferedLocalOffer={},this.bufferedRemoteOffers={},this.currentRTCRTPSenders={},this.clientId=_s(),this.streamsMediaStatus={},this.peerMedias={},this.remoteStreams={},this.hasPersistentMessage=t.hasPersistentMessage},Md=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return new Promise((function(n,r){var i=window,a=i.navigator,o=i.AdapterJS,s=new Td,d=new Bo,c=Yd.getInitOptions(),l=new Dd,u=Td.getRoomNameFromParams(e)?Td.getRoomNameFromParams(e):c.defaultRoom;Bs(Ce({readyState:ft.LOADING,error:null,room:u})),s.createRoom(u).then((function(i){var S=i.endpoint,E=i.response;E.roomName=u;var g=new fd(E);c=s.enforceUserInitOptions(g);var p=new yd(c);p.userData=e.userData||"",p.path=S,Yd.setSkylinkState(p,u),s.checkCodecSupport(p.room.id).then((function(){return l.send(p.room.id),d.createSocket(E.room_key).then((function(){var i=Td.getStateByKey(E.room_key),s=Object.assign({},e);s.room=i,t||e.id&&e.active?Un.usePrefetchedStream(E.room_key,t,e).then((function(){d.joinRoom(i),n(null)})).catch((function(e){r(e)})):e.audio||e.video?Un.getUserMedia(p,s).then((function(e){d.joinRoom(i),n(e)})).catch((function(e){r(e)})):(o.webrtcDetectedBrowser===$t.SAFARI?a.mediaDevices.getUserMedia({audio:!0}).then((function(){return d.joinRoom(i)})):d.joinRoom(i),n(null))}))})).catch((function(e){r(e)}))})).catch((function(e){r(e)}))}))},kd=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e,r=n.room,i=n.user,a=new Bo;n.roomLocked=t,Yd.setSkylinkState(n,r.id),a.roomLock(n),Bs(ye({isLocked:n.roomLocked,peerInfo:Hn.getCurrentSessionInfo(r),peerId:i.sid,isSelf:!0}))},Pd=function(){function e(){Object(o.a)(this,e)}return Object(s.a)(e,null,[{key:"leaveRoom",value:function(e){return Nd(e)}},{key:"leaveAllRooms",value:function(){return function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return new Promise((function(r,i){var a=on.ROOM.LEAVE_ROOM;try{var o=Yd.getSkylinkState(),s=Object.values(o);s[0]?Nd(s[0]).then((function(i){t.push(i),n.push(r),e(t,n)})):(Xs.log.INFO([t,"Room",null,a.LEAVE_ALL_ROOMS.SUCCESS]),n.forEach((function(e){return e(t)})))}catch(d){Xs.log.ERROR([null,"Room",null,a.LEAVE_ALL_ROOMS.ERROR],d),i(d)}}))}()}},{key:"lockRoom",value:function(e){return function(e){return kd(e,!0)}(e)}},{key:"unlockRoom",value:function(e){return function(e){return kd(e,!1)}(e)}},{key:"joinRoom",value:function(e){return Md(e)}}]),e}(),bd=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=new Eo;return Xs.log.ERROR(t),a.send(e.room.id,n,r,i,t),new Error(t)},wd=function(e,t){return new Promise((function(n,r){var a=e.hasMCU,o=e.currentRecordingId,s=e.recordingStartInterval,d=t?on.RECORDING.START_FAILED:on.RECORDING.STOP_FAILED;if(!a){d="".concat(d," - ").concat(on.RECORDING.ERRORS.MCU_NOT_CONNECTED);var c=t?on.STATS_MODULE.HANDLE_RECORDING_STATS.ERROR_NO_MCU_START:on.STATS_MODULE.HANDLE_RECORDING_STATS.ERROR_NO_MCU_STOP;r(bd(e,d,c,null,null))}t&&o&&r(bd(e,"".concat(d," - ").concat(on.RECORDING.ERRORS.EXISTING_RECORDING_IN_PROGRESS),on.STATS_MODULE.HANDLE_RECORDING_STATS.ERROR_START_ACTIVE,o,null));t||o||r(bd(e,"".concat(d," - ").concat(on.RECORDING.ERRORS.NO_RECORDING_IN_PROGRESS),on.STATS_MODULE.HANDLE_RECORDING_STATS.ERROR_STOP_ACTIVE,o,null));!t&&s&&r(bd(e,"".concat(d," - ").concat(on.RECORDING.ERRORS.MIN_RECORDING_TIME),on.STATS_MODULE.HANDLE_RECORDING_STATS.ERROR_MIN_STOP,o,null));!function(e,t){Gs(i.EVENTS.RECORDING_STATE,(function n(r){var a=r.detail,o=t?i.RECORDING_STATE.START:i.RECORDING_STATE.STOP;a.state===o&&(Fs(i.EVENTS.RECORDING_STATE,n),e(a.recordingId))}))}(n,t),function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=new Bo,a=new Eo;r.recording(e.room.id,t?i.SIG_MESSAGE_TYPE.START_RECORDING:i.SIG_MESSAGE_TYPE.STOP_RECORDING),a.send(e.room.id,t?on.STATS_MODULE.HANDLE_RECORDING_STATS.REQUEST_START:on.STATS_MODULE.HANDLE_RECORDING_STATS.REQUEST_STOP,n,null,null)}(e,t,o)}))},Ld=function(e){return wd(e,!0)},Ud=function(e){return wd(e,!1)},Gd=function(){function e(){Object(o.a)(this,e)}return Object(s.a)(e,null,[{key:"start",value:function(){return Ld.apply(void 0,arguments)}},{key:"stop",value:function(){return Ud.apply(void 0,arguments)}},{key:"getRecordings",value:function(e){var t=e.recordings;return Object.assign({},t)}}]),e}(),Fd={checkRTMPDependencies:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i={shouldProceed:!0,errorMessage:""},a=t.hasMCU;return a?e&&!n?(i.errorMessage=on.RTMP.start_no_stream_id,i.shouldProceed=!1,i):e&&!r?(i.errorMessage=on.RTMP.start_no_endpoint,i.shouldProceed=!1,i):i:(i.errorMessage=e?on.RTMP.start_no_mcu:on.RTMP.stop_no_mcu,i.shouldProceed=!1,i)},registerRTMPEventListenersAndResolve:function(e,t){Gs(i.EVENTS.RTMP_STATE,(function n(r){var a=r.detail,o=e?i.RTMP_STATE.START:i.RTMP_STATE.STOP;a.state===o&&(Fs(i.EVENTS.RTMP_STATE,n),t(a.rtmpId))}))},sendRTMPMessageViaSig:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=e.room,o=e.user,s=new Bo,d=t?Ut.START_RTMP:Ut.STOP_RTMP;s.rtmp(d,a.id,o.sid,n,r,i)}},Bd=function(){function e(){Object(o.a)(this,e)}return Object(s.a)(e,null,[{key:"startSession",value:function(e,t,n){return this.commonRTMPOperations(e,t,null,n,!0,on.RTMP.starting_rtmp)}},{key:"stopSession",value:function(e,t){return this.commonRTMPOperations(e,null,t,null,!1,on.RTMP.stopping_rtmp)}},{key:"logErrorAndReject",value:function(e,t){Xs.log.ERROR(e),t(e)}},{key:"commonRTMPOperations",value:function(e,t,n,r,i,a){var o=this;return new Promise((function(s,d){try{var c=Fd.checkRTMPDependencies(i,e,t,r),l=n||_s();c.shouldProceed?(Fd.registerRTMPEventListenersAndResolve(i,s),Fd.sendRTMPMessageViaSig(e,i,l,t,r),Xs.log.INFO([en.MCU,"RTMP",a])):o.logErrorAndReject(new Error(c.errorMessage),d)}catch(u){o.logErrorAndReject(u,d)}}))}}]),e}(),jd=function(){function e(){Object(o.a)(this,e)}return Object(s.a)(e,[{key:"joinRoom",value:function(){var e,t,n=arguments;return f.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return e=n.length>0&&void 0!==n[0]?n[0]:{},t=n.length>1?n[1]:void 0,r.abrupt("return",Pd.joinRoom(e,t));case 3:case"end":return r.stop()}}))}},{key:"sendP2PMessage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";od.sendP2PMessage(e,t,n)}},{key:"sendMessage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";xr.sendMessage(e,t,n)}},{key:"getStoredMessages",value:function(e){var t=Ts(e);t&&new jr(t).getStoredMessages()}},{key:"getPeersInRoom",value:function(e){return vs(e,"roomName","getPeersInRoom")?od.getPeersInRoom(e):null}},{key:"getPeerInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=Ts(e);return t&&n?Hn.getPeerInfo(t,n.room):!t&&n?Hn.getCurrentSessionInfo(n.room):null}},{key:"getUserData",value:function(e,t){var n=Ts(e);return n&&n.room?Hn.getUserData(n,t):null}},{key:"setUserData",value:function(e,t){var n=Ts(e);return n&&n.room?Hn.setUserData(n.room,t):null}},{key:"getConnectionStatus",value:function(e,t){var n=Ts(e);return od.getConnectionStatus(n,t)}},{key:"getPeers",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Ts(e);return n?ud.getPeerList(n.room,t):null}},{key:"getPeersStreams",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Ts(e);return n?Hn.getPeersStreams(n,t):null}},{key:"getPeersDataChannels",value:function(e){var t=Ts(e);return t?Hn.getPeersDataChannels(t):null}},{key:"getPeersCustomSettings",value:function(e){var t=Ts(e);return t?Hn.getPeersCustomSettings(t):null}},{key:"refreshDatachannel",value:function(e,t){var n=Ts(e);return n?od.refreshDataChannel(n,t):null}},{key:"refreshConnection",value:function(e,t,n,r){var i=Ts(e);return od.refreshConnection(i,t,n,r)}},{key:"shareScreen",value:function(e,t){var n=Ts(e);return n?new dd(n).start(!1,t):null}},{key:"getPeersScreenshare",value:function(e){var t=Ts(e);return t?od.getPeerScreenshare(t):null}},{key:"getUserMedia",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;if(!e)return Ns(t);if(hs(e)){var n=Ts(e);if(n)return Un.getUserMediaLayer(n,t)}else if(gs(e))return Ns(e)}},{key:"stopPrefetchedStream",value:function(e){return e&&(e.getTracks().forEach((function(e){e.stop()})),Bs(ve({room:null,peerId:null,peerInfo:null,isSelf:!0,isScreensharing:!1,streamId:e.id}))),null}},{key:"stopScreen",value:function(e){var t=Ts(e);t&&new dd(t).stop();return null}},{key:"stopStreams",value:function(e,t){var n=Ts(e);return n?Un.stopStreams(n,t):null}},{key:"leaveRoom",value:function(e){var t=Ts(e);return t?Pd.leaveRoom(t):null}},{key:"leaveAllRooms",value:function(){return Pd.leaveAllRooms()}},{key:"startRecording",value:function(e){var t=Ts(e);return t?Gd.start(t):null}},{key:"stopRecording",value:function(e){var t=Ts(e);return t?Gd.stop(t):null}},{key:"lockRoom",value:function(e){var t=Ts(e);return t?Pd.lockRoom(t):null}},{key:"unlockRoom",value:function(e){var t=Ts(e);return t?Pd.unlockRoom(t):null}},{key:"getRecordings",value:function(e){var t=Ts(e);return t?Gd.getRecordings(t):null}},{key:"muteStreams",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{audioMuted:!0,videoMuted:!0},n=arguments.length>2?arguments[2]:void 0,r=Ts(e);return r?Un.muteStreams(r,t,n):null}},{key:"startRTMPSession",value:function(e,t,n){var r=Ts(e);return r?Bd.startSession(r,t,n):null}},{key:"stopRTMPSession",value:function(e,t){var n=Ts(e);return n?Bd.stopSession(n,t):null}},{key:"getStreamSources",value:function(){return Un.getStreamSources()}},{key:"sendStream",value:function(e,t){var n=Ts(e);return Un.sendStream(n,t)}},{key:"getScreenSources",value:function(){return Un.getScreenSources()}},{key:"getStreams",value:function(e){var t=Ts(e);return t?Un.getStreams(t):null}},{key:"generateUUID",value:function(){return _s()}},{key:"setEncryptSecret",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=Ts(e),i=new br(r);return i.setEncryptSecret(t,n)}},{key:"getEncryptSecrets",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=Ts(e),n=new br(t);return n.getEncryptSecrets()}},{key:"deleteEncryptSecrets",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=Ts(e),r=new br(n);return r.deleteEncryptSecrets(t)}},{key:"setSelectedSecret",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=Ts(e),r=new br(n);r.setSelectedSecretId(t)}},{key:"getSelectedSecret",value:function(e,t){var n=Ts(e);return new br(n).getSelectedSecretId(t)}},{key:"setMessagePersistence",value:function(e,t){var n=Ts(e);return new jr(n).setMessagePersistence(t)}},{key:"getMessagePersistence",value:function(e){var t=Ts(e);return new jr(t).getMessagePersistence()}}]),e}();n.d(t,"c",(function(){return Wd})),n.d(t,"d",(function(){return Xs})),n.d(t,"b",(function(){return js})),n.d(t,"a",(function(){return i})),window.AdapterJS=g,window.io=S.a;var Vd=new ld,xd={},Hd={},Wd=an,Kd=function(e){function t(e){var n;Object(o.a)(this,t),n=Object(d.a)(this,Object(c.a)(t).call(this));var r=(new Td).init(e);return t.setInitOptions(r),n}return Object(l.a)(t,e),Object(s.a)(t,null,[{key:"getSkylinkState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e?Vd.getState(e):Vd.getAllStates()}},{key:"setSkylinkState",value:function(e,t){t&&Vd.setState(e)}},{key:"removeSkylinkState",value:function(e){if(e)return Vd.removeStateByRoomId(e)}},{key:"clearRoomStateFromSingletons",value:function(e){if(e)return Vd.clearRoomStateFromSingletons(e)}},{key:"getInitOptions",value:function(){return xd}},{key:"setInitOptions",value:function(e){xd=e}},{key:"setUserInitOptions",value:function(e){Hd=e}},{key:"getUserInitOptions",value:function(){return Hd}},{key:"logNoRoomState",value:function(e){Xs.log.ERROR("".concat(on.ROOM_STATE.NOT_FOUND," - ").concat(e))}}]),t}(jd),Yd=t.e=Kd}},[[281,1,2]]]);
//# sourceMappingURL=main.7aead312.chunk.js.map